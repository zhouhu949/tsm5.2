<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.qftx.tsm.cust.dao.ResCustInfoMapper">
    <!-- 基础结果集 -->
	<resultMap type="com.qftx.tsm.cust.bean.ResCustInfoBean" id="BaseResultMap">
		<id column="RES_CUST_ID" property="resCustId" jdbcType="VARCHAR" />
		<result column="NAME" property="name" jdbcType="VARCHAR" />
		<result column="MOBILEPHONE" property="mobilephone" jdbcType="VARCHAR" />
		<result column="TELPHONE" property="telphone" jdbcType="VARCHAR" />
		<result column="COMPANY" property="company" jdbcType="VARCHAR" />
		<result column="DUTY" property="duty" jdbcType="VARCHAR" />
		<result column="SEX" property="sex" jdbcType="DECIMAL" />
		<result column="COMPANY_ADDR" property="companyAddr" jdbcType="VARCHAR" />
		<result column="COMPANY_ORG" property="companyOrg" jdbcType="VARCHAR" />
		<result column="REMARK" property="remark" jdbcType="VARCHAR" />
		<result column="TYPE" property="type" jdbcType="DECIMAL" />
		<result column="IS_DEL" property="isDel" jdbcType="DECIMAL" />
		<result column="RES_LAST_CALL_DATE" property="resLastCallDate" jdbcType="TIMESTAMP" />
		<result column="INPUT_DATE" property="inputDate" jdbcType="TIMESTAMP" />
		<result column="INPUT_ACC" property="inputAcc" jdbcType="VARCHAR" />
		<result column="UPDATE_DATE" property="updateDate" jdbcType="TIMESTAMP" />
		<result column="UPDATE_ACC" property="updateAcc" jdbcType="VARCHAR" />
		<result column="IS_MAJOR" property="isMajor" jdbcType="DECIMAL" />
		<result column="RES_GROUP_ID" property="resGroupId" jdbcType="VARCHAR" />
		<result column="OWNER_ACC" property="ownerAcc" jdbcType="VARCHAR" />
		<result column="OWNER_NAME" property="ownerName" jdbcType="VARCHAR" />
		<result column="STATUS" property="status" jdbcType="DECIMAL" />
		<result column="ORG_ID" property="orgId" jdbcType="VARCHAR" />
		<result column="SIGN_DATE" property="signDate" jdbcType="TIMESTAMP" />
		<result column="INPUT_STATUS" property="inputStatus" jdbcType="DECIMAL" />
		<result column="OWNER_START_DATE" property="ownerStartDate" jdbcType="TIMESTAMP" />
		<result column="FILTER_COUNT" property="filterCount" jdbcType="DECIMAL" />
		<result column="FILTER_TYPE" property="filterType" jdbcType="DECIMAL" />
		<result column="OPREATE_TYPE" property="opreateType" jdbcType="DECIMAL" />
		<result column="COORDINATES" property="coordinates" jdbcType="VARCHAR" />
		<result column="FAX" property="fax" jdbcType="VARCHAR" />
		<result column="EMAIL" property="email" jdbcType="VARCHAR" />
		<result column="UNITHOME" property="unithome" jdbcType="VARCHAR" />
		<result column="UNITINTRODUCTION" property="unitintroduction" jdbcType="VARCHAR" />
		<result column="AMOYTOCUSTOMER_DATE" property="amoytocustomerDate" jdbcType="TIMESTAMP" />
		<result column="QQ" property="qq" jdbcType="VARCHAR" />
		<result column="KEYWORD" property="keyWord" jdbcType="VARCHAR" />
		<result column="CONTRACT_NUMBER" property="contractNumber" jdbcType="VARCHAR" />
		<result column="DEFINED1" property="defined1" jdbcType="VARCHAR" />
		<result column="DEFINED2" property="defined2" jdbcType="VARCHAR" />
		<result column="DEFINED3" property="defined3" jdbcType="VARCHAR" />
		<result column="DEFINED4" property="defined4" jdbcType="VARCHAR" />
		<result column="SIGN_ACC" property="signAcc" jdbcType="VARCHAR" />
		<result column="SIGN_NAME" property="signName" jdbcType="VARCHAR" />
		<result column="NEXTFOLLOW_DATE" property="nextFollowDate" jdbcType="TIMESTAMP" />
		<result column="BIRTHDAY" property="birthday" jdbcType="TIMESTAMP" />
		<result column="CALL_DATE_POSTPONED" property="callDatePostponed" jdbcType="TIMESTAMP" />
		<result column="REASON_FOR_CALLDELAY" property="reasonForCalldelay" jdbcType="VARCHAR" />
		<result column="DEFINED5" property="defined5" jdbcType="VARCHAR" />
		<result column="ALTERNATE_PHONE2" property="alternatePhone2" jdbcType="VARCHAR" />
		<result column="RECUCLING_TYPE_DETAILS" property="recuclingTypeDetails" jdbcType="VARCHAR" />
		<result column="AGAINWASH_COUNT" property="againwashCount" jdbcType="DECIMAL" />
		<result column="ACTION_DATE" property="actionDate" jdbcType="TIMESTAMP" />
		<result column="LAST_CUST_FOLLOW_ID" property="lastCustFollowID" jdbcType="VARCHAR" />
		<result column="SERVICE_ACC" jdbcType="VARCHAR" property="serviceAcc" />
		<result column="SERVICE_NAME" jdbcType="VARCHAR" property="serviceName" />
		<result column="SERVICE_LEVEL" jdbcType="VARCHAR" property="serviceLevel" />
		<result column="VISITING_DATE" jdbcType="TIMESTAMP" property="visitingDate" />
		<result column="NEXT_VISITING_DATE" jdbcType="TIMESTAMP" property="nextVisitingDate" />
		<result column="SERVICE_LABEL_CODE" jdbcType="VARCHAR" property="serviceLabelCode" />
		<result column="SERVICE_LABEL_NAME" jdbcType="VARCHAR" property="serviceLabelName" />
		<result column="IS_PRECEDENCE" jdbcType="DECIMAL" property="isPrecedence" />
		<result column="FOR_THE_CUSTOMER_TIME" jdbcType="TIMESTAMP" property="forTheCustomerTime" />
		<result column="LAST_VISIT_ACC" jdbcType="VARCHAR" property="lastVisitAcc" />
		<!-- 4.0新增 -->
		<result column="STATE" jdbcType="DECIMAL" property="state"/>
		<result column="PLAN_DATE" jdbcType="TIMESTAMP" property="planDate"/>
		<result column="ADDRESS" jdbcType="VARCHAR" property="address"/>
		<result column="COMPANY_MONEY" jdbcType="VARCHAR" property="companyMoney"/>
		<result column="COMPANY_USER" jdbcType="VARCHAR" property="companyUser"/>
		<result column="COMPANY_TRADE" jdbcType="VARCHAR" property="companyTrade"/>
		<result column="COMPANY_FAX" jdbcType="VARCHAR" property="companyFax"/>
		<result column="LOSING_ID" jdbcType="VARCHAR" property="losingId"/>
		<result column="LOSING_REMARK" jdbcType="VARCHAR" property="losingRemark"/>
		<result column="PROVINCE_ID" jdbcType="DECIMAL" property="provinceId"/>
		<result column="CITY_ID" jdbcType="DECIMAL" property="cityId"/>
		<result column="COUNTY_ID" jdbcType="DECIMAL" property="countyId"/>
		<result column="LAST_LOG_ID" jdbcType="VARCHAR" property="lastLogId"/>
		<result column="WANGWANG" jdbcType="VARCHAR" property="wangwang"/>
		<result column="SCOPE" jdbcType="VARCHAR" property="scope"/>
		<result column="MAIN_LINKMAN" jdbcType="VARCHAR" property="mainLinkman"/>
		<result column="DEFINED6" property="defined6" jdbcType="VARCHAR" />
		<result column="DEFINED7" property="defined7" jdbcType="VARCHAR" />
		<result column="DEFINED8" property="defined8" jdbcType="VARCHAR" />
		<result column="DEFINED9" property="defined9" jdbcType="VARCHAR" />
		<result column="DEFINED10" property="defined10" jdbcType="VARCHAR" />
	    <result column="TAO_NO" property="taoNo" jdbcType="DECIMAL" />
	    <result column="SIGN_BEFORE_STATUS" property="signBeforeStatus" jdbcType="DECIMAL" />
	    <result column="SIGN_BEFORE_TYPE" property="signBeforeType" jdbcType="DECIMAL" />
	    <result column="IMPORT_DEPT_ID" jdbcType="VARCHAR" property="importDeptId"/>
	    <result column="LIFE_CODE" jdbcType="VARCHAR" property="lifeCode"/>
	    <result column="last_Option_Id" jdbcType="VARCHAR" property="lastOptionId"/>
	    <result column="last_Loss_Date" property="lastLossDate" jdbcType="TIMESTAMP" />
	    <result column="is_Concat" jdbcType="VARCHAR" property="isConcat"/>
	    <result column="last_Cust_Type_Id" jdbcType="VARCHAR" property="lastCustTypeId"/>
	    <result column="label_Code" jdbcType="VARCHAR" property="labelCode"/>
	    <result column="label_name" jdbcType="VARCHAR" property="labelName"/>	
		<result column="DEFINED11" property="defined11" jdbcType="VARCHAR" />
		<result column="DEFINED12" property="defined12" jdbcType="VARCHAR" />
		<result column="DEFINED13" property="defined13" jdbcType="VARCHAR" />
		<result column="DEFINED14" property="defined14" jdbcType="VARCHAR" />
		<result column="DEFINED15" property="defined15" jdbcType="VARCHAR" />	
		<result column="DEFINED16" property="defined16" jdbcType="TIMESTAMP" />	
		<result column="DEFINED17" property="defined17" jdbcType="TIMESTAMP" />
		<result column="DEFINED18" property="defined18" jdbcType="TIMESTAMP" />	
		<!-- 5.0新增 -->     
		<result column="COMMON_ACC" property="commonAcc" jdbcType="VARCHAR" />	 
		<!-- 5.1新增 -->    
		<result column="SOURCE" property="source" jdbcType="DECIMAL" /> 
		<result column="OWNER_ACTION_DATE" property="ownerActionDate" jdbcType="TIMESTAMP" />  	    
	</resultMap>
	
	<resultMap type="com.qftx.tsm.cust.dto.ResCustInfoDto" id="DtoResultMap" extends="BaseResultMap">
		<result column="GROUP_NAME" property="groupName" jdbcType="VARCHAR" />
		<result column="OWNER_NAME" property="ownerName" jdbcType="VARCHAR" />
		<result column="SALE_PROCESS_NAME" property="saleProcessName" jdbcType="VARCHAR" />
		<result column="SALE_PROCESS_ID" property="saleProcessId" jdbcType="VARCHAR" />
		<result column="CUST_TYPE_ID" property="custTypeId" jdbcType="VARCHAR"/>
		<result column="CUST_TYPE_NAME" property="custTypeName" jdbcType="VARCHAR"/>
		<result column="IS_TODAY" property="isToday" jdbcType="DECIMAL"/>
		<result column="TOTAL_ORDER_AMOUNT" property="totalOrderAmount" jdbcType="DECIMAL"/>
		<result column="SILENT_DAY" property="silentDay" jdbcType="DECIMAL"/>
		<result column="CONTRACT_END_DATE" property="contractEndDate" jdbcType="TIMESTAMP" />
		<result column="LINK_MAN" property="linkMan" jdbcType="VARCHAR"/>
		<result column="INPUT_DAYS" property="inputDays" jdbcType="DECIMAL" />
		<result column="DAYS" property="days" jdbcType="DECIMAL" />
		<result column="CONTRACT_CODE" property="contractCode" jdbcType="VARCHAR"/>
		<result column="LOSING_REASON" property="losingReason" jdbcType="VARCHAR"/>
		<result column="CUST_NUMS" property="custNums" jdbcType="DECIMAL"/>
		<result column="PROC_ID" property="procId" jdbcType="VARCHAR"/>
		<result column="RES_REMARK" property="resRemark" jdbcType="VARCHAR"/>
		<result column="GIVE_UP_NAME" property="giveUpName" jdbcType="VARCHAR"/>
	</resultMap>
	
	<!-- 实体表名 -->
	<sql id="table_name">TSM_RES_CUST_INFO</sql>
	
	<!-- 实体条件查询组装 -->
	<sql id="entity_condition_orderby">
		<if test="orgId != null and orgId !=''">
			and ORG_ID = #{orgId,jdbcType=VARCHAR}
		</if>
		<if test="resCustId != null and resCustId!=''">
			and RES_CUST_ID = #{resCustId,jdbcType=VARCHAR}
		</if>
		<if test="name != null and name !=''">
			and NAME like '%'||#{name}||'%'
		</if>
		<if test="mobilephone != null and mobilephone !=''">
			and MOBILEPHONE like '%'||#{mobilephone}||'%'
		</if>
		<if test="telphone != null and telphone !=''">
			and TELPHONE like '%'||#{telphone}||'%'
		</if>
		<if test="company != null and company !=''">
			and COMPANY like '%'||#{company}||'%'
		</if>
		<if test="duty != null and duty !=''">
			and DUTY like '%'||#{duty}||'%'
		</if>
		<if test="sex != null and sex !=''">
			and SEX = #{sex,jdbcType=VARCHAR}
		</if>
		<if test="companyAddr != null and companyAddr !=''">
			and COMPANY_ADDR like '%'||#{companyAddr}||'%'
		</if>
		<if test="companyOrg != null and companyOrg !=''">
			and COMPANY_ORG like '%'||#{companyOrg}||'%'
		</if>
		<if test="remark != null and remark !=''">
			and REMARK like '%'||#{remark}||'%'
		</if>
		<if test="type != null">
			and TYPE = #{type,jdbcType=DECIMAL}
		</if>
		<if test="isDel != null">
			and IS_DEL = #{isDel,jdbcType=DECIMAL}
		</if>
		<if test="resLastCallDate != null">
			and RES_LAST_CALL_DATE =
			#{resLastCallDate,jdbcType=TIMESTAMP}
		</if>
		<if test="inputDate != null">
			and INPUT_DATE = #{resLastCallDate,jdbcType=TIMESTAMP}
		</if>
		<if test="inputAcc != null and inputAcc !=''">
			and INPUT_ACC = #{inputAcc,jdbcType=VARCHAR}
		</if>
		<if test="updateDate != null">
			and UPDATE_DATE = #{updateDate,jdbcType=TIMESTAMP}
		</if>
		<if test="updateAcc != null and updateAcc !=''">
			and UPDATE_ACC = #{updateAcc,jdbcType=VARCHAR}
		</if>
		<if test="isMajor != null">
			and IS_MAJOR = #{isMajor,jdbcType=DECIMAL}
		</if>
		<if test="resGroupId != null and resGroupId !=''">
			and RES_GROUP_ID = #{resGroupId,jdbcType=VARCHAR}
		</if>
		<if test="ownerAcc != null and ownerAcc !=''">
			and OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR}
		</if>
		<if test="status != null">
			and STATUS = #{status,jdbcType=DECIMAL}
		</if>
		<if test="signDate != null">
			and SIGN_DATE = #{signDate,jdbcType=TIMESTAMP}
		</if>
		<if test="inputStatus != null">
			and INPUT_STATUS = #{signDate,jdbcType=DECIMAL}
		</if>
		<if test="ownerStartDate != null">
			and OWNER_START_DATE =
			#{ownerStartDate,jdbcType=TIMESTAMP}
		</if>
		<if test="filterCount != null">
			and FILTER_COUNT = #{filterCount,jdbcType=DECIMAL}
		</if>
		<if test="filterType != null">
			and FILTER_TYPE = #{filterType,jdbcType=DECIMAL}
		</if>
		<if test="opreateType != null">
			and OPREATE_TYPE = #{opreateType,jdbcType=DECIMAL}
		</if>
		<if test="fax != null and fax !=''">
			and FAX = #{fax,jdbcType=VARCHAR}
		</if>
		<if test="email != null and email !=''">
			and EMAIL = #{email,jdbcType=VARCHAR}
		</if>
		<if test="unithome != null and unithome !=''">
			and UNITHOME = #{unithome,jdbcType=VARCHAR}
		</if>
		<if test="unitintroduction != null and unitintroduction !=''">
			and UNITINTRODUCTION =
			#{unitintroduction,jdbcType=VARCHAR}
		</if>
		<if test="amoytocustomerDate != null">
			and AMOYTOCUSTOMER_DATE =
			#{amoytocustomerDate,jdbcType=TIMESTAMP}
		</if>
		<if test="qq != null">
			and QQ = #{qq,jdbcType=VARCHAR}
		</if>
		<if test="keyWord != null">
			and KEYWORD = #{keyWord,jdbcType=VARCHAR}
		</if>
		<if test="contractNumber != null and contractNumber !=''">
			and CONTRACT_NUMBER like '%'||#{contractNumber}||'%'
		</if>
		<if test="defined1 != null">
			and DEFINED1 = #{defined1,jdbcType=VARCHAR}
		</if>
		<if test="defined2 != null">
			and DEFINED2 = #{defined2,jdbcType=VARCHAR}
		</if>
		<if test="defined3 != null">
			and DEFINED3 = #{defined3,jdbcType=VARCHAR}
		</if>
		<if test="defined4 != null">
			and DEFINED4 = #{defined4,jdbcType=VARCHAR}
		</if>
		<if test="defined5 != null">
			and DEFINED5 = #{defined5,jdbcType=VARCHAR}
		</if>
		<if test="defined6 != null">
			and DEFINED6 = #{defined6,jdbcType=VARCHAR}
		</if>
		<if test="defined7 != null">
			and DEFINED7 = #{defined7,jdbcType=VARCHAR}
		</if>
		<if test="defined8 != null">
			and DEFINED8 = #{defined8,jdbcType=VARCHAR}
		</if>
		<if test="defined9 != null">
			and DEFINED9 = #{defined9,jdbcType=VARCHAR}
		</if>
		<if test="defined10 != null">
			and DEFINED10 = #{defined10,jdbcType=VARCHAR}
		</if>
		<if test="defined11 != null">
			and DEFINED11 = #{defined11,jdbcType=VARCHAR}
		</if>
		<if test="defined12 != null">
			and DEFINED12 = #{defined12,jdbcType=VARCHAR}
		</if>
		<if test="defined13 != null">
			and DEFINED13 = #{defined13,jdbcType=VARCHAR}
		</if>
		<if test="defined14 != null">
			and DEFINED14 = #{defined14,jdbcType=VARCHAR}
		</if>
		<if test="defined15 != null">
			and DEFINED15 = #{defined15,jdbcType=VARCHAR}
		</if>		
		<if test="alternatePhone2 != null">
			and ALTERNATE_PHONE2 = #{alternatePhone2,jdbcType=VARCHAR}
		</if>
		<if test="signAcc != null">
			and SIGN_ACC = #{signAcc,jdbcType=VARCHAR}
		</if>
		<if test="signName != null">
			and SIGN_NAME = #{signName,jdbcType=VARCHAR}
		</if>
		<if test="nextFollowDate != null">
			and NEXTFOLLOW_DATE = #{nextFollowDate,jdbcType=VARCHAR}
		</if>
		<if test="birthday != null">
			and BIRTHDAY = #{birthday,jdbcType=VARCHAR}
		</if>
		<if test="callDatePostponed != null">
			and CALL_DATE_POSTPONED =
			#{callDatePostponed,jdbcType=TIMESTAMP}
		</if>
		<if test="reasonForCalldelay != null">
			and REASON_FOR_CALLDELAY =
			#{reasonForCalldelay,jdbcType=VARCHAR}
		</if>
		<if test="recuclingTypeDetails != null">
			and RECUCLING_TYPE_DETAILS =
			#{recuclingTypeDetails,jdbcType=VARCHAR}
		</if>
		<if test="againwashCount != null">
			and AGAINWASH_COUNT = #{againwashCount,jdbcType=DECIMAL}
		</if>
		<if test="actionDate != null">
			and ACTION_DATE = #{actionDate,jdbcType=TIMESTAMP}
		</if>
		<if test="lastCustFollowID != null">
			and LAST_CUST_FOLLOW_ID =
			#{lastCustFollowID,jdbcType=VARCHAR}
		</if>
		<if test="serviceAcc != null">
			and SERVICE_ACC = #{serviceAcc,jdbcType=VARCHAR}
		</if>
		<if test="serviceName != null">
			and SERVICE_NAME = #{serviceName,jdbcType=VARCHAR}
		</if>
		<if test="serviceLevel != null">
			and SERVICE_LEVEL = #{serviceLevel,jdbcType=VARCHAR}
		</if>
		<if test="serviceName != null">
			and VISITING_DATE = #{visitingDate,jdbcType=TIMESTAMP}
		</if>
		<if test="nextVisitingDate != null">
			and NEXT_VISITING_DATE =
			#{nextVisitingDate,jdbcType=TIMESTAMP}
		</if>
		<if test="serviceLabelCode != null">
			and SERVICE_LABEL_CODE =
			#{serviceLabelCode,jdbcType=VARCHAR}
		</if>
		<if test="serviceLabelName != null">
			and SERVICE_LABEL_NAME =
			#{serviceLabelName,jdbcType=VARCHAR}
		</if>
		<if test="isPrecedence != null">
			and IS_PRECEDENCE =
			#{isPrecedence,jdbcType=DECIMAL}
		</if>
		<if test="forTheCustomerTime != null">
			and FOR_THE_CUSTOMER_TIME =
			#{forTheCustomerTime,jdbcType=TIMESTAMP}
		</if>
		<if test="lastVisitAcc != null">
			and LAST_VISIT_ACC =
			#{lastVisitAcc,jdbcType=VARCHAR}
		</if>	
		<if test="state != null">
			and STATE = #{state,jdbcType=DECIMAL} 
		</if>	
		<if test="planDate != null">
			and PLAN_DATE = #{planDate,jdbcType=TIMESTAMP} 
		</if>
		<if test="address != null">
			and ADDRESS = #{address,jdbcType=VARCHAR} 
		</if>
		<if test="companyMoney != null">
			and COMPANY_MONEY = #{companyMoney,jdbcType=VARCHAR} 
		</if>
		<if test="companyUser != null">
			and COMPANY_USER = #{companyUser,jdbcType=VARCHAR} 
		</if>
		<if test="companyTrade != null">
			and COMPANY_TRADE = #{companyTrade,jdbcType=VARCHAR} 
		</if>
		<if test="companyFax != null">
			and COMPANY_FAX = #{companyFax,jdbcType=VARCHAR} 
		</if>
		<if test="losingId != null">
			and LOSING_ID = #{losingId,jdbcType=VARCHAR} 
		</if>
		<if test="losingRemark != null">
			and LOSING_REMARK = #{losingRemark,jdbcType=VARCHAR} 
		</if>
		<if test="provinceId != null">
			and PROVINCE_ID = #{provinceId,jdbcType=DECIMAL} 
		</if>
		<if test="cityId != null">
			and CITY_ID = #{cityId,jdbcType=DECIMAL} 
		</if>
		<if test="countyId != null">
			and COUNTY_ID = #{countyId,jdbcType=DECIMAL} 
		</if>
		<if test="lastLogId != null">
			and LAST_LOG_ID = #{lastLogId,jdbcType=VARCHAR} 
		</if>
		<if test="wangwang != null">
			and WANGWANG = #{wangwang,jdbcType=VARCHAR} 
		</if>
		<if test="scope != null">
			and SCOPE = #{scope,jdbcType=VARCHAR} 
		</if>
		<if test="mainLinkman != null">
			and MAIN_LINKMAN = #{mainLinkman,jdbcType=VARCHAR} 
		</if>
		<if test="taoNo != null">
			and tao_No = #{taoNo,jdbcType=DECIMAL} 
		</if>
		<if test="importDeptId != null">
			and IMPORT_DEPT_ID = #{importDeptId,jdbcType=VARCHAR} 
		</if>	
		<if test="lifeCode != null and lifeCode != ''">
			and LIFE_CODE = #{lifeCode,jdbcType=VARCHAR} 
		</if>
		<if test="lastOptionId != null and lastOptionId != ''">
			and last_Option_Id = #{lastOptionId,jdbcType=VARCHAR} 
		</if>	
		<if test="lastLossDate != null">
			and last_Loss_Date = #{lastLossDate,jdbcType=TIMESTAMP} 
		</if>		
		<if test="isConcat != null">
			and is_Concat = #{isConcat,jdbcType=VARCHAR} 
		</if>	
		<if test="lastCustTypeId != null">
			and last_Cust_Type_Id = #{lastCustTypeId,jdbcType=VARCHAR} 
		</if>
		<if test="labelCode != null">
			and label_Code = #{labelCode,jdbcType=VARCHAR} 
		</if>
		<if test="labelName != null">
			and label_name = #{labelName,jdbcType=VARCHAR} 
		</if>						
	</sql>
	<!-- 修改实体对应set语句 -->
	<sql id="trents_update_set_sql">
		<trim prefix="set" suffixOverrides=",">
			<if test="name != null">
				NAME = #{name,jdbcType=VARCHAR},
			</if>
			<if test="mobilephone != null">
				MOBILEPHONE = #{mobilephone,jdbcType=VARCHAR},
			</if>
			<if test="telphone != null">
				TELPHONE = #{telphone,jdbcType=VARCHAR},
			</if>
			<if test="company != null">
				COMPANY = #{company,jdbcType=VARCHAR},
			</if>
			<if test="duty != null">
				DUTY = #{duty,jdbcType=VARCHAR},
			</if>
			<if test="sex != null">
				SEX = #{sex,jdbcType=VARCHAR},
			</if>
			<if test="companyAddr != null">
				COMPANY_ADDR = #{companyAddr,jdbcType=VARCHAR},
			</if>
			<if test="companyOrg != null">
				COMPANY_ORG = #{companyOrg,jdbcType=VARCHAR},
			</if>
			<if test="remark != null">
				REMARK = #{remark,jdbcType=VARCHAR},
			</if>
			<if test="type != null">
				TYPE = #{type,jdbcType=DECIMAL},
			</if>
			<if test="isDel != null">
				IS_DEL = #{isDel,jdbcType=DECIMAL},
			</if>
			<if test="resLastCallDate != null">
				RES_LAST_CALL_DATE = #{resLastCallDate,jdbcType=TIMESTAMP},
			</if>
			<if test="inputDate != null">
				INPUT_DATE = #{inputDate,jdbcType=TIMESTAMP},
			</if>
			<if test="inputAcc != null">
				INPUT_ACC = #{inputAcc,jdbcType=VARCHAR},
			</if>
			<if test="updateDate != null">
				UPDATE_DATE = #{updateDate,jdbcType=TIMESTAMP},
			</if>
			<if test="updateAcc != null">
				UPDATE_ACC = #{updateAcc,jdbcType=VARCHAR},
			</if>
			<if test="isMajor != null">
				IS_MAJOR = #{isMajor,jdbcType=DECIMAL},
			</if>
			<if test="resGroupId != null">
				RES_GROUP_ID = #{resGroupId,jdbcType=VARCHAR},
			</if>
			<if test="ownerAcc != null">
				OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR},
			</if>
			<if test="status != null">
				STATUS = #{status,jdbcType=DECIMAL},
			</if>
			<if test="signDate != null">
				SIGN_DATE = #{signDate,jdbcType=TIMESTAMP},
			</if>
			<if test="inputStatus != null">
				INPUT_STATUS = #{inputStatus,jdbcType=DECIMAL},
			</if>
			<if test="status != null and status == 4">
				OWNER_START_DATE = null,
			</if>
			<if test="ownerStartDate != null and status != 4">
				OWNER_START_DATE = #{ownerStartDate,jdbcType=TIMESTAMP},
			</if>
			<if test="filterCount != null">
				FILTER_COUNT = #{filterCount,jdbcType=DECIMAL},
			</if>
			<if test="filterType != null">
				FILTER_TYPE = #{filterType,jdbcType=DECIMAL},
			</if>
			<if test="opreateType != null">
				OPREATE_TYPE = #{opreateType,jdbcType=DECIMAL},
			</if>
			<if test="fax != null">
				FAX = #{fax,jdbcType=VARCHAR},
			</if>
			<if test="email != null">
				EMAIL = #{email,jdbcType=VARCHAR},
			</if>
			<if test="unithome != null">
				UNITHOME = #{unithome,jdbcType=VARCHAR},
			</if>
			<if test="unitintroduction != null">
				UNITINTRODUCTION = #{unitintroduction,jdbcType=VARCHAR},
			</if>
			<if test="amoytocustomerDate != null">
				AMOYTOCUSTOMER_DATE = #{amoytocustomerDate,jdbcType=TIMESTAMP},
			</if>
			<if test="qq != null">
				QQ = #{qq,jdbcType=VARCHAR},
			</if>
			<if test="keyWord != null">
				KEYWORD = #{keyWord,jdbcType=VARCHAR},
			</if>
			<if test="contractNumber != null">
				CONTRACT_NUMBER = #{contractNumber,jdbcType=VARCHAR},
			</if>
			<if test="defined1 != null">
				DEFINED1 = #{defined1,jdbcType=VARCHAR},
			</if>
			<if test="defined2 != null">
				DEFINED2 = #{defined2,jdbcType=VARCHAR},
			</if>
			<if test="defined3 != null">
				DEFINED3 = #{defined3,jdbcType=VARCHAR},
			</if>
			<if test="defined4 != null">
				DEFINED4 = #{defined4,jdbcType=VARCHAR},
			</if>
			<if test="defined5 != null">
				DEFINED5 = #{defined5,jdbcType=VARCHAR},
			</if>
			<if test="defined6 != null">
				DEFINED6 = #{defined6,jdbcType=VARCHAR},
			</if>
			<if test="defined7 != null">
				DEFINED7 = #{defined7,jdbcType=VARCHAR},
			</if>
			<if test="defined8 != null">
				DEFINED8 = #{defined8,jdbcType=VARCHAR},
			</if>
			<if test="defined9 != null">
				DEFINED9 = #{defined9,jdbcType=VARCHAR},
			</if>
			<if test="defined10 != null">
				DEFINED10 = #{defined10,jdbcType=VARCHAR},
			</if>
			<if test="defined11 != null">
				DEFINED11 = #{defined11,jdbcType=VARCHAR},
			</if>
			<if test="defined12 != null">
				DEFINED12 = #{defined12,jdbcType=VARCHAR},
			</if>
			<if test="defined13 != null">
				DEFINED13 = #{defined13,jdbcType=VARCHAR},
			</if>
			<if test="defined14 != null">
				DEFINED14 = #{defined14,jdbcType=VARCHAR},
			</if>
			<if test="defined15 != null">
				DEFINED15 = #{defined15,jdbcType=VARCHAR},
			</if>	
			<if test="defined16 != null">
				DEFINED16 = #{defined16,jdbcType=TIMESTAMP},
			</if>		
			<if test="defined17 != null">
				DEFINED17 = #{defined17,jdbcType=TIMESTAMP},
			</if>		
			<if test="defined18 != null">
				DEFINED18 = #{defined18,jdbcType=TIMESTAMP},
			</if>		
			<if test="alternatePhone2 != null">
				ALTERNATE_PHONE2 = #{alternatePhone2,jdbcType=VARCHAR},
			</if>
			<if test="signAcc != null">
				SIGN_ACC = #{signAcc,jdbcType=VARCHAR},
			</if>
			<if test="signName != null">
				SIGN_NAME = #{signName,jdbcType=VARCHAR},
			</if>
			<if test="nextFollowDate != null">
				NEXTFOLLOW_DATE = #{nextFollowDate,jdbcType=VARCHAR},
			</if>		
			<if test="lastCustFollowID != null">
				LAST_CUST_FOLLOW_ID = #{lastCustFollowID,jdbcType=VARCHAR},
			</if>
			<if test="serviceAcc != null">
				SERVICE_ACC = #{serviceAcc,jdbcType=VARCHAR},
			</if>
			<if test="serviceName != null">
				SERVICE_NAME = #{serviceName,jdbcType=VARCHAR},
			</if>
			<if test="serviceLevel != null">
				SERVICE_LEVEL = #{serviceLevel,jdbcType=VARCHAR},
			</if>
			<if test="birthday != null">
				BIRTHDAY = #{birthday,jdbcType=TIMESTAMP},
			</if>		
			<if test="callDatePostponed != null">
				CALL_DATE_POSTPONED = #{callDatePostponed,jdbcType=TIMESTAMP},
			</if>
			<if test="reasonForCalldelay != null">
				REASON_FOR_CALLDELAY = #{reasonForCalldelay,jdbcType=VARCHAR},
			</if>
			<if test="recuclingTypeDetails != null">
				RECUCLING_TYPE_DETAILS = #{recuclingTypeDetails,jdbcType=VARCHAR},
			</if>
			<if test="againwashCount != null">
				AGAINWASH_COUNT = #{againwashCount,jdbcType=DECIMAL},
			</if>
			<if test="actionDate != null">
				ACTION_DATE = #{actionDate,jdbcType=TIMESTAMP},
			</if>
			<if test="visitingDate != null">
				VISITING_DATE = #{visitingDate,jdbcType=TIMESTAMP},
			</if>
			<if test="nextVisitingDate != null">
				NEXT_VISITING_DATE = #{nextVisitingDate,jdbcType=TIMESTAMP},
			</if>
			<if test="serviceLabelCode != null">
				SERVICE_LABEL_CODE = #{serviceLabelCode,jdbcType=VARCHAR},
			</if>
			<if test="serviceLabelName != null">
				SERVICE_LABEL_NAME = #{serviceLabelName,jdbcType=VARCHAR},
			</if>
			<if test="isPrecedence != null">
				IS_PRECEDENCE = #{isPrecedence,jdbcType=DECIMAL},
			</if>
			<if test="forTheCustomerTime != null">
				FOR_THE_CUSTOMER_TIME = #{forTheCustomerTime,jdbcType=TIMESTAMP},
			</if>
			<if test="lastVisitAcc != null">
				LAST_VISIT_ACC = #{lastVisitAcc,jdbcType=VARCHAR},
			</if>	
			<if test="state != null">
				STATE = #{state,jdbcType=DECIMAL},
			</if>
			<if test="planDate != null">
				PLAN_DATE = #{planDate,jdbcType=TIMESTAMP}, 
			</if>
			<if test="address != null">
				ADDRESS = #{address,jdbcType=VARCHAR}, 
			</if>
			<if test="companyMoney != null">
				COMPANY_MONEY = #{companyMoney,jdbcType=VARCHAR}, 
			</if>
			<if test="companyUser != null">
				COMPANY_USER = #{companyUser,jdbcType=VARCHAR}, 
			</if>
			<if test="companyTrade != null">
				COMPANY_TRADE = #{companyTrade,jdbcType=VARCHAR}, 
			</if>
			<if test="companyFax != null">
				COMPANY_FAX = #{companyFax,jdbcType=VARCHAR}, 
			</if>
			<if test="losingId != null">
				LOSING_ID = #{losingId,jdbcType=VARCHAR}, 
			</if>
			<if test="losingRemark != null">
				LOSING_REMARK = #{losingRemark,jdbcType=VARCHAR}, 
			</if>	
			<if test="provinceId != null">
				PROVINCE_ID = #{provinceId,jdbcType=DECIMAL},
			</if>
			<if test="cityId != null">
				CITY_ID = #{cityId,jdbcType=DECIMAL},
			</if>
			<if test="countyId != null">
				COUNTY_ID = #{countyId,jdbcType=DECIMAL},
			</if>
			<if test="lastLogId != null">
				LAST_LOG_ID = #{lastLogId,jdbcType=VARCHAR}, 
			</if>	
			<if test="wangwang != null">
				WANGWANG = #{wangwang,jdbcType=VARCHAR},
			</if>
			<if test="scope != null">
				SCOPE = #{scope,jdbcType=VARCHAR},
			</if>
			<if test="mainLinkman != null">
				MAIN_LINKMAN = #{mainLinkman,jdbcType=VARCHAR},
			</if>
			<if test="taoNo != null">
				 tao_No = #{taoNo,jdbcType=DECIMAL} ,
			</if>	
			<if test="signBeforeStatus != null">
				 SIGN_BEFORE_STATUS = #{signBeforeStatus,jdbcType=DECIMAL} ,
			</if>
			<if test="signBeforeType != null">
				 SIGN_BEFORE_TYPE = #{signBeforeType,jdbcType=DECIMAL} ,
			</if>
			<if test="importDeptId != null">
				 IMPORT_DEPT_ID = #{importDeptId,jdbcType=VARCHAR} ,
			</if>
			<if test="lifeCode != null">
				 LIFE_CODE = #{lifeCode,jdbcType=VARCHAR},
			</if>
			<if test="lastOptionId != null">
				 last_Option_Id = #{lastOptionId,jdbcType=VARCHAR},
			</if>			
			<if test="lastLossDate != null">
				 last_Loss_Date = #{lastLossDate,jdbcType=TIMESTAMP} ,
			</if>
			<if test="isConcat != null">
				 is_Concat = #{isConcat,jdbcType=VARCHAR} ,
			</if>
			<if test="lastCustTypeId != null">
				 last_Cust_Type_Id = #{lastCustTypeId,jdbcType=VARCHAR} ,
			</if>
			<if test="labelCode != null">
				 label_Code = #{labelCode,jdbcType=VARCHAR} ,
			</if>
			<if test="labelName != null">
				 label_name = #{labelName,jdbcType=VARCHAR} ,
			</if>
			<if test="source != null">
				 source = #{source,jdbcType=DECIMAL} ,
			</if>	
			<if test="ownerActionDate != null">
				OWNER_ACTION_DATE = #{ownerActionDate,jdbcType=TIMESTAMP},
			</if>										
		</trim>
	</sql>
	
	<!-- 修改实体对应set语句【表单修改】 -->
	<sql id="form_trents_update_set_sql">
		<trim prefix="set" suffixOverrides=",">
		<if test="name != null">
			NAME = #{name,jdbcType=VARCHAR},
		</if>
		<if test="mobilephone != null">
			MOBILEPHONE = #{mobilephone,jdbcType=VARCHAR},
		</if>
		<if test="telphone != null">
			TELPHONE = #{telphone,jdbcType=VARCHAR},
		</if>
		<if test="companyAddr != null">
			COMPANY_ADDR = #{companyAddr,jdbcType=VARCHAR},
		</if>	
		<if test="address != null">
			ADDRESS = #{address,jdbcType=VARCHAR}, 
		</if>	
			COMPANY = #{company,jdbcType=VARCHAR},
			DUTY = #{duty,jdbcType=VARCHAR},
			SEX = #{sex,jdbcType=VARCHAR},			
			COMPANY_ORG = #{companyOrg,jdbcType=VARCHAR},
			REMARK = #{remark,jdbcType=VARCHAR},
			FAX = #{fax,jdbcType=VARCHAR},
			EMAIL = #{email,jdbcType=VARCHAR},		
			UNITHOME = #{unithome,jdbcType=VARCHAR},
			UNITINTRODUCTION = #{unitintroduction,jdbcType=VARCHAR},
			QQ = #{qq,jdbcType=VARCHAR},
			KEYWORD = #{keyWord,jdbcType=VARCHAR},
			DEFINED1 = #{defined1,jdbcType=VARCHAR},
			DEFINED2 = #{defined2,jdbcType=VARCHAR},
			DEFINED3 = #{defined3,jdbcType=VARCHAR},
			DEFINED4 = #{defined4,jdbcType=VARCHAR},
			DEFINED5 = #{defined5,jdbcType=VARCHAR},
			DEFINED6 = #{defined6,jdbcType=VARCHAR},
			DEFINED7 = #{defined7,jdbcType=VARCHAR},
			DEFINED8 = #{defined8,jdbcType=VARCHAR},
			DEFINED9 = #{defined9,jdbcType=VARCHAR},
			DEFINED10 = #{defined10,jdbcType=VARCHAR},
			DEFINED11 = #{defined11,jdbcType=VARCHAR},
			DEFINED12 = #{defined12,jdbcType=VARCHAR},
			DEFINED13 = #{defined13,jdbcType=VARCHAR},
			DEFINED14 = #{defined14,jdbcType=VARCHAR},
			DEFINED15 = #{defined15,jdbcType=VARCHAR},
			DEFINED16 = #{defined16,jdbcType=TIMESTAMP},
			DEFINED17 = #{defined17,jdbcType=TIMESTAMP},
			DEFINED18 = #{defined18,jdbcType=TIMESTAMP},
			ALTERNATE_PHONE2 = #{alternatePhone2,jdbcType=VARCHAR},
			BIRTHDAY = #{birthday,jdbcType=TIMESTAMP},					
			COMPANY_MONEY = #{companyMoney,jdbcType=VARCHAR}, 
			COMPANY_USER = #{companyUser,jdbcType=VARCHAR}, 
			COMPANY_TRADE = #{companyTrade,jdbcType=VARCHAR}, 
			COMPANY_FAX = #{companyFax,jdbcType=VARCHAR}, 
			PROVINCE_ID = #{provinceId,jdbcType=DECIMAL},
			CITY_ID = #{cityId,jdbcType=DECIMAL},
			COUNTY_ID = #{countyId,jdbcType=DECIMAL},
			WANGWANG = #{wangwang,jdbcType=VARCHAR},
			SCOPE = #{scope,jdbcType=VARCHAR},
			<if test="mainLinkman != null">
				MAIN_LINKMAN = #{mainLinkman,jdbcType=VARCHAR},
			</if>			
			<if test="type != null">
				TYPE = #{type,jdbcType=DECIMAL},
			</if>
			<if test="isDel != null">
				IS_DEL = #{isDel,jdbcType=DECIMAL},
			</if>
			<if test="resLastCallDate != null">
				RES_LAST_CALL_DATE = #{resLastCallDate,jdbcType=TIMESTAMP},
			</if>
			<if test="inputDate != null">
				INPUT_DATE = #{inputDate,jdbcType=TIMESTAMP},
			</if>
			<if test="inputAcc != null">
				INPUT_ACC = #{inputAcc,jdbcType=VARCHAR},
			</if>
			<if test="updateDate != null">
				UPDATE_DATE = #{updateDate,jdbcType=TIMESTAMP},
			</if>
			<if test="updateAcc != null">
				UPDATE_ACC = #{updateAcc,jdbcType=VARCHAR},
			</if>
			<if test="isMajor != null">
				IS_MAJOR = #{isMajor,jdbcType=DECIMAL},
			</if>
			<if test="resGroupId != null">
				RES_GROUP_ID = #{resGroupId,jdbcType=VARCHAR},
			</if>
			<if test="ownerAcc != null">
				OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR},
			</if>
			<if test="status != null">
				STATUS = #{status,jdbcType=DECIMAL},
			</if>
			<if test="signDate != null">
				SIGN_DATE = #{signDate,jdbcType=TIMESTAMP},
			</if>
			<if test="inputStatus != null">
				INPUT_STATUS = #{inputStatus,jdbcType=DECIMAL},
			</if>
			<if test="status != null and status == 4">
				OWNER_START_DATE = null,
			</if>
			<if test="ownerStartDate != null and status != 4">
				OWNER_START_DATE = #{ownerStartDate,jdbcType=TIMESTAMP},
			</if>
			<if test="filterCount != null">
				FILTER_COUNT = #{filterCount,jdbcType=DECIMAL},
			</if>
			<if test="filterType != null">
				FILTER_TYPE = #{filterType,jdbcType=DECIMAL},
			</if>
			<if test="opreateType != null">
				OPREATE_TYPE = #{opreateType,jdbcType=DECIMAL},
			</if>			
			<if test="amoytocustomerDate != null">
				AMOYTOCUSTOMER_DATE = #{amoytocustomerDate,jdbcType=TIMESTAMP},
			</if>
			<if test="contractNumber != null">
				CONTRACT_NUMBER = #{contractNumber,jdbcType=VARCHAR},
			</if>			
			<if test="signAcc != null">
				SIGN_ACC = #{signAcc,jdbcType=VARCHAR},
			</if>
			<if test="signName != null">
				SIGN_NAME = #{signName,jdbcType=VARCHAR},
			</if>
			<if test="nextFollowDate != null">
				NEXTFOLLOW_DATE = #{nextFollowDate,jdbcType=VARCHAR},
			</if>		
			<if test="lastCustFollowID != null">
				LAST_CUST_FOLLOW_ID = #{lastCustFollowID,jdbcType=VARCHAR},
			</if>
			<if test="serviceAcc != null">
				SERVICE_ACC = #{serviceAcc,jdbcType=VARCHAR},
			</if>
			<if test="serviceName != null">
				SERVICE_NAME = #{serviceName,jdbcType=VARCHAR},
			</if>
			<if test="serviceLevel != null">
				SERVICE_LEVEL = #{serviceLevel,jdbcType=VARCHAR},
			</if>		
			<if test="callDatePostponed != null">
				CALL_DATE_POSTPONED = #{callDatePostponed,jdbcType=TIMESTAMP},
			</if>
			<if test="reasonForCalldelay != null">
				REASON_FOR_CALLDELAY = #{reasonForCalldelay,jdbcType=VARCHAR},
			</if>
			<if test="recuclingTypeDetails != null">
				RECUCLING_TYPE_DETAILS = #{recuclingTypeDetails,jdbcType=VARCHAR},
			</if>
			<if test="againwashCount != null">
				AGAINWASH_COUNT = #{againwashCount,jdbcType=DECIMAL},
			</if>
			<if test="actionDate != null">
				ACTION_DATE = #{actionDate,jdbcType=TIMESTAMP},
			</if>
			<if test="visitingDate != null">
				VISITING_DATE = #{visitingDate,jdbcType=TIMESTAMP},
			</if>
			<if test="nextVisitingDate != null">
				NEXT_VISITING_DATE = #{nextVisitingDate,jdbcType=TIMESTAMP},
			</if>
			<if test="serviceLabelCode != null">
				SERVICE_LABEL_CODE = #{serviceLabelCode,jdbcType=VARCHAR},
			</if>
			<if test="serviceLabelName != null">
				SERVICE_LABEL_NAME = #{serviceLabelName,jdbcType=VARCHAR},
			</if>
			<if test="isPrecedence != null">
				IS_PRECEDENCE = #{isPrecedence,jdbcType=DECIMAL},
			</if>
			<if test="forTheCustomerTime != null">
				FOR_THE_CUSTOMER_TIME = #{forTheCustomerTime,jdbcType=TIMESTAMP},
			</if>
			<if test="lastVisitAcc != null">
				LAST_VISIT_ACC = #{lastVisitAcc,jdbcType=VARCHAR},
			</if>	
			<if test="state != null">
				STATE = #{state,jdbcType=DECIMAL},
			</if>
			<if test="planDate != null">
				PLAN_DATE = #{planDate,jdbcType=TIMESTAMP}, 
			</if>
			<if test="losingId != null">
				LOSING_ID = #{losingId,jdbcType=VARCHAR}, 
			</if>
			<if test="losingRemark != null">
				LOSING_REMARK = #{losingRemark,jdbcType=VARCHAR}, 
			</if>	
				
			<if test="lastLogId != null">
				LAST_LOG_ID = #{lastLogId,jdbcType=VARCHAR}, 
			</if>	
			<if test="taoNo != null">
				 tao_No = #{taoNo,jdbcType=DECIMAL} ,
			</if>	
			<if test="signBeforeStatus != null">
				 SIGN_BEFORE_STATUS = #{signBeforeStatus,jdbcType=DECIMAL} ,
			</if>
			<if test="signBeforeType != null">
				 SIGN_BEFORE_TYPE = #{signBeforeType,jdbcType=DECIMAL} ,
			</if>
			<if test="importDeptId != null">
				 IMPORT_DEPT_ID = #{importDeptId,jdbcType=VARCHAR} ,
			</if>
			<if test="lifeCode != null">
				 LIFE_CODE = #{lifeCode,jdbcType=VARCHAR},
			</if>
			<if test="lastOptionId != null">
				 last_Option_Id = #{lastOptionId,jdbcType=VARCHAR},
			</if>			
			<if test="lastLossDate != null">
				 last_Loss_Date = #{lastLossDate,jdbcType=TIMESTAMP} ,
			</if>
			<if test="isConcat != null">
				 is_Concat = #{isConcat,jdbcType=VARCHAR} ,
			</if>
			<if test="lastCustTypeId != null">
				 last_Cust_Type_Id = #{lastCustTypeId,jdbcType=VARCHAR} ,
			</if>
			<if test="labelCode != null">
				 label_Code = #{labelCode,jdbcType=VARCHAR} ,
			</if>
			<if test="labelName != null">
				 label_name = #{labelName,jdbcType=VARCHAR} ,
			</if>
			<if test="source != null">
				 source = #{source,jdbcType=DECIMAL} ,
			</if>	
			<if test="ownerActionDate != null">
				OWNER_ACTION_DATE = #{ownerActionDate,jdbcType=TIMESTAMP},
			</if>										
		</trim>
	</sql>
	
	<!-- bathc update -->
	<sql id="trents_update_set_sql_batch">
		<trim prefix="set" suffixOverrides=",">
			<if test="remark != null">
				REMARK = #{remark,jdbcType=VARCHAR},
			</if>
			<if test="type != null">
				TYPE = #{type,jdbcType=DECIMAL},
			</if>
			<if test="isDel != null">
				IS_DEL = #{isDel,jdbcType=DECIMAL},
			</if>
			<if test="updateDate != null">
				UPDATE_DATE = #{updateDate,jdbcType=TIMESTAMP},
			</if>
			<if test="updateAcc != null">
				UPDATE_ACC = #{updateAcc,jdbcType=VARCHAR},
			</if>
			<if test="isMajor != null">
				IS_MAJOR = #{isMajor,jdbcType=DECIMAL},
			</if>
			<if test="resGroupId != null">
				RES_GROUP_ID = #{resGroupId,jdbcType=VARCHAR},
			</if>
			<if test="status != null and status == 4">
				OWNER_START_DATE = null,
			</if>
			<if test="ownerStartDate != null and status != 4">
				OWNER_START_DATE = #{ownerStartDate,jdbcType=TIMESTAMP},
			</if>
			<if test="filterType != null">
				FILTER_TYPE = #{filterType,jdbcType=DECIMAL},
			</if>
			<if test="ownerAcc != null">
				OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR},
			</if>
			<if test="status != null">
				STATUS = #{status,jdbcType=DECIMAL},
			</if>
			<if test="opreateType != null">
				OPREATE_TYPE = #{opreateType,jdbcType=DECIMAL},
			</if>
			<if test="keyWord != null">
				KEYWORD = #{keyWord,jdbcType=VARCHAR},
			</if>
			<if test="serviceAcc != null">
				SERVICE_ACC = #{serviceAcc,jdbcType=VARCHAR},
			</if>
			<if test="isPrecedence != null">
				IS_PRECEDENCE = #{isPrecedence,jdbcType=DECIMAL},
			</if>
			<if test="state != null">
				STATE = #{state,jdbcType=DECIMAL},
			</if>
			<if test="planDate != null">
				PLAN_DATE = #{planDate,jdbcType=TIMESTAMP}, 
			</if>
			<if test="losingId != null">
				LOSING_ID = #{losingId,jdbcType=VARCHAR}, 
			</if>
			<if test="losingRemark != null">
				LOSING_REMARK = #{losingRemark,jdbcType=VARCHAR}, 
			</if>
			<if test="signBeforeStatus != null">
				 SIGN_BEFORE_STATUS = #{signBeforeStatus,jdbcType=DECIMAL} ,
			</if>
			<if test="signBeforeType != null">
				 SIGN_BEFORE_TYPE = #{signBeforeType,jdbcType=DECIMAL} ,
			</if>
			<if test='isClean == "1"'>
				LAST_CUST_FOLLOW_ID = null,
				LAST_LOG_ID = null,
				PLAN_DATE = null,
			</if>
			<if test='opreateType != null and opreateType == "13"'>
				ACTION_DATE = null,
			</if>
			<if test='opreateType != null and opreateType == "13"'>
				ACTION_DATE = null,
			</if>
			<if test="taoNo != null">
				 tao_No = #{taoNo,jdbcType=DECIMAL} ,
			</if>
			<if test="importDeptId != null">
				 IMPORT_DEPT_ID = #{importDeptId,jdbcType=VARCHAR} ,
			</if>	
			<if test="lifeCode != null">
				 LIFE_CODE = REPLACE(UUID(),'-',''),
			</if>
			<if test="lastOptionId != null">
				 last_Option_Id = #{lastOptionId,jdbcType=VARCHAR},
			</if>			
			<if test="lastLossDate != null">
				 last_Loss_Date = #{lastLossDate,jdbcType=TIMESTAMP} ,
			</if>
			<if test="isConcat != null">
				 is_Concat = #{isConcat,jdbcType=VARCHAR} ,
			</if>
			<if test="lastCustTypeId != null">
			   last_Cust_Type_Id = #{lastCustTypeId,jdbcType=VARCHAR} ,
		    </if>
			<if test="labelCode != null">
				 label_Code = #{labelCode,jdbcType=VARCHAR} ,
			</if>
			<if test="labelName != null">
				 label_name = #{labelName,jdbcType=VARCHAR} ,
			</if>	
			<if test="source != null">
				 source = #{source,jdbcType=DECIMAL} ,
			</if>		    
		</trim>
	</sql>
	
		<!-- 修改实体对应set语句 -->
	<sql id="trents_update_set_sql2">
		<trim prefix="set" suffixOverrides=",">
			<if test="name != null">
				NAME = #{name,jdbcType=VARCHAR},
			</if>
			<if test="mobilephone != null">
				MOBILEPHONE = #{mobilephone,jdbcType=VARCHAR},
			</if>
			<if test="telphone != null">
				TELPHONE = #{telphone,jdbcType=VARCHAR},
			</if>
			<if test="company != null">
				COMPANY = #{company,jdbcType=VARCHAR},
			</if>
			<if test="duty != null">
				DUTY = #{duty,jdbcType=VARCHAR},
			</if>
			<if test="sex != null">
				SEX = #{sex,jdbcType=VARCHAR},
			</if>
			<if test="companyAddr != null">
				COMPANY_ADDR = #{companyAddr,jdbcType=VARCHAR},
			</if>
			<if test="companyOrg != null">
				COMPANY_ORG = #{companyOrg,jdbcType=VARCHAR},
			</if>
			<if test="remark != null">
				REMARK = #{remark,jdbcType=VARCHAR},
			</if>
			<if test="type != null">
				TYPE = #{type,jdbcType=DECIMAL},
			</if>
			<if test="isDel != null">
				IS_DEL = #{isDel,jdbcType=DECIMAL},
			</if>
			<if test="resLastCallDate != null">
				RES_LAST_CALL_DATE = #{resLastCallDate,jdbcType=TIMESTAMP},
			</if>
			<if test="inputDate != null">
				INPUT_DATE = #{inputDate,jdbcType=TIMESTAMP},
			</if>
			<if test="inputAcc != null">
				INPUT_ACC = #{inputAcc,jdbcType=VARCHAR},
			</if>
			<if test="updateDate != null">
				UPDATE_DATE = #{updateDate,jdbcType=TIMESTAMP},
			</if>
			<if test="updateAcc != null">
				UPDATE_ACC = #{updateAcc,jdbcType=VARCHAR},
			</if>
			<if test="isMajor != null">
				IS_MAJOR = #{isMajor,jdbcType=DECIMAL},
			</if>
			<if test="resGroupId != null">
				RES_GROUP_ID = #{resGroupId,jdbcType=VARCHAR},
			</if>
			<if test="ownerAcc != null">
				OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR},
			</if>
			<if test="status != null">
				STATUS = #{status,jdbcType=DECIMAL},
			</if>
<!-- 			<if test="orgId != null"> -->
<!-- 				ORG_ID = #{orgId,jdbcType=VARCHAR}, -->
<!-- 			</if> -->
			<if test="signDate != null">
				SIGN_DATE = #{signDate,jdbcType=TIMESTAMP},
			</if>
			<if test="inputStatus != null">
				INPUT_STATUS = #{inputStatus,jdbcType=DECIMAL},
			</if>
			<if test="status != null and status == 4">
				OWNER_START_DATE = null,
			</if>
			<if test="ownerStartDate != null and status != 4">
				OWNER_START_DATE = #{ownerStartDate,jdbcType=TIMESTAMP},
			</if>
			<if test="filterCount != null">
				FILTER_COUNT = #{filterCount,jdbcType=DECIMAL},
			</if>
			<if test="filterType != null">
				FILTER_TYPE = #{filterType,jdbcType=DECIMAL},
			</if>
			<if test="opreateType != null">
				OPREATE_TYPE = #{opreateType,jdbcType=DECIMAL},
			</if>
			<if test="fax != null">
				FAX = #{fax,jdbcType=VARCHAR},
			</if>
			<if test="email != null">
				EMAIL = #{email,jdbcType=VARCHAR},
			</if>
			<if test="unithome != null">
				UNITHOME = #{unithome,jdbcType=VARCHAR},
			</if>
			<if test="unitintroduction != null">
				UNITINTRODUCTION = #{unitintroduction,jdbcType=VARCHAR},
			</if>
			<if test="amoytocustomerDate != null">
				AMOYTOCUSTOMER_DATE = #{amoytocustomerDate,jdbcType=TIMESTAMP},
			</if>
			<if test="qq != null">
				QQ = #{qq,jdbcType=VARCHAR},
			</if>
			<if test="keyWord != null">
				KEYWORD = #{keyWord,jdbcType=VARCHAR},
			</if>
			<if test="contractNumber != null">
				CONTRACT_NUMBER = #{contractNumber,jdbcType=VARCHAR},
			</if>
			<if test="defined1 != null">
				DEFINED1 = #{defined1,jdbcType=VARCHAR},
			</if>
			<if test="defined2 != null">
				DEFINED2 = #{defined2,jdbcType=VARCHAR},
			</if>
			<if test="defined3 != null">
				DEFINED3 = #{defined3,jdbcType=VARCHAR},
			</if>
			<if test="defined4 != null">
				DEFINED4 = #{defined4,jdbcType=VARCHAR},
			</if>
			<if test="defined5 != null">
				DEFINED5 = #{defined5,jdbcType=VARCHAR},
			</if>
			<if test="defined6 != null">
				DEFINED6 = #{defined6,jdbcType=VARCHAR},
			</if>
			<if test="defined7 != null">
				DEFINED7 = #{defined7,jdbcType=VARCHAR},
			</if>
			<if test="defined8 != null">
				DEFINED8 = #{defined8,jdbcType=VARCHAR},
			</if>
			<if test="defined9 != null">
				DEFINED9 = #{defined9,jdbcType=VARCHAR},
			</if>
			<if test="defined10 != null">
				DEFINED10 = #{defined10,jdbcType=VARCHAR},
			</if>
			<if test="defined11 != null">
				DEFINED11 = #{defined11,jdbcType=VARCHAR},
			</if>
			<if test="defined12 != null">
				DEFINED12 = #{defined12,jdbcType=VARCHAR},
			</if>
			<if test="defined13 != null">
				DEFINED13 = #{defined13,jdbcType=VARCHAR},
			</if>
			<if test="defined14 != null">
				DEFINED14 = #{defined14,jdbcType=VARCHAR},
			</if>
			<if test="defined15 != null">
				DEFINED15 = #{defined15,jdbcType=VARCHAR},
			</if>	
			<if test="defined16 != null">
				DEFINED16 = #{defined16,jdbcType=TIMESTAMP},
			</if>		
			<if test="defined17 != null">
				DEFINED17 = #{defined17,jdbcType=TIMESTAMP},
			</if>		
			<if test="defined18 != null">
				DEFINED18 = #{defined18,jdbcType=TIMESTAMP},
			</if>		
			<if test="alternatePhone2 != null">
				ALTERNATE_PHONE2 = #{alternatePhone2,jdbcType=VARCHAR},
			</if>
			<if test="signAcc != null">
				SIGN_ACC = #{signAcc,jdbcType=VARCHAR},
			</if>
			<if test="signName != null">
				SIGN_NAME = #{signName,jdbcType=VARCHAR},
			</if>
			<if test="nextFollowDate != null">
				NEXTFOLLOW_DATE = #{nextFollowDate,jdbcType=VARCHAR},
			</if>	
			<if test="nextFollowDate == null">
				NEXTFOLLOW_DATE = null,
			</if>		
			<if test="lastCustFollowID != null">
				LAST_CUST_FOLLOW_ID = #{lastCustFollowID,jdbcType=VARCHAR},
			</if>
			<if test="serviceAcc != null">
				SERVICE_ACC = #{serviceAcc,jdbcType=VARCHAR},
			</if>
			<if test="serviceName != null">
				SERVICE_NAME = #{serviceName,jdbcType=VARCHAR},
			</if>
			<if test="serviceLevel != null">
				SERVICE_LEVEL = #{serviceLevel,jdbcType=VARCHAR},
			</if>
			<if test="birthday != null">
				BIRTHDAY = #{birthday,jdbcType=TIMESTAMP},
			</if>	
			<if test="callDatePostponed != null">
				CALL_DATE_POSTPONED = #{callDatePostponed,jdbcType=TIMESTAMP},
			</if>
			<if test="reasonForCalldelay != null">
				REASON_FOR_CALLDELAY = #{reasonForCalldelay,jdbcType=VARCHAR},
			</if>
			<if test="recuclingTypeDetails != null">
				RECUCLING_TYPE_DETAILS = #{recuclingTypeDetails,jdbcType=VARCHAR},
			</if>
			<if test="againwashCount != null">
				AGAINWASH_COUNT = #{againwashCount,jdbcType=DECIMAL},
			</if>
			<if test='opreateType != null and opreateType == "2"'>
				ACTION_DATE = null,
			</if>
			<if test="visitingDate != null">
				VISITING_DATE = #{visitingDate,jdbcType=TIMESTAMP},
			</if>
			<if test="nextVisitingDate != null">
				NEXT_VISITING_DATE = #{nextVisitingDate,jdbcType=TIMESTAMP},
			</if>
			<if test="serviceLabelCode != null">
				SERVICE_LABEL_CODE = #{serviceLabelCode,jdbcType=VARCHAR},
			</if>
			<if test="serviceLabelName != null">
				SERVICE_LABEL_NAME = #{serviceLabelName,jdbcType=VARCHAR},
			</if>
			<if test="isPrecedence != null">
				IS_PRECEDENCE = #{isPrecedence,jdbcType=DECIMAL},
			</if>
			<if test="forTheCustomerTime != null">
				FOR_THE_CUSTOMER_TIME = #{forTheCustomerTime,jdbcType=TIMESTAMP},
			</if>
			<if test="lastVisitAcc != null">
				LAST_VISIT_ACC = #{lastVisitAcc,jdbcType=VARCHAR},
			</if>	
			<if test="state != null">
				STATE = #{state,jdbcType=DECIMAL},
			</if>
			<if test="planDate != null">
				PLAN_DATE = #{planDate,jdbcType=TIMESTAMP}, 
			</if>
			<if test="address != null">
				ADDRESS = #{address,jdbcType=VARCHAR}, 
			</if>
			<if test="companyMoney != null">
				COMPANY_MONEY = #{companyMoney,jdbcType=VARCHAR}, 
			</if>
			<if test="companyUser != null">
				COMPANY_USER = #{companyUser,jdbcType=VARCHAR}, 
			</if>
			<if test="companyTrade != null">
				COMPANY_TRADE = #{companyTrade,jdbcType=VARCHAR}, 
			</if>
			<if test="companyFax != null">
				COMPANY_FAX = #{companyFax,jdbcType=VARCHAR}, 
			</if>
			<if test="losingId != null">
				LOSING_ID = #{losingId,jdbcType=VARCHAR}, 
			</if>
			<if test="losingRemark != null">
				LOSING_REMARK = #{losingRemark,jdbcType=VARCHAR}, 
			</if>	
			<if test="provinceId != null">
				PROVINCE_ID = #{provinceId,jdbcType=DECIMAL},
			</if>
			<if test="cityId != null">
				CITY_ID = #{cityId,jdbcType=DECIMAL},
			</if>
			<if test="countyId != null">
				COUNTY_ID = #{countyId,jdbcType=DECIMAL},
			</if>
			<if test="lastLogId != null">
				LAST_LOG_ID = #{lastLogId,jdbcType=VARCHAR}, 
			</if>	
			<if test="wangwang != null">
				WANGWANG = #{wangwang,jdbcType=VARCHAR},
			</if>
			<if test="scope != null">
				SCOPE = #{scope,jdbcType=VARCHAR},
			</if>
			<if test="mainLinkman != null">
				MAIN_LINKMAN = #{mainLinkman,jdbcType=VARCHAR},
			</if>
			<if test="taoNo != null">
				 tao_No = #{taoNo,jdbcType=DECIMAL} ,
			</if>	
			<if test="signBeforeStatus != null">
				 SIGN_BEFORE_STATUS = #{signBeforeStatus,jdbcType=DECIMAL} ,
			</if>
			<if test="signBeforeType != null">
				 SIGN_BEFORE_TYPE = #{signBeforeType,jdbcType=DECIMAL} ,
			</if>
			<if test="importDeptId != null">
				 IMPORT_DEPT_ID = #{importDeptId,jdbcType=VARCHAR} ,
			</if>
			<if test="lifeCode != null">
				 LIFE_CODE = #{lifeCode,jdbcType=VARCHAR},
			</if>
			<if test="lastOptionId != null">
				 last_Option_Id = #{lastOptionId,jdbcType=VARCHAR},
			</if>	
			<if test="lastOptionId == null">
				 last_Option_Id = null,
			</if>			
			<if test="lastLossDate != null">
				 last_Loss_Date = #{lastLossDate,jdbcType=TIMESTAMP} ,
			</if>
			<if test="isConcat != null">
				 is_Concat = #{isConcat,jdbcType=VARCHAR} ,
			</if>
			<if test="lastCustTypeId != null">
				 last_Cust_Type_Id = #{lastCustTypeId,jdbcType=VARCHAR} ,
			</if>
			<if test="labelCode != null">
				 label_Code = #{labelCode,jdbcType=VARCHAR} ,
			</if>
			<if test="labelName != null">
				 label_name = #{labelName,jdbcType=VARCHAR} ,
			</if>		
			<if test="source != null">
				 source = #{source,jdbcType=DECIMAL} ,
			</if>										
		</trim>
	</sql>
	<!-- 插入实体对应的字段语句 -->
	<sql id="insert_into_field">
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="resCustId != null">
				RES_CUST_ID,
			</if>
			<if test="name != null">
				NAME,
			</if>
			<if test="mobilephone != null">
				MOBILEPHONE,
			</if>
			<if test="telphone != null">
				TELPHONE,
			</if>
			<if test="company != null">
				COMPANY,
			</if>
			<if test="duty != null">
				DUTY,
			</if>
			<if test="sex != null">
				SEX,
			</if>
			<if test="companyAddr != null">
				COMPANY_ADDR,
			</if>
			<if test="companyOrg != null">
				COMPANY_ORG,
			</if>
			<if test="remark != null">
				REMARK,
			</if>
			<if test="type != null">
				TYPE,
			</if>
			<if test="isDel != null">
				IS_DEL,
			</if>
			<if test="resLastCallDate != null">
				RES_LAST_CALL_DATE,
			</if>
			<if test="inputDate != null">
				INPUT_DATE,
			</if>
			<if test="inputAcc != null">
				INPUT_ACC,
			</if>
			<if test="updateDate != null">
				UPDATE_DATE,
			</if>
			<if test="updateAcc != null">
				UPDATE_ACC,
			</if>
			<if test="isMajor != null">
				IS_MAJOR,
			</if>
			<if test="resGroupId != null">
				RES_GROUP_ID,
			</if>
			<if test="ownerAcc != null">
				OWNER_ACC,
			</if>
			<if test="status != null">
				STATUS,
			</if>
			<if test="orgId != null">
				ORG_ID,
			</if>
			<if test="signDate != null">
				SIGN_DATE,
			</if>
			<if test="inputStatus != null">
				INPUT_STATUS,
			</if>
			<if test="ownerStartDate != null">
				OWNER_START_DATE,
			</if>
			<if test="filterCount != null">
				FILTER_COUNT,
			</if>
			<if test="filterType != null">
				FILTER_TYPE,
			</if>
			<if test="opreateType != null">
				OPREATE_TYPE,
			</if>
			<if test="fax != null">
				FAX,
			</if>
			<if test="email != null">
				EMAIL,
			</if>
			<if test="unithome != null">
				UNITHOME,
			</if>
			<if test="unitintroduction != null">
				UNITINTRODUCTION,
			</if>
			<if test="amoytocustomerDate != null">
				AMOYTOCUSTOMER_DATE,
			</if>
			<if test="qq != null">
				QQ,
			</if>
			<if test="keyWord != null">
				KEYWORD,
			</if>
			<if test="contractNumber != null">
				CONTRACT_NUMBER,
			</if>
			<if test="defined1 != null">
				DEFINED1,
			</if>
			<if test="defined2 != null">
				DEFINED2,
			</if>
			<if test="defined3 != null">
				DEFINED3,
			</if>
			<if test="defined4 != null">
				DEFINED4,
			</if>
			<if test="defined5 != null">
				DEFINED5,
			</if>
			<if test="defined6 != null">
				DEFINED6,
			</if>
			<if test="defined7 != null">
				DEFINED7,
			</if>
			<if test="defined8 != null">
				DEFINED8,
			</if>
			<if test="defined9 != null">
				DEFINED9,
			</if>
			<if test="defined10 != null">
				DEFINED10,
			</if>
			<if test="defined11 != null">
				DEFINED11,
			</if>
			<if test="defined12 != null">
				DEFINED12,
			</if>
			<if test="defined13 != null">
				DEFINED13,
			</if>
			<if test="defined14 != null">
				DEFINED14,
			</if>
			<if test="defined15 != null">
				DEFINED15,
			</if>	
			<if test="defined16!= null">
				DEFINED16,
			</if>	
			<if test="defined17 != null">
				DEFINED17,
			</if>	
			<if test="defined18 != null">
				DEFINED18,
			</if>			
			<if test="alternatePhone2 != null">
				ALTERNATE_PHONE2,
			</if>
			<if test="signAcc != null">
				SIGN_ACC,
			</if>
			<if test="signName != null">
				SIGN_NAME,
			</if>
			
				NEXTFOLLOW_DATE,
			
			<if test="birthday != null">
				BIRTHDAY,
			</if>
			<if test="recuclingTypeDetails != null">
				RECUCLING_TYPE_DETAILS,
			</if>
			<if test="callDatePostponed != null">
				CALL_DATE_POSTPONED,
			</if>
			<if test="reasonForCalldelay != null">
				REASON_FOR_CALLDELAY,
			</if>
			<if test="recuclingTypeDetails != null">
				RECUCLING_TYPE_DETAILS,
			</if>
			<if test="againwashCount != null">
				AGAINWASH_COUNT,
			</if>
			<if test="actionDate != null">
				ACTION_DATE,
			</if>
			<if test="lastCustFollowID != null">
				LAST_CUST_FOLLOW_ID,
			</if>
			<if test="serviceAcc != null">
				SERVICE_ACC,
			</if>
			<if test="serviceName != null">
				SERVICE_NAME,
			</if>
			<if test="serviceLevel != null">
				SERVICE_LEVEL,
			</if>
			<if test="visitingDate != null">
				VISITING_DATE,
			</if>
			<if test="nextVisitingDate != null">
				NEXT_VISITING_DATE,
			</if>
			<if test="serviceLabelCode != null">
				SERVICE_LABEL_CODE,
			</if>
			<if test="serviceLabelName != null">
				SERVICE_LABEL_NAME,
			</if>
			<if test="isPrecedence != null">
				IS_PRECEDENCE,
			</if>
			<if test="forTheCustomerTime != null">
				FOR_THE_CUSTOMER_TIME,
			</if>
			<if test="lastVisitAcc != null">
				LAST_VISIT_ACC,
			</if>
			<if test="state != null">
				STATE,
			</if>
			<if test="planDate != null">
				PLAN_DATE, 
			</if>
			<if test="address != null">
				ADDRESS, 
			</if>
			<if test="companyMoney != null">
				COMPANY_MONEY, 
			</if>
			<if test="companyUser != null">
				COMPANY_USER, 
			</if>
			<if test="companyTrade != null">
				COMPANY_TRADE, 
			</if>
			<if test="companyFax != null">
				COMPANY_FAX, 
			</if>
			<if test="losingId != null">
				LOSING_ID, 
			</if>
			<if test="losingRemark != null">
				LOSING_REMARK, 
			</if>
			<if test="provinceId != null">
				PROVINCE_ID,
			</if>
			<if test="cityId != null">
				CITY_ID,
			</if>
			<if test="countyId != null">
				COUNTY_ID,
			</if>
			<if test="lastLogId != null">
				LAST_LOG_ID,
			</if>
			<if test="wangwang != null">
				WANGWANG,
			</if>
			<if test="scope != null">
				SCOPE,
			</if>	
			<if test="mainLinkman != null">
				MAIN_LINKMAN,
			</if>
			<if test="taoNo != null">
				 tao_No ,
			</if>	
			<if test="importDeptId != null">
				 IMPORT_DEPT_ID,
			</if>	
			<if test="lifeCode != null">
				 LIFE_CODE,
			</if>	
			<if test="lastOptionId != null">
				 last_Option_Id,
			</if>				
			<if test="lastLossDate != null">
				 last_Loss_Date,
			</if>
			<if test="isConcat != null">
				 is_Concat ,
			</if>
			<if test="lastCustTypeId != null">
			   last_Cust_Type_Id,
		    </if>
			<if test="labelCode != null">
				 label_Code ,
			</if>
			<if test="labelName != null">
			     label_name ,
			</if>	
			<if test="ownerActionDate != null">
			     owner_action_date ,
			</if>
			<if test="source != null">
			     source ,
			</if>	    															
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="resCustId != null">
				#{resCustId,jdbcType=VARCHAR},
			</if>
			<if test="name != null">
				#{name,jdbcType=VARCHAR},
			</if>
			<if test="mobilephone != null">
				#{mobilephone,jdbcType=VARCHAR},
			</if>
			<if test="telphone != null">
				#{telphone,jdbcType=VARCHAR},
			</if>
			<if test="company != null">
				#{company,jdbcType=VARCHAR},
			</if>
			<if test="duty != null">
				#{duty,jdbcType=VARCHAR},
			</if>
			<if test="sex != null">
				#{sex,jdbcType=VARCHAR},
			</if>
			<if test="companyAddr != null">
				#{companyAddr,jdbcType=VARCHAR},
			</if>
			<if test="companyOrg != null">
				#{companyOrg,jdbcType=VARCHAR},
			</if>
			<if test="remark != null">
				#{remark,jdbcType=VARCHAR},
			</if>
			<if test="type != null">
				#{type,jdbcType=DECIMAL},
			</if>
			<if test="isDel != null">
				#{isDel,jdbcType=DECIMAL},
			</if>
			<if test="resLastCallDate != null">
				#{resLastCallDate,jdbcType=TIMESTAMP},
			</if>
			<if test="inputDate != null">
				#{inputDate,jdbcType=TIMESTAMP},
			</if>
			<if test="inputAcc != null">
				#{inputAcc,jdbcType=VARCHAR},
			</if>
			<if test="updateDate != null">
				#{updateDate,jdbcType=TIMESTAMP},
			</if>
			<if test="updateAcc != null">
				#{updateAcc,jdbcType=VARCHAR},
			</if>
			<if test="isMajor != null">
				#{isMajor,jdbcType=DECIMAL},
			</if>
			<if test="resGroupId != null">
				#{resGroupId,jdbcType=VARCHAR},
			</if>
			<if test="ownerAcc != null">
				#{ownerAcc,jdbcType=VARCHAR},
			</if>
			<if test="status != null">
				#{status,jdbcType=DECIMAL},
			</if>
			<if test="orgId != null">
				#{orgId,jdbcType=VARCHAR},
			</if>
			<if test="signDate != null">
				#{signDate,jdbcType=TIMESTAMP},
			</if>
			<if test="inputStatus != null">
				#{inputStatus,jdbcType=DECIMAL},
			</if>
			<if test="ownerStartDate != null">
				#{ownerStartDate,jdbcType=TIMESTAMP},
			</if>
			<if test="filterCount != null">
				#{filterCount,jdbcType=DECIMAL},
			</if>
			<if test="filterType != null">
				#{filterType,jdbcType=DECIMAL},
			</if>
			<if test="opreateType != null">
				#{opreateType,jdbcType=DECIMAL},
			</if>
			<if test="fax != null">
				#{fax,jdbcType=VARCHAR},
			</if>
			<if test="email != null">
				#{email,jdbcType=VARCHAR},
			</if>
			<if test="unithome != null">
				#{unithome,jdbcType=VARCHAR},
			</if>
			<if test="unitintroduction != null">
				#{unitintroduction,jdbcType=VARCHAR},
			</if>
			<if test="amoytocustomerDate != null">
				#{amoytocustomerDate,jdbcType=TIMESTAMP},
			</if>
			<if test="qq != null">
				#{qq,jdbcType=VARCHAR},
			</if>
			<if test="keyWord != null">
				#{keyWord,jdbcType=VARCHAR},
			</if>
			<if test="contractNumber != null">
				#{contractNumber,jdbcType=VARCHAR},
			</if>
			<if test="defined1 != null">
				#{defined1,jdbcType=VARCHAR},
			</if>
			<if test="defined2 != null">
				#{defined2,jdbcType=VARCHAR},
			</if>
			<if test="defined3 != null">
				#{defined3,jdbcType=VARCHAR},
			</if>
			<if test="defined4 != null">
				#{defined4,jdbcType=VARCHAR},
			</if>
			<if test="defined5 != null">
				#{defined5,jdbcType=VARCHAR},
			</if>
			<if test="defined6 != null">
				#{defined6,jdbcType=VARCHAR},
			</if>
			<if test="defined7 != null">
				#{defined7,jdbcType=VARCHAR},
			</if>
			<if test="defined8 != null">
				#{defined8,jdbcType=VARCHAR},
			</if>
			<if test="defined9 != null">
				#{defined9,jdbcType=VARCHAR},
			</if>
			<if test="defined10 != null">
				#{defined10,jdbcType=VARCHAR},
			</if>
			<if test="defined11 != null">
				#{defined11,jdbcType=VARCHAR},
			</if>
			<if test="defined12 != null">
				#{defined12,jdbcType=VARCHAR},
			</if>
			<if test="defined13 != null">
				#{defined13,jdbcType=VARCHAR},
			</if>
			<if test="defined14 != null">
				#{defined14,jdbcType=VARCHAR},
			</if>
			<if test="defined15 != null">
				#{defined15,jdbcType=VARCHAR},
			</if>			
			<if test="defined16 != null">
				#{defined16,jdbcType=TIMESTAMP},
			</if>		
			<if test="defined17 != null">
				#{defined17,jdbcType=TIMESTAMP},
			</if>		
			<if test="defined18 != null">
				#{defined18,jdbcType=TIMESTAMP},
			</if>		
			<if test="alternatePhone2 != null">
				#{alternatePhone2,jdbcType=VARCHAR},
			</if>
			<if test="signAcc != null">
				#{signAcc,jdbcType=VARCHAR},
			</if>
			<if test="signName != null">
				#{signName,jdbcType=VARCHAR},
			</if>
			
				#{nextFollowDate,jdbcType=VARCHAR},
			
			<if test="birthday != null">
				#{birthday,jdbcType=VARCHAR},
			</if>
			<if test="callDatePostponed != null">
				#{callDatePostponed,jdbcType=TIMESTAMP},
			</if>
			<if test="reasonForCalldelay != null">
				#{reasonForCalldelay,jdbcType=VARCHAR},
			</if>
			<if test="recuclingTypeDetails != null">
				#{recuclingTypeDetails,jdbcType=VARCHAR},
			</if>
			<if test="againwashCount != null">
				#{againwashCount,jdbcType=VARCHAR},
			</if>
			<if test="actionDate != null">
				#{actionDate,jdbcType=TIMESTAMP},
			</if>
			<if test="lastCustFollowID != null">
				#{lastCustFollowID,jdbcType=VARCHAR},
			</if>
			<if test="serviceAcc != null">
				#{serviceAcc,jdbcType=VARCHAR},
			</if>
			<if test="serviceName != null">
				#{serviceName,jdbcType=VARCHAR},
			</if>
			<if test="serviceLevel != null">
				#{serviceLevel,jdbcType=VARCHAR},
			</if>
			<if test="visitingDate != null">
				#{visitingDate,jdbcType=TIMESTAMP},
			</if>
			<if test="nextVisitingDate != null">
				#{nextVisitingDate,jdbcType=TIMESTAMP},
			</if>
			<if test="serviceLabelCode != null">
				#{serviceLabelCode,jdbcType=VARCHAR},
			</if>
			<if test="serviceLabelName != null">
				#{serviceLabelName,jdbcType=VARCHAR},
			</if>
			<if test="isPrecedence != null">
				#{isPrecedence,jdbcType=DECIMAL},
			</if>
			<if test="forTheCustomerTime != null">
				#{forTheCustomerTime,jdbcType=TIMESTAMP},
			</if>
			<if test="lastVisitAcc != null">
				#{lastVisitAcc,jdbcType=VARCHAR},
			</if>	
			<if test="state != null">
				#{state,jdbcType=DECIMAL},
			</if>
			<if test="planDate != null">
				#{planDate,jdbcType=TIMESTAMP}, 
			</if>
			<if test="address != null">
				#{address,jdbcType=VARCHAR}, 
			</if>
			<if test="companyMoney != null">
				#{companyMoney,jdbcType=VARCHAR}, 
			</if>
			<if test="companyUser != null">
				#{companyUser,jdbcType=VARCHAR}, 
			</if>
			<if test="companyTrade != null">
				#{companyTrade,jdbcType=VARCHAR}, 
			</if>
			<if test="companyFax != null">
				#{companyFax,jdbcType=VARCHAR}, 
			</if>
			<if test="losingId != null">
				#{losingId,jdbcType=VARCHAR}, 
			</if>
			<if test="losingRemark != null">
				#{losingRemark,jdbcType=VARCHAR}, 
			</if>
			<if test="provinceId != null">
				#{provinceId,jdbcType=DECIMAL},
			</if>
			<if test="cityId != null">
				#{cityId,jdbcType=DECIMAL},
			</if>
			<if test="countyId != null">
				#{countyId,jdbcType=DECIMAL},
			</if>	
			<if test="lastLogId != null">
				#{lastLogId,jdbcType=VARCHAR},
			</if>	
			<if test="wangwang != null">
				#{wangwang,jdbcType=VARCHAR},
			</if>
			<if test="scope != null">
				#{scope,jdbcType=VARCHAR},
			</if>
			<if test="mainLinkman != null">
				#{mainLinkman,jdbcType=VARCHAR},
			</if>
			<if test="taoNo != null">
			    #{taoNo,jdbcType=DECIMAL} ,
			</if>
			<if test="importDeptId != null">
				#{importDeptId,jdbcType=VARCHAR} ,
			</if>
			<if test="lifeCode != null">
				#{lifeCode,jdbcType=VARCHAR},
			</if>	
			<if test="lastOptionId != null">
				#{lastOptionId,jdbcType=VARCHAR},
			</if>
			<if test="lastLossDate != null">
				  #{lastLossDate,jdbcType=TIMESTAMP} ,
			</if>
			<if test="isConcat != null">
				 #{isConcat,jdbcType=VARCHAR} ,
			</if>
			<if test="lastCustTypeId != null">
			   #{lastCustTypeId,jdbcType=VARCHAR} ,
		    </if>	
			<if test="labelCode != null">
				 #{labelCode,jdbcType=VARCHAR} ,
			</if>
			<if test="labelName != null">
				 #{labelName,jdbcType=VARCHAR} ,
			</if>
			<if test="ownerActionDate != null">
				  #{ownerActionDate,jdbcType=TIMESTAMP} ,
			</if>
			<if test="source != null">
			    #{source,jdbcType=DECIMAL} ,
			</if>		    												
		</trim>
	</sql>
	<!-- 表字段 -->
	<sql id="Base_Column_List">
		RES_CUST_ID,NAME,MOBILEPHONE,TELPHONE,COMPANY,DUTY,SEX,COMPANY_ADDR,COMPANY_ORG,
		REMARK,TYPE,IS_DEL,RES_LAST_CALL_DATE,INPUT_DATE,INPUT_ACC,UPDATE_DATE,UPDATE_ACC,
		IS_MAJOR,RES_GROUP_ID,OWNER_ACC,STATUS,ORG_ID,SIGN_DATE,INPUT_STATUS,OWNER_START_DATE,
		FILTER_COUNT,FILTER_TYPE,OPREATE_TYPE,FAX,EMAIL,UNITHOME,UNITINTRODUCTION,AMOYTOCUSTOMER_DATE,QQ,KEYWORD,CONTRACT_NUMBER,
		DEFINED1,DEFINED2,DEFINED3,DEFINED4,DEFINED5,ALTERNATE_PHONE2,SIGN_ACC,SIGN_NAME,NEXTFOLLOW_DATE,BIRTHDAY,
		CALL_DATE_POSTPONED,COMMON_ACC,
		REASON_FOR_CALLDELAY,RECUCLING_TYPE_DETAILS,AGAINWASH_COUNT,ACTION_DATE,LAST_CUST_FOLLOW_ID,
		SERVICE_ACC, SERVICE_NAME,
		SERVICE_LEVEL,VISITING_DATE,NEXT_VISITING_DATE,SERVICE_LABEL_CODE,SERVICE_LABEL_NAME,
		IS_PRECEDENCE,FOR_THE_CUSTOMER_TIME,LAST_VISIT_ACC,STATE,PLAN_DATE,ADDRESS,COMPANY_MONEY,
		COMPANY_USER,COMPANY_TRADE,COMPANY_FAX,LOSING_ID,LOSING_REMARK,PROVINCE_ID,CITY_ID,COUNTY_ID,LAST_LOG_ID,WANGWANG,SCOPE,MAIN_LINKMAN,
		DEFINED6,DEFINED7,DEFINED8,DEFINED9,DEFINED10,DEFINED11,DEFINED12,DEFINED13,DEFINED14,DEFINED15,DEFINED16,DEFINED17,DEFINED18,TAO_NO,SIGN_BEFORE_STATUS,SIGN_BEFORE_TYPE,IMPORT_DEPT_ID,LIFE_CODE,last_Option_Id ,
		last_Loss_Date,is_Concat,last_Cust_Type_Id,label_Code,label_name
	</sql>
	<!-- 查询所有实体信息，对应接口中的find方法 -->
	<select id="find" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from
		<include refid="table_name" />
	</select>

	<select id="findListPage" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from
		<include refid="table_name" />
		where 1=1
		<include refid="entity_condition_orderby" />
	</select>

	<!-- 根据条件查询所有实体信息，对应接口中的findByCondtion方法 -->
	<select id="findByCondtion" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from
		<include refid="table_name" />
		where 1=1
		<include refid="entity_condition_orderby" />
	</select>

	<!-- 按编号获取实体信息，对应接口中的getByPrimaryKey方法 -->
	<select id="getByPrimaryKey" parameterType="map" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />,COMMON_ACC 
		from
		<include refid="table_name" />
		where ORG_ID = #{orgId} AND RES_CUST_ID = #{resId}
	</select>
	
	<!-- 按条件查询获取实体信息，对应接口中的getByCondtion方法 -->
	<select id="getByCondtion" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from
		<include refid="table_name" />
		where 1=1
		<include refid="entity_condition_orderby" />
	</select>

	<!-- 添加实体 -->
	<insert id="insert" parameterType="com.qftx.tsm.cust.bean.ResCustInfoBean">
		insert into
		<include refid="table_name" />
		<include refid="insert_into_field" />
	</insert>
	
	<!-- 批量添加实体 -->
	<insert id="insertBatch" parameterType="com.qftx.tsm.cust.bean.ResCustInfoBean">
		insert into
		<include refid="table_name" />(
		RES_CUST_ID,NAME,MOBILEPHONE,TELPHONE,COMPANY,DUTY,SEX,COMPANY_ADDR,COMPANY_ORG,REMARK,TYPE,IS_DEL,RES_LAST_CALL_DATE,INPUT_DATE,INPUT_ACC,UPDATE_DATE,UPDATE_ACC,IS_MAJOR,RES_GROUP_ID,OWNER_ACC,STATUS,ORG_ID,SIGN_DATE,INPUT_STATUS,OWNER_START_DATE,FILTER_COUNT,FILTER_TYPE,OPREATE_TYPE,FAX,EMAIL,UNITHOME,UNITINTRODUCTION,AMOYTOCUSTOMER_DATE,QQ,KEYWORD,CONTRACT_NUMBER,DEFINED1,DEFINED2,DEFINED3,DEFINED4,DEFINED5,DEFINED6,DEFINED7,DEFINED8,DEFINED9,DEFINED10,ALTERNATE_PHONE2,SIGN_ACC,SIGN_NAME,NEXTFOLLOW_DATE,BIRTHDAY,CALL_DATE_POSTPONED,REASON_FOR_CALLDELAY,RECUCLING_TYPE_DETAILS,AGAINWASH_COUNT,ACTION_DATE,LAST_CUST_FOLLOW_ID,SERVICE_ACC,SERVICE_NAME,SERVICE_LEVEL,VISITING_DATE,NEXT_VISITING_DATE,SERVICE_LABEL_CODE,SERVICE_LABEL_NAME,IS_PRECEDENCE,FOR_THE_CUSTOMER_TIME,LAST_VISIT_ACC,STATE,PLAN_DATE,ADDRESS,COMPANY_MONEY,COMPANY_USER,COMPANY_TRADE,COMPANY_FAX,LOSING_ID,LOSING_REMARK,PROVINCE_ID,CITY_ID,COUNTY_ID,LAST_LOG_ID,WANGWANG,SCOPE,MAIN_LINKMAN,tao_No ,IMPORT_DEPT_ID,LIFE_CODE,last_Option_Id
		)values<foreach collection="list" item="bean" separator=",">(
				#{bean.resCustId,jdbcType=VARCHAR},#{bean.name,jdbcType=VARCHAR},#{bean.mobilephone,jdbcType=VARCHAR},#{bean.telphone,jdbcType=VARCHAR},#{bean.company,jdbcType=VARCHAR},#{bean.duty,jdbcType=VARCHAR},#{bean.sex,jdbcType=VARCHAR},#{bean.companyAddr,jdbcType=VARCHAR},#{bean.companyOrg,jdbcType=VARCHAR},#{bean.remark,jdbcType=VARCHAR},#{bean.type,jdbcType=DECIMAL},#{bean.isDel,jdbcType=DECIMAL},#{bean.resLastCallDate,jdbcType=TIMESTAMP},#{bean.inputDate,jdbcType=TIMESTAMP},#{bean.inputAcc,jdbcType=VARCHAR},#{bean.updateDate,jdbcType=TIMESTAMP},#{bean.updateAcc,jdbcType=VARCHAR},#{bean.isMajor,jdbcType=DECIMAL},#{bean.resGroupId,jdbcType=VARCHAR},#{bean.ownerAcc,jdbcType=VARCHAR},#{bean.status,jdbcType=DECIMAL},#{bean.orgId,jdbcType=VARCHAR},#{bean.signDate,jdbcType=TIMESTAMP},#{bean.inputStatus,jdbcType=DECIMAL},#{bean.ownerStartDate,jdbcType=TIMESTAMP},#{bean.filterCount,jdbcType=DECIMAL},#{bean.filterType,jdbcType=DECIMAL},#{bean.opreateType,jdbcType=DECIMAL},#{bean.fax,jdbcType=VARCHAR},#{bean.email,jdbcType=VARCHAR},#{bean.unithome,jdbcType=VARCHAR},#{bean.unitintroduction,jdbcType=VARCHAR},#{bean.amoytocustomerDate,jdbcType=TIMESTAMP},#{bean.qq,jdbcType=VARCHAR},#{bean.keyWord,jdbcType=VARCHAR},#{bean.contractNumber,jdbcType=VARCHAR},#{bean.defined1,jdbcType=VARCHAR},#{bean.defined2,jdbcType=VARCHAR},#{bean.defined3,jdbcType=VARCHAR},#{bean.defined4,jdbcType=VARCHAR},#{bean.defined5,jdbcType=VARCHAR},#{bean.defined6,jdbcType=VARCHAR},#{bean.defined7,jdbcType=VARCHAR},#{bean.defined8,jdbcType=VARCHAR},#{bean.defined9,jdbcType=VARCHAR},#{bean.defined10,jdbcType=VARCHAR},#{bean.alternatePhone2,jdbcType=VARCHAR},#{bean.signAcc,jdbcType=VARCHAR},#{bean.signName,jdbcType=VARCHAR},#{bean.nextFollowDate,jdbcType=VARCHAR},#{bean.birthday,jdbcType=VARCHAR},#{bean.callDatePostponed,jdbcType=TIMESTAMP},#{bean.reasonForCalldelay,jdbcType=VARCHAR},#{bean.recuclingTypeDetails,jdbcType=VARCHAR},#{bean.againwashCount,jdbcType=VARCHAR},#{bean.actionDate,jdbcType=TIMESTAMP},#{bean.lastCustFollowID,jdbcType=VARCHAR},#{bean.serviceAcc,jdbcType=VARCHAR},#{bean.serviceName,jdbcType=VARCHAR},#{bean.serviceLevel,jdbcType=VARCHAR},#{bean.visitingDate,jdbcType=TIMESTAMP},#{bean.nextVisitingDate,jdbcType=TIMESTAMP},#{bean.serviceLabelCode,jdbcType=VARCHAR},#{bean.serviceLabelName,jdbcType=VARCHAR},#{bean.isPrecedence,jdbcType=DECIMAL},#{bean.forTheCustomerTime,jdbcType=TIMESTAMP},#{bean.lastVisitAcc,jdbcType=VARCHAR},#{bean.state,jdbcType=DECIMAL},#{bean.planDate,jdbcType=TIMESTAMP},#{bean.address,jdbcType=VARCHAR},#{bean.companyMoney,jdbcType=VARCHAR},#{bean.companyUser,jdbcType=VARCHAR},#{bean.companyTrade,jdbcType=VARCHAR},#{bean.companyFax,jdbcType=VARCHAR},#{bean.losingId,jdbcType=VARCHAR},#{bean.losingRemark,jdbcType=VARCHAR},#{bean.provinceId,jdbcType=DECIMAL},#{bean.cityId,jdbcType=DECIMAL},#{bean.countyId,jdbcType=DECIMAL},#{bean.lastLogId,jdbcType=VARCHAR},#{bean.wangwang,jdbcType=VARCHAR},#{bean.scope,jdbcType=VARCHAR},#{bean.mainLinkman,jdbcType=VARCHAR},#{bean.taoNo,jdbcType=DECIMAL} ,#{bean.importDeptId,jdbcType=VARCHAR} ,#{bean.lifeCode,jdbcType=VARCHAR},#{bean.lastOptionId,jdbcType=VARCHAR}				
		)</foreach>
	</insert>
	
	<!-- 修改实体 -->
	<update id="update" parameterType="com.qftx.tsm.cust.bean.ResCustInfoBean">
		update
		<include refid="table_name" />
		<include refid="trents_update_set_sql" />
		where ORG_ID = #{orgId} and RES_CUST_ID = #{resCustId} 
	</update>
	
	<!-- 修改实体【form 表单】 -->
	<update id="updateForm" parameterType="com.qftx.tsm.cust.bean.ResCustInfoBean">
		update
		<include refid="table_name" />
		<include refid="form_trents_update_set_sql" />
		where ORG_ID = #{orgId} and RES_CUST_ID = #{resCustId} 
	</update>
	
		<!-- 修改实体 ,跟新ACTION_DATE为null-->
	<update id="update2" parameterType="com.qftx.tsm.cust.bean.ResCustInfoBean">
		update
		<include refid="table_name" />
		<include refid="trents_update_set_sql2" />
		where ORG_ID = #{orgId} and RES_CUST_ID = #{resCustId} 
	</update>

	<!-- 动态修改实体 -->
	<update id="updateTrends" parameterType="com.qftx.tsm.cust.bean.ResCustInfoBean">
		update
		<include refid="table_name" />
		<include refid="trents_update_set_sql" />
		where RES_CUST_ID = #{resCustId}
	</update>


	<!-- 删除 -->
	<delete id="delete" parameterType="string">
		delete
		<include refid="table_name" />
		where RES_CUST_ID = #{resCustId}
	</delete>

	<!-- 批量删除 -->
	<update id="deleteBatch" parameterType="map">
		update
		<include refid="table_name" />
		set IS_DEL = 1,UPDATE_ACC =#{updateacc},UPDATE_DATE = sysdate
		where
		RES_CUST_ID in
		<foreach collection="ids" item="id" open="(" separator=","
			close=")">
			#{id}
		</foreach>
	</update>
	
	<!-- 我的客户 资源 查询分页列表 计划 -->
	<select id="findMyResCustPlanListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		SELECT T.NAME,
		       T.RES_CUST_ID,
		       T.COMPANY,
		       T.OWNER_ACC,
		       T.STATUS,
		       T.TYPE,
		       T.OWNER_START_DATE,
		       T.MOBILEPHONE,
		       T.TELPHONE,
		       T.ALTERNATE_PHONE2,
		       T.IS_MAJOR,
		       T.PLAN_DATE,
		       T.ACTION_DATE,
		       T.NEXTFOLLOW_DATE,
		       T.IS_PRECEDENCE,
		       T.MAIN_LINKMAN,
		       T.RES_GROUP_ID,
		       t2.context as RES_REMARK
		  FROM 
		  (
		  	SELECT 
		  		T1.NAME,
		  		T1.RES_GROUP_ID,
			    T1.RES_CUST_ID,
			    T1.COMPANY,
			    T1.OWNER_ACC,
			    T1.STATUS,
			    T1.TYPE,
			    T1.OWNER_START_DATE,
			    T1.MOBILEPHONE,
			    T1.TELPHONE,
			    T1.ALTERNATE_PHONE2,
			    T1.IS_MAJOR,
			    T1.PLAN_DATE,
			    T1.ACTION_DATE,
			    T1.NEXTFOLLOW_DATE,
		        T1.IS_PRECEDENCE,
		        T1.MAIN_LINKMAN,
		        T1.LAST_LOG_ID 
		  	 FROM TSM_RES_CUST_INFO T1
		  	 WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
			   AND T1.TYPE IN (1,3) 
			   AND T1.STATUS IN (2,3) 
			   AND T1.IS_DEL = 0 
			   <if test="adminAcc != null and adminAcc != ''">
			   	AND T1.OWNER_ACC IN (SELECT TTGM.MEMBER_ACC
		          FROM TSM_GROUP_SHAREINFO TGS
		         RIGHT JOIN TSM_TEAM_GROUP_MEMBER TTGM
		            ON  TGS.ORG_ID= #{orgId} and TTGM.ORG_ID= #{orgId} and  TTGM.GROUP_ID = TGS.GROUP_ID
		         WHERE SHARE_ACC = #{adminAcc,jdbcType=VARCHAR}) 
			   </if>
			   <if test="ownerAccs!=null">
		       		AND T1.OWNER_ACC IN 
					<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
						#{item}
					</foreach>
		       </if>
			   <if test="ownerAcc != null and ownerAcc != ''">
				    AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
			   </if>
			   <if test='noteType != null and noteType == "2"'>
			   		AND T1.ACTION_DATE IS NULL 
			   </if>
			   <if test='noteType != null and noteType == "3"'>
			   		AND T1.ACTION_DATE IS NOT NULL 
			   </if>
			   <if test='noteType != null and noteType == "4"'>
			   		AND T1.PLAN_DATE IS NOT NULL 
			   		AND STR_TO_DATE(DATE_FORMAT(T1.PLAN_DATE,'%Y-%m-%d'),'%Y-%m-%d') &gt;= STR_TO_DATE(DATE_FORMAT(NOW(),'%Y-%m-%d'),'%Y-%m-%d') 
			   </if>
			   <if test='noteType != null and noteType == "5"'>
			   		AND T1.PLAN_DATE IS NULL 
			   </if>
			   <if test="name != null and name != ''">
			   		AND T1.NAME LIKE CONCAT(#{name,jdbcType=VARCHAR},'%') 
			   </if>
			   <if test="telphone != null and telphone != ''">
			   		AND (T1.MOBILEPHONE = #{telphone} or T1.TELPHONE = #{telphone} or T1.ALTERNATE_PHONE2 = #{telphone}) 
			   </if>
			   <if test="pstartDate != null and pstartDate != ''">
		       		AND STR_TO_DATE(DATE_FORMAT(T1.OWNER_START_DATE,'%Y-%m-%d'),'%Y-%m-%d') &gt;= STR_TO_DATE(#{pstartDate},'%Y-%m-%d')
		       </if>
		       <if test="pendDate != null and pendDate != ''">
		       		AND STR_TO_DATE(DATE_FORMAT(T1.OWNER_START_DATE,'%Y-%m-%d'),'%Y-%m-%d') &lt;= STR_TO_DATE(#{pendDate},'%Y-%m-%d')
		       </if>
		       <if test="startActionDate != null and startActionDate != ''">
		       		AND STR_TO_DATE(DATE_FORMAT(T1.ACTION_DATE,'%Y-%m-%d'),'%Y-%m-%d') &gt;= STR_TO_DATE(#{startActionDate},'%Y-%m-%d')
		       </if>
		       <if test="endActionDate != null and endActionDate != ''">
		       		AND STR_TO_DATE(DATE_FORMAT(T1.ACTION_DATE,'%Y-%m-%d'),'%Y-%m-%d') &lt;= STR_TO_DATE(#{endActionDate},'%Y-%m-%d')
		       </if>
		       <if test="queryText != null and queryText != ''">
		       		AND (T1.NAME LIKE CONCAT('%',#{queryText},'%') OR T1.TELPHONE LIKE CONCAT('%',#{queryText},'%') OR T1.MOBILEPHONE LIKE CONCAT('%',#{queryText},'%') OR T1.MAIN_LINKMAN LIKE CONCAT('%',#{queryText},'%'))
		       </if>
		        <if test="groupId != null and groupId != ''">
		       		AND T1.RES_GROUP_ID=#{groupId}
		       </if>
		       <!-- 查询结果排除ids by lizhihui-->
		       <if test="rejectIds != null and rejectIds.size()>0">
		       		<foreach collection="rejectIds" item="id">
		       			and T1.RES_CUST_ID !=#{id}
		       		</foreach>
		       </if>
		  ) T 
		  left join 
		  (
		  	select
		  		t3.context,
		  		t3.ses_id,
				t3.trcl_id
			 from tsm_res_custinfo_log t3 
			 where t3.org_id=#{orgId} 
			 and t3.is_del = 0
			) t2 on t.RES_CUST_ID = t2.ses_id and t.last_log_id = t2.trcl_id
		 WHERE 1=1 
	       <if test="isHaveResRemark != null and isHaveResRemark == 1 ">
	       		AND t2.context is not null
	       </if>
	       ORDER BY T.OWNER_START_DATE DESC,T.IS_MAJOR DESC 
	</select>
	
	<!-- 我的客户 资源 查询分页列表 -->
	<select id="findMyResCustListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		  	SELECT 
		  		T1.NAME,
			    T1.RES_CUST_ID,
			    T1.COMPANY,
			    T1.OWNER_ACC,
			    T1.STATUS,
			    T1.TYPE,
			    T1.OWNER_START_DATE,
			    T1.MOBILEPHONE,
			    T1.TELPHONE,
			    T1.ALTERNATE_PHONE2,
			    T1.IS_MAJOR,
			    T1.PLAN_DATE,
			    T1.ACTION_DATE,
			    T1.NEXTFOLLOW_DATE,
		        T1.IS_PRECEDENCE,
		        T1.MAIN_LINKMAN,
		        T1.RES_GROUP_ID,
		        T1.LAST_LOG_ID,
		        T1.FILTER_TYPE,
		        T1.DEFINED1,
		        T1.DEFINED2,
		        T1.DEFINED3,
		        T1.DEFINED4,
		        T1.DEFINED5,
		        T1.DEFINED6,
		        T1.DEFINED7,
		        T1.DEFINED8,
		        T1.DEFINED9,
		        T1.DEFINED10,
		        T1.DEFINED11,
		        T1.DEFINED12,
		        T1.DEFINED13,
		        T1.DEFINED14,
		        T1.DEFINED15, 
		        T1.DEFINED16, 
		        T1.DEFINED17, 
		        T1.DEFINED18,
		        T1.IMPORT_DEPT_ID,
		        T1.COMPANY_MONEY,
		        T1.COMPANY_USER,
		        T1.COMPANY_FAX,
		        T1.PROVINCE_ID,
		        T1.CITY_ID,
		        T1.COUNTY_ID,
		        T1.KEYWORD,
		        T1.COMPANY_TRADE,
		        T1.SOURCE ,
		        T1.INPUT_STATUS
		  	 <!-- <if test="queryResLog"> ,t2.context as RES_REMARK </if> -->
		  	 FROM TSM_RES_CUST_INFO T1
		  	 <!-- <if test="queryResLog">
		  	 left join tsm_res_custinfo_log t2
  				on t2.org_id = #{orgId,jdbcType=VARCHAR}  and t2.ses_id=T1.RES_CUST_ID and t1.last_log_id =t2.trcl_id
		  	 </if> -->
		  	 WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
			   AND T1.TYPE IN (1,3) 
			   AND T1.STATUS IN (2,3) 
			   AND T1.IS_DEL = 0 
			   <if test="custIds != null and custIds.size() > 0">
			   		AND T1.RES_CUST_ID IN 
			   			<foreach collection="custIds" item="cid" open="(" separator="," close=")">
			   				#{cid}
			   			</foreach>
			   </if>
			   <choose>
				   <when test="adminAcc != null and adminAcc != '' and ownerAccs!=null and ownerAccs.size() > 0">
			       		AND T1.OWNER_ACC IN 
						<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
							#{item}
						</foreach>
				   </when>
				   <otherwise>
				   		AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
				   </otherwise>
			   </choose>
			   <if test='noteType != null and noteType == "2"'>
			   		AND T1.OWNER_ACTION_DATE IS NULL 
			   </if>
			   <if test='noteType != null and noteType == "3"'>
			   		AND T1.OWNER_ACTION_DATE IS NOT NULL 
			   </if>
			   <if test='noteType != null and noteType == "4"'>
			   		<choose>
		       			<when test="ids != null and ids.size() > 0">
		       				AND (
		       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       				OR T1.RES_CUST_ID IN <foreach collection="ids" item="item" open="(" separator="," close=")">#{item}</foreach>
		       				)
		       			</when>
		       			<otherwise>
				       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
				       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
		       			</otherwise>
		       		</choose>
			   </if>
			   <if test='noteType != null and noteType == "5"'>
			   		AND T1.OWNER_ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
			   </if>
			   <if test='noteType != null and noteType == "6"'>
			   		AND T1.IS_PRECEDENCE = 1 
			   </if>
			   <if test='noteType != null and noteType == "7"'>
			   		AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 7 
			   </if>
			   <if test='noteType != null and noteType == "8"'>
			   		<choose>
						<when test='expireType != null and expireType = "1"'>
							AND DATEDIFF(NOW(),T1.OWNER_START_DATE) >= ${recyleDay }
						</when>
						<when test='expireType != null and expireType = "2"'>
							AND DATEDIFF(NOW(),IFNULL(T1.ACTION_DATE,T1.OWNER_START_DATE)) >= ${recyleDay }
						</when>
						<otherwise></otherwise>
					</choose>
			   </if>
			   
			   <if test="inputStatusList != null and inputStatusList.size() > 0">
			   		AND T1.INPUT_STATUS IN 
			   			<foreach collection="inputStatusList" item="inputId" open="(" separator="," close=")">
			   				#{inputId}
			   			</foreach>
			   </if>
			   
			   <if test="name != null and name != ''">
			   		AND T1.NAME LIKE CONCAT(#{name,jdbcType=VARCHAR},'%') 
			   </if>
			   <if test="source != null">
			   		AND T1.SOURCE = #{source,jdbcType=DECIMAL} 
			   </if>
			   <if test="telphone != null and telphone != ''">
			   		AND (T1.MOBILEPHONE = #{telphone} or T1.TELPHONE = #{telphone} or T1.ALTERNATE_PHONE2 = #{telphone}) 
			   </if>
			   <if test="pstartDate != null and pstartDate != ''">
		       		AND T1.OWNER_START_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="pendDate != null and pendDate != ''">
		       		AND T1.OWNER_START_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="startActionDate != null and startActionDate != ''">
		       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="endActionDate != null and endActionDate != ''">
		       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="startDate != null and startDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="endDate != null and endDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="queryText != null and queryText != ''">
		       		<choose>
		       			<when test='queryType != null and queryType == "custName"'>
		       				AND T1.NAME LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<when test='queryType != null and queryType == "mainLinkman"'>
		       				AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<when test='queryType != null and queryType == "company"'>
		       				AND T1.COMPANY LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<otherwise>
		       				AND T1.${queryType} LIKE CONCAT('%',#{queryText},'%') 
		       			</otherwise>
		       		</choose>
		       </if>
		       <if test="importDeptIds != null and importDeptIds.size() > 0">
		       		AND T1.IMPORT_DEPT_ID IN 
		       			<foreach collection="importDeptIds" item="ipd" open="(" separator="," close=")">
		       				#{ipd} 
		       			</foreach>
		       </if>
		       <if test="groupId != null and groupId != ''">
		       		AND T1.RES_GROUP_ID=#{groupId}
		       </if>
		        <if test="defined1 != null and defined1 != ''">
				   AND T1.DEFINED1 = #{defined1,jdbcType=VARCHAR} 
				</if>
				<if test="defined2 != null and defined2 != ''">
				   AND T1.DEFINED2 = #{defined2,jdbcType=VARCHAR} 
				</if>
				<if test="defined3 != null and defined3 != ''">
					AND T1.DEFINED3 = #{defined3,jdbcType=VARCHAR} 
				</if>
				<if test="defined4 != null and defined4 != ''">
					AND T1.DEFINED4 = #{defined4,jdbcType=VARCHAR}  
				</if>
				<if test="defined5 != null and defined5 != ''">
					AND T1.DEFINED5 = #{defined5,jdbcType=VARCHAR} 
				</if>
				<if test="defined6 != null and defined6 != ''">
					AND T1.DEFINED6 = #{defined6,jdbcType=VARCHAR} 
				</if>
				<if test="defined7 != null and defined7 != ''">
					AND T1.DEFINED7 = #{defined7,jdbcType=VARCHAR} 
				</if>
				<if test="defined8 != null and defined8 != ''">
					AND T1.DEFINED8 = #{defined8,jdbcType=VARCHAR} 
				</if>
				<if test="defined9 != null and defined9 != ''">
					AND T1.DEFINED9 = #{defined9,jdbcType=VARCHAR} 
				</if>
				<if test="defined10 != null and defined10 != ''">
					AND T1.DEFINED10 = #{defined10,jdbcType=VARCHAR} 
				</if>
				<if test="defined11 != null and defined11 != ''">
					AND T1.DEFINED11 = #{defined11,jdbcType=VARCHAR} 
				</if>
				<if test="defined12 != null and defined12 != ''">
					AND T1.DEFINED12 = #{defined12,jdbcType=VARCHAR} 
				</if>
				<if test="defined13 != null and defined13 != ''">
					AND T1.DEFINED13 = #{defined13,jdbcType=VARCHAR} 
				</if>
				<if test="defined14 != null and defined14 != ''">
					AND T1.DEFINED14 = #{defined14,jdbcType=VARCHAR} 
				</if>
				<if test="defined15 != null and defined15 != ''">
					AND T1.DEFINED15 = #{defined15,jdbcType=VARCHAR} 
				</if>
		       <if test="startdefined16!= null and startdefined16 !=''">
					AND T1.DEFINED16 >=
					 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test=" enddefined16 != null and enddefined16 !=''">
					AND T1.DEFINED16 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="startdefined17!= null and startdefined17 !=''">
					AND T1.DEFINED17 >=
					 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined17 != null and enddefined17 !=''">
					AND T1.DEFINED17 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>	
				<if test="startdefined18!= null and startdefined18 !=''">
					AND T1.DEFINED18 >=
					 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined18 != null and enddefined18 !=''">
					AND T1.DEFINED18 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="companyTrade != null and companyTrade != ''">
					AND T1.COMPANY_TRADE = #{companyTrade }
				</if>
		        <if test="queryResLog and isHaveResRemark != null and isHaveResRemark == 1 ">
	       			AND T1.LAST_LOG_ID IS NOT NULL
	       		</if>
		       <!-- 查询结果排除ids by lizhihui-->
				<if test="rejectIds != null and rejectIds.size()>0">
					<foreach collection="rejectIds" item="id" open="and T1.RES_CUST_ID not in(" close=")" separator=",">
						#{id}
					</foreach>
				</if>
				<!-- 所在地区查询 -->
				<if test="provinceId != null">
					AND T1.PROVINCE_ID = #{provinceId,jdbcType=DECIMAL}
				</if>
				<if test="cityId != null">
					AND T1.CITY_ID = #{cityId,jdbcType=DECIMAL}
				</if>
				<if test="countyId != null">
					AND T1.COUNTY_ID = #{countyId,jdbcType=DECIMAL}
				</if>
	       <if test="orderKey != null and orderKey != ''">
			   ORDER BY ${orderKey } 
		   </if>
	</select>
	
		<!-- 统计未筛查总数 -->
	<select id="findNoChooseCount" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultType="Integer">
			  	SELECT 
					COUNT(1)
			  	    FROM TSM_RES_CUST_INFO T1
			  	    WHERE
		                T1.ORG_ID = #{orgId,jdbcType=VARCHAR}
						<if test="ownerAcc != null and ownerAcc != ''">
							and T1.OWNER_ACC =#{ownerAcc,jdbcType=VARCHAR}
						</if>

			  	     <if test="keyWord != null and keyWord != ''">
                        <choose>
                            <when test='keyWord != null and keyWord == "1"'>
                                AND T1.TYPE IN (1,3)
                                AND T1.STATUS IN (2,3)
                            </when>
                            <when test='keyWord != null and keyWord == "2"'>
                                AND T1.TYPE = 1
                                AND T1.STATUS = 1
                            </when>
                        </choose>
                     </if>
			  	    
			            AND T1.IS_DEL = 0
                     <if test="groupId != null and groupId != ''">
                            AND T1.RES_GROUP_ID=#{groupId}
                     </if>
					 <if test="deptIds!=null">
						AND T1.import_dept_id IN
						<foreach collection="deptIds" item="deptId" open="(" separator=","
								 close=")">
							#{deptId}
						</foreach>
					 </if>
                    AND ( INPUT_STATUS NOT in ('1','2','3','4')  OR  INPUT_STATUS is NULL )
	</select>
	
	<select id="findMyResCustPhoneListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		SELECT T1.NAME,T1.RES_CUST_ID, T1.COMPANY,T1.OWNER_ACC,T1.STATUS,T1.TYPE,T1.OWNER_START_DATE,T1.MOBILEPHONE,T1.TELPHONE,
			T1.ALTERNATE_PHONE2,T1.IS_MAJOR,T1.PLAN_DATE,T1.ACTION_DATE,T1.NEXTFOLLOW_DATE,T1.IS_PRECEDENCE,T1.MAIN_LINKMAN,
			T1.RES_GROUP_ID,T1.LAST_LOG_ID,T1.FILTER_TYPE,T1.DEFINED1,T1.DEFINED2,T1.DEFINED3,T1.DEFINED4,T1.DEFINED5,
		    T1.DEFINED6,T1.DEFINED7,T1.DEFINED8,T1.DEFINED9,T1.DEFINED10,T1.DEFINED11,T1.DEFINED12,T1.DEFINED13,T1.DEFINED14,T1.DEFINED15, 
		        T1.DEFINED16, 
		        T1.DEFINED17, 
		        T1.DEFINED18,
		        T1.IMPORT_DEPT_ID,
		        T1.COMPANY_MONEY,
		        T1.COMPANY_USER,
		        T1.COMPANY_FAX,
		        T1.PROVINCE_ID,
		        T1.CITY_ID,
		        T1.COUNTY_ID,
		        T1.KEYWORD,
		        T1.COMPANY_TRADE,
		        T1.SOURCE,
		        T1.INPUT_STATUS
			  	 FROM TSM_RES_CUST_INFO T1 
			  	 WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
				   AND T1.TYPE IN (1,3) 
				   AND T1.STATUS IN (2,3) 
				   AND T1.IS_DEL = 0 
				   AND T1.MOBILEPHONE = #{queryText} 
				   <if test="custIds != null and custIds.size() > 0">
				   		AND T1.RES_CUST_ID IN 
				   			<foreach collection="custIds" item="cid" open="(" separator="," close=")">
				   				#{cid}
				   			</foreach>
				   </if>
				   <choose>
					   <when test="adminAcc != null and adminAcc != ''">
							<choose>
								<when test="ownerAccs!=null and ownerAccs.size() > 0">
									<if test="ownerAccs!=null">
							       		AND T1.OWNER_ACC IN 
										<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
											#{item}
										</foreach>
							        </if>
								</when>
								<otherwise>
									AND T1.OWNER_ACC = #{adminAcc,jdbcType=VARCHAR} 
								</otherwise>
							</choose>
					   </when>
					   <otherwise>
					   		AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
					   </otherwise>
				   </choose>
				   <if test='noteType != null and noteType == "2"'>
				   		AND T1.OWNER_ACTION_DATE IS NULL 
				   </if>
				   <if test='noteType != null and noteType == "3"'>
				   		AND T1.OWNER_ACTION_DATE IS NOT NULL 
				   </if>
				   <if test='noteType != null and noteType == "4"'>
				   		<choose>
			       			<when test="ids != null and ids.size() > 0">
			       				AND (
			       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
			       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
			       				OR T1.RES_CUST_ID IN <foreach collection="ids" item="item" open="(" separator="," close=")">#{item}</foreach>
			       				)
			       			</when>
			       			<otherwise>
					       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
					       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
			       			</otherwise>
			       		</choose>
				   </if>
				   <if test='noteType != null and noteType == "5"'>
				   		AND T1.OWNER_ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
				   </if>
				   <if test='noteType != null and noteType == "6"'>
				   		AND T1.IS_PRECEDENCE = 1 
				   </if>
				   <if test='noteType != null and noteType == "7"'>
				   		AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 7 
				   </if>
				   <if test='noteType != null and noteType == "8"'>
				   		<choose>
							<when test='expireType != null and expireType = "1"'>
								AND DATEDIFF(NOW(),T1.OWNER_START_DATE) >= ${recyleDay }
							</when>
							<when test='expireType != null and expireType = "2"'>
								AND DATEDIFF(NOW(),IFNULL(T1.ACTION_DATE,T1.OWNER_START_DATE)) >= ${recyleDay }
							</when>
							<otherwise></otherwise>
						</choose>
				   </if>
				   <if test="name != null and name != ''">
				   		AND T1.NAME LIKE CONCAT(#{name,jdbcType=VARCHAR},'%') 
				   </if>
				   <if test="source != null">
				   		AND T1.SOURCE = #{source,jdbcType=DECIMAL} 
				   </if>
				   <if test="telphone != null and telphone != ''">
				   		AND (T1.MOBILEPHONE = #{telphone} or T1.TELPHONE = #{telphone} or T1.ALTERNATE_PHONE2 = #{telphone}) 
				   </if>
				   <if test="pstartDate != null and pstartDate != ''">
			       		AND T1.OWNER_START_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
			       </if>
			       <if test="pendDate != null and pendDate != ''">
			       		AND T1.OWNER_START_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
			       </if>
			       <if test="startActionDate != null and startActionDate != ''">
			       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
			       </if>
			       <if test="endActionDate != null and endActionDate != ''">
			       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
			       </if>
			       <if test="startDate != null and startDate != ''">
			       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
			       </if>
			       <if test="endDate != null and endDate != ''">
			       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
			       </if>
			       <if test="importDeptIds != null and importDeptIds.size() > 0">
			       		AND T1.IMPORT_DEPT_ID IN 
			       			<foreach collection="importDeptIds" item="ipd" open="(" separator="," close=")">
			       				#{ipd} 
			       			</foreach>
			       </if>
			       <if test="groupId != null and groupId != ''">
			       		AND T1.RES_GROUP_ID=#{groupId}
			       </if>
			       <if test="defined1 != null and defined1 != ''">
				   AND T1.DEFINED1 = #{defined1,jdbcType=VARCHAR} 
				</if>
				<if test="defined2 != null and defined2 != ''">
				   AND T1.DEFINED2 = #{defined2,jdbcType=VARCHAR} 
				</if>
				<if test="defined3 != null and defined3 != ''">
					AND T1.DEFINED3 = #{defined3,jdbcType=VARCHAR} 
				</if>
				<if test="defined4 != null and defined4 != ''">
					AND T1.DEFINED4 = #{defined4,jdbcType=VARCHAR}  
				</if>
				<if test="defined5 != null and defined5 != ''">
					AND T1.DEFINED5 = #{defined5,jdbcType=VARCHAR} 
				</if>
				<if test="defined6 != null and defined6 != ''">
					AND T1.DEFINED6 = #{defined6,jdbcType=VARCHAR} 
				</if>
				<if test="defined7 != null and defined7 != ''">
					AND T1.DEFINED7 = #{defined7,jdbcType=VARCHAR} 
				</if>
				<if test="defined8 != null and defined8 != ''">
					AND T1.DEFINED8 = #{defined8,jdbcType=VARCHAR} 
				</if>
				<if test="defined9 != null and defined9 != ''">
					AND T1.DEFINED9 = #{defined9,jdbcType=VARCHAR} 
				</if>
				<if test="defined10 != null and defined10 != ''">
					AND T1.DEFINED10 = #{defined10,jdbcType=VARCHAR} 
				</if>
				<if test="defined11 != null and defined11 != ''">
					AND T1.DEFINED11 = #{defined11,jdbcType=VARCHAR} 
				</if>
				<if test="defined12 != null and defined12 != ''">
					AND T1.DEFINED12 = #{defined12,jdbcType=VARCHAR} 
				</if>
				<if test="defined13 != null and defined13 != ''">
					AND T1.DEFINED13 = #{defined13,jdbcType=VARCHAR} 
				</if>
				<if test="defined14 != null and defined14 != ''">
					AND T1.DEFINED14 = #{defined14,jdbcType=VARCHAR} 
				</if>
				<if test="defined15 != null and defined15 != ''">
					AND T1.DEFINED15 = #{defined15,jdbcType=VARCHAR} 
				</if>
			       <if test="startdefined16!= null and startdefined16 !=''">
						AND T1.DEFINED16 >=
						 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
			                                       '%Y-%m-%d %H:%i:%s')
					</if>
					<if test=" enddefined16 != null and enddefined16 !=''">
						AND T1.DEFINED16 <![CDATA[ <= ]]>
						STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
			                                       '%Y-%m-%d %H:%i:%s')
					</if>
					<if test="startdefined17!= null and startdefined17 !=''">
						AND T1.DEFINED17 >=
						 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
			                                       '%Y-%m-%d %H:%i:%s')
					</if>
					<if test="enddefined17 != null and enddefined17 !=''">
						AND T1.DEFINED17 <![CDATA[ <= ]]>
						STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
			                                       '%Y-%m-%d %H:%i:%s')
					</if>	
					<if test="startdefined18!= null and startdefined18 !=''">
						AND T1.DEFINED18 >=
						 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
			                                       '%Y-%m-%d %H:%i:%s')
					</if>
					<if test="enddefined18 != null and enddefined18 !=''">
						AND T1.DEFINED18 <![CDATA[ <= ]]>
						STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
			                                       '%Y-%m-%d %H:%i:%s')
					</if>
					<if test="companyTrade != null and companyTrade != ''">
						AND T1.COMPANY_TRADE = #{companyTrade }
					</if>
			        <if test="queryResLog and isHaveResRemark != null and isHaveResRemark == 1 ">
		       			AND t1.last_log_id is not null
		       		</if>
			       <!-- 查询结果排除ids by lizhihui-->
			       <if test="rejectIds != null and rejectIds.size()>0">
			       		<foreach collection="rejectIds" item="id" open="and T1.RES_CUST_ID not in(" close=")" separator=",">
			       			#{id}
			       		</foreach>
			       </if> 
			       <!-- 所在地区查询 -->
					<if test="provinceId != null">
						AND T1.PROVINCE_ID = #{provinceId,jdbcType=DECIMAL}
					</if>
					<if test="cityId != null">
						AND T1.CITY_ID = #{cityId,jdbcType=DECIMAL}
					</if>
					<if test="countyId != null">
						AND T1.COUNTY_ID = #{countyId,jdbcType=DECIMAL}
					</if>
					<if test="inputStatusList != null and inputStatusList.size() > 0">
						AND T1.INPUT_STATUS IN
						<foreach collection="inputStatusList" item="inputId" open="(" separator="," close=")">
							#{inputId}
						</foreach>
					</if>
		UNION 
		   SELECT T1.NAME,T1.RES_CUST_ID, T1.COMPANY,T1.OWNER_ACC,T1.STATUS,T1.TYPE,T1.OWNER_START_DATE,T1.MOBILEPHONE,T1.TELPHONE,
		T1.ALTERNATE_PHONE2,T1.IS_MAJOR,T1.PLAN_DATE,T1.ACTION_DATE,T1.NEXTFOLLOW_DATE,T1.IS_PRECEDENCE,T1.MAIN_LINKMAN,
		T1.RES_GROUP_ID,T1.LAST_LOG_ID,T1.FILTER_TYPE,T1.DEFINED1,T1.DEFINED2,T1.DEFINED3,T1.DEFINED4,T1.DEFINED5,
		    T1.DEFINED6,T1.DEFINED7,T1.DEFINED8,T1.DEFINED9,T1.DEFINED10,T1.DEFINED11,T1.DEFINED12,T1.DEFINED13,T1.DEFINED14,T1.DEFINED15, 
		        T1.DEFINED16, 
		        T1.DEFINED17, 
		        T1.DEFINED18,
		        T1.IMPORT_DEPT_ID,
		        T1.COMPANY_MONEY,
		        T1.COMPANY_USER,
		        T1.COMPANY_FAX,
		        T1.PROVINCE_ID,
		        T1.CITY_ID,
		        T1.COUNTY_ID,
		        T1.KEYWORD,
		        T1.COMPANY_TRADE,
		        T1.SOURCE,
		        T1.INPUT_STATUS
		  	 FROM TSM_RES_CUST_INFO T1 
		  	 WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
			   AND T1.TYPE IN (1,3) 
			   AND T1.STATUS IN (2,3) 
			   AND T1.IS_DEL = 0 
			   AND T1.TELPHONE = #{queryText} 
			   <if test="custIds != null and custIds.size() > 0">
			   		AND T1.RES_CUST_ID IN 
			   			<foreach collection="custIds" item="cid" open="(" separator="," close=")">
			   				#{cid}
			   			</foreach>
			   </if>
			   <choose>
				   <when test="adminAcc != null and adminAcc != ''">
						<choose>
							<when test="ownerAccs!=null and ownerAccs.size() > 0">
								<if test="ownerAccs!=null">
						       		AND T1.OWNER_ACC IN 
									<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
										#{item}
									</foreach>
						        </if>
							</when>
							<otherwise>
								AND T1.OWNER_ACC = #{adminAcc,jdbcType=VARCHAR} 
							</otherwise>
						</choose>
				   </when>
				   <otherwise>
				   		AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
				   </otherwise>
			   </choose>
			   <if test='noteType != null and noteType == "2"'>
			   		AND T1.OWNER_ACTION_DATE IS NULL 
			   </if>
			   <if test='noteType != null and noteType == "3"'>
			   		AND T1.OWNER_ACTION_DATE IS NOT NULL 
			   </if>
			   <if test='noteType != null and noteType == "4"'>
			   		<choose>
		       			<when test="ids != null and ids.size() > 0">
		       				AND (
		       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       				OR T1.RES_CUST_ID IN <foreach collection="ids" item="item" open="(" separator="," close=")">#{item}</foreach>
		       				)
		       			</when>
		       			<otherwise>
				       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
				       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
		       			</otherwise>
		       		</choose>
			   </if>
			   <if test='noteType != null and noteType == "5"'>
			   		AND T1.OWNER_ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
			   </if>
			   <if test='noteType != null and noteType == "6"'>
			   		AND T1.IS_PRECEDENCE = 1 
			   </if>
			   <if test='noteType != null and noteType == "7"'>
			   		AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 7 
			   </if>
			   <if test='noteType != null and noteType == "8"'>
			   		<choose>
						<when test='expireType != null and expireType = "1"'>
							AND DATEDIFF(NOW(),T1.OWNER_START_DATE) >= ${recyleDay }
						</when>
						<when test='expireType != null and expireType = "2"'>
							AND DATEDIFF(NOW(),IFNULL(T1.ACTION_DATE,T1.OWNER_START_DATE)) >= ${recyleDay }
						</when>
						<otherwise></otherwise>
					</choose>
			   </if>
			   <if test="name != null and name != ''">
			   		AND T1.NAME LIKE CONCAT(#{name,jdbcType=VARCHAR},'%') 
			   </if>
			   <if test="source != null">
			   		AND T1.SOURCE = #{source,jdbcType=DECIMAL} 
			   </if>
			   <if test="telphone != null and telphone != ''">
			   		AND (T1.MOBILEPHONE = #{telphone} or T1.TELPHONE = #{telphone} or T1.ALTERNATE_PHONE2 = #{telphone}) 
			   </if>
			   <if test="pstartDate != null and pstartDate != ''">
		       		AND T1.OWNER_START_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="pendDate != null and pendDate != ''">
		       		AND T1.OWNER_START_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="startActionDate != null and startActionDate != ''">
		       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="endActionDate != null and endActionDate != ''">
		       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="startDate != null and startDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="endDate != null and endDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="importDeptIds != null and importDeptIds.size() > 0">
		       		AND T1.IMPORT_DEPT_ID IN 
		       			<foreach collection="importDeptIds" item="ipd" open="(" separator="," close=")">
		       				#{ipd} 
		       			</foreach>
		       </if>
		       <if test="groupId != null and groupId != ''">
		       		AND T1.RES_GROUP_ID=#{groupId}
		       </if>
		       <if test="defined1 != null and defined1 != ''">
				   AND T1.DEFINED1 = #{defined1,jdbcType=VARCHAR} 
				</if>
				<if test="defined2 != null and defined2 != ''">
				   AND T1.DEFINED2 = #{defined2,jdbcType=VARCHAR} 
				</if>
				<if test="defined3 != null and defined3 != ''">
					AND T1.DEFINED3 = #{defined3,jdbcType=VARCHAR} 
				</if>
				<if test="defined4 != null and defined4 != ''">
					AND T1.DEFINED4 = #{defined4,jdbcType=VARCHAR}  
				</if>
				<if test="defined5 != null and defined5 != ''">
					AND T1.DEFINED5 = #{defined5,jdbcType=VARCHAR} 
				</if>
				<if test="defined6 != null and defined6 != ''">
					AND T1.DEFINED6 = #{defined6,jdbcType=VARCHAR} 
				</if>
				<if test="defined7 != null and defined7 != ''">
					AND T1.DEFINED7 = #{defined7,jdbcType=VARCHAR} 
				</if>
				<if test="defined8 != null and defined8 != ''">
					AND T1.DEFINED8 = #{defined8,jdbcType=VARCHAR} 
				</if>
				<if test="defined9 != null and defined9 != ''">
					AND T1.DEFINED9 = #{defined9,jdbcType=VARCHAR} 
				</if>
				<if test="defined10 != null and defined10 != ''">
					AND T1.DEFINED10 = #{defined10,jdbcType=VARCHAR} 
				</if>
				<if test="defined11 != null and defined11 != ''">
					AND T1.DEFINED11 = #{defined11,jdbcType=VARCHAR} 
				</if>
				<if test="defined12 != null and defined12 != ''">
					AND T1.DEFINED12 = #{defined12,jdbcType=VARCHAR} 
				</if>
				<if test="defined13 != null and defined13 != ''">
					AND T1.DEFINED13 = #{defined13,jdbcType=VARCHAR} 
				</if>
				<if test="defined14 != null and defined14 != ''">
					AND T1.DEFINED14 = #{defined14,jdbcType=VARCHAR} 
				</if>
				<if test="defined15 != null and defined15 != ''">
					AND T1.DEFINED15 = #{defined15,jdbcType=VARCHAR} 
				</if>
		       <if test="startdefined16!= null and startdefined16 !=''">
					AND T1.DEFINED16 >=
					 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test=" enddefined16 != null and enddefined16 !=''">
					AND T1.DEFINED16 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="startdefined17!= null and startdefined17 !=''">
					AND T1.DEFINED17 >=
					 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined17 != null and enddefined17 !=''">
					AND T1.DEFINED17 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>	
				<if test="startdefined18!= null and startdefined18 !=''">
					AND T1.DEFINED18 >=
					 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined18 != null and enddefined18 !=''">
					AND T1.DEFINED18 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="companyTrade != null and companyTrade != ''">
					AND T1.COMPANY_TRADE = #{companyTrade }
				</if>
		        <if test="queryResLog and isHaveResRemark != null and isHaveResRemark == 1 ">
	       			AND t1.last_log_id is not null
	       		</if>
		       <!-- 查询结果排除ids by lizhihui-->
				<if test="rejectIds != null and rejectIds.size()>0">
					<foreach collection="rejectIds" item="id" open="and T1.RES_CUST_ID not in(" close=")" separator=",">
						#{id}
					</foreach>
				</if>
				<!-- 所在地区查询 -->
				<if test="provinceId != null">
					AND T1.PROVINCE_ID = #{provinceId,jdbcType=DECIMAL}
				</if>
				<if test="cityId != null">
					AND T1.CITY_ID = #{cityId,jdbcType=DECIMAL}
				</if>
				<if test="countyId != null">
					AND T1.COUNTY_ID = #{countyId,jdbcType=DECIMAL}
				</if>
				<if test="inputStatusList != null and inputStatusList.size() > 0">
					AND T1.INPUT_STATUS IN
					<foreach collection="inputStatusList" item="inputId" open="(" separator="," close=")">
						#{inputId}
					</foreach>
				</if>
	</select>
	
	<sql id="findMyCommonCustSql">
		SELECT
	  		   T1.NAME,
		       T1.RES_CUST_ID,
		       T1.COMPANY,
		       T1.OWNER_ACC,
		       T1.STATUS,
		       T1.TYPE,
		       T1.OWNER_START_DATE,
		       T1.MOBILEPHONE,
		       T1.TELPHONE,
		       T1.ALTERNATE_PHONE2,
		       T1.IS_MAJOR,
		       T1.ACTION_DATE, 
		       T1.NEXTFOLLOW_DATE,
		       T1.RES_GROUP_ID,
		       T1.AMOYTOCUSTOMER_DATE,
		       (CASE DATE_FORMAT(T1.AMOYTOCUSTOMER_DATE, '%Y-%m-%d') WHEN DATE_FORMAT(now(), '%Y-%m-%d') THEN 1 ELSE 0 END) IS_TODAY ,
		       T1.MAIN_LINKMAN,
		       T1.LAST_OPTION_ID,
		       T1.LAST_CUST_TYPE_ID AS CUST_TYPE_ID,
		       T1.LAST_CUST_FOLLOW_ID,
		       T1.COMMON_ACC,
		       T1.SIGN_DATE,
		       T1.SIGN_ACC,
		       T1.DEFINED1,
		       T1.DEFINED2,
		       T1.DEFINED3,
		       T1.DEFINED4,
		       T1.DEFINED5,
		       T1.DEFINED6,
		       T1.DEFINED7,
		       T1.DEFINED8,
		       T1.DEFINED9,
		       T1.DEFINED10,
		       T1.DEFINED11,
		       T1.DEFINED12,
		       T1.DEFINED13,
		       T1.DEFINED14,
		       T1.DEFINED15 
		FROM TSM_RES_CUST_INFO T1
		  	WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
			   AND T1.TYPE = 2 
			    AND T1.IS_DEL = 0 
			   AND T1.COMMON_ACC = #{commonAcc} 
			   <if test="custIds != null and custIds.size() > 0">
			   		AND T1.RES_CUST_ID IN 
			   			<foreach collection="custIds" item="cid" open="(" separator="," close=")">
			   				#{cid}
			   			</foreach>
			   </if>
			   <choose>
			   		<when test='custType == "2"'>
			   			AND T1.STATUS IN (2,3) 
			   		</when>
			   		<when test='custType == "3"'>
			   			AND T1.STATUS = 6  
			   		</when>
			   		<otherwise>
			   			AND T1.STATUS IN (2,3,6) 
			   		</otherwise>
			   </choose>
			   <if test="commonAccs != null and commonAccs.size() > 0">
					AND T1.OWNER_ACC IN 
						<foreach collection="commonAccs" item="ca" open="(" separator="," close=")">
							#{ca} 
						</foreach>
			   </if>
			   <if test="custTypeId != null and custTypeId != ''">
		       		AND T1.LAST_CUST_TYPE_ID = #{custTypeId,jdbcType=VARCHAR} 
		       </if>
		       <if test="saleProcessId != null and saleProcessId != ''">
		       		AND T1.LAST_OPTION_ID = #{saleProcessId,jdbcType=VARCHAR}
		       </if>
		       <if test="resGroupId != null and resGroupId != ''">
		       		AND T1.RES_GROUP_ID = #{resGroupId,jdbcType=VARCHAR} 
		       </if>
		       <if test="startActionDate != null and startActionDate != ''">
		       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test="endActionDate != null and endActionDate != ''">
		       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="startDate != null and startDate != ''">
		       		AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="endDate != null and endDate != ''">
		       		AND T1.SIGN_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
	         	<if test="pstartDate != null and pstartDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="pendDate != null and pendDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test='lDateType != null and lDateType == 6'>
		       		AND T1.ACTION_DATE IS NULL 
		       </if>
		       <if test='oDateType != null and oDateType == 6'>
		       		AND T1.NEXTFOLLOW_DATE IS NULL 
		       </if>
		       <if test='noteType == "2"'>
		       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "3"'>
		       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "4"'>
		       		AND T1.ACTION_DATE  >= STR_TO_DATE(CONCAT(DATE_FORMAT(DATE_ADD(CURDATE(),INTERVAL -WEEKDAY(CURDATE())DAY),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test='noteType == "5"'>
		       		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
		       </if>
		       <if test='noteType == "6"'>
		       		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -30 DAY) 
		       </if>
		       <if test="labels != null and labels.size() > 0">
		       		<foreach collection="labels" item="label" separator=" " >
		       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
		       		</foreach> 
		       </if>
	</sql>
	
	<select id="findMyCommonCustListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		<include refid="findMyCommonCustSql" /> 
	  	<if test="queryText != null and queryText != ''">
       		<choose>
       			<when test='queryType != null and queryType == "1"'>
       				AND T1.NAME LIKE CONCAT('%',#{queryText},'%') 
       			</when>
       			<when test='queryType != null and queryType == "2"'>
       				AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{queryText},'%') 
       			</when>
       			<when test='queryType != null and queryType == "4"'>
       				AND T1.COMPANY LIKE CONCAT('%',#{queryText},'%') 
       			</when>
       			<otherwise>
       				AND T1.${queryType } LIKE CONCAT('%',#{queryText},'%') 
       			</otherwise>
       		</choose>
       </if>
		<if test="orderKey != null and orderKey != ''">
		   ORDER BY ${orderKey } 
	    </if>
	</select>
	
	<select id="findMyCommonCustPhoneListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
  		<include refid="findMyCommonCustSql" /> 
	        AND T1.MOBILEPHONE = #{queryText} 
	    UNION 
	        <include refid="findMyCommonCustSql" /> 
		    AND T1.TELPHONE = #{queryText} 
	</select>
	
	<sql id="findMyCustSql">
		 SELECT
	  		   T1.NAME,
		       T1.RES_CUST_ID,
		       T1.COMPANY,
		       T1.OWNER_ACC,
		       T1.STATUS,
		       T1.TYPE,
		       T1.OWNER_START_DATE,
		       T1.MOBILEPHONE,
		       T1.TELPHONE,
		       T1.ALTERNATE_PHONE2,
		       T1.IS_MAJOR,
		       T1.ACTION_DATE, 
		       T1.NEXTFOLLOW_DATE,
		       T1.RES_GROUP_ID,
		       T1.AMOYTOCUSTOMER_DATE,
		       (CASE DATE_FORMAT(T1.AMOYTOCUSTOMER_DATE, '%Y-%m-%d') WHEN DATE_FORMAT(now(), '%Y-%m-%d') THEN 1 ELSE 0 END) IS_TODAY ,
		       T1.MAIN_LINKMAN,
		       T1.LAST_OPTION_ID,
		       T1.LAST_CUST_TYPE_ID AS CUST_TYPE_ID,
		       T1.LAST_CUST_FOLLOW_ID,
		       T1.COMMON_ACC,
		       T1.DEFINED1,
		       T1.DEFINED2,
		       T1.DEFINED3,
		       T1.DEFINED4,
		       T1.DEFINED5,
		       T1.DEFINED6,
		       T1.DEFINED7,
		       T1.DEFINED8,
		       T1.DEFINED9,
		       T1.DEFINED10,
		       T1.DEFINED11,
		       T1.DEFINED12,
		       T1.DEFINED13,
		       T1.DEFINED14,
		       T1.DEFINED15, 
        	   T1.DEFINED16, 
	           T1.DEFINED17, 
	           T1.DEFINED18,
	           T1.IMPORT_DEPT_ID,
	           T1.COMPANY_MONEY,
	           T1.COMPANY_USER,
	           T1.COMPANY_FAX,
	           T1.PROVINCE_ID,
	           T1.CITY_ID,
	           T1.COUNTY_ID,
	           T1.KEYWORD,
	           T1.COMPANY_TRADE,
	           T1.SOURCE  
				FROM TSM_RES_CUST_INFO T1
		  		WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
			   AND T1.TYPE = 2 
			   AND T1.STATUS IN (2,3) 	
			   AND T1.IS_DEL = 0 
			    <if test="custIds != null and custIds.size() > 0">
			   		AND T1.RES_CUST_ID IN 
			   			<foreach collection="custIds" item="cid" open="(" separator="," close=")">
			   				#{cid}
			   			</foreach>
			    </if>
				<choose>
				   <when test="adminAcc != null and adminAcc != '' and ownerAccs!=null and ownerAccs.size() > 0">
						AND T1.OWNER_ACC IN 
							<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
								#{item}
							</foreach>
				   </when>
				   <otherwise>
						AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
				   </otherwise>
			    </choose>
				<if test="commonAccs != null and commonAccs.size() > 0">
					AND T1.COMMON_ACC IN 
						<foreach collection="commonAccs" item="ca" open="(" separator="," close=")">
							#{ca} 
						</foreach>
				</if>
				<if test='noteType=="9"'>
		     		AND T1.COMMON_ACC IS NOT NULL  
		     	</if>
		       <if test='noteType == "2"'>
		       		AND T1.AMOYTOCUSTOMER_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "3"'>
		       		<choose>
		       			<when test="ids != null and ids.size() > 0">
		       				AND (
		       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       				OR T1.RES_CUST_ID IN <foreach collection="ids" item="item" open="(" separator="," close=")">#{item}</foreach>
		       				)
		       			</when>
		       			<otherwise>
				       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
				       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
		       			</otherwise>
		       		</choose>
		       </if>
		       <if test='noteType == "5"'>
		       		AND T1.IS_MAJOR = 1  
		       </if>
		       <if test="name != null and name != ''">
			   		AND T1.NAME LIKE CONCAT(#{name,jdbcType=VARCHAR},'%') 
			   </if>
			   <if test="source != null">
			   		AND T1.SOURCE = #{source,jdbcType=DECIMAL} 
			   </if>
			   <if test="startDate != null and startDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="endDate != null and endDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="pstartDate != null and pstartDate != ''">
		       		AND T1.AMOYTOCUSTOMER_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="pendDate != null and pendDate != ''">
		       		AND T1.AMOYTOCUSTOMER_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="mainLinkman != null and mainLinkman != ''">
		       		AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{mainLinkman,jdbcType=VARCHAR},'%') 
		       </if>
		       <if test="isMajor != null and isMajor != ''">
		       		AND T1.IS_MAJOR = #{isMajor}
		       </if>
		       <if test='noteType == "4"'>
		       		AND T1.OWNER_ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "6"'>
		       		AND T1.OWNER_ACTION_DATE  >= STR_TO_DATE(CONCAT(DATE_FORMAT(DATE_ADD(CURDATE(),INTERVAL -WEEKDAY(CURDATE())DAY),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "7"'>
		       		AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 7 
		       </if>
		       <if test='noteType == "8"'>
		       		AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 30  
		       </if>
		       <if test="startActionDate != null and startActionDate != ''">
		       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="endActionDate != null and endActionDate != ''">
		       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="custTypeId != null and custTypeId != ''">
		       		AND T1.LAST_CUST_TYPE_ID = #{custTypeId,jdbcType=VARCHAR} 
		       </if>
		       <if test="saleProcessId != null and saleProcessId != ''">
		       		AND T1.LAST_OPTION_ID = #{saleProcessId,jdbcType=VARCHAR}
		       </if>
		       <if test='lDateType != null and lDateType == 6'>
		       		AND T1.ACTION_DATE IS NULL 
		       </if>
		       <if test='nDateType != null and nDateType == 6'>
		       		AND T1.NEXTFOLLOW_DATE IS NULL 
		       </if>
		       <if test="labels != null and labels.size() > 0">
		       		<foreach collection="labels" item="label" separator=" " >
		       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
		       		</foreach> 
		       </if>
		       <if test="groupId != null and groupId != ''">
		       		AND T1.RES_GROUP_ID=#{groupId}
		       </if>
		       <if test="defined1 != null and defined1 != ''">
				   AND T1.DEFINED1 = #{defined1,jdbcType=VARCHAR} 
				</if>
				<if test="defined2 != null and defined2 != ''">
				   AND T1.DEFINED2 = #{defined2,jdbcType=VARCHAR} 
				</if>
				<if test="defined3 != null and defined3 != ''">
					AND T1.DEFINED3 = #{defined3,jdbcType=VARCHAR} 
				</if>
				<if test="defined4 != null and defined4 != ''">
					AND T1.DEFINED4 = #{defined4,jdbcType=VARCHAR}  
				</if>
				<if test="defined5 != null and defined5 != ''">
					AND T1.DEFINED5 = #{defined5,jdbcType=VARCHAR} 
				</if>
				<if test="defined6 != null and defined6 != ''">
					AND T1.DEFINED6 = #{defined6,jdbcType=VARCHAR} 
				</if>
				<if test="defined7 != null and defined7 != ''">
					AND T1.DEFINED7 = #{defined7,jdbcType=VARCHAR} 
				</if>
				<if test="defined8 != null and defined8 != ''">
					AND T1.DEFINED8 = #{defined8,jdbcType=VARCHAR} 
				</if>
				<if test="defined9 != null and defined9 != ''">
					AND T1.DEFINED9 = #{defined9,jdbcType=VARCHAR} 
				</if>
				<if test="defined10 != null and defined10 != ''">
					AND T1.DEFINED10 = #{defined10,jdbcType=VARCHAR} 
				</if>
				<if test="defined11 != null and defined11 != ''">
					AND T1.DEFINED11 = #{defined11,jdbcType=VARCHAR} 
				</if>
				<if test="defined12 != null and defined12 != ''">
					AND T1.DEFINED12 = #{defined12,jdbcType=VARCHAR} 
				</if>
				<if test="defined13 != null and defined13 != ''">
					AND T1.DEFINED13 = #{defined13,jdbcType=VARCHAR} 
				</if>
				<if test="defined14 != null and defined14 != ''">
					AND T1.DEFINED14 = #{defined14,jdbcType=VARCHAR} 
				</if>
				<if test="defined15 != null and defined15 != ''">
					AND T1.DEFINED15 = #{defined15,jdbcType=VARCHAR} 
				</if>
		       <if test="startdefined16!= null and startdefined16 !=''">
					AND T1.DEFINED16 >=
					 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test=" enddefined16 != null and enddefined16 !=''">
					AND T1.DEFINED16 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="startdefined17!= null and startdefined17 !=''">
					AND T1.DEFINED17 >=
					 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined17 != null and enddefined17 !=''">
					AND T1.DEFINED17 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>	
				<if test="startdefined18!= null and startdefined18 !=''">
					AND T1.DEFINED18 >=
					 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined18 != null and enddefined18 !=''">
					AND T1.DEFINED18 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="companyTrade != null and companyTrade != ''">
					AND T1.COMPANY_TRADE = #{companyTrade }
				</if>
		       <!-- 查询结果排除ids by lizhihui-->
				<if test="rejectIds != null and rejectIds.size()>0">
					<foreach collection="rejectIds" item="id" open="and T1.RES_CUST_ID not in(" close=")" separator=",">
						#{id}
					</foreach>
				</if>
				<!-- 所在地区查询 -->
				<if test="provinceId != null">
					AND T1.PROVINCE_ID = #{provinceId,jdbcType=DECIMAL}
				</if>
				<if test="cityId != null">
					AND T1.CITY_ID = #{cityId,jdbcType=DECIMAL}
				</if>
				<if test="countyId != null">
					AND T1.COUNTY_ID = #{countyId,jdbcType=DECIMAL}
				</if>
	</sql>
	
	<!-- 我的客户 意向客户 查询列表 -->
	<select id="findMyCustListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		<include refid="findMyCustSql" /> 
	  	<if test="queryText != null and queryText != ''">
	       		<choose>
	       			<when test='queryType != null and queryType == "custName"'>
	       				AND T1.NAME LIKE CONCAT('%',#{queryText},'%') 
	       			</when>
	       			<when test='queryType != null and queryType == "mainLinkman"'>
	       				AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{queryText},'%') 
	       			</when>
	       			<when test='queryType != null and queryType == "company"'>
	       				AND T1.COMPANY LIKE CONCAT('%',#{queryText},'%') 
	       			</when>
	       			<otherwise>
	       				AND T1.${queryType} LIKE CONCAT('%',#{queryText},'%') 
	       			</otherwise>
	       		</choose>
	    </if>
		<if test="orderKey != null and orderKey != ''">
		   ORDER BY ${orderKey } 
	    </if>
	</select>
	
	<select id="findMyCustPhoneListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
	 		<include refid="findMyCustSql" /> 
	        AND T1.MOBILEPHONE = #{queryText} 
	    UNION 
	        <include refid="findMyCustSql" /> 
		    AND T1.TELPHONE = #{queryText} 
	</select>
	
	<!-- 我的客户  签约客户列表查询 -->
	<sql id="findSignCustSql">
		SELECT 
			T1.NAME,
	        T1.RES_CUST_ID,
	        T1.RES_GROUP_ID,
	        T1.COMPANY,
	        T1.OWNER_ACC,
	        T1.STATUS,
	        T1.TYPE,
	        T1.OWNER_START_DATE,
	        T1.MOBILEPHONE,
	        T1.TELPHONE,
	        T1.ALTERNATE_PHONE2,
	        T1.IS_MAJOR,
	        T1.ACTION_DATE,
	        T1.NEXTFOLLOW_DATE,
	        T1.SIGN_ACC,
	        T1.SIGN_DATE,
	        T1.LAST_CUST_TYPE_ID,
	        T1.MAIN_LINKMAN,
	        T1.COMMON_ACC,
	        T1.DEFINED1,
	        T1.DEFINED2,
	        T1.DEFINED3,
	        T1.DEFINED4,
	        T1.DEFINED5,
	        T1.DEFINED6,
	        T1.DEFINED7,
	        T1.DEFINED8,
	        T1.DEFINED9,
	        T1.DEFINED10,
	        T1.DEFINED11,
	        T1.DEFINED12,
	        T1.DEFINED13,
	        T1.DEFINED14,
	        T1.DEFINED15, 
       	    T1.DEFINED16, 
            T1.DEFINED17, 
            T1.DEFINED18,
            T1.IMPORT_DEPT_ID,
            T1.COMPANY_MONEY,
            T1.COMPANY_USER,
            T1.COMPANY_FAX,
            T1.PROVINCE_ID,
            T1.CITY_ID,
            T1.COUNTY_ID,
            T1.KEYWORD,
            T1.COMPANY_TRADE,
            T1.SERVICE_ACC,
            T1.SOURCE,
           		T1.ORG_ID,
				T1.BIRTHDAY,
				T1.DUTY,
				T1.SEX,
				T1.COMPANY_ADDR,
				T1.COMPANY_ORG,
				T1.REMARK,
				T1.RES_LAST_CALL_DATE,
				T1.INPUT_DATE,
				T1.INPUT_ACC,
				T1.UPDATE_DATE,
				T1.UPDATE_ACC,
				T1.INPUT_STATUS,
				T1.FILTER_COUNT,
				T1.OPREATE_TYPE,
				T1.FILTER_TYPE,
				T1.COORDINATES,
				T1.FAX,
				T1.EMAIL,
				T1.UNITHOME,
				T1.UNITINTRODUCTION,
				T1.AMOYTOCUSTOMER_DATE,
				T1.EFFECTIVE_FOLLOWUP_DATE,
				T1.FOLLOWUP_DATE,
				T1.QQ,
				T1.CONTRACT_NUMBER,
				T1.SIGN_NAME,
				T1.CALL_DATE_POSTPONED,
				T1.REASON_FOR_CALLDELAY,
				T1.RECUCLING_TYPE_DETAILS,
				T1.AGAINWASH_COUNT,
				T1.LAST_CUST_FOLLOW_ID,
				T1.SERVICE_NAME,
				T1.SERVICE_LEVEL,
				T1.VISITING_DATE,
				T1.NEXT_VISITING_DATE,
				T1.SERVICE_LABEL_CODE,
				T1.SERVICE_LABEL_NAME,
				T1.IS_PRECEDENCE,
				T1.FOR_THE_CUSTOMER_TIME,
				T1.LAST_VISIT_ACC,
				T1.IS_DEL,
				T1.plan_date,
				T1.address,
				T1.state,
				T1.losing_id,
				T1.losing_remark,
				T1.last_log_id,
				T1.is_concat,
				T1.wangwang,
				T1.scope,
				T1.tao_no,
				T1.SIGN_BEFORE_STATUS,
				T1.SIGN_BEFORE_TYPE,
				T1.life_code,
				T1.last_Option_Id,
				T1.last_Loss_Date,
				T1.LABEL_CODE,
				T1.LABEL_NAME,
				T1.service_assign_type,
				T1.service_assign_date,
				T1.service_assign_groups,
				T1.OWNER_ACTION_DATE   
		FROM TSM_RES_CUST_INFO T1 
	  		WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
			  	AND T1.TYPE = 2 
			    AND T1.STATUS =6  	
			    AND T1.IS_DEL = 0 
			     <if test="custIds != null and custIds.size() > 0">
			   		AND T1.RES_CUST_ID IN 
			   			<foreach collection="custIds" item="cid" open="(" separator="," close=")">
			   				#{cid}
			   			</foreach>
			     </if>
				 <choose>
				   <when test="adminAcc != null and adminAcc != '' and ownerAccs!=null and ownerAccs.size() > 0">
						AND T1.OWNER_ACC IN 
							<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
								#{item}
							</foreach>
				   </when>
				   <otherwise>
						AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
				   </otherwise>
			    </choose>
				<if test="commonAccs != null and commonAccs.size() > 0">
					AND T1.COMMON_ACC IN 
						<foreach collection="commonAccs" item="ca" open="(" separator="," close=")">
							#{ca} 
						</foreach>
				</if>
			   <if test="serviceAccs != null and serviceAccs.size() > 0">
					AND T1.SERVICE_ACC IN 
						<foreach collection="serviceAccs" item="ca" open="(" separator="," close=")">
							#{ca} 
						</foreach>
			   </if>
			   <if test='noteType=="8"'>
			     		AND T1.COMMON_ACC IS NOT NULL 
			   </if>
			   <if test="name != null and name != ''">
			   		AND T1.NAME LIKE CONCAT(#{name,jdbcType=VARCHAR},'%') 
			   </if>
			   <if test="source != null">
			   		AND T1.SOURCE = #{source,jdbcType=DECIMAL} 
			   </if>
			   <if test="telphone != null and telphone != ''">
			   		AND (T1.MOBILEPHONE = #{telphone} or T1.TELPHONE = #{telphone} or T1.ALTERNATE_PHONE2 = #{telphone}) 
			   </if>
			   <if test="startActionDate != null and startActionDate != ''">
		       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="endActionDate != null and endActionDate != ''">
		       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="startDate != null and startDate != ''">
		       		AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="endDate != null and endDate != ''">
		       		AND T1.SIGN_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
	         	<if test="pstartDate != null and pstartDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="pendDate != null and pendDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="mainLinkman != null and mainLinkman != ''">
		       		AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{mainLinkman,jdbcType=VARCHAR},'%') 
		       </if>
		       <if test='noteType == "2"'>
		        	AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(NOW(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "3"'>
		        	AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(NOW(),'%Y-%m'),'-01 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "4"'>
		        	<choose>
		       			<when test="ids != null and ids.size() > 0">
		       				AND (
		       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       				OR T1.RES_CUST_ID IN <foreach collection="ids" item="item" open="(" separator="," close=")">#{item}</foreach>
		       				)
		       			</when>
		       			<otherwise>
				       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
				       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
		       			</otherwise>
		       		</choose>
		       </if>
		       <if test='noteType == "5"'>
		        	AND T1.OWNER_ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "6"'>
		        	AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 7 
		       </if>
		       <if test='noteType == "7"'>
		        	AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 30  
		       </if>
		       <if test="custTypeId != null and custTypeId != ''">
		       		AND T1.LAST_CUST_TYPE_ID = #{custTypeId,jdbcType=VARCHAR} 
		       </if>
		       <if test='lDateType != null and lDateType == 6'>
		       		AND T1.ACTION_DATE IS NULL 
		       </if>
		       <if test='oDateType != null and oDateType == 6'>
		       		AND T1.NEXTFOLLOW_DATE IS NULL 
		       </if>
		       <if test="labels != null and labels.size() > 0">
		       		<foreach collection="labels" item="label" separator=" " >
		       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
		       		</foreach> 
		       </if>
		       <if test="groupId != null and groupId != ''">
		       		AND T1.RES_GROUP_ID=#{groupId}
		       </if>
		       <if test="defined1 != null and defined1 != ''">
				   AND T1.DEFINED1 = #{defined1,jdbcType=VARCHAR} 
				</if>
				<if test="defined2 != null and defined2 != ''">
				   AND T1.DEFINED2 = #{defined2,jdbcType=VARCHAR} 
				</if>
				<if test="defined3 != null and defined3 != ''">
					AND T1.DEFINED3 = #{defined3,jdbcType=VARCHAR} 
				</if>
				<if test="defined4 != null and defined4 != ''">
					AND T1.DEFINED4 = #{defined4,jdbcType=VARCHAR}  
				</if>
				<if test="defined5 != null and defined5 != ''">
					AND T1.DEFINED5 = #{defined5,jdbcType=VARCHAR} 
				</if>
				<if test="defined6 != null and defined6 != ''">
					AND T1.DEFINED6 = #{defined6,jdbcType=VARCHAR} 
				</if>
				<if test="defined7 != null and defined7 != ''">
					AND T1.DEFINED7 = #{defined7,jdbcType=VARCHAR} 
				</if>
				<if test="defined8 != null and defined8 != ''">
					AND T1.DEFINED8 = #{defined8,jdbcType=VARCHAR} 
				</if>
				<if test="defined9 != null and defined9 != ''">
					AND T1.DEFINED9 = #{defined9,jdbcType=VARCHAR} 
				</if>
				<if test="defined10 != null and defined10 != ''">
					AND T1.DEFINED10 = #{defined10,jdbcType=VARCHAR} 
				</if>
				<if test="defined11 != null and defined11 != ''">
					AND T1.DEFINED11 = #{defined11,jdbcType=VARCHAR} 
				</if>
				<if test="defined12 != null and defined12 != ''">
					AND T1.DEFINED12 = #{defined12,jdbcType=VARCHAR} 
				</if>
				<if test="defined13 != null and defined13 != ''">
					AND T1.DEFINED13 = #{defined13,jdbcType=VARCHAR} 
				</if>
				<if test="defined14 != null and defined14 != ''">
					AND T1.DEFINED14 = #{defined14,jdbcType=VARCHAR} 
				</if>
				<if test="defined15 != null and defined15 != ''">
					AND T1.DEFINED15 = #{defined15,jdbcType=VARCHAR} 
				</if>
		       <if test="startdefined16!= null and startdefined16 !=''">
					AND T1.DEFINED16 >=
					 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test=" enddefined16 != null and enddefined16 !=''">
					AND T1.DEFINED16 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="startdefined17!= null and startdefined17 !=''">
					AND T1.DEFINED17 >=
					 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined17 != null and enddefined17 !=''">
					AND T1.DEFINED17 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>	
				<if test="startdefined18!= null and startdefined18 !=''">
					AND T1.DEFINED18 >=
					 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined18 != null and enddefined18 !=''">
					AND T1.DEFINED18 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="companyTrade != null and companyTrade != ''">
					AND T1.COMPANY_TRADE = #{companyTrade }
				</if>
		       <!-- 查询结果排除ids by lizhihui-->
				<if test="rejectIds != null and rejectIds.size()>0">
					<foreach collection="rejectIds" item="id" open="and T1.RES_CUST_ID not in(" close=")" separator=",">
						#{id}
					</foreach>
				</if>
				<!-- 所在地区查询 -->
				<if test="provinceId != null">
					AND T1.PROVINCE_ID = #{provinceId,jdbcType=DECIMAL}
				</if>
				<if test="cityId != null">
					AND T1.CITY_ID = #{cityId,jdbcType=DECIMAL}
				</if>
				<if test="countyId != null">
					AND T1.COUNTY_ID = #{countyId,jdbcType=DECIMAL}
				</if>
	</sql>
	<select id="findSignCustListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		SELECT T.NAME,
		       T.RES_CUST_ID,
		       T.RES_GROUP_ID,
		       T.COMPANY,
		       T.OWNER_ACC,
		       T.STATUS,
		       T.TYPE,
		       T.OWNER_START_DATE,
		       T.MOBILEPHONE,
		       T.TELPHONE,
		       T.ALTERNATE_PHONE2,
		       T.IS_MAJOR,
		       T.ACTION_DATE,
		       T.NEXTFOLLOW_DATE,
		       T.SIGN_ACC,
		       T.SIGN_DATE,
		       T.LAST_CUST_TYPE_ID AS CUST_TYPE_ID,
		       <if test="!queryContract">IFNULL(CM.MONEY,0) AS TOTAL_ORDER_AMOUNT,</if>
		       <if test="queryContract"> TD.CONTRACT_END_DATE,</if>
		       T.MAIN_LINKMAN,
		       T.COMMON_ACC,
		       T.DEFINED1,
		       T.DEFINED2,
		       T.DEFINED3,
		       T.DEFINED4,
		       T.DEFINED5,
		       T.DEFINED6,
		       T.DEFINED7,
		       T.DEFINED8,
		       T.DEFINED9,
		       T.DEFINED10,
		       T.DEFINED11,
		       T.DEFINED12,
		       T.DEFINED13,
		       T.DEFINED14,
		       T.DEFINED15, 
       	       T.DEFINED16, 
               T.DEFINED17, 
               T.DEFINED18,
               T.IMPORT_DEPT_ID,
               T.COMPANY_MONEY,
               T.COMPANY_USER,
               T.COMPANY_FAX,
               T.PROVINCE_ID,
               T.CITY_ID,
               T.COUNTY_ID,
               T.KEYWORD,
               T.COMPANY_TRADE,
               T.SERVICE_ACC,
               T.SOURCE,
               	T.ORG_ID,
				T.BIRTHDAY,
				T.DUTY,
				T.SEX,
				T.COMPANY_ADDR,
				T.COMPANY_ORG,
				T.REMARK,
				T.RES_LAST_CALL_DATE,
				T.INPUT_DATE,
				T.INPUT_ACC,
				T.UPDATE_DATE,
				T.UPDATE_ACC,
				T.INPUT_STATUS,
				T.FILTER_COUNT,
				T.OPREATE_TYPE,
				T.FILTER_TYPE,
				T.COORDINATES,
				T.FAX,
				T.EMAIL,
				T.UNITHOME,
				T.UNITINTRODUCTION,
				T.AMOYTOCUSTOMER_DATE,
				T.EFFECTIVE_FOLLOWUP_DATE,
				T.FOLLOWUP_DATE,
				T.QQ,
				T.CONTRACT_NUMBER,
				T.SIGN_NAME,
				T.CALL_DATE_POSTPONED,
				T.REASON_FOR_CALLDELAY,
				T.RECUCLING_TYPE_DETAILS,
				T.AGAINWASH_COUNT,
				T.LAST_CUST_FOLLOW_ID,
				T.SERVICE_NAME,
				T.SERVICE_LEVEL,
				T.VISITING_DATE,
				T.NEXT_VISITING_DATE,
				T.SERVICE_LABEL_CODE,
				T.SERVICE_LABEL_NAME,
				T.IS_PRECEDENCE,
				T.FOR_THE_CUSTOMER_TIME,
				T.LAST_VISIT_ACC,
				T.IS_DEL,
				T.plan_date,
				T.address,
				T.state,
				T.losing_id,
				T.losing_remark,
				T.last_log_id,
				T.is_concat,
				T.wangwang,
				T.scope,
				T.tao_no,
				T.SIGN_BEFORE_STATUS,
				T.SIGN_BEFORE_TYPE,
				T.life_code,
				T.last_Option_Id,
				T.last_cust_type_id,
				T.last_Loss_Date,
				T.LABEL_CODE,
				T.LABEL_NAME,
				T.service_assign_type,
				T.service_assign_date,
				T.service_assign_groups,
				T.OWNER_ACTION_DATE        
		  FROM (
		  	<include refid="findSignCustSql" />
       		<if test="queryText != null and queryText != ''">
	       		<choose>
	       			<when test='queryType != null and queryType == "custName"'>
	       				AND T1.NAME LIKE CONCAT('%',#{queryText},'%') 
	       			</when>
	       			<when test='queryType != null and queryType == "mainLinkman"'>
	       				AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{queryText},'%') 
	       			</when>
	       			<when test='queryType != null and queryType == "company"'>
	       				AND T1.COMPANY LIKE CONCAT('%',#{queryText},'%') 
	       			</when>
	       			<otherwise>
	       				AND T1.${queryType} LIKE CONCAT('%',#{queryText},'%') 
	       			</otherwise>
	       		</choose>
	       </if>
		  ) T 
	      <if test="!queryContract">LEFT JOIN (SELECT CM1.MONEY,CM1.CUST_ID FROM CONTRACT_MONEY CM1 WHERE CM1.ORG_ID=#{orgId}) CM 
			ON T.RES_CUST_ID = CM.CUST_ID 
		</if>
		 <if test="queryContract"> 			
			LEFT JOIN (SELECT CT.CUST_ID,MAX(CT.INVALID_DATE) AS CONTRACT_END_DATE FROM CONTRACT CT 
		  	WHERE CT.ORG_ID = #{orgId,jdbcType=VARCHAR}  AND CT.IS_DEL = 0 
		  	and CT.sign_userid = #{ownerAcc,jdbcType=VARCHAR} 
		  	<!-- 查询结果排除ids-->
	       <if test="rejectIds != null and rejectIds.size()>0">
	       		<foreach collection="rejectIds" item="id">
	       			and CT.cust_id !=#{id}
	       		</foreach>
	       </if>
		  	GROUP BY CT.CUST_ID) TD on T.RES_CUST_ID = TD.CUST_ID 
		  	WHERE 1=1 
	       <if test="startContractEndDate != null and startContractEndDate != ''"> AND TD.CONTRACT_END_DATE &gt;= STR_TO_DATE(CONCAT(#{startContractEndDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s') </if>
	       <if test="endContractEndDate != null and endContractEndDate != ''"> AND TD.CONTRACT_END_DATE &lt;= STR_TO_DATE(CONCAT(#{endContractEndDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s') </if>
       </if>
	      <if test="orderKey != null and orderKey != ''">
			   ORDER BY ${orderKey } 
		   </if>
	</select>
	
	<select id="findSignCustPhoneListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		SELECT T.NAME,
		       T.RES_CUST_ID,
		       T.RES_GROUP_ID,
		       T.COMPANY,
		       T.OWNER_ACC,
		       T.STATUS,
		       T.TYPE,
		       T.OWNER_START_DATE,
		       T.MOBILEPHONE,
		       T.TELPHONE,
		       T.ALTERNATE_PHONE2,
		       T.IS_MAJOR,
		       T.ACTION_DATE,
		       T.NEXTFOLLOW_DATE,
		       T.SIGN_ACC,
		       T.SIGN_DATE,
		       T.LAST_CUST_TYPE_ID AS CUST_TYPE_ID,
		       <if test="!queryContract">IFNULL(CM.MONEY,0) AS TOTAL_ORDER_AMOUNT,</if>
		       <if test="queryContract"> TD.CONTRACT_END_DATE,</if>
		       T.MAIN_LINKMAN,
		       T.COMMON_ACC,
		       T.DEFINED1,
	           T.DEFINED2,
	           T.DEFINED3,
	           T.DEFINED4,
	           T.DEFINED5,
	           T.DEFINED6,
	           T.DEFINED7,
	           T.DEFINED8,
	           T.DEFINED9,
	           T.DEFINED10,
	           T.DEFINED11,
	           T.DEFINED12,
	           T.DEFINED13,
	           T.DEFINED14,
	           T.DEFINED15, 
       	       T.DEFINED16, 
               T.DEFINED17, 
               T.DEFINED18,
               T.IMPORT_DEPT_ID,
               T.COMPANY_MONEY,
               T.COMPANY_USER,
               T.COMPANY_FAX,
               T.PROVINCE_ID,
               T.CITY_ID,
               T.COUNTY_ID,
               T.KEYWORD,
               T.COMPANY_TRADE,
               T.SERVICE_ACC,
               T.SOURCE      
		  FROM (
	  			  <include refid="findSignCustSql" />
				    AND T1.MOBILEPHONE = #{queryText} 
			      UNION 
			      <include refid="findSignCustSql" />
				    AND T1.TELPHONE = #{queryText} 
		  ) T 
	      <if test="!queryContract">LEFT JOIN (SELECT CM1.MONEY,CM1.CUST_ID FROM CONTRACT_MONEY CM1 WHERE CM1.ORG_ID=#{orgId}) CM 
			ON T.RES_CUST_ID = CM.CUST_ID 
		</if>
		 <if test="queryContract"> 			
			LEFT JOIN (SELECT CT.CUST_ID,MAX(CT.INVALID_DATE) AS CONTRACT_END_DATE FROM CONTRACT CT 
		  	WHERE CT.ORG_ID = #{orgId,jdbcType=VARCHAR}  AND CT.IS_DEL = 0 
		  	and CT.sign_userid = #{ownerAcc,jdbcType=VARCHAR} 
		  	<!-- 查询结果排除ids-->
	       <if test="rejectIds != null and rejectIds.size()>0">
	       		<foreach collection="rejectIds" item="id">
	       			and CT.cust_id !=#{id}
	       		</foreach>
	       </if>
		  	GROUP BY CT.CUST_ID) TD on T.RES_CUST_ID = TD.CUST_ID 
		  	WHERE 1=1 
	       <if test="startContractEndDate != null and startContractEndDate != ''"> AND TD.CONTRACT_END_DATE &gt;= STR_TO_DATE(CONCAT(#{startContractEndDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s') </if>
	       <if test="endContractEndDate != null and endContractEndDate != ''"> AND TD.CONTRACT_END_DATE &lt;= STR_TO_DATE(CONCAT(#{endContractEndDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s') </if>
       </if>
	       ORDER BY T.SIGN_DATE DESC,T.RES_CUST_ID DESC
	</select>
	
	<resultMap type="map" id="MapResultMap">
		<result column="sign_num" property="signNum" jdbcType="DECIMAL"/>
		<result column="today_sign_num" property="todaySignNum" jdbcType="DECIMAL"/>
		<result column="month_sign_num" property="monthSignNum" jdbcType="DECIMAL"/>
	</resultMap>
	
	<select id="getSignNum" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="MapResultMap">
		select count(1) as sign_num,
			ifnull(sum(case date_format(t.sign_date,'%Y-%m-%d') when date_format(now(),'%Y-%m-%d') then 1 else 0 end),0) today_sign_num,
			ifnull(sum(case date_format(t.sign_date,'%Y-%m') when date_format(now(),'%Y-%m') then 1 else 0 end),0) month_sign_num 
			from tsm_res_cust_info t 
			where t.org_id = #{orgId} 
			and t.type = 2 
		    and t.status =6  	
		    and t.is_del = 0 
		    <if test="adminAcc != null and adminAcc != ''">
			   	and t.owner_acc in (select ttgm.member_acc
		          from tsm_group_shareinfo tgs
		         right join tsm_team_group_member ttgm
		            on  TGS.ORG_ID= #{orgId} and TTGM.ORG_ID= #{orgId} and ttgm.group_id = tgs.group_id
		         where share_acc = #{adminAcc,jdbcType=VARCHAR}) 
		  	</if>
			<if test="ownerAcc != null and ownerAcc != ''">
			  	and t.owner_acc = #{ownerAcc,jdbcType=VARCHAR} 
			</if>
	</select>
	
	<!-- 我的客户 沉默客户列表 -->
	<select id="findSilentCustListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		SELECT 
		   W.NAME,
	       W.RES_CUST_ID,
	       W.COMPANY,
	       W.OWNER_ACC,
	       W.STATUS,
	       W.TYPE,
	       W.OWNER_START_DATE,
	       W.MOBILEPHONE,
	       W.TELPHONE,
	       W.ALTERNATE_PHONE2,
	       W.IS_MAJOR,
	       W.ACTION_DATE,
	       W.NEXTFOLLOW_DATE,
	       W.SIGN_DATE,
	       W.CONTRACT_END_DATE,   
	       W.DAYS,
	       W.MAIN_LINKMAN,
	       W.TOTAL_ORDER_AMOUNT,
	       W.RES_GROUP_ID,
    	   W.DEFINED1,
	       W.DEFINED2,
	       W.DEFINED3,
	       W.DEFINED4,
	       W.DEFINED5,
	       W.DEFINED6,
	       W.DEFINED7,
	       W.DEFINED8,
	       W.DEFINED9,
	       W.DEFINED10,
	       W.DEFINED11,
	       W.DEFINED12,
	       W.DEFINED13,
	       W.DEFINED14,
	       W.DEFINED15 
		 FROM (SELECT T.NAME,
		       T.RES_CUST_ID,
		       T.COMPANY,
		       T.OWNER_ACC,
		       T.STATUS,
		       T.TYPE,
		       T.OWNER_START_DATE,
		       T.MOBILEPHONE,
		       T.TELPHONE,
		       T.ALTERNATE_PHONE2,
		       T.IS_MAJOR,
		       T.ACTION_DATE,
		       T.NEXTFOLLOW_DATE,
		       T.SIGN_DATE,
		       TD.CONTRACT_END_DATE,   
		       DATEDIFF(NOW(),T.ACTION_DATE) DAYS,
		       T.MAIN_LINKMAN,
		       IFNULL(CM.MONEY,0) AS TOTAL_ORDER_AMOUNT,
		       T.RES_GROUP_ID,
      		   T.DEFINED1,
		       T.DEFINED2,
		       T.DEFINED3,
		       T.DEFINED4,
		       T.DEFINED5,
		       T.DEFINED6,
		       T.DEFINED7,
		       T.DEFINED8,
		       T.DEFINED9,
		       T.DEFINED10,
		       T.DEFINED11,
		       T.DEFINED12,
		       T.DEFINED13,
		       T.DEFINED14,
		       T.DEFINED15   
		  FROM (
		  		SELECT T1.NAME,
				       T1.RES_CUST_ID,
				       T1.COMPANY,
				       T1.OWNER_ACC,
				       T1.STATUS,
				       T1.TYPE,
				       T1.OWNER_START_DATE,
				       T1.MOBILEPHONE,
				       T1.TELPHONE,
				       T1.ALTERNATE_PHONE2,
				       T1.IS_MAJOR,
				       T1.ACTION_DATE,
				       T1.NEXTFOLLOW_DATE,
		      		   T1.SIGN_DATE,
		      		   T1.MAIN_LINKMAN,
		      		   T1.RES_GROUP_ID,
		      		   T1.DEFINED1,
				       T1.DEFINED2,
				       T1.DEFINED3,
				       T1.DEFINED4,
				       T1.DEFINED5,
				       T1.DEFINED6,
				       T1.DEFINED7,
				       T1.DEFINED8,
				       T1.DEFINED9,
				       T1.DEFINED10,
				       T1.DEFINED11,
				       T1.DEFINED12,
				       T1.DEFINED13,
				       T1.DEFINED14,
				       T1.DEFINED15 
		        FROM TSM_RES_CUST_INFO T1
		  				WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
						  	AND T1.TYPE = 2 
						    AND T1.STATUS = 7   	
						    AND T1.IS_DEL = 0 
						 <if test="custIds != null and custIds.size() > 0">
					   		AND T1.RES_CUST_ID IN 
					   			<foreach collection="custIds" item="cid" open="(" separator="," close=")">
					   				#{cid}
					   			</foreach>
					     </if>
						  <choose>
							   <when test="adminAcc != null and adminAcc != ''">
									<choose>
										<when test="ownerAccs!=null and ownerAccs.size() > 0">
											<if test="ownerAccs!=null">
									       		AND T1.OWNER_ACC IN 
												<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
													#{item}
												</foreach>
									        </if>
										</when>
										<otherwise>
											AND T1.OWNER_ACC = #{adminAcc,jdbcType=VARCHAR} 
										</otherwise>
									</choose>
							   </when>
							   <otherwise>
							   		AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
							   </otherwise>
						   </choose>
						   <if test="name != null and name != ''">
						   		AND T1.NAME LIKE CONCAT(#{name,jdbcType=VARCHAR},'%') 
						   </if>
						   <if test="telphone != null and telphone != ''">
						   		AND (T1.MOBILEPHONE = #{telphone} or T1.TELPHONE = #{telphone} or T1.ALTERNATE_PHONE2 = #{telphone}) 
						   </if>
						   <if test="startActionDate != null and startActionDate != ''">
					       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					       </if>
					       <if test="endActionDate != null and endActionDate != ''">
					       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					       </if>
					       <if test="mainLinkman != null and mainLinkman != ''">
					       		AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{mainLinkman,jdbcType=VARCHAR},'%') 
					       </if>
					       <if test='noteType == "2"'>
					       		AND DATEDIFF(NOW(),T1.ACTION_DATE) &lt;= 7 
					       </if>
					       <if test='noteType == "3"'>
					       	   AND DATEDIFF(NOW(),T1.ACTION_DATE) &lt;= 30  
					       </if>
					       <if test='noteType == "4"'>
					       	   AND DATEDIFF(NOW(),T1.ACTION_DATE) &lt;= 90 
					       </if>
					       <if test='noteType == "5"'>
								AND DATEDIFF(NOW(),T1.ACTION_DATE) > 90 
					       </if>
					       <if test="queryText != null and queryText != ''">
					       		<choose>
					       			<when test='queryType != null and queryType == "1"'>
					       				AND T1.NAME LIKE CONCAT('%',#{queryText},'%') 
					       			</when>
					       			<when test='queryType != null and queryType == "2"'>
					       				AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{queryText},'%') 
					       			</when>
					       			<when test='queryType != null and queryType == "4"'>
					       				AND T1.COMPANY LIKE CONCAT('%',#{queryText},'%') 
					       			</when>
					       			<otherwise>
					       				AND T1.${queryType} LIKE CONCAT('%',#{queryText},'%') 
					       			</otherwise>
					       		</choose>
					       </if>
					       <if test="labels != null and labels.size() > 0">
					       		<foreach collection="labels" item="label" separator=" " >
					       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
					       		</foreach> 
					       </if>
					       <if test="resGroupId != null and resGroupId != ''">
					       		AND T1.RES_GROUP_ID = #{resGroupId} 
					       </if>
					       <!-- 最近联系时间 -->
					       <if test="startActionDate != null and startActionDate != ''">
					       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					       </if>
					       <if test="endActionDate != null and endActionDate != ''">
					       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					       </if>
		  ) T 
		  LEFT JOIN (SELECT CM1.MONEY,CM1.CUST_ID FROM CONTRACT_MONEY CM1 WHERE CM1.ORG_ID=#{orgId}) CM 
			ON T.RES_CUST_ID = CM.CUST_ID 
		  LEFT JOIN (SELECT CT.CUST_ID,MAX(CT.INVALID_DATE) AS CONTRACT_END_DATE 
		  		FROM CONTRACT CT 
		  	WHERE CT.ORG_ID = #{orgId,jdbcType=VARCHAR} 
<!-- 		  	AND CT.AUTH_STATE = 2  -->
		  	AND CT.IS_DEL = 0 
		  GROUP BY CT.CUST_ID) TD 
			ON T.RES_CUST_ID = TD.CUST_ID 
		  WHERE 1=1 
	       <!-- 合同截止时间 -->
	       <if test="pstartDate != null and pstartDate != ''">
	       		AND TD.CONTRACT_END_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
	       </if>
	       <if test="pendDate != null and pendDate != ''">
	       		AND TD.CONTRACT_END_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
	       </if>
	       ) W 
			<if test="orderKey != null and orderKey != ''">
			   ORDER BY ${orderKey } 
		    </if>
	</select>
	
	<select id="findSilentCustPhoneListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		SELECT 
		   W.NAME,
	       W.RES_CUST_ID,
	       W.COMPANY,
	       W.OWNER_ACC,
	       W.STATUS,
	       W.TYPE,
	       W.OWNER_START_DATE,
	       W.MOBILEPHONE,
	       W.TELPHONE,
	       W.ALTERNATE_PHONE2,
	       W.IS_MAJOR,
	       W.ACTION_DATE,
	       W.NEXTFOLLOW_DATE,
	       W.SIGN_DATE,
	       W.CONTRACT_END_DATE,   
	       W.DAYS,
	       W.MAIN_LINKMAN,
	       W.TOTAL_ORDER_AMOUNT,
	       W.RES_GROUP_ID,
     	   W.DEFINED1,
	       W.DEFINED2,
	       W.DEFINED3,
	       W.DEFINED4,
	       W.DEFINED5,
	       W.DEFINED6,
	       W.DEFINED7,
	       W.DEFINED8,
	       W.DEFINED9,
	       W.DEFINED10,
	       W.DEFINED11,
	       W.DEFINED12,
	       W.DEFINED13,
	       W.DEFINED14,
	       W.DEFINED15 
		 FROM (SELECT T.NAME,
		       T.RES_CUST_ID,
		       T.COMPANY,
		       T.OWNER_ACC,
		       T.STATUS,
		       T.TYPE,
		       T.OWNER_START_DATE,
		       T.MOBILEPHONE,
		       T.TELPHONE,
		       T.ALTERNATE_PHONE2,
		       T.IS_MAJOR,
		       T.ACTION_DATE,
		       T.NEXTFOLLOW_DATE,
		       T.SIGN_DATE,
		       TD.CONTRACT_END_DATE,   
		       DATEDIFF(NOW(),T.ACTION_DATE) DAYS,
		       T.MAIN_LINKMAN,
		       IFNULL(CM.MONEY,0) AS TOTAL_ORDER_AMOUNT,
		       T.RES_GROUP_ID,
      		   T.DEFINED1,
		       T.DEFINED2,
		       T.DEFINED3,
		       T.DEFINED4,
		       T.DEFINED5,
		       T.DEFINED6,
		       T.DEFINED7,
		       T.DEFINED8,
		       T.DEFINED9,
		       T.DEFINED10,
		       T.DEFINED11,
		       T.DEFINED12,
		       T.DEFINED13,
		       T.DEFINED14,
		       T.DEFINED15   
		  FROM (
		  		SELECT T1.NAME,
				       T1.RES_CUST_ID,
				       T1.COMPANY,
				       T1.OWNER_ACC,
				       T1.STATUS,
				       T1.TYPE,
				       T1.OWNER_START_DATE,
				       T1.MOBILEPHONE,
				       T1.TELPHONE,
				       T1.ALTERNATE_PHONE2,
				       T1.IS_MAJOR,
				       T1.ACTION_DATE,
				       T1.NEXTFOLLOW_DATE,
		      		   T1.SIGN_DATE,
		      		   T1.MAIN_LINKMAN,
		      		   T1.RES_GROUP_ID,
		      		   T1.DEFINED1,
				       T1.DEFINED2,
				       T1.DEFINED3,
				       T1.DEFINED4,
				       T1.DEFINED5,
				       T1.DEFINED6,
				       T1.DEFINED7,
				       T1.DEFINED8,
				       T1.DEFINED9,
				       T1.DEFINED10,
				       T1.DEFINED11,
				       T1.DEFINED12,
				       T1.DEFINED13,
				       T1.DEFINED14,
				       T1.DEFINED15 
		        FROM TSM_RES_CUST_INFO T1
		  				WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
						  	AND T1.TYPE = 2 
						    AND T1.STATUS = 7   	
						    AND T1.IS_DEL = 0 
						    AND T1.MOBILEPHONE = #{queryText} 
						  <choose>
							   <when test="adminAcc != null and adminAcc != ''">
									<choose>
										<when test="ownerAccs!=null and ownerAccs.size() > 0">
											<if test="ownerAccs!=null">
									       		AND T1.OWNER_ACC IN 
												<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
													#{item}
												</foreach>
									        </if>
										</when>
										<otherwise>
											AND T1.OWNER_ACC = #{adminAcc,jdbcType=VARCHAR} 
										</otherwise>
									</choose>
							   </when>
							   <otherwise>
							   		AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
							   </otherwise>
						   </choose>
						   <if test="name != null and name != ''">
						   		AND T1.NAME LIKE CONCAT(#{name,jdbcType=VARCHAR},'%') 
						   </if>
						   <if test="telphone != null and telphone != ''">
						   		AND (T1.MOBILEPHONE = #{telphone} or T1.TELPHONE = #{telphone} or T1.ALTERNATE_PHONE2 = #{telphone}) 
						   </if>
						   <if test="startActionDate != null and startActionDate != ''">
					       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					       </if>
					       <if test="endActionDate != null and endActionDate != ''">
					       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					       </if>
					       <if test="mainLinkman != null and mainLinkman != ''">
					       		AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{mainLinkman,jdbcType=VARCHAR},'%') 
					       </if>
					       <if test='noteType == "2"'>
					       		AND DATEDIFF(NOW(),T1.ACTION_DATE) &lt;= 7  
					       </if>
					       <if test='noteType == "3"'>
					       	    AND DATEDIFF(NOW(),T1.ACTION_DATE) &lt;= 30  
					       </if>
					       <if test='noteType == "4"'>
					       		AND DATEDIFF(NOW(),T1.ACTION_DATE) &lt;= 90  
					       </if>
					       <if test='noteType == "5"'>
<!-- 					       		AND T1.ACTION_DATE &lt; DATE_ADD(NOW(),INTERVAL -90 DAY)  -->
								AND DATEDIFF(NOW(),T1.ACTION_DATE) > 90 
					       </if>
					       <if test="labels != null and labels.size() > 0">
					       		<foreach collection="labels" item="label" separator=" " >
					       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
					       		</foreach> 
					       </if>
					        <if test="resGroupId != null and resGroupId != ''">
				       		AND T1.RES_GROUP_ID = #{resGroupId} 
				       		</if>
					       <!-- 最近联系时间 -->
					       <if test="startActionDate != null and startActionDate != ''">
					       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					       </if>
					       <if test="endActionDate != null and endActionDate != ''">
					       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					       </if>
					       UNION 
					       SELECT T1.NAME,
							       T1.RES_CUST_ID,
							       T1.COMPANY,
							       T1.OWNER_ACC,
							       T1.STATUS,
							       T1.TYPE,
							       T1.OWNER_START_DATE,
							       T1.MOBILEPHONE,
							       T1.TELPHONE,
							       T1.ALTERNATE_PHONE2,
							       T1.IS_MAJOR,
							       T1.ACTION_DATE,
							       T1.NEXTFOLLOW_DATE,
					      		   T1.SIGN_DATE,
					      		   T1.MAIN_LINKMAN,
					      		   T1.RES_GROUP_ID,
					      		   T1.DEFINED1,
							       T1.DEFINED2,
							       T1.DEFINED3,
							       T1.DEFINED4,
							       T1.DEFINED5,
							       T1.DEFINED6,
							       T1.DEFINED7,
							       T1.DEFINED8,
							       T1.DEFINED9,
							       T1.DEFINED10,
							       T1.DEFINED11,
							       T1.DEFINED12,
							       T1.DEFINED13,
							       T1.DEFINED14,
							       T1.DEFINED15  
					        FROM TSM_RES_CUST_INFO T1
					  				WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
									  	AND T1.TYPE = 2 
									    AND T1.STATUS = 7   	
									    AND T1.IS_DEL = 0 
									    AND T1.TELPHONE = #{queryText} 
									  <choose>
										   <when test="adminAcc != null and adminAcc != ''">
												<choose>
													<when test="ownerAccs!=null and ownerAccs.size() > 0">
														<if test="ownerAccs!=null">
												       		AND T1.OWNER_ACC IN 
															<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
																#{item}
															</foreach>
												        </if>
													</when>
													<otherwise>
														AND T1.OWNER_ACC = #{adminAcc,jdbcType=VARCHAR} 
													</otherwise>
												</choose>
										   </when>
										   <otherwise>
										   		AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
										   </otherwise>
									   </choose>
									   <if test="name != null and name != ''">
									   		AND T1.NAME LIKE CONCAT(#{name,jdbcType=VARCHAR},'%') 
									   </if>
									   <if test="telphone != null and telphone != ''">
									   		AND (T1.MOBILEPHONE = #{telphone} or T1.TELPHONE = #{telphone} or T1.ALTERNATE_PHONE2 = #{telphone}) 
									   </if>
									   <if test="startActionDate != null and startActionDate != ''">
								       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
								       </if>
								       <if test="endActionDate != null and endActionDate != ''">
								       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
								       </if>
								       <if test="mainLinkman != null and mainLinkman != ''">
								       		AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{mainLinkman,jdbcType=VARCHAR},'%') 
								       </if>
								       <if test='noteType == "2"'>
								       		AND DATEDIFF(NOW(),T1.ACTION_DATE) &lt;= 7   
								       </if>
								       <if test='noteType == "3"'>
								       	   AND DATEDIFF(NOW(),T1.ACTION_DATE) &lt;= 30  
								       </if>
								       <if test='noteType == "4"'>
								       		AND DATEDIFF(NOW(),T1.ACTION_DATE) &lt;= 90  
								       </if>
								       <if test='noteType == "5"'>
<!-- 								       		AND T1.ACTION_DATE &lt; DATE_ADD(NOW(),INTERVAL -90 DAY)  -->
											AND DATEDIFF(NOW(),T1.ACTION_DATE) > 90 
								       </if>
								       <if test="labels != null and labels.size() > 0">
								       		<foreach collection="labels" item="label" separator=" " >
								       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
								       		</foreach> 
								       </if>
								       <if test="resGroupId != null and resGroupId != ''">
								       		AND T1.RES_GROUP_ID = #{resGroupId} 
								       </if>
								       <!-- 最近联系时间 -->
								       <if test="startActionDate != null and startActionDate != ''">
								       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
								       </if>
								       <if test="endActionDate != null and endActionDate != ''">
								       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
								       </if>
		  ) T 
		  LEFT JOIN (SELECT CM1.MONEY,CM1.CUST_ID FROM CONTRACT_MONEY CM1 WHERE CM1.ORG_ID=#{orgId}) CM 
			ON T.RES_CUST_ID = CM.CUST_ID 
		  LEFT JOIN (SELECT CT.CUST_ID,MAX(CT.INVALID_DATE) AS CONTRACT_END_DATE 
		  		FROM CONTRACT CT 
		  	WHERE CT.ORG_ID = #{orgId,jdbcType=VARCHAR} 
<!-- 		  	AND CT.AUTH_STATE = 2  -->
		  	AND CT.IS_DEL = 0 
		  GROUP BY CT.CUST_ID) TD 
			ON T.RES_CUST_ID = TD.CUST_ID 
		  WHERE 1=1 
	       <!-- 合同截止时间 -->
	       <if test="pstartDate != null and pstartDate != ''">
	       		AND TD.CONTRACT_END_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
	       </if>
	       <if test="pendDate != null and pendDate != ''">
	       		AND TD.CONTRACT_END_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
	       </if>
	       ) W 
	       <if test="orderKey != null">
		       ORDER BY ${orderKey }  
	       </if>
	</select>
	
	<!-- 流失客户列表查询 -->
	<select id="findLosingCustListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		SELECT 
		   W.NAME,
	       W.RES_CUST_ID,
	       W.COMPANY,
	       W.OWNER_ACC,
	       W.STATUS,
	       W.TYPE,
	       W.OWNER_START_DATE,
	       W.MOBILEPHONE,
	       W.TELPHONE,
	       W.ALTERNATE_PHONE2,
	       W.IS_MAJOR,
	       W.ACTION_DATE,
	       W.NEXTFOLLOW_DATE,
	       W.SIGN_DATE,
	       W.TOTAL_ORDER_AMOUNT,
	       W.CONTRACT_END_DATE,   
	       W.DAYS,
	       W.MAIN_LINKMAN,
	       W.LOSING_REMARK,  
	       W.RES_GROUP_ID,
	       W.LOSING_ID,
	       W.DEFINED1,
	       W.DEFINED2,
	       W.DEFINED3,
	       W.DEFINED4,
	       W.DEFINED5,
	       W.DEFINED6,
	       W.DEFINED7,
	       W.DEFINED8,
	       W.DEFINED9,
	       W.DEFINED10,
	       W.DEFINED11,
	       W.DEFINED12,
	       W.DEFINED13,
	       W.DEFINED14,
	       W.DEFINED15 
		FROM (SELECT T.NAME,
		       T.RES_CUST_ID,
		       T.COMPANY,
		       T.OWNER_ACC,
		       T.STATUS,
		       T.TYPE,
		       T.OWNER_START_DATE,
		       T.MOBILEPHONE,
		       T.TELPHONE,
		       T.ALTERNATE_PHONE2,
		       T.IS_MAJOR,
		       T.ACTION_DATE,
		       T.NEXTFOLLOW_DATE,
		       T.SIGN_DATE,
		       IFNULL(CM.MONEY,0) AS TOTAL_ORDER_AMOUNT,
		       TD.CONTRACT_END_DATE,   
		       DATEDIFF(NOW(),T.ACTION_DATE) DAYS,
		       T.MAIN_LINKMAN,
		       T.LOSING_REMARK,  
		       T.LOSING_ID,
		       T.RES_GROUP_ID,
		       T.DEFINED1,
		       T.DEFINED2,
		       T.DEFINED3,
		       T.DEFINED4,
		       T.DEFINED5,
		       T.DEFINED6,
		       T.DEFINED7,
		       T.DEFINED8,
		       T.DEFINED9,
		       T.DEFINED10,
		       T.DEFINED11,
		       T.DEFINED12,
		       T.DEFINED13,
		       T.DEFINED14,
		       T.DEFINED15
		  FROM (
		  		SELECT 
				   T1.NAME,
			       T1.RES_CUST_ID,
			       T1.COMPANY,
			       T1.OWNER_ACC,
			       T1.STATUS,
			       T1.TYPE,
			       T1.OWNER_START_DATE,
			       T1.MOBILEPHONE,
			       T1.TELPHONE,
			       T1.ALTERNATE_PHONE2,
			       T1.IS_MAJOR,
			       T1.ACTION_DATE,
			       T1.NEXTFOLLOW_DATE,
		       	   T1.SIGN_DATE,
		       	   T1.MAIN_LINKMAN,
		       	   T1.LOSING_REMARK,
		       	   T1.LOSING_ID,
		       	   T1.RES_GROUP_ID,
		       	   T1.DEFINED1,
			       T1.DEFINED2,
			       T1.DEFINED3,
			       T1.DEFINED4,
			       T1.DEFINED5,
			       T1.DEFINED6,
			       T1.DEFINED7,
			       T1.DEFINED8,
			       T1.DEFINED9,
			       T1.DEFINED10,
			       T1.DEFINED11,
			       T1.DEFINED12,
			       T1.DEFINED13,
			       T1.DEFINED14,
			       T1.DEFINED15 
				 FROM TSM_RES_CUST_INFO T1 
		  				WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
					  	AND T1.TYPE = 2 
					    AND T1.STATUS = 8    	
					    AND T1.IS_DEL = 0 
					  <if test="custIds != null and custIds.size() > 0">
				   		AND T1.RES_CUST_ID IN 
				   			<foreach collection="custIds" item="cid" open="(" separator="," close=")">
				   				#{cid}
				   			</foreach>
				     </if>
					  <choose>
						   <when test="adminAcc != null and adminAcc != ''">
								<choose>
									<when test="ownerAccs!=null and ownerAccs.size() > 0">
										<if test="ownerAccs!=null">
								       		AND T1.OWNER_ACC IN 
											<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
												#{item}
											</foreach>
								        </if>
									</when>
									<otherwise>
										AND T1.OWNER_ACC = #{adminAcc,jdbcType=VARCHAR} 
									</otherwise>
								</choose>
						   </when>
						   <otherwise>
						   		AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
						   </otherwise>
					   </choose>
					   <if test="name != null and name != ''">
					   		AND T1.NAME LIKE CONCAT(#{name,jdbcType=VARCHAR},'%') 
					   </if>
					   <if test="telphone != null and telphone != ''">
					   		AND (T1.MOBILEPHONE = #{telphone} or T1.TELPHONE = #{telphone} or T1.ALTERNATE_PHONE2 = #{telphone}) 
					   </if>
					   <if test="startActionDate != null and startActionDate != ''">
				       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
				       </if>
				       <if test="endActionDate != null and endActionDate != ''">
				       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
				       </if>
				       <if test="mainLinkman != null and mainLinkman != ''">
				       		AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{mainLinkman,jdbcType=VARCHAR},'%') 
				       </if>
				       <if test='noteType == "2"'>
				       		AND DATEDIFF(NOW(),T1.ACTION_DATE) &lt;= 7   
				       </if>
				       <if test='noteType == "3"'>
				       	   AND DATEDIFF(NOW(),T1.ACTION_DATE) &lt;= 30  
				       </if>
				       <if test='noteType == "4"'>
				       	   AND DATEDIFF(NOW(),T1.ACTION_DATE) &lt;= 90  
				       </if>
				       <if test='noteType == "5"'>
<!-- 				       		AND T1.ACTION_DATE &lt; DATE_ADD(NOW(),INTERVAL -90 DAY)  -->
							AND DATEDIFF(NOW(),T1.ACTION_DATE) > 90 
				       </if>
				       <if test="queryText != null and queryText != ''">
				       		<choose>
				       			<when test='queryType != null and queryType == "1"'>
				       				AND T1.NAME LIKE CONCAT('%',#{queryText},'%') 
				       			</when>
				       			<when test='queryType != null and queryType == "2"'>
				       				AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{queryText},'%') 
				       			</when>
				       			<when test='queryType != null and queryType == "4"'>
				       				AND T1.COMPANY LIKE CONCAT('%',#{queryText},'%') 
				       			</when>
				       			<otherwise>
				       				AND T1.${queryType } LIKE CONCAT('%',#{queryText},'%') 
				       			</otherwise>
				       		</choose>
				       </if>
				       <if test="losingId != null and losingId != ''">
				       		AND T1.LOSING_ID = #{losingId} 
				       </if>
				       <if test="resGroupId != null and resGroupId != ''">
				       		AND T1.RES_GROUP_ID = #{resGroupId} 
				       </if>
				       <if test="labels != null and labels.size() > 0">
				       		<foreach collection="labels" item="label" separator=" " >
				       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
				       		</foreach> 
				       </if>
		  ) T 
		  LEFT JOIN (SELECT CM1.MONEY,CM1.CUST_ID FROM CONTRACT_MONEY CM1 WHERE CM1.ORG_ID=#{orgId}) CM ON T.RES_CUST_ID = CM.CUST_ID
		  LEFT JOIN (SELECT CT.CUST_ID,MAX(CT.INVALID_DATE) AS CONTRACT_END_DATE 
		  		FROM CONTRACT CT 
		  	WHERE CT.ORG_ID = #{orgId,jdbcType=VARCHAR} 
<!-- 		  	AND CT.AUTH_STATE = 2  -->
		  	AND CT.IS_DEL = 0 
		  GROUP BY CT.CUST_ID) TD 
			ON T.RES_CUST_ID = TD.CUST_ID 
		  WHERE 1=1 
		   <!-- 合同截止时间 -->
	       <if test="pstartDate != null and pstartDate != ''">
	       		AND TD.CONTRACT_END_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
	       </if>
	       <if test="pendDate != null and pendDate != ''">
	       		AND TD.CONTRACT_END_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
	       </if>
		   ) W 
		   <if test="orderKey != null">
		       ORDER BY ${orderKey }  
	       </if>
	</select>
	
	<select id="findLosingCustPhoneListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		SELECT 
		   W.NAME,
	       W.RES_CUST_ID,
	       W.COMPANY,
	       W.OWNER_ACC,
	       W.STATUS,
	       W.TYPE,
	       W.OWNER_START_DATE,
	       W.MOBILEPHONE,
	       W.TELPHONE,
	       W.ALTERNATE_PHONE2,
	       W.IS_MAJOR,
	       W.ACTION_DATE,
	       W.NEXTFOLLOW_DATE,
	       W.SIGN_DATE,
	       W.TOTAL_ORDER_AMOUNT,
	       W.CONTRACT_END_DATE,   
	       W.DAYS,
	       W.MAIN_LINKMAN,
	       W.LOSING_REMARK,  
	       W.LOSING_ID,
	       W.RES_GROUP_ID,
	       W.DEFINED1,
	       W.DEFINED2,
	       W.DEFINED3,
	       W.DEFINED4,
	       W.DEFINED5,
	       W.DEFINED6,
	       W.DEFINED7,
	       W.DEFINED8,
	       W.DEFINED9,
	       W.DEFINED10,
	       W.DEFINED11,
	       W.DEFINED12,
	       W.DEFINED13,
	       W.DEFINED14,
	       W.DEFINED15 
		FROM (SELECT T.NAME,
		       T.RES_CUST_ID,
		       T.COMPANY,
		       T.OWNER_ACC,
		       T.STATUS,
		       T.TYPE,
		       T.OWNER_START_DATE,
		       T.MOBILEPHONE,
		       T.TELPHONE,
		       T.ALTERNATE_PHONE2,
		       T.IS_MAJOR,
		       T.ACTION_DATE,
		       T.NEXTFOLLOW_DATE,
		       T.SIGN_DATE,
		       IFNULL(CM.MONEY,0) AS TOTAL_ORDER_AMOUNT,
		       TD.CONTRACT_END_DATE,   
		       DATEDIFF(NOW(),T.ACTION_DATE) DAYS,
		       T.MAIN_LINKMAN,
		       T.LOSING_REMARK,  
		       T.LOSING_ID,
		       T.RES_GROUP_ID,
		       T.DEFINED1,
		       T.DEFINED2,
		       T.DEFINED3,
		       T.DEFINED4,
		       T.DEFINED5,
		       T.DEFINED6,
		       T.DEFINED7,
		       T.DEFINED8,
		       T.DEFINED9,
		       T.DEFINED10,
		       T.DEFINED11,
		       T.DEFINED12,
		       T.DEFINED13,
		       T.DEFINED14,
		       T.DEFINED15 
		  FROM (
		  		SELECT 
				   T1.NAME,
			       T1.RES_CUST_ID,
			       T1.COMPANY,
			       T1.OWNER_ACC,
			       T1.STATUS,
			       T1.TYPE,
			       T1.OWNER_START_DATE,
			       T1.MOBILEPHONE,
			       T1.TELPHONE,
			       T1.ALTERNATE_PHONE2,
			       T1.IS_MAJOR,
			       T1.ACTION_DATE,
			       T1.NEXTFOLLOW_DATE,
		       	   T1.SIGN_DATE,
		       	   T1.MAIN_LINKMAN,
		       	   T1.LOSING_REMARK,
		       	   T1.LOSING_ID,
		       	   T1.RES_GROUP_ID,
			       T1.DEFINED1,
			       T1.DEFINED2,
			       T1.DEFINED3,
			       T1.DEFINED4,
			       T1.DEFINED5,
			       T1.DEFINED6,
			       T1.DEFINED7,
			       T1.DEFINED8,
			       T1.DEFINED9,
			       T1.DEFINED10,
			       T1.DEFINED11,
			       T1.DEFINED12,
			       T1.DEFINED13,
			       T1.DEFINED14,
			       T1.DEFINED15  
				 FROM TSM_RES_CUST_INFO T1 
		  				WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
					  	AND T1.TYPE = 2 
					    AND T1.STATUS = 8    	
					    AND T1.IS_DEL = 0 
					    AND T1.MOBILEPHONE = #{queryText} 
					  <choose>
						   <when test="adminAcc != null and adminAcc != ''">
								<choose>
									<when test="ownerAccs!=null and ownerAccs.size() > 0">
										<if test="ownerAccs!=null">
								       		AND T1.OWNER_ACC IN 
											<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
												#{item}
											</foreach>
								        </if>
									</when>
									<otherwise>
										AND T1.OWNER_ACC = #{adminAcc,jdbcType=VARCHAR} 
									</otherwise>
								</choose>
						   </when>
						   <otherwise>
						   		AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
						   </otherwise>
					   </choose>
					   <if test="name != null and name != ''">
					   		AND T1.NAME LIKE CONCAT(#{name,jdbcType=VARCHAR},'%') 
					   </if>
					   <if test="telphone != null and telphone != ''">
					   		AND (T1.MOBILEPHONE = #{telphone} or T1.TELPHONE = #{telphone} or T1.ALTERNATE_PHONE2 = #{telphone}) 
					   </if>
					   <if test="startActionDate != null and startActionDate != ''">
				       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
				       </if>
				       <if test="endActionDate != null and endActionDate != ''">
				       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
				       </if>
				       <if test="mainLinkman != null and mainLinkman != ''">
				       		AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{mainLinkman,jdbcType=VARCHAR},'%') 
				       </if>
				       <if test='noteType == "2"'>
				       		AND DATEDIFF(NOW(),T1.ACTION_DATE) &lt;= 7    
				       </if>
				       <if test='noteType == "3"'>
				       	    AND DATEDIFF(NOW(),T1.ACTION_DATE) &lt;= 30  
				       </if>
				       <if test='noteType == "4"'>
				       		AND DATEDIFF(NOW(),T1.ACTION_DATE) &lt;= 90  
				       </if>
				       <if test='noteType == "5"'>
<!-- 				       		AND T1.ACTION_DATE &lt; DATE_ADD(NOW(),INTERVAL -90 DAY)  -->
				       		AND DATEDIFF(NOW(),T1.ACTION_DATE) > 90 
				       </if>
				       <if test="losingId != null and losingId != ''">
				       		AND T1.LOSING_ID = #{losingId} 
				       </if>
				       <if test="resGroupId != null and resGroupId != ''">
				       		AND T1.RES_GROUP_ID = #{resGroupId} 
				       </if>
				       <if test="labels != null and labels.size() > 0">
				       		<foreach collection="labels" item="label" separator=" " >
				       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
				       		</foreach> 
				       </if>
				       UNION 
				       SELECT 
						   T1.NAME,
					       T1.RES_CUST_ID,
					       T1.COMPANY,
					       T1.OWNER_ACC,
					       T1.STATUS,
					       T1.TYPE,
					       T1.OWNER_START_DATE,
					       T1.MOBILEPHONE,
					       T1.TELPHONE,
					       T1.ALTERNATE_PHONE2,
					       T1.IS_MAJOR,
					       T1.ACTION_DATE,
					       T1.NEXTFOLLOW_DATE,
				       	   T1.SIGN_DATE,
				       	   T1.MAIN_LINKMAN,
				       	   T1.LOSING_REMARK,
				       	   T1.LOSING_ID,
				       	   T1.RES_GROUP_ID,
					       T1.DEFINED1,
					       T1.DEFINED2,
					       T1.DEFINED3,
					       T1.DEFINED4,
					       T1.DEFINED5,
					       T1.DEFINED6,
					       T1.DEFINED7,
					       T1.DEFINED8,
					       T1.DEFINED9,
					       T1.DEFINED10,
					       T1.DEFINED11,
					       T1.DEFINED12,
					       T1.DEFINED13,
					       T1.DEFINED14,
					       T1.DEFINED15 
						 FROM TSM_RES_CUST_INFO T1 
				  				WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
							  	AND T1.TYPE = 2 
							    AND T1.STATUS = 8    	
							    AND T1.IS_DEL = 0 
							    AND T1.TELPHONE = #{queryText} 
							  <choose>
								   <when test="adminAcc != null and adminAcc != ''">
										<choose>
											<when test="ownerAccs!=null and ownerAccs.size() > 0">
												<if test="ownerAccs!=null">
										       		AND T1.OWNER_ACC IN 
													<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
														#{item}
													</foreach>
										        </if>
											</when>
											<otherwise>
												AND T1.OWNER_ACC = #{adminAcc,jdbcType=VARCHAR} 
											</otherwise>
										</choose>
								   </when>
								   <otherwise>
								   		AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
								   </otherwise>
							   </choose>
							   <if test="name != null and name != ''">
							   		AND T1.NAME LIKE CONCAT(#{name,jdbcType=VARCHAR},'%') 
							   </if>
							   <if test="telphone != null and telphone != ''">
							   		AND (T1.MOBILEPHONE = #{telphone} or T1.TELPHONE = #{telphone} or T1.ALTERNATE_PHONE2 = #{telphone}) 
							   </if>
							   <if test="startActionDate != null and startActionDate != ''">
						       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
						       </if>
						       <if test="endActionDate != null and endActionDate != ''">
						       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
						       </if>
						       <if test="mainLinkman != null and mainLinkman != ''">
						       		AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{mainLinkman,jdbcType=VARCHAR},'%') 
						       </if>
						       <if test='noteType == "2"'>
						       		AND DATEDIFF(NOW(),T1.ACTION_DATE) &lt;= 7  
						       </if>
						       <if test='noteType == "3"'>
						       	    AND DATEDIFF(NOW(),T1.ACTION_DATE) &lt;= 30  
						       </if>
						       <if test='noteType == "4"'>
						       		AND DATEDIFF(NOW(),T1.ACTION_DATE) &lt;= 90  
						       </if>
						       <if test='noteType == "5"'>
<!-- 						       		AND T1.ACTION_DATE &lt; DATE_ADD(NOW(),INTERVAL -90 DAY)  -->
						       		AND DATEDIFF(NOW(),T1.ACTION_DATE) > 90 
						       </if>
						       <if test="losingId != null and losingId != ''">
						       		AND T1.LOSING_ID = #{losingId} 
						       </if>
						       <if test="resGroupId != null and resGroupId != ''">
						       		AND T1.RES_GROUP_ID = #{resGroupId} 
						       </if>
						       <if test="labels != null and labels.size() > 0">
						       		<foreach collection="labels" item="label" separator=" " >
						       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
						       		</foreach> 
						       </if>
		  ) T 
		  LEFT JOIN (SELECT CM1.MONEY,CM1.CUST_ID FROM CONTRACT_MONEY CM1 WHERE CM1.ORG_ID=#{orgId}) CM ON T.RES_CUST_ID = CM.CUST_ID
		  LEFT JOIN (SELECT CT.CUST_ID,MAX(CT.INVALID_DATE) AS CONTRACT_END_DATE 
		  		FROM CONTRACT CT 
		  	WHERE CT.ORG_ID = #{orgId,jdbcType=VARCHAR} 
<!-- 		  	AND CT.AUTH_STATE = 2  -->
		  	AND CT.IS_DEL = 0 
		  GROUP BY CT.CUST_ID) TD 
			ON T.RES_CUST_ID = TD.CUST_ID 
		  WHERE 1=1 
		   <!-- 合同截止时间 -->
	       <if test="pstartDate != null and pstartDate != ''">
	       		AND TD.CONTRACT_END_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
	       </if>
	       <if test="pendDate != null and pendDate != ''">
	       		AND TD.CONTRACT_END_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
	       </if>
		   ) W 
			<if test="orderKey != null">
		       ORDER BY ${orderKey }  
	       </if>
	</select>
	
	<sql id="findLosingCusts">
		SELECT 
		   T1.NAME,
	       T1.RES_CUST_ID,
	       T1.COMPANY,
	       T1.OWNER_ACC,
	       T1.STATUS,
	       T1.TYPE,
	       T1.OWNER_START_DATE,
	       T1.MOBILEPHONE,
	       T1.TELPHONE,
	       T1.ALTERNATE_PHONE2,
	       T1.IS_MAJOR,
	       T1.ACTION_DATE,
	       T1.NEXTFOLLOW_DATE,
       	   T1.SIGN_DATE,
       	   T1.MAIN_LINKMAN,
       	   T1.LOSING_REMARK,
       	   T1.LOSING_ID,
       	   T1.RES_GROUP_ID,
       	   T1.LAST_CUST_TYPE_ID AS CUST_TYPE_ID,
       	   T1.DEFINED1,
	       T1.DEFINED2,
	       T1.DEFINED3,
	       T1.DEFINED4,
	       T1.DEFINED5,
	       T1.DEFINED6,
	       T1.DEFINED7,
	       T1.DEFINED8,
	       T1.DEFINED9,
	       T1.DEFINED10,
	       T1.DEFINED11,
	       T1.DEFINED12,
	       T1.DEFINED13,
	       T1.DEFINED14,
	       T1.DEFINED15, 
   	       T1.DEFINED16, 
           T1.DEFINED17, 
           T1.DEFINED18,
           T1.IMPORT_DEPT_ID,
           T1.COMPANY_MONEY,
           T1.COMPANY_USER,
           T1.COMPANY_FAX,
           T1.PROVINCE_ID,
           T1.CITY_ID,
           T1.COUNTY_ID,
           T1.KEYWORD,
           T1.COMPANY_TRADE,
           T1.SOURCE  
		 FROM TSM_RES_CUST_INFO T1 
  				WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
			  	AND T1.TYPE = 2 
			    AND T1.STATUS = 8    	
			    AND T1.IS_DEL = 0 
			  <if test="custIds != null and custIds.size() > 0">
		   		AND T1.RES_CUST_ID IN 
		   			<foreach collection="custIds" item="cid" open="(" separator="," close=")">
		   				#{cid}
		   			</foreach>
		      </if>
			  <choose>
				   <when test="adminAcc != null and adminAcc != ''">
						<choose>
							<when test="ownerAccs!=null and ownerAccs.size() > 0">
								<if test="ownerAccs!=null">
						       		AND T1.OWNER_ACC IN 
									<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
										#{item}
									</foreach>
						        </if>
							</when>
							<otherwise>
								AND T1.OWNER_ACC = #{adminAcc,jdbcType=VARCHAR} 
							</otherwise>
						</choose>
				   </when>
				   <otherwise>
				   		AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
				   </otherwise>
			   </choose>
			   <if test="name != null and name != ''">
			   		AND T1.NAME LIKE CONCAT(#{name,jdbcType=VARCHAR},'%') 
			   </if>
			   <if test="telphone != null and telphone != ''">
			   		AND (T1.MOBILEPHONE = #{telphone} or T1.TELPHONE = #{telphone} or T1.ALTERNATE_PHONE2 = #{telphone}) 
			   </if>
			   <if test="startActionDate != null and startActionDate != ''">
		       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="endActionDate != null and endActionDate != ''">
		       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="mainLinkman != null and mainLinkman != ''">
		       		AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{mainLinkman,jdbcType=VARCHAR},'%') 
		       </if>
		       <if test='noteType == "2"'>
		       		AND DATEDIFF(NOW(),T1.ACTION_DATE) &lt;= 7    
		       </if>
		       <if test='noteType == "3"'>
		       	    AND DATEDIFF(NOW(),T1.ACTION_DATE) &lt;= 30    
		       </if>
		       <if test='noteType == "4"'>
		       		AND DATEDIFF(NOW(),T1.ACTION_DATE) &lt;= 90  
		       </if>
		       <if test='noteType == "5"'>
		       		AND DATEDIFF(NOW(),T1.ACTION_DATE) > 90  
		       </if>
		       <if test="losingId != null and losingId != ''">
		       		AND T1.LOSING_ID = #{losingId} 
		       </if>
		       <if test="resGroupId != null and resGroupId != ''">
		       		AND T1.RES_GROUP_ID = #{resGroupId} 
		       </if>
		       <if test="custTypeId != null and custTypeId != ''">
		       		AND T1.LAST_CUST_TYPE_ID = #{custTypeId} 
		       </if>
		       <if test="labels != null and labels.size() > 0">
		       		<foreach collection="labels" item="label" separator=" " >
		       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
		       		</foreach> 
		       </if>
		       <if test="defined1 != null and defined1 != ''">
				   AND T1.DEFINED1 = #{defined1,jdbcType=VARCHAR} 
				</if>
				<if test="defined2 != null and defined2 != ''">
				   AND T1.DEFINED2 = #{defined2,jdbcType=VARCHAR} 
				</if>
				<if test="defined3 != null and defined3 != ''">
					AND T1.DEFINED3 = #{defined3,jdbcType=VARCHAR} 
				</if>
				<if test="defined4 != null and defined4 != ''">
					AND T1.DEFINED4 = #{defined4,jdbcType=VARCHAR}  
				</if>
				<if test="defined5 != null and defined5 != ''">
					AND T1.DEFINED5 = #{defined5,jdbcType=VARCHAR} 
				</if>
				<if test="defined6 != null and defined6 != ''">
					AND T1.DEFINED6 = #{defined6,jdbcType=VARCHAR} 
				</if>
				<if test="defined7 != null and defined7 != ''">
					AND T1.DEFINED7 = #{defined7,jdbcType=VARCHAR} 
				</if>
				<if test="defined8 != null and defined8 != ''">
					AND T1.DEFINED8 = #{defined8,jdbcType=VARCHAR} 
				</if>
				<if test="defined9 != null and defined9 != ''">
					AND T1.DEFINED9 = #{defined9,jdbcType=VARCHAR} 
				</if>
				<if test="defined10 != null and defined10 != ''">
					AND T1.DEFINED10 = #{defined10,jdbcType=VARCHAR} 
				</if>
				<if test="defined11 != null and defined11 != ''">
					AND T1.DEFINED11 = #{defined11,jdbcType=VARCHAR} 
				</if>
				<if test="defined12 != null and defined12 != ''">
					AND T1.DEFINED12 = #{defined12,jdbcType=VARCHAR} 
				</if>
				<if test="defined13 != null and defined13 != ''">
					AND T1.DEFINED13 = #{defined13,jdbcType=VARCHAR} 
				</if>
				<if test="defined14 != null and defined14 != ''">
					AND T1.DEFINED14 = #{defined14,jdbcType=VARCHAR} 
				</if>
				<if test="defined15 != null and defined15 != ''">
					AND T1.DEFINED15 = #{defined15,jdbcType=VARCHAR} 
				</if>
		       <if test="startdefined16!= null and startdefined16 !=''">
					AND T1.DEFINED16 >=
					 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test=" enddefined16 != null and enddefined16 !=''">
					AND T1.DEFINED16 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="startdefined17!= null and startdefined17 !=''">
					AND T1.DEFINED17 >=
					 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined17 != null and enddefined17 !=''">
					AND T1.DEFINED17 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>	
				<if test="startdefined18!= null and startdefined18 !=''">
					AND T1.DEFINED18 >=
					 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined18 != null and enddefined18 !=''">
					AND T1.DEFINED18 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="companyTrade != null and companyTrade != ''">
					AND T1.COMPANY_TRADE = #{companyTrade }
				</if>
				<if test="source != null">
					 AND T1.SOURCE = #{source,jdbcType=DECIMAL} 
			   </if>
			   <!-- 所在地区查询 -->
				<if test="provinceId != null">
					AND T1.PROVINCE_ID = #{provinceId,jdbcType=DECIMAL}
				</if>
				<if test="cityId != null">
					AND T1.CITY_ID = #{cityId,jdbcType=DECIMAL}
				</if>
				<if test="countyId != null">
					AND T1.COUNTY_ID = #{countyId,jdbcType=DECIMAL}
				</if>
	</sql>
	
	<select id="findManageLosingCustListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		SELECT 
		   W.NAME,
	       W.RES_CUST_ID,
	       W.COMPANY,
	       W.OWNER_ACC,
	       W.STATUS,
	       W.TYPE,
	       W.OWNER_START_DATE,
	       W.MOBILEPHONE,
	       W.TELPHONE,
	       W.ALTERNATE_PHONE2,
	       W.IS_MAJOR,
	       W.ACTION_DATE,
	       W.NEXTFOLLOW_DATE,
	       W.SIGN_DATE,
	       W.TOTAL_ORDER_AMOUNT,
	       W.CONTRACT_END_DATE,   
	       W.DAYS,
	       W.MAIN_LINKMAN,
	       W.LOSING_REMARK,  
	       W.RES_GROUP_ID,
	       W.CUST_TYPE_ID,
	       W.LOSING_ID,
	       W.DEFINED1,
	       W.DEFINED2,
	       W.DEFINED3,
	       W.DEFINED4,
	       W.DEFINED5,
	       W.DEFINED6,
	       W.DEFINED7,
	       W.DEFINED8,
	       W.DEFINED9,
	       W.DEFINED10,
	       W.DEFINED11,
	       W.DEFINED12,
	       W.DEFINED13,
	       W.DEFINED14,
	       W.DEFINED15, 
   	       W.DEFINED16, 
           W.DEFINED17, 
           W.DEFINED18,
           W.IMPORT_DEPT_ID,
           W.COMPANY_MONEY,
           W.COMPANY_USER,
           W.COMPANY_FAX,
           W.PROVINCE_ID,
           W.CITY_ID,
           W.COUNTY_ID,
           W.KEYWORD,
           W.COMPANY_TRADE,
           W.SOURCE   
		FROM (SELECT T.NAME,
		       T.RES_CUST_ID,
		       T.COMPANY,
		       T.OWNER_ACC,
		       T.STATUS,
		       T.TYPE,
		       T.OWNER_START_DATE,
		       T.MOBILEPHONE,
		       T.TELPHONE,
		       T.ALTERNATE_PHONE2,
		       T.IS_MAJOR,
		       T.ACTION_DATE,
		       T.NEXTFOLLOW_DATE,
		       T.SIGN_DATE,
		       IFNULL(CM.MONEY,0) AS TOTAL_ORDER_AMOUNT,
		       TD.CONTRACT_END_DATE,   
		       DATEDIFF(NOW(),T.ACTION_DATE) DAYS,
		       T.MAIN_LINKMAN,
		       T.LOSING_REMARK,  
		       T.LOSING_ID,
		       T.RES_GROUP_ID,
		       T.CUST_TYPE_ID,
		       T.DEFINED1,
		       T.DEFINED2,
		       T.DEFINED3,
		       T.DEFINED4,
		       T.DEFINED5,
		       T.DEFINED6,
		       T.DEFINED7,
		       T.DEFINED8,
		       T.DEFINED9,
		       T.DEFINED10,
		       T.DEFINED11,
		       T.DEFINED12,
		       T.DEFINED13,
		       T.DEFINED14,
		       T.DEFINED15, 
	   	       T.DEFINED16, 
	           T.DEFINED17, 
	           T.DEFINED18,
	           T.IMPORT_DEPT_ID,
	           T.COMPANY_MONEY,
	           T.COMPANY_USER,
	           T.COMPANY_FAX,
	           T.PROVINCE_ID,
	           T.CITY_ID,
	           T.COUNTY_ID,
	           T.KEYWORD,
	           T.COMPANY_TRADE,
	           T.SOURCE  
		  FROM (
		  		<include refid="findLosingCusts" />
		  		<if test="queryText != null and queryText != ''">
		       		<choose>
		       			<when test='queryType != null and queryType == "custName"'>
		       				AND T1.NAME LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<when test='queryType != null and queryType == "mainLinkman"'>
		       				AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<when test='queryType != null and queryType == "company"'>
		       				AND T1.COMPANY LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<otherwise>
		       				AND T1.${queryType } LIKE CONCAT('%',#{queryText},'%') 
		       			</otherwise>
		       		</choose>
		       </if>
		  ) T 
		  LEFT JOIN (SELECT CM1.MONEY,CM1.CUST_ID FROM CONTRACT_MONEY CM1 WHERE CM1.ORG_ID=#{orgId}) CM ON T.RES_CUST_ID = CM.CUST_ID
		  LEFT JOIN (SELECT CT.CUST_ID,MAX(CT.INVALID_DATE) AS CONTRACT_END_DATE 
		  		FROM CONTRACT CT 
		  	WHERE CT.ORG_ID = #{orgId,jdbcType=VARCHAR} 
		  	AND CT.IS_DEL = 0 
		  GROUP BY CT.CUST_ID) TD 
			ON T.RES_CUST_ID = TD.CUST_ID 
		  WHERE 1=1 
		   <!-- 合同截止时间 -->
	       <if test="pstartDate != null and pstartDate != ''">
	       		AND TD.CONTRACT_END_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
	       </if>
	       <if test="pendDate != null and pendDate != ''">
	       		AND TD.CONTRACT_END_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
	       </if>
		   ) W 
		   <if test="orderKey != null and orderKey != ''">
			   ORDER BY ${orderKey } 
		   </if>
	</select>
	
	<select id="findManageLosingCustPhoneListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		SELECT 
		   W.NAME,
	       W.RES_CUST_ID,
	       W.COMPANY,
	       W.OWNER_ACC,
	       W.STATUS,
	       W.TYPE,
	       W.OWNER_START_DATE,
	       W.MOBILEPHONE,
	       W.TELPHONE,
	       W.ALTERNATE_PHONE2,
	       W.IS_MAJOR,
	       W.ACTION_DATE,
	       W.NEXTFOLLOW_DATE,
	       W.SIGN_DATE,
	       W.TOTAL_ORDER_AMOUNT,
	       W.CONTRACT_END_DATE,   
	       W.DAYS,
	       W.MAIN_LINKMAN,
	       W.LOSING_REMARK,  
	       W.RES_GROUP_ID,
	       W.CUST_TYPE_ID,
	       W.LOSING_ID,
	       W.DEFINED1,
	       W.DEFINED2,
	       W.DEFINED3,
	       W.DEFINED4,
	       W.DEFINED5,
	       W.DEFINED6,
	       W.DEFINED7,
	       W.DEFINED8,
	       W.DEFINED9,
	       W.DEFINED10,
	       W.DEFINED11,
	       W.DEFINED12,
	       W.DEFINED13,
	       W.DEFINED14,
	       W.DEFINED15, 
   	       W.DEFINED16, 
           W.DEFINED17, 
           W.DEFINED18,
           W.IMPORT_DEPT_ID,
           W.COMPANY_MONEY,
           W.COMPANY_USER,
           W.COMPANY_FAX,
           W.PROVINCE_ID,
           W.CITY_ID,
           W.COUNTY_ID,
           W.KEYWORD,
           W.COMPANY_TRADE,
           W.SOURCE   
		FROM (SELECT T.NAME,
		       T.RES_CUST_ID,
		       T.COMPANY,
		       T.OWNER_ACC,
		       T.STATUS,
		       T.TYPE,
		       T.OWNER_START_DATE,
		       T.MOBILEPHONE,
		       T.TELPHONE,
		       T.ALTERNATE_PHONE2,
		       T.IS_MAJOR,
		       T.ACTION_DATE,
		       T.NEXTFOLLOW_DATE,
		       T.SIGN_DATE,
		       IFNULL(CM.MONEY,0) AS TOTAL_ORDER_AMOUNT,
		       TD.CONTRACT_END_DATE,   
		       DATEDIFF(NOW(),T.ACTION_DATE) DAYS,
		       T.MAIN_LINKMAN,
		       T.LOSING_REMARK,  
		       T.LOSING_ID,
		       T.RES_GROUP_ID,
		       T.CUST_TYPE_ID,
		       T.DEFINED1,
		       T.DEFINED2,
		       T.DEFINED3,
		       T.DEFINED4,
		       T.DEFINED5,
		       T.DEFINED6,
		       T.DEFINED7,
		       T.DEFINED8,
		       T.DEFINED9,
		       T.DEFINED10,
		       T.DEFINED11,
		       T.DEFINED12,
		       T.DEFINED13,
		       T.DEFINED14,
		       T.DEFINED15, 
	   	       T.DEFINED16, 
	           T.DEFINED17, 
	           T.DEFINED18,
	           T.IMPORT_DEPT_ID,
	           T.COMPANY_MONEY,
	           T.COMPANY_USER,
	           T.COMPANY_FAX,
	           T.PROVINCE_ID,
	           T.CITY_ID,
	           T.COUNTY_ID,
	           T.KEYWORD,
	           T.COMPANY_TRADE,
	           T.SOURCE 
		  FROM (
		  		<include refid="findLosingCusts" />
		  		AND T1.MOBILEPHONE = #{queryText}
		  		UNION
		  		<include refid="findLosingCusts" />
		  		AND T1.TELPHONE = #{queryText}
		  ) T 
		  LEFT JOIN (SELECT CM1.MONEY,CM1.CUST_ID FROM CONTRACT_MONEY CM1 WHERE CM1.ORG_ID=#{orgId}) CM ON T.RES_CUST_ID = CM.CUST_ID
		  LEFT JOIN (SELECT CT.CUST_ID,MAX(CT.INVALID_DATE) AS CONTRACT_END_DATE 
		  		FROM CONTRACT CT 
		  	WHERE CT.ORG_ID = #{orgId,jdbcType=VARCHAR} 
		  	AND CT.IS_DEL = 0 
		  GROUP BY CT.CUST_ID) TD 
			ON T.RES_CUST_ID = TD.CUST_ID 
		  WHERE 1=1 
		   <!-- 合同截止时间 -->
	       <if test="pstartDate != null and pstartDate != ''">
	       		AND TD.CONTRACT_END_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
	       </if>
	       <if test="pendDate != null and pendDate != ''">
	       		AND TD.CONTRACT_END_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
	       </if>
		   ) W 
		   
		   <if test="orderKey != null and orderKey != ''">
			   ORDER BY ${orderKey } 
		   </if> 
	</select>
	
	<select id="findDeliveryIdsListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		SELECT  T.RES_CUST_ID ,
				T.TYPE,
				T.STATUS,
		        T.LAST_OPTION_ID,
		        (CASE T.STATUS WHEN 6 THEN T.OWNER_START_DATE ELSE NOW() END) AS OWNER_START_DATE 
			FROM TSM_RES_CUST_INFO T 
		WHERE T.ORG_ID=#{orgId} 
			AND T.IS_DEL = 0 
			AND T.OWNER_ACC = #{ownerAcc}
			<if test='custType == null or custType == ""'>
				AND T.STATUS IN (2,3,6,7,8) 
			</if>
			<if test='custType == "1"'>
				AND T.STATUS IN (2,3) 
		    	AND T.TYPE in (1,3) 
			</if>
			<if test='custType == "2"'>
				AND T.STATUS IN (2,3) 
	       		AND T.TYPE = 2 
			</if>
			<if test='custType == "3"'>
				AND T.STATUS = 6 
			</if>
			<if test='custType == "4"'>
				AND T.STATUS = 7 
			</if>
			<if test='custType == "5"'>
				AND T.STATUS = 8 
			</if>
	</select>
	
	<resultMap type="map" id="NumMap">
		<result column="resNum" property="resNum" jdbcType="DECIMAL"/>
		<result column="intNum" property="intNum" jdbcType="DECIMAL"/>
		<result column="signNum" property="signNum" jdbcType="DECIMAL"/>
		<result column="silentNum" property="silentNum" jdbcType="DECIMAL"/>
		<result column="losingNum" property="losingNum" jdbcType="DECIMAL"/>
		<result column="allNum" property="allNum" jdbcType="DECIMAL"/>
	</resultMap>
	
	
	<select id="findCustNums" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="NumMap">
		SELECT 
			 IFNULL(SUM((CASE WHEN T.STATUS IN (2,3) AND T.TYPE in (1,3) THEN 1 ELSE 0 END)),0) resNum,
			 IFNULL(SUM((CASE WHEN T.STATUS IN (2,3) AND T.TYPE = 2 THEN 1 ELSE 0 END)),0) intNum,
			 IFNULL(SUM((CASE WHEN T.STATUS = 6 THEN 1 ELSE 0 END )),0) signNum,
			 IFNULL(SUM((CASE WHEN T.STATUS = 7 THEN 1 ELSE 0 END )),0) silentNum,
			 IFNULL(SUM((CASE WHEN T.STATUS = 8 THEN 1 ELSE 0 END )),0) losingNum,
			 IFNULL(SUM((CASE WHEN T.STATUS IN (2,3,6,7,8) THEN 1 ELSE 0 END)),0) allNum,
			 IFNULL(SUM((CASE WHEN T.STATUS IN (4, 5) THEN 1 ELSE 0 END)),0) poolNum 
		 FROM 
			TSM_RES_CUST_INFO T 
		  WHERE T.ORG_ID=#{orgId} 
		  	AND T.IS_DEL = 0 
		  	<if test="adminAcc != null and adminAcc != ''">
			   	AND T.OWNER_ACC IN (SELECT TTGM.MEMBER_ACC
		          FROM TSM_GROUP_SHAREINFO TGS
		         RIGHT JOIN TSM_TEAM_GROUP_MEMBER TTGM
		            ON  TGS.ORG_ID= #{orgId} and TTGM.ORG_ID= #{orgId} and TTGM.GROUP_ID = TGS.GROUP_ID
		         WHERE SHARE_ACC = #{adminAcc,jdbcType=VARCHAR}
		         <if test="groupId != null and groupId != ''">
		         	AND TTGM.GROUP_ID = #{groupId} 
		         </if>
		         ) 
		  	</if>
		  	<if test="startDate != null and startDate != ''">
		  		AND T.NEXTFOLLOW_DATE >= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		  		AND T.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{startDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
		  	</if>
		  	<if test="ownerAcc != null and ownerAcc != ''">
		      	AND T.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
		    </if>
	</select>
	
	<select id="findIsPrecedence" resultType="java.lang.Integer">
		SELECT IS_PRECEDENCE FROM 
			TSM_RES_CUST_INFO T 
		  WHERE T.ORG_ID=#{orgId} 
		  	and t.RES_CUST_ID =#{resCustId}
		  	AND T.IS_DEL = 0 
	</select>

	<select id="findAllTypeCustListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		  		SELECT 
				   T1.NAME,
				   T1.RES_CUST_ID,
			       T1.COMPANY,
			       T1.OWNER_ACC,
			       T1.STATUS,
			       T1.TYPE,
			       T1.OWNER_START_DATE,
			       T1.NEXTFOLLOW_DATE,
			       T1.LAST_OPTION_ID,
			       T1.ACTION_DATE,
		           T1.MOBILEPHONE,
			  	   T1.TELPHONE,
		       	   T1.IS_MAJOR,
		           T1.MAIN_LINKMAN,
		           T1.FILTER_COUNT,
		           T1.RES_GROUP_ID,
		           T1.LAST_CUST_TYPE_ID AS CUST_TYPE_ID,
		           T1.FILTER_TYPE,
			       T1.DEFINED1,
			       T1.DEFINED2,
			       T1.DEFINED3,
			       T1.DEFINED4,
			       T1.DEFINED5,
			       T1.DEFINED6,
			       T1.DEFINED7,
			       T1.DEFINED8,
			       T1.DEFINED9,
			       T1.DEFINED10,
			       T1.DEFINED11,
			       T1.DEFINED12,
			       T1.DEFINED13,
			       T1.DEFINED14,
			       T1.DEFINED15, 
	       	       T1.DEFINED16, 
	               T1.DEFINED17, 
	               T1.DEFINED18,
	               T1.IMPORT_DEPT_ID,
	               T1.COMPANY_MONEY,
	               T1.COMPANY_USER,
	               T1.COMPANY_FAX,
	               T1.PROVINCE_ID,
	               T1.CITY_ID,
	               T1.COUNTY_ID,
	               T1.KEYWORD,
	               T1.COMPANY_TRADE,
	               T1.SOURCE  
				 FROM TSM_RES_CUST_INFO T1
		  				WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
						 	AND T1.IS_DEL = 0 
						  <if test="custIds != null and custIds.size() > 0">
					   		AND T1.RES_CUST_ID IN 
					   			<foreach collection="custIds" item="cid" open="(" separator="," close=")">
					   				#{cid}
					   			</foreach>
					      </if>
					      <if test="source != null">
								AND T1.SOURCE = #{source,jdbcType=DECIMAL} 
						  </if>
						  <choose>
							   <when test="adminAcc != null and adminAcc != ''">
									<choose>
										<when test="ownerAccs!=null and ownerAccs.size() > 0">
											<if test="ownerAccs!=null">
									       		AND T1.OWNER_ACC IN 
												<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
													#{item}
												</foreach>
									        </if>
										</when>
										<otherwise>
											AND T1.OWNER_ACC = #{adminAcc,jdbcType=VARCHAR} 
										</otherwise>
									</choose>
							   </when>
							   <otherwise>
							   		AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
							   </otherwise>
						  </choose>
						  <if test='custType == "0"'>
						  		AND T1.STATUS IN (2,3,6,7,8) 
						  </if>
						  <if test='custType == "1"'><!-- 资源 -->
								AND T1.STATUS IN (2,3) 
							    AND T1.TYPE in (1,3) 
							   <if test='noteType != null and noteType == "2"'>
							   		AND T1.OWNER_ACTION_DATE IS NULL 
							   </if>
							   <if test='noteType != null and noteType == "3"'>
							   		AND T1.OWNER_ACTION_DATE IS NOT NULL 
							   </if>
							   <if test='noteType != null and noteType == "4"'>
							   		<choose>
						       			<when test="ids != null and ids.size() > 0">
						       				AND (
						       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
						       				OR T1.RES_CUST_ID IN <foreach collection="ids" item="item" open="(" separator="," close=")">#{item}</foreach>
						       				)
						       			</when>
						       			<otherwise>
								       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
								       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
						       			</otherwise>
						       		</choose>
							   </if>
							   <if test='noteType != null and noteType == "5"'>
							   		AND T1.OWNER_ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
							   </if>
							   <if test='noteType != null and noteType == "6"'>
							   		AND T1.IS_PRECEDENCE = 1 
							   </if>
							   <if test='noteType != null and noteType == "7"'>
							   		AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 7 
							   </if>
						  </if>
						  <if test='custType == "2"'><!-- 意向客户 -->
						    	AND T1.STATUS IN (2,3)  
						       	AND T1.TYPE = 2 
						       <if test='noteType == "2"'>
						       		AND T1.AMOYTOCUSTOMER_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "3"'>
						       		<choose>
						       			<when test="ids != null and ids.size() > 0">
						       				AND (
						       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
						       				OR T1.RES_CUST_ID IN <foreach collection="ids" item="item" open="(" separator="," close=")">#{item}</foreach>
						       				)
						       			</when>
						       			<otherwise>
								       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
								       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
						       			</otherwise>
						       		</choose>
						       </if>
						       <if test='noteType == "4"'>
						       		AND T1.OWNER_ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "5"'>
						       		AND T1.IS_MAJOR = 1 
						       </if>
						       <if test='noteType == "6"'>
						       		AND T1.OWNER_ACTION_DATE  >= STR_TO_DATE(CONCAT(DATE_FORMAT(DATE_ADD(CURDATE(),INTERVAL -WEEKDAY(CURDATE())DAY),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "7"'>
						       		AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 7 
						       </if>
						       <if test='noteType == "8"'>
						       		AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 30  
						       </if>
						  </if>
						  <if test='custType == "3"'><!-- 签约客户 -->
						    	AND T1.STATUS = 6  
						       <if test='noteType == "2"'>
						        	AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(NOW(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "3"'>
						        	AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(NOW(),'%Y-%m'),'-01 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "4"'>
						        	<choose>
						       			<when test="ids != null and ids.size() > 0">
						       				AND (
						       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
						       				OR T1.RES_CUST_ID IN <foreach collection="ids" item="item" open="(" separator="," close=")">#{item}</foreach>
						       				)
						       			</when>
						       			<otherwise>
								       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
								       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
						       			</otherwise>
						       		</choose>
						       </if>
						       <if test='noteType == "5"'>
						        	AND T1.OWNER_ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "6"'>
						        	AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 7 
						       </if>
						       <if test='noteType == "7"'>
						        	AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 30  
						       </if>
						  </if>
						  <if test='custType == "4"'><!-- 沉默客户 -->
					    	AND T1.STATUS = 7  
						  </if>
						  <if test='custType == "5"'><!-- 流失客户 -->
					    	AND T1.STATUS = 8   
						  </if>
						  <if test='custType == "6"'><!-- 意向客户 签约客户 -->
						  	AND T1.STATUS IN (2,3,6) 
					       	AND T1.TYPE = 2 
						  </if>
					   	  <if test="telphone != null and telphone != ''">
					        AND (T1.MOBILEPHONE = #{telphone} or T1.TELPHONE = #{telphone} or T1.ALTERNATE_PHONE2 = #{telphone}) 
					      </if>
					      <if test='resGroupId != null and resGroupId != "" and resGroupId != "0"'>
				       		AND T1.RES_GROUP_ID = #{resGroupId} 
				          </if>
				       	  <if test='resGroupId == "0"'>
				       		AND T1.RES_GROUP_ID IS NULL 
				          </if>
				          <if test="startActionDate != null and startActionDate != ''">
				       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="endActionDate != null and endActionDate != ''">
				       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="pstartDate != null and pstartDate != ''">
				       		AND T1.OWNER_START_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="pendDate != null and pendDate != ''">
				       		AND T1.OWNER_START_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="startNextContactDate != null and startNextContactDate != ''">
					       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{startNextContactDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="endNextContactDate != null and endNextContactDate != ''">
					       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{endNextContactDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="startDate != null and startDate != ''">
					       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="endDate != null and endDate != ''">
					       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test='nDateType == "6"'>
					      		AND T1.NEXTFOLLOW_DATE IS NULL 
					      </if>
					      <if test="defined1 != null and defined1 != ''">
							   AND T1.DEFINED1 = #{defined1,jdbcType=VARCHAR} 
							</if>
							<if test="defined2 != null and defined2 != ''">
							   AND T1.DEFINED2 = #{defined2,jdbcType=VARCHAR} 
							</if>
							<if test="defined3 != null and defined3 != ''">
								AND T1.DEFINED3 = #{defined3,jdbcType=VARCHAR} 
							</if>
							<if test="defined4 != null and defined4 != ''">
								AND T1.DEFINED4 = #{defined4,jdbcType=VARCHAR}  
							</if>
							<if test="defined5 != null and defined5 != ''">
								AND T1.DEFINED5 = #{defined5,jdbcType=VARCHAR} 
							</if>
							<if test="defined6 != null and defined6 != ''">
								AND T1.DEFINED6 = #{defined6,jdbcType=VARCHAR} 
							</if>
							<if test="defined7 != null and defined7 != ''">
								AND T1.DEFINED7 = #{defined7,jdbcType=VARCHAR} 
							</if>
							<if test="defined8 != null and defined8 != ''">
								AND T1.DEFINED8 = #{defined8,jdbcType=VARCHAR} 
							</if>
							<if test="defined9 != null and defined9 != ''">
								AND T1.DEFINED9 = #{defined9,jdbcType=VARCHAR} 
							</if>
							<if test="defined10 != null and defined10 != ''">
								AND T1.DEFINED10 = #{defined10,jdbcType=VARCHAR} 
							</if>
							<if test="defined11 != null and defined11 != ''">
								AND T1.DEFINED11 = #{defined11,jdbcType=VARCHAR} 
							</if>
							<if test="defined12 != null and defined12 != ''">
								AND T1.DEFINED12 = #{defined12,jdbcType=VARCHAR} 
							</if>
							<if test="defined13 != null and defined13 != ''">
								AND T1.DEFINED13 = #{defined13,jdbcType=VARCHAR} 
							</if>
							<if test="defined14 != null and defined14 != ''">
								AND T1.DEFINED14 = #{defined14,jdbcType=VARCHAR} 
							</if>
							<if test="defined15 != null and defined15 != ''">
								AND T1.DEFINED15 = #{defined15,jdbcType=VARCHAR} 
							</if>
					      <if test="startdefined16!= null and startdefined16 !=''">
								AND T1.DEFINED16 >=
								 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
					                                       '%Y-%m-%d %H:%i:%s')
							</if>
							<if test=" enddefined16 != null and enddefined16 !=''">
								AND T1.DEFINED16 <![CDATA[ <= ]]>
								STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
					                                       '%Y-%m-%d %H:%i:%s')
							</if>
							<if test="startdefined17!= null and startdefined17 !=''">
								AND T1.DEFINED17 >=
								 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
					                                       '%Y-%m-%d %H:%i:%s')
							</if>
							<if test="enddefined17 != null and enddefined17 !=''">
								AND T1.DEFINED17 <![CDATA[ <= ]]>
								STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
					                                       '%Y-%m-%d %H:%i:%s')
							</if>	
							<if test="startdefined18!= null and startdefined18 !=''">
								AND T1.DEFINED18 >=
								 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
					                                       '%Y-%m-%d %H:%i:%s')
							</if>
							<if test="enddefined18 != null and enddefined18 !=''">
								AND T1.DEFINED18 <![CDATA[ <= ]]>
								STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
					                                       '%Y-%m-%d %H:%i:%s')
							</if>
							<if test="companyTrade != null and companyTrade != ''">
								AND T1.COMPANY_TRADE = #{companyTrade }
							</if>
					      <if test="nextFollowDate != null">
					      	AND T1.NEXTFOLLOW_DATE >= STR_TO_DATE(DATE_FORMAT(#{nextFollowDate,jdbcType=TIMESTAMP},'%Y-%m-%d 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		  					AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(DATE_FORMAT(#{nextFollowDate,jdbcType=TIMESTAMP},'%Y-%m-%d 23:59:59'),'%Y-%m-%d %H:%i:%s')
				          </if> 
				          <if test="queryText != null and queryText != ''">
					       		<choose>
					       			<when test='queryType != null and queryType == "custName"'>
					       				AND T1.NAME LIKE CONCAT('%',#{queryText},'%') 
					       			</when>
					       			<when test='queryType != null and queryType == "mainLinkman"'>
					       				AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{queryText},'%') 
					       			</when>
					       			<when test='queryType != null and queryType == "company"'>
					       				AND T1.COMPANY LIKE CONCAT('%',#{queryText},'%') 
					       			</when>
					       			<otherwise>
					       				AND T1.${queryType} LIKE CONCAT('%',#{queryText},'%') 
					       			</otherwise>
					       		</choose>
					       </if>
					      <if test="isMajor != null">
					       	AND T1.IS_MAJOR = #{isMajor}
					      </if>
					      <if test="saleProcessId != null and saleProcessId != ''">
				       		AND T1.LAST_OPTION_ID = #{saleProcessId} 
				          </if>
				          <if test="custTypeId != null and custTypeId != ''">
				       		AND T1.LAST_CUST_TYPE_ID = #{custTypeId} 
				          </if>
				          <if test="labels != null and labels.size() > 0">
					       		<foreach collection="labels" item="label" separator=" " >
					       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
					       		</foreach> 
					       </if>
					      <!-- 查询结果排除ids by lizhihui-->
					       <if test="rejectIds != null and rejectIds.size()>0">
					       		<foreach collection="rejectIds" item="id">
					       			and T1.RES_CUST_ID !=#{id}
					       		</foreach>
					       </if>
					       <!-- 所在地区查询 -->
							<if test="provinceId != null">
								AND T1.PROVINCE_ID = #{provinceId,jdbcType=DECIMAL}
							</if>
							<if test="cityId != null">
								AND T1.CITY_ID = #{cityId,jdbcType=DECIMAL}
							</if>
							<if test="countyId != null">
								AND T1.COUNTY_ID = #{countyId,jdbcType=DECIMAL}
							</if>
					       <if test="orderKey != null and orderKey != ''">
							   ORDER BY ${orderKey } 
						   </if>
	</select>
	
	<select id="findAllTypeCustPhoneListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		  		SELECT 
				   T1.NAME,
				   T1.RES_CUST_ID,
			       T1.COMPANY,
			       T1.OWNER_ACC,
			       T1.STATUS,
			       T1.TYPE,
			       T1.OWNER_START_DATE,
			       T1.NEXTFOLLOW_DATE,
			       T1.LAST_OPTION_ID,
			       T1.ACTION_DATE,
		           T1.MOBILEPHONE,
			  	   T1.TELPHONE,
		       	   T1.IS_MAJOR,
		           T1.MAIN_LINKMAN,
		           T1.FILTER_COUNT,
		           T1.RES_GROUP_ID,
		           T1.LAST_CUST_TYPE_ID AS CUST_TYPE_ID,
		           T1.FILTER_TYPE,
			       T1.DEFINED1,
			       T1.DEFINED2,
			       T1.DEFINED3,
			       T1.DEFINED4,
			       T1.DEFINED5,
			       T1.DEFINED6,
			       T1.DEFINED7,
			       T1.DEFINED8,
			       T1.DEFINED9,
			       T1.DEFINED10,
			       T1.DEFINED11,
			       T1.DEFINED12,
			       T1.DEFINED13,
			       T1.DEFINED14,
			       T1.DEFINED15, 
	       	       T1.DEFINED16, 
	               T1.DEFINED17, 
	               T1.DEFINED18,
	               T1.IMPORT_DEPT_ID,
	               T1.COMPANY_MONEY,
	               T1.COMPANY_USER,
	               T1.COMPANY_FAX,
	               T1.PROVINCE_ID,
	               T1.CITY_ID,
	               T1.COUNTY_ID,
	               T1.KEYWORD,
	               T1.COMPANY_TRADE,
	               T1.SOURCE      
				 FROM TSM_RES_CUST_INFO T1
		  				WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
						 	AND T1.IS_DEL = 0 
						 	AND T1.MOBILEPHONE = #{queryText} 
						  <if test="custIds != null and custIds.size() > 0">
					   		AND T1.RES_CUST_ID IN 
					   			<foreach collection="custIds" item="cid" open="(" separator="," close=")">
					   				#{cid}
					   			</foreach>
					      </if>
					      <if test="source != null">
								 AND T1.SOURCE = #{source,jdbcType=DECIMAL} 
						  </if>
						  <choose>
							   <when test="adminAcc != null and adminAcc != ''">
									<choose>
										<when test="ownerAccs!=null and ownerAccs.size() > 0">
											<if test="ownerAccs!=null">
									       		AND T1.OWNER_ACC IN 
												<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
													#{item}
												</foreach>
									        </if>
										</when>
										<otherwise>
											AND T1.OWNER_ACC = #{adminAcc,jdbcType=VARCHAR} 
										</otherwise>
									</choose>
							   </when>
							   <otherwise>
							   		AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
							   </otherwise>
						  </choose>
						  <if test='custType == "0"'>
						  		AND T1.STATUS IN (2,3,6,7,8) 
						  </if>
						  <if test='custType == "1"'><!-- 资源 -->
								AND T1.STATUS IN (2,3) 
							    AND T1.TYPE in (1,3) 
							   <if test='noteType != null and noteType == "2"'>
							   		AND T1.OWNER_ACTION_DATE IS NULL 
							   </if>
							   <if test='noteType != null and noteType == "3"'>
							   		AND T1.OWNER_ACTION_DATE IS NOT NULL 
							   </if>
							   <if test='noteType != null and noteType == "4"'>
							   		<choose>
						       			<when test="ids != null and ids.size() > 0">
						       				AND (
						       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
						       				OR T1.RES_CUST_ID IN <foreach collection="ids" item="item" open="(" separator="," close=")">#{item}</foreach>
						       				)
						       			</when>
						       			<otherwise>
								       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
								       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
						       			</otherwise>
						       		</choose>
							   </if>
							   <if test='noteType != null and noteType == "5"'>
							   		AND T1.OWNER_ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
							   </if>
							   <if test='noteType != null and noteType == "6"'>
							   		AND T1.IS_PRECEDENCE = 1 
							   </if>
							   <if test='noteType != null and noteType == "7"'>
							   		AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 7 
							   </if>
						  </if>
						  <if test='custType == "2"'><!-- 意向客户 -->
						    	AND T1.STATUS IN (2,3)  
						       	AND T1.TYPE = 2 
						       <if test='noteType == "2"'>
						       		AND T1.AMOYTOCUSTOMER_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "3"'>
						       		<choose>
						       			<when test="ids != null and ids.size() > 0">
						       				AND (
						       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
						       				OR T1.RES_CUST_ID IN <foreach collection="ids" item="item" open="(" separator="," close=")">#{item}</foreach>
						       				)
						       			</when>
						       			<otherwise>
								       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
								       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
						       			</otherwise>
						       		</choose>
						       </if>
						       <if test='noteType == "4"'>
						       		AND T1.OWNER_ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "5"'>
						       		AND T1.IS_MAJOR = 1 
						       </if>
						       <if test='noteType == "6"'>
						       		AND T1.OWNER_ACTION_DATE  >= STR_TO_DATE(CONCAT(DATE_FORMAT(DATE_ADD(CURDATE(),INTERVAL -WEEKDAY(CURDATE())DAY),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "7"'>
						       		AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 7 
						       </if>
						       <if test='noteType == "8"'>
						       		AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 30  
						       </if>
						  </if>
						  <if test='custType == "3"'><!-- 签约客户 -->
						    	AND T1.STATUS = 6  
						       <if test='noteType == "2"'>
						        	AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(NOW(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "3"'>
						        	AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(NOW(),'%Y-%m'),'-01 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "4"'>
						        	<choose>
						       			<when test="ids != null and ids.size() > 0">
						       				AND (
						       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
						       				OR T1.RES_CUST_ID IN <foreach collection="ids" item="item" open="(" separator="," close=")">#{item}</foreach>
						       				)
						       			</when>
						       			<otherwise>
								       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
								       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
						       			</otherwise>
						       		</choose>
						       </if>
						       <if test='noteType == "5"'>
						        	AND T1.OWNER_ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "6"'>
						        	AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 7 
						       </if>
						       <if test='noteType == "7"'>
						        	AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 30  
						       </if>
						  </if>
						  <if test='custType == "4"'><!-- 沉默客户 -->
					    	AND T1.STATUS = 7  
						  </if>
						  <if test='custType == "5"'><!-- 流失客户 -->
					    	AND T1.STATUS = 8   
						  </if>
						  <if test='custType == "6"'><!-- 意向客户 签约客户 -->
						  	AND T1.STATUS IN (2,3,6) 
					       	AND T1.TYPE = 2 
						  </if>
					   	  <if test="telphone != null and telphone != ''">
					        AND (T1.MOBILEPHONE = #{telphone} or T1.TELPHONE = #{telphone} or T1.ALTERNATE_PHONE2 = #{telphone}) 
					      </if>
					      <if test='resGroupId != null and resGroupId != "" and resGroupId != "0"'>
				       		AND T1.RES_GROUP_ID = #{resGroupId} 
				          </if>
				       	  <if test='resGroupId == "0"'>
				       		AND T1.RES_GROUP_ID IS NULL 
				          </if>
				          <if test="startActionDate != null and startActionDate != ''">
				       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="endActionDate != null and endActionDate != ''">
				       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="pstartDate != null and pstartDate != ''">
				       		AND T1.OWNER_START_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="pendDate != null and pendDate != ''">
				       		AND T1.OWNER_START_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="startNextContactDate != null and startNextContactDate != ''">
					       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{startNextContactDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="endNextContactDate != null and endNextContactDate != ''">
					       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{endNextContactDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="startDate != null and startDate != ''">
					       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					       </if>
					       <if test="endDate != null and endDate != ''">
					       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					       </if>
					       <if test='nDateType == "6"'>
					      		AND T1.NEXTFOLLOW_DATE IS NULL 
					       </if>
					       <if test="defined1 != null and defined1 != ''">
							   AND T1.DEFINED1 = #{defined1,jdbcType=VARCHAR} 
							</if>
							<if test="defined2 != null and defined2 != ''">
							   AND T1.DEFINED2 = #{defined2,jdbcType=VARCHAR} 
							</if>
							<if test="defined3 != null and defined3 != ''">
								AND T1.DEFINED3 = #{defined3,jdbcType=VARCHAR} 
							</if>
							<if test="defined4 != null and defined4 != ''">
								AND T1.DEFINED4 = #{defined4,jdbcType=VARCHAR}  
							</if>
							<if test="defined5 != null and defined5 != ''">
								AND T1.DEFINED5 = #{defined5,jdbcType=VARCHAR} 
							</if>
							<if test="defined6 != null and defined6 != ''">
								AND T1.DEFINED6 = #{defined6,jdbcType=VARCHAR} 
							</if>
							<if test="defined7 != null and defined7 != ''">
								AND T1.DEFINED7 = #{defined7,jdbcType=VARCHAR} 
							</if>
							<if test="defined8 != null and defined8 != ''">
								AND T1.DEFINED8 = #{defined8,jdbcType=VARCHAR} 
							</if>
							<if test="defined9 != null and defined9 != ''">
								AND T1.DEFINED9 = #{defined9,jdbcType=VARCHAR} 
							</if>
							<if test="defined10 != null and defined10 != ''">
								AND T1.DEFINED10 = #{defined10,jdbcType=VARCHAR} 
							</if>
							<if test="defined11 != null and defined11 != ''">
								AND T1.DEFINED11 = #{defined11,jdbcType=VARCHAR} 
							</if>
							<if test="defined12 != null and defined12 != ''">
								AND T1.DEFINED12 = #{defined12,jdbcType=VARCHAR} 
							</if>
							<if test="defined13 != null and defined13 != ''">
								AND T1.DEFINED13 = #{defined13,jdbcType=VARCHAR} 
							</if>
							<if test="defined14 != null and defined14 != ''">
								AND T1.DEFINED14 = #{defined14,jdbcType=VARCHAR} 
							</if>
							<if test="defined15 != null and defined15 != ''">
								AND T1.DEFINED15 = #{defined15,jdbcType=VARCHAR} 
							</if>
					       <if test="startdefined16!= null and startdefined16 !=''">
								AND T1.DEFINED16 >=
								 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
					                                       '%Y-%m-%d %H:%i:%s')
							</if>
							<if test=" enddefined16 != null and enddefined16 !=''">
								AND T1.DEFINED16 <![CDATA[ <= ]]>
								STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
					                                       '%Y-%m-%d %H:%i:%s')
							</if>
							<if test="startdefined17!= null and startdefined17 !=''">
								AND T1.DEFINED17 >=
								 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
					                                       '%Y-%m-%d %H:%i:%s')
							</if>
							<if test="enddefined17 != null and enddefined17 !=''">
								AND T1.DEFINED17 <![CDATA[ <= ]]>
								STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
					                                       '%Y-%m-%d %H:%i:%s')
							</if>	
							<if test="startdefined18!= null and startdefined18 !=''">
								AND T1.DEFINED18 >=
								 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
					                                       '%Y-%m-%d %H:%i:%s')
							</if>
							<if test="enddefined18 != null and enddefined18 !=''">
								AND T1.DEFINED18 <![CDATA[ <= ]]>
								STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
					                                       '%Y-%m-%d %H:%i:%s')
							</if>
							<if test="companyTrade != null and companyTrade != ''">
								AND T1.COMPANY_TRADE = #{companyTrade }
							</if>
					      <if test="nextFollowDate != null">
					      	AND T1.NEXTFOLLOW_DATE >= STR_TO_DATE(DATE_FORMAT(#{nextFollowDate,jdbcType=TIMESTAMP},'%Y-%m-%d 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		  					AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(DATE_FORMAT(#{nextFollowDate,jdbcType=TIMESTAMP},'%Y-%m-%d 23:59:59'),'%Y-%m-%d %H:%i:%s')
				          </if> 
					      <if test="isMajor != null">
					       	AND T1.IS_MAJOR = #{isMajor}
					      </if>
					      <if test="saleProcessId != null and saleProcessId != ''">
				       		AND T1.LAST_OPTION_ID = #{saleProcessId} 
				          </if>
				          <if test="custTypeId != null and custTypeId != ''">
				       		AND T1.LAST_CUST_TYPE_ID = #{custTypeId} 
				          </if>
				          <if test="labels != null and labels.size() > 0">
					       		<foreach collection="labels" item="label" separator=" " >
					       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
					       		</foreach> 
					       </if>
					      <!-- 查询结果排除ids by lizhihui-->
					       <if test="rejectIds != null and rejectIds.size()>0">
					       		<foreach collection="rejectIds" item="id">
					       			and T1.RES_CUST_ID !=#{id}
					       		</foreach>
					       </if>
					       <!-- 所在地区查询 -->
							<if test="provinceId != null">
								AND T1.PROVINCE_ID = #{provinceId,jdbcType=DECIMAL}
							</if>
							<if test="cityId != null">
								AND T1.CITY_ID = #{cityId,jdbcType=DECIMAL}
							</if>
							<if test="countyId != null">
								AND T1.COUNTY_ID = #{countyId,jdbcType=DECIMAL}
							</if>
					    UNION 
					  		SELECT 
							   T1.NAME,
							   T1.RES_CUST_ID,
						       T1.COMPANY,
						       T1.OWNER_ACC,
						       T1.STATUS,
						       T1.TYPE,
						       T1.OWNER_START_DATE,
						       T1.NEXTFOLLOW_DATE,
						       T1.LAST_OPTION_ID,
						       T1.ACTION_DATE,
					           T1.MOBILEPHONE,
						  	   T1.TELPHONE,
					       	   T1.IS_MAJOR,
					           T1.MAIN_LINKMAN,
					           T1.FILTER_COUNT,
					           T1.RES_GROUP_ID,
					           T1.LAST_CUST_TYPE_ID AS CUST_TYPE_ID,
					           T1.FILTER_TYPE,
						       T1.DEFINED1,
						       T1.DEFINED2,
						       T1.DEFINED3,
						       T1.DEFINED4,
						       T1.DEFINED5,
						       T1.DEFINED6,
						       T1.DEFINED7,
						       T1.DEFINED8,
						       T1.DEFINED9,
						       T1.DEFINED10,
						       T1.DEFINED11,
						       T1.DEFINED12,
						       T1.DEFINED13,
						       T1.DEFINED14,
						       T1.DEFINED15, 
				       	       T1.DEFINED16, 
				               T1.DEFINED17, 
				               T1.DEFINED18,
				               T1.IMPORT_DEPT_ID,
				               T1.COMPANY_MONEY,
				               T1.COMPANY_USER,
				               T1.COMPANY_FAX,
				               T1.PROVINCE_ID,
				               T1.CITY_ID,
				               T1.COUNTY_ID,
				               T1.KEYWORD,
				               T1.COMPANY_TRADE,
				               T1.SOURCE      
							 FROM TSM_RES_CUST_INFO T1
					  				WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
									 	AND T1.IS_DEL = 0 
									 	AND T1.TELPHONE = #{queryText} 
									  <if test="custIds != null and custIds.size() > 0">
								   		AND T1.RES_CUST_ID IN 
								   			<foreach collection="custIds" item="cid" open="(" separator="," close=")">
								   				#{cid}
								   			</foreach>
								      </if>
								      <if test="source != null">
											AND T1.SOURCE = #{source,jdbcType=DECIMAL} 
									  </if>
									  <choose>
										   <when test="adminAcc != null and adminAcc != ''">
												<choose>
													<when test="ownerAccs!=null and ownerAccs.size() > 0">
														<if test="ownerAccs!=null">
												       		AND T1.OWNER_ACC IN 
															<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
																#{item}
															</foreach>
												        </if>
													</when>
													<otherwise>
														AND T1.OWNER_ACC = #{adminAcc,jdbcType=VARCHAR} 
													</otherwise>
												</choose>
										   </when>
										   <otherwise>
										   		AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
										   </otherwise>
									   </choose>
									  <if test='custType == "0"'>
									  		AND T1.STATUS IN (2,3,6,7,8) 
									  </if>
									  <if test='custType == "1"'><!-- 资源 -->
											AND T1.STATUS IN (2,3) 
										    AND T1.TYPE in (1,3) 
										   <if test='noteType != null and noteType == "2"'>
										   		AND T1.OWNER_ACTION_DATE IS NULL 
										   </if>
										   <if test='noteType != null and noteType == "3"'>
										   		AND T1.OWNER_ACTION_DATE IS NOT NULL 
										   </if>
										   <if test='noteType != null and noteType == "4"'>
										   		<choose>
									       			<when test="ids != null and ids.size() > 0">
									       				AND (
									       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
									       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
									       				OR T1.RES_CUST_ID IN <foreach collection="ids" item="item" open="(" separator="," close=")">#{item}</foreach>
									       				)
									       			</when>
									       			<otherwise>
											       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
											       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
									       			</otherwise>
									       		</choose>
										   </if>
										   <if test='noteType != null and noteType == "5"'>
										   		AND T1.OWNER_ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
										   </if>
										   <if test='noteType != null and noteType == "6"'>
										   		AND T1.IS_PRECEDENCE = 1 
										   </if>
										   <if test='noteType != null and noteType == "7"'>
										   		AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 7 
										   </if>
									  </if>
									  <if test='custType == "2"'><!-- 意向客户 -->
									    	AND T1.STATUS IN (2,3)  
									       	AND T1.TYPE = 2 
									       <if test='noteType == "2"'>
									       		AND T1.AMOYTOCUSTOMER_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
									       </if>
									       <if test='noteType == "3"'>
									       		<choose>
									       			<when test="ids != null and ids.size() > 0">
									       				AND (
									       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
									       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
									       				OR T1.RES_CUST_ID IN <foreach collection="ids" item="item" open="(" separator="," close=")">#{item}</foreach>
									       				)
									       			</when>
									       			<otherwise>
											       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
											       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
									       			</otherwise>
									       		</choose>
									       </if>
									       <if test='noteType == "4"'>
									       		AND T1.OWNER_ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
									       </if>
									       <if test='noteType == "5"'>
									       		AND T1.IS_MAJOR = 1 
									       </if>
									       <if test='noteType == "6"'>
									       		AND T1.OWNER_ACTION_DATE  >= STR_TO_DATE(CONCAT(DATE_FORMAT(DATE_ADD(CURDATE(),INTERVAL -WEEKDAY(CURDATE())DAY),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
									       </if>
									       <if test='noteType == "7"'>
									       		AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 7 
									       </if>
									       <if test='noteType == "8"'>
									       		AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 30 
									       </if>
									  </if>
									  <if test='custType == "3"'><!-- 签约客户 -->
									    	AND T1.STATUS = 6  
									       <if test='noteType == "2"'>
									        	AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(NOW(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
									       </if>
									       <if test='noteType == "3"'>
									        	AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(NOW(),'%Y-%m'),'-01 00:00:00'),'%Y-%m-%d %H:%i:%s') 
									       </if>
									       <if test='noteType == "4"'>
									        	<choose>
									       			<when test="ids != null and ids.size() > 0">
									       				AND (
									       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
									       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
									       				OR T1.RES_CUST_ID IN <foreach collection="ids" item="item" open="(" separator="," close=")">#{item}</foreach>
									       				)
									       			</when>
									       			<otherwise>
											       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
											       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
									       			</otherwise>
									       		</choose>
									       </if>
									       <if test='noteType == "5"'>
									        	AND T1.OWNER_ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
									       </if>
									       <if test='noteType == "6"'>
									        	AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 7 
									       </if>
									       <if test='noteType == "7"'>
									        	AND DATEDIFF(NOW(),T1.OWNER_ACTION_DATE) &gt;= 30  
									       </if>
									  </if>
									  <if test='custType == "4"'><!-- 沉默客户 -->
								    	AND T1.STATUS = 7  
									  </if>
									  <if test='custType == "5"'><!-- 流失客户 -->
								    	AND T1.STATUS = 8   
									  </if>
									  <if test='custType == "6"'><!-- 意向客户 签约客户 -->
									  	AND T1.STATUS IN (2,3,6) 
								       	AND T1.TYPE = 2 
									  </if>
								   	  <if test="telphone != null and telphone != ''">
								        AND (T1.MOBILEPHONE = #{telphone} or T1.TELPHONE = #{telphone} or T1.ALTERNATE_PHONE2 = #{telphone}) 
								      </if>
								      <if test='resGroupId != null and resGroupId != "" and resGroupId != "0"'>
							       		AND T1.RES_GROUP_ID = #{resGroupId} 
							          </if>
							       	  <if test='resGroupId == "0"'>
							       		AND T1.RES_GROUP_ID IS NULL 
							          </if>
							          <if test="startActionDate != null and startActionDate != ''">
							       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
								      </if>
								      <if test="endActionDate != null and endActionDate != ''">
							       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
								      </if>
								      <if test="pstartDate != null and pstartDate != ''">
							       		AND T1.OWNER_START_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
								      </if>
								      <if test="pendDate != null and pendDate != ''">
							       		AND T1.OWNER_START_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
								      </if>
								      <if test="startNextContactDate != null and startNextContactDate != ''">
								       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{startNextContactDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
								      </if>
								      <if test="endNextContactDate != null and endNextContactDate != ''">
								       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{endNextContactDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
								      </if>
								      <if test="startDate != null and startDate != ''">
								       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
								       </if>
								       <if test="endDate != null and endDate != ''">
								       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
								       </if>
								       <if test='nDateType == "6"'>
								      		AND T1.NEXTFOLLOW_DATE IS NULL 
								       </if>
								       <if test="defined1 != null and defined1 != ''">
										   AND T1.DEFINED1 = #{defined1,jdbcType=VARCHAR} 
										</if>
										<if test="defined2 != null and defined2 != ''">
										   AND T1.DEFINED2 = #{defined2,jdbcType=VARCHAR} 
										</if>
										<if test="defined3 != null and defined3 != ''">
											AND T1.DEFINED3 = #{defined3,jdbcType=VARCHAR} 
										</if>
										<if test="defined4 != null and defined4 != ''">
											AND T1.DEFINED4 = #{defined4,jdbcType=VARCHAR}  
										</if>
										<if test="defined5 != null and defined5 != ''">
											AND T1.DEFINED5 = #{defined5,jdbcType=VARCHAR} 
										</if>
										<if test="defined6 != null and defined6 != ''">
											AND T1.DEFINED6 = #{defined6,jdbcType=VARCHAR} 
										</if>
										<if test="defined7 != null and defined7 != ''">
											AND T1.DEFINED7 = #{defined7,jdbcType=VARCHAR} 
										</if>
										<if test="defined8 != null and defined8 != ''">
											AND T1.DEFINED8 = #{defined8,jdbcType=VARCHAR} 
										</if>
										<if test="defined9 != null and defined9 != ''">
											AND T1.DEFINED9 = #{defined9,jdbcType=VARCHAR} 
										</if>
										<if test="defined10 != null and defined10 != ''">
											AND T1.DEFINED10 = #{defined10,jdbcType=VARCHAR} 
										</if>
										<if test="defined11 != null and defined11 != ''">
											AND T1.DEFINED11 = #{defined11,jdbcType=VARCHAR} 
										</if>
										<if test="defined12 != null and defined12 != ''">
											AND T1.DEFINED12 = #{defined12,jdbcType=VARCHAR} 
										</if>
										<if test="defined13 != null and defined13 != ''">
											AND T1.DEFINED13 = #{defined13,jdbcType=VARCHAR} 
										</if>
										<if test="defined14 != null and defined14 != ''">
											AND T1.DEFINED14 = #{defined14,jdbcType=VARCHAR} 
										</if>
										<if test="defined15 != null and defined15 != ''">
											AND T1.DEFINED15 = #{defined15,jdbcType=VARCHAR} 
										</if>
								       <if test="startdefined16!= null and startdefined16 !=''">
											AND T1.DEFINED16 >=
											 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
								                                       '%Y-%m-%d %H:%i:%s')
										</if>
										<if test=" enddefined16 != null and enddefined16 !=''">
											AND T1.DEFINED16 <![CDATA[ <= ]]>
											STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
								                                       '%Y-%m-%d %H:%i:%s')
										</if>
										<if test="startdefined17!= null and startdefined17 !=''">
											AND T1.DEFINED17 >=
											 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
								                                       '%Y-%m-%d %H:%i:%s')
										</if>
										<if test="enddefined17 != null and enddefined17 !=''">
											AND T1.DEFINED17 <![CDATA[ <= ]]>
											STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
								                                       '%Y-%m-%d %H:%i:%s')
										</if>	
										<if test="startdefined18!= null and startdefined18 !=''">
											AND T1.DEFINED18 >=
											 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
								                                       '%Y-%m-%d %H:%i:%s')
										</if>
										<if test="enddefined18 != null and enddefined18 !=''">
											AND T1.DEFINED18 <![CDATA[ <= ]]>
											STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
								                                       '%Y-%m-%d %H:%i:%s')
										</if>
										<if test="companyTrade != null and companyTrade != ''">
											AND T1.COMPANY_TRADE = #{companyTrade }
										</if>
								      <if test="nextFollowDate != null">
								      	AND T1.NEXTFOLLOW_DATE >= STR_TO_DATE(DATE_FORMAT(#{nextFollowDate,jdbcType=TIMESTAMP},'%Y-%m-%d 00:00:00'),'%Y-%m-%d %H:%i:%s') 
					  					AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(DATE_FORMAT(#{nextFollowDate,jdbcType=TIMESTAMP},'%Y-%m-%d 23:59:59'),'%Y-%m-%d %H:%i:%s')
							          </if> 
								      <if test="isMajor != null">
								       	AND T1.IS_MAJOR = #{isMajor}
								      </if>
								      <if test="saleProcessId != null and saleProcessId != ''">
							       		AND T1.LAST_OPTION_ID = #{saleProcessId} 
							          </if>
							          <if test="custTypeId != null and custTypeId != ''">
							       		AND T1.LAST_CUST_TYPE_ID = #{custTypeId} 
							          </if>
							          <if test="labels != null and labels.size() > 0">
								       		<foreach collection="labels" item="label" separator=" " >
								       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
								       		</foreach> 
								       </if>
								      <!-- 查询结果排除ids by lizhihui-->
								       <if test="rejectIds != null and rejectIds.size()>0">
								       		<foreach collection="rejectIds" item="id">
								       			and T1.RES_CUST_ID !=#{id}
								       		</foreach>
								       </if>
								       <!-- 所在地区查询 -->
										<if test="provinceId != null">
											AND T1.PROVINCE_ID = #{provinceId,jdbcType=DECIMAL}
										</if>
										<if test="cityId != null">
											AND T1.CITY_ID = #{cityId,jdbcType=DECIMAL}
										</if>
										<if test="countyId != null">
											AND T1.COUNTY_ID = #{countyId,jdbcType=DECIMAL}
										</if>
	</select>
	
	<select id="findCustPoolList" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
			SELECT 
				T1.RES_CUST_ID,
				T1.MOBILEPHONE,
				T1.TELPHONE,
				T1.NAME,
				T1.OPREATE_TYPE,
				T1.IS_MAJOR,
				T1.INPUT_DATE,
		        TIMESTAMPDIFF(DAY,T1.INPUT_DATE,NOW()) INPUT_DAYS,
				T1.ACTION_DATE,
		        TIMESTAMPDIFF(DAY,T1.ACTION_DATE,NOW()) DAYS,
				T1.UPDATE_DATE,
				T1.UPDATE_ACC,
				T1.OWNER_ACC,
				T1.RES_GROUP_ID,
				T1.LAST_OPTION_ID,
				T1.RECUCLING_TYPE_DETAILS,
				T1.ORG_ID,
				T1.COMPANY,
		        T1.DEFINED1,
		        T1.DEFINED2,
		        T1.DEFINED3,
		        T1.DEFINED4,
		        T1.DEFINED5,
		        T1.DEFINED6,
		        T1.DEFINED7,
		        T1.DEFINED8,
		        T1.DEFINED9,
		        T1.DEFINED10,
		        T1.DEFINED11,
		        T1.DEFINED12,
		        T1.DEFINED13,
		        T1.DEFINED14,
		        T1.DEFINED15,
		        T1.DEFINED16,
		        T1.DEFINED17,
		        T1.DEFINED18,
		        T1.MAIN_LINKMAN,
		        T1.COMPANY_MONEY,
                T1.COMPANY_USER,
                T1.COMPANY_FAX,
                T1.PROVINCE_ID,
                T1.CITY_ID,
                T1.COUNTY_ID,
                T1.KEYWORD,
                T1.COMPANY_TRADE,
                T1.LOSING_ID,
                T1.COMMON_ACC,
                T1.COMPANY_ADDR,
                T1.IS_DEL,
                T1.TYPE,
                T1.STATUS,
                T1.SIGN_DATE,
                T1.NEXTFOLLOW_DATE,
                T1.AMOYTOCUSTOMER_DATE,
                T1.LAST_CUST_TYPE_ID,
                T1.SOURCE          
		 FROM TSM_RES_CUST_INFO T1
	  			WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
				   AND T1.RES_CUST_ID IN 
				 <foreach collection="ids" item="resCustId" open="(" separator="," close=")">
				 	#{resCustId} 
				 </foreach>
			   	   
	</select>
	
	<select id="findCustPoolResListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		SELECT 
			T1.RES_CUST_ID,
			T1.MOBILEPHONE,
			T1.TELPHONE,
			T1.NAME,
			T1.OPREATE_TYPE,
			T1.UPDATE_ACC,
			T1.OWNER_ACC,
			T1.RES_GROUP_ID,
			T1.LAST_OPTION_ID,
			T1.RECUCLING_TYPE_DETAILS,
			T1.ORG_ID,
			T1.COMPANY,
	        T1.DEFINED1,
	        T1.DEFINED2,
	        T1.DEFINED3,
	        T1.DEFINED4,
	        T1.DEFINED5,
	        T1.DEFINED6,
	        T1.DEFINED7,
	        T1.DEFINED8,
	        T1.DEFINED9,
	        T1.DEFINED10,
	        T1.DEFINED11,
	        T1.DEFINED12,
	        T1.DEFINED13,
	        T1.DEFINED14,
	        T1.DEFINED15,
	        T1.SOURCE    
	 FROM TSM_RES_CUST_INFO T1
  			WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
			   AND T1.IS_DEL = 0 
		   	   AND T1.TYPE = 1
	    	   AND T1.STATUS = 1 
	    	   AND T1.RES_GROUP_ID IN (
	    	   		SELECT 
					  RES_GROUP_ID 
					FROM
					  TSM_RES_GROUP 
					WHERE ORG_ID = #{orgId }  
					AND is_share_pool = 1 
	    	   )
	    	   <if test="authGroupIds != null and authGroupIds.size() > 0">
			 		AND T1.import_dept_id IN 
		 			<foreach collection="authGroupIds" item="authGroupId" open="(" separator="," close=")">
		 				#{authGroupId}
		 			</foreach>
		 	    </if>
		 	    <if test="ownerAcc != null and ownerAcc != ''">
				   	AND T1.OWNER_ACC = #{ownerAcc }
			    </if>
			    <if test="ownerAccs!=null">
		       		AND T1.OWNER_ACC IN 
					<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
						#{item}
					</foreach>
		        </if>
				<if test="startDate != null and startDate != '' ">
		            AND T1.UPDATE_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'), '%Y-%m-%d %H:%i:%s') 	       						
				</if>
				<if test="endDate != null and endDate != ''">
		             AND T1.UPDATE_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'), '%Y-%m-%d %H:%i:%s') 	       			
				</if>
				<if test="recuclingTypeDetails != null and recuclingTypeDetails != ''">
					AND T1.RECUCLING_TYPE_DETAILS LIKE CONCAT ('%',#{recuclingTypeDetails},'%')
				</if>
				<if test="resGroupId != null and resGroupId != ''">
				   AND T1.RES_GROUP_ID = #{resGroupId}
				</if>
				<if test="isUnGroup != null and isUnGroup != ''">
				   AND T1.RES_GROUP_ID  IS NULL
				</if>
				<if test="saleProcessId != null and saleProcessId != ''">
					AND T1.LAST_OPTION_ID =#{saleProcessId}
				</if>
				<if test="queryText != null and queryText != ''">
		       		<choose>
		       			<when test='queryType != null and queryType == "1"'>
		       				AND T1.NAME LIKE CONCAT('%',#{queryText},'%')
		       			</when>
		       			<when test='queryType != null and queryType == "2"'>
		       				AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<when test='queryType != null and queryType == "3"'>
		       				AND (T1.TELPHONE = #{queryText} OR T1.MOBILEPHONE = #{queryText}) 
		       			</when>
		       			<when test='queryType != null and queryType == "4"'>
		       				AND T1.RECUCLING_TYPE_DETAILS LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<when test='queryType != null and queryType == "5"'>
		       				AND T1.COMPANY LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<otherwise>
		       				AND T1.${queryType } LIKE CONCAT('%',#{queryText},'%')
		       			</otherwise>
		       		</choose>
		       </if>
			    <if test="opreateType != null">
			       AND	T1.OPREATE_TYPE = ${opreateType} 
			    </if>
			    <if test="source != null">
					AND T1.SOURCE = #{source,jdbcType=DECIMAL} 
			    </if>
			    <if test="labels != null and labels.size() > 0">
		       		<foreach collection="labels" item="label" separator=" " >
		       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
		       		</foreach> 
		       </if>
	</select>
	
	<select id="findCustPoolResPhoneListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		SELECT 
			T1.RES_CUST_ID,
			T1.MOBILEPHONE,
			T1.TELPHONE,
			T1.NAME,
			T1.OPREATE_TYPE,
			T1.UPDATE_ACC,
			T1.OWNER_ACC,
			T1.RES_GROUP_ID,
			T1.LAST_OPTION_ID,
			T1.RECUCLING_TYPE_DETAILS,
			T1.ORG_ID,
			T1.COMPANY,
	        T1.DEFINED1,
	        T1.DEFINED2,
	        T1.DEFINED3,
	        T1.DEFINED4,
	        T1.DEFINED5,
	        T1.DEFINED6,
	        T1.DEFINED7,
	        T1.DEFINED8,
	        T1.DEFINED9,
	        T1.DEFINED10,
	        T1.DEFINED11,
	        T1.DEFINED12,
	        T1.DEFINED13,
	        T1.DEFINED14,
	        T1.DEFINED15,
	        T1.SOURCE    
	 FROM TSM_RES_CUST_INFO T1
  			WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
			   AND T1.IS_DEL = 0 
		   	   AND T1.TYPE = 1
	    	   AND T1.STATUS = 1 
	    	   AND T1.MOBILEPHONE = #{queryText} 
	    	   AND T1.RES_GROUP_ID IN (
	    	   		SELECT 
					  RES_GROUP_ID 
					FROM
					  TSM_RES_GROUP 
					WHERE ORG_ID = #{orgId }  
					AND is_share_pool = 1 
	    	   )
	    	   <if test="authGroupIds != null and authGroupIds.size() > 0">
			 		AND T1.import_dept_id IN 
		 			<foreach collection="authGroupIds" item="authGroupId" open="(" separator="," close=")">
		 				#{authGroupId}
		 			</foreach>
		 	    </if>
		 	    <if test="ownerAcc != null and ownerAcc != ''">
				   	AND T1.OWNER_ACC = #{ownerAcc }
			    </if>
			    <if test="ownerAccs!=null">
		       		AND T1.OWNER_ACC IN 
					<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
						#{item}
					</foreach>
		        </if>
				<if test="startDate != null and startDate != '' ">
		            AND T1.UPDATE_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'), '%Y-%m-%d %H:%i:%s') 	       						
				</if>
				<if test="endDate != null and endDate != ''">
		             AND T1.UPDATE_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'), '%Y-%m-%d %H:%i:%s') 	       			
				</if>
				<if test="recuclingTypeDetails != null and recuclingTypeDetails != ''">
					AND T1.RECUCLING_TYPE_DETAILS LIKE CONCAT ('%',#{recuclingTypeDetails},'%')
				</if>
				<if test="resGroupId != null and resGroupId != ''">
				   AND T1.RES_GROUP_ID = #{resGroupId}
				</if>
				<if test="isUnGroup != null and isUnGroup != ''">
				   AND T1.RES_GROUP_ID  IS NULL
				</if>
				<if test="saleProcessId != null and saleProcessId != ''">
					AND T1.LAST_OPTION_ID =#{saleProcessId}
				</if>
			    <if test="opreateType != null">
			       AND	T1.OPREATE_TYPE = ${opreateType} 
			    </if>
			    <if test="source != null">
					 AND T1.SOURCE = #{source,jdbcType=DECIMAL} 
			  </if>
			    <if test="labels != null and labels.size() > 0">
		       		<foreach collection="labels" item="label" separator=" " >
		       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
		       		</foreach> 
		       </if>
			    UNION 
			    SELECT 
					T1.RES_CUST_ID,
					T1.MOBILEPHONE,
					T1.TELPHONE,
					T1.NAME,
					T1.OPREATE_TYPE,
					T1.UPDATE_ACC,
					T1.OWNER_ACC,
					T1.RES_GROUP_ID,
					T1.LAST_OPTION_ID,
					T1.RECUCLING_TYPE_DETAILS,
					T1.ORG_ID,
					T1.COMPANY,
			        T1.DEFINED1,
			        T1.DEFINED2,
			        T1.DEFINED3,
			        T1.DEFINED4,
			        T1.DEFINED5,
			        T1.DEFINED6,
			        T1.DEFINED7,
			        T1.DEFINED8,
			        T1.DEFINED9,
			        T1.DEFINED10,
			        T1.DEFINED11,
			        T1.DEFINED12,
			        T1.DEFINED13,
			        T1.DEFINED14,
			        T1.DEFINED15,
			        T1.SOURCE    
			 FROM TSM_RES_CUST_INFO T1
		  			WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
					   AND T1.IS_DEL = 0 
				   	   AND T1.TYPE = 1
			    	   AND T1.STATUS = 1 
			    	   AND T1.TELPHONE = #{queryText} 
			    	   AND T1.RES_GROUP_ID IN (
			    	   		SELECT 
							  RES_GROUP_ID 
							FROM
							  TSM_RES_GROUP 
							WHERE ORG_ID = #{orgId }  
							AND is_share_pool = 1 
			    	   )
			    	   <if test="authGroupIds != null and authGroupIds.size() > 0">
					 		AND T1.import_dept_id IN 
				 			<foreach collection="authGroupIds" item="authGroupId" open="(" separator="," close=")">
				 				#{authGroupId}
				 			</foreach>
				 	    </if>
				 	    <if test="ownerAcc != null and ownerAcc != ''">
						   	AND T1.OWNER_ACC = #{ownerAcc }
					    </if>
					    <if test="ownerAccs!=null">
				       		AND T1.OWNER_ACC IN 
							<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
								#{item}
							</foreach>
				        </if>
						<if test="startDate != null and startDate != '' ">
				            AND T1.UPDATE_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'), '%Y-%m-%d %H:%i:%s') 	       						
						</if>
						<if test="endDate != null and endDate != ''">
				             AND T1.UPDATE_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'), '%Y-%m-%d %H:%i:%s') 	       			
						</if>
						<if test="recuclingTypeDetails != null and recuclingTypeDetails != ''">
							AND T1.RECUCLING_TYPE_DETAILS LIKE CONCAT ('%',#{recuclingTypeDetails},'%')
						</if>
						<if test="resGroupId != null and resGroupId != ''">
						   AND T1.RES_GROUP_ID = #{resGroupId}
						</if>
						<if test="isUnGroup != null and isUnGroup != ''">
						   AND T1.RES_GROUP_ID  IS NULL
						</if>
						<if test="saleProcessId != null and saleProcessId != ''">
							AND T1.LAST_OPTION_ID =#{saleProcessId}
						</if>
					    <if test="opreateType != null">
					       AND	T1.OPREATE_TYPE = ${opreateType} 
					    </if>
					    <if test="source != null">
							AND T1.SOURCE = #{source,jdbcType=DECIMAL} 
					     </if>
					    <if test="labels != null and labels.size() > 0">
				       		<foreach collection="labels" item="label" separator=" " >
				       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
				       		</foreach> 
				       </if>
	</select>
	
	<sql id="findPoolIdSql">
		 SELECT 
			  	R1.RES_CUST_ID 
			  	FROM TSM_RES_CUST_INFO R1 
			  	WHERE R1.ORG_ID = #{orgId} 
			  	 AND R1.IS_DEL = 0 
				 AND R1.STATUS IN (4, 5) 
				  <if test="custIds != null and custIds.size() > 0">
			   		AND R1.RES_CUST_ID IN 
			   			<foreach collection="custIds" item="cid" open="(" separator="," close=")">
			   				#{cid}
			   			</foreach>
			      </if>
				 <if test="authGroupIds != null and authGroupIds.size() > 0">
				 	AND R1.OWNER_ACC IN (
				 		SELECT 
						  member_acc
						FROM
						  tsm_team_group_member 
						WHERE org_id = #{orgId} 
						AND group_id IN 
				 		<foreach collection="authGroupIds" item="authGroupId" open="(" separator="," close=")">
				 			#{authGroupId}
				 		</foreach>
				 	)
				</if>
				<if test="ownerAcc != null and ownerAcc != ''">
				   	AND R1.OWNER_ACC = #{ownerAcc }
			    </if>
				<if test="ownerAccs!=null">
		       		AND R1.OWNER_ACC IN 
					<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
						#{item}
					</foreach>
		        </if>
		        <if test="source != null">
					 AND R1.SOURCE = #{source,jdbcType=DECIMAL} 
			    </if>
				<if test="startDate != null and startDate != '' ">
		            AND R1.UPDATE_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'), '%Y-%m-%d %H:%i:%s') 	       						
				</if>
				<if test="endDate != null and endDate != ''">
		             AND R1.UPDATE_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'), '%Y-%m-%d %H:%i:%s') 	       			
				</if>
				<if test="recuclingTypeDetails != null and recuclingTypeDetails != ''">
					AND R1.RECUCLING_TYPE_DETAILS LIKE CONCAT ('%',#{recuclingTypeDetails},'%')
				</if>
				<if test="resGroupId != null and resGroupId != ''">
				   AND R1.RES_GROUP_ID = #{resGroupId}
				</if>
				<if test="groupIds != null and groupIds.size() > 0">
					 AND R1.RES_GROUP_ID IN 
					 <foreach collection="groupIds" item="groupId" open="(" separator="," close=")">#{groupId}</foreach>
				</if>
				<if test="isUnGroup != null and isUnGroup != ''">
				   AND R1.RES_GROUP_ID  IS NULL
				</if>
				<if test="reason != null and reason != ''">
					AND R1.RECUCLING_TYPE_DETAILS LIKE CONCAT('%',#{reason,jdbcType=VARCHAR},'%')
				</if>
				<if test="startActionDate != null and startActionDate != '' ">
		            AND R1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'), '%Y-%m-%d %H:%i:%s') 	       						
				</if>
				<if test="endActionDate != null and endActionDate != ''">
		             AND R1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'), '%Y-%m-%d %H:%i:%s') 	       			
				</if>
				<if test="updateAcc != null and updateAcc != ''">
		        	AND R1.UPDATE_ACC = #{updateAcc} 
		        </if>
		        <if test="updateAccs != null and updateAccs.size() > 0 ">
		        	AND R1.UPDATE_ACC IN 
		        	<foreach collection="updateAccs" item="upa" open="(" separator="," close=")">
		        		#{upa} 
		        	</foreach>
		        </if>
		        <if test="defined1 != null and defined1 != ''">
				   AND R1.DEFINED1 = #{defined1,jdbcType=VARCHAR} 
				</if>
				<if test="defined2 != null and defined2 != ''">
				   AND R1.DEFINED2 = #{defined2,jdbcType=VARCHAR} 
				</if>
				<if test="defined3 != null and defined3 != ''">
					AND R1.DEFINED3 = #{defined3,jdbcType=VARCHAR} 
				</if>
				<if test="defined4 != null and defined4 != ''">
					AND R1.DEFINED4 = #{defined4,jdbcType=VARCHAR}  
				</if>
				<if test="defined5 != null and defined5 != ''">
					AND R1.DEFINED5 = #{defined5,jdbcType=VARCHAR} 
				</if>
				<if test="defined6 != null and defined6 != ''">
					AND R1.DEFINED6 = #{defined6,jdbcType=VARCHAR} 
				</if>
				<if test="defined7 != null and defined7 != ''">
					AND R1.DEFINED7 = #{defined7,jdbcType=VARCHAR} 
				</if>
				<if test="defined8 != null and defined8 != ''">
					AND R1.DEFINED8 = #{defined8,jdbcType=VARCHAR} 
				</if>
				<if test="defined9 != null and defined9 != ''">
					AND R1.DEFINED9 = #{defined9,jdbcType=VARCHAR} 
				</if>
				<if test="defined10 != null and defined10 != ''">
					AND R1.DEFINED10 = #{defined10,jdbcType=VARCHAR} 
				</if>
				<if test="defined11 != null and defined11 != ''">
					AND R1.DEFINED11 = #{defined11,jdbcType=VARCHAR} 
				</if>
				<if test="defined12 != null and defined12 != ''">
					AND R1.DEFINED12 = #{defined12,jdbcType=VARCHAR} 
				</if>
				<if test="defined13 != null and defined13 != ''">
					AND R1.DEFINED13 = #{defined13,jdbcType=VARCHAR} 
				</if>
				<if test="defined14 != null and defined14 != ''">
					AND R1.DEFINED14 = #{defined14,jdbcType=VARCHAR} 
				</if>
				<if test="defined15 != null and defined15 != ''">
					AND R1.DEFINED15 = #{defined15,jdbcType=VARCHAR} 
				</if>
		       <if test="startdefined16!= null and startdefined16 !=''">
					AND R1.DEFINED16 >=
					 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test=" enddefined16 != null and enddefined16 !=''">
					AND R1.DEFINED16 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="startdefined17!= null and startdefined17 !=''">
					AND R1.DEFINED17 >=
					 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined17 != null and enddefined17 !=''">
					AND R1.DEFINED17 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>	
				<if test="startdefined18!= null and startdefined18 !=''">
					AND R1.DEFINED18 >=
					 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined18 != null and enddefined18 !=''">
					AND R1.DEFINED18 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="companyTrade != null and companyTrade != ''">
					AND R1.COMPANY_TRADE = #{companyTrade }
				</if>
				<if test="opreateType != null">
			       AND	R1.OPREATE_TYPE = ${opreateType} 
			    </if>
			    <if test="saleProcessId != null and saleProcessId != ''">
					AND R1.LAST_OPTION_ID =#{saleProcessId}
				</if>
				<if test="labels != null and labels.size() > 0">
		       		<foreach collection="labels" item="label" separator=" " >
		       			AND R1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
		       		</foreach> 
		       </if>
		       <if test='noteType == "2"'>
		       		AND R1.INPUT_DATE &gt; DATE_ADD(NOW(),INTERVAL -8 DAY)
		       </if>
		       <if test='noteType == "3"'>
		       		AND R1.INPUT_DATE &gt; DATE_ADD(NOW(),INTERVAL -31 DAY)
		       </if>
		       <if test='noteType == "4"'>
		       		AND R1.INPUT_DATE &gt; DATE_ADD(NOW(),INTERVAL -91 DAY)
		       </if>
		       <if test='noteType == "5"'>
		       		AND R1.INPUT_DATE &lt;= DATE_ADD(NOW(),INTERVAL -91 DAY)
		       </if>
		       <if test='notContactedType == "2"'>
					AND R1.ACTION_DATE &gt; DATE_ADD(NOW(),INTERVAL -8 DAY)
			   </if>
			   <if test='notContactedType == "3"'>
					AND R1.ACTION_DATE &gt; DATE_ADD(NOW(),INTERVAL -31 DAY)
			   </if>
			   <if test='notContactedType == "4"'>
					AND R1.ACTION_DATE &gt; DATE_ADD(NOW(),INTERVAL -91 DAY)
			   </if>
			   <if test='notContactedType == "5"'>
					AND R1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -91 DAY)
			   </if>

		       <!-- 所在地区查询 -->
				<if test="provinceId != null">
					AND R1.PROVINCE_ID = #{provinceId,jdbcType=DECIMAL}
				</if>
				<if test="cityId != null">
					AND R1.CITY_ID = #{cityId,jdbcType=DECIMAL}
				</if>
				<if test="countyId != null">
					AND R1.COUNTY_ID = #{countyId,jdbcType=DECIMAL}
				</if>
	</sql>
	
	
	<select id="findClearPoolListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
			<include refid="findPoolIdSql" />
			<if test="queryText != null and queryText != ''">
				<choose>
					<when test='queryType != null and queryType == "custName"'>
						AND R1.NAME LIKE CONCAT('%',#{queryText},'%')
					</when>
					<when test='queryType != null and queryType == "mainLinkman"'>
						AND R1.MAIN_LINKMAN LIKE CONCAT('%',#{queryText},'%')
					</when>
					<when test='queryType != null and queryType == "reason"'>
						AND R1.RECUCLING_TYPE_DETAILS LIKE CONCAT('%',#{queryText},'%')
					</when>
					<when test='queryType != null and queryType == "company"'>
						AND R1.COMPANY LIKE CONCAT('%',#{queryText},'%')
					</when>
					<otherwise>
						AND R1.${queryType } LIKE CONCAT('%',#{queryText},'%')
					</otherwise>
				</choose>
			 </if>
	</select>
	
	<select id="findClearPoolPhoneListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		<include refid="findPoolIdSql" />
		AND R1.MOBILEPHONE = #{queryText}
		union
		<include refid="findPoolIdSql" />
		AND R1.TELPHONE = #{queryText}
	</select>
	
	<select id="findClearPoolResListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
			  SELECT 
			  	R1.RES_CUST_ID 
			  	FROM TSM_RES_CUST_INFO R1 
			  	WHERE R1.ORG_ID = #{orgId} 
			  	 AND R1.IS_DEL = 0 
			     AND R1.TYPE = 1
			     AND R1.STATUS = 1 
			     <if test="custIds != null and custIds.size() > 0">
			   		AND R1.RES_CUST_ID IN 
			   			<foreach collection="custIds" item="cid" open="(" separator="," close=")">
			   				#{cid}
			   			</foreach>
			      </if>
			     AND R1.RES_GROUP_ID IN (
	    	   		SELECT 
					  RES_GROUP_ID 
					FROM
					  TSM_RES_GROUP 
					WHERE ORG_ID = #{orgId }  
					AND is_share_pool = 1 
	    	    )
			    <if test="authGroupIds != null and authGroupIds.size() > 0">
				 	AND R1.import_dept_id IN 
			 		<foreach collection="authGroupIds" item="authGroupId" open="(" separator="," close=")">
			 			#{authGroupId}
			 		</foreach>
				</if>
				<if test="ownerAcc != null and ownerAcc != ''">
				   	AND R1.OWNER_ACC = #{ownerAcc }
			    </if>
				<if test="ownerAccs!=null">
		       		AND R1.OWNER_ACC IN 
					<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
						#{item}
					</foreach>
		        </if>
				<if test="startDate != null and startDate != '' ">
		            AND R1.UPDATE_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'), '%Y-%m-%d %H:%i:%s') 	       						
				</if>
				<if test="endDate != null and endDate != ''">
		             AND R1.UPDATE_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'), '%Y-%m-%d %H:%i:%s') 	       			
				</if>
				<if test="recuclingTypeDetails != null and recuclingTypeDetails != ''">
					AND R1.RECUCLING_TYPE_DETAILS LIKE CONCAT ('%',#{recuclingTypeDetails},'%')
				</if>
				<if test="resGroupId != null and resGroupId != ''">
				   AND R1.RES_GROUP_ID = #{resGroupId}
				</if>
				<if test="groupIds != null and groupIds.size() > 0">
					 AND R1.RES_GROUP_ID IN 
					 <foreach collection="groupIds" item="groupId" open="(" separator="," close=")">#{groupId}</foreach>
				</if>
				<if test="isUnGroup != null and isUnGroup != ''">
				   AND R1.RES_GROUP_ID  IS NULL
				</if>
				<if test="startActionDate != null and startActionDate != '' ">
		            AND R1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'), '%Y-%m-%d %H:%i:%s') 	       						
				</if>
				<if test="endActionDate != null and endActionDate != ''">
		             AND R1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'), '%Y-%m-%d %H:%i:%s') 	       			
				</if>
				<if test="updateAcc != null and updateAcc != ''">
		        	AND R1.UPDATE_ACC = #{updateAcc} 
		        </if>
		        <if test="updateAccs != null and updateAccs.size() > 0 ">
		        	AND R1.UPDATE_ACC IN 
		        	<foreach collection="updateAccs" item="upa" open="(" separator="," close=")">
		        		#{upa} 
		        	</foreach>
		        </if>
		        <if test="defined1 != null and defined1 != ''">
				   AND R1.DEFINED1 = #{defined1,jdbcType=VARCHAR} 
				</if>
				<if test="defined2 != null and defined2 != ''">
				   AND R1.DEFINED2 = #{defined2,jdbcType=VARCHAR} 
				</if>
				<if test="defined3 != null and defined3 != ''">
					AND R1.DEFINED3 = #{defined3,jdbcType=VARCHAR} 
				</if>
				<if test="defined4 != null and defined4 != ''">
					AND R1.DEFINED4 = #{defined4,jdbcType=VARCHAR}  
				</if>
				<if test="defined5 != null and defined5 != ''">
					AND R1.DEFINED5 = #{defined5,jdbcType=VARCHAR} 
				</if>
				<if test="defined6 != null and defined6 != ''">
					AND R1.DEFINED6 = #{defined6,jdbcType=VARCHAR} 
				</if>
				<if test="defined7 != null and defined7 != ''">
					AND R1.DEFINED7 = #{defined7,jdbcType=VARCHAR} 
				</if>
				<if test="defined8 != null and defined8 != ''">
					AND R1.DEFINED8 = #{defined8,jdbcType=VARCHAR} 
				</if>
				<if test="defined9 != null and defined9 != ''">
					AND R1.DEFINED9 = #{defined9,jdbcType=VARCHAR} 
				</if>
				<if test="defined10 != null and defined10 != ''">
					AND R1.DEFINED10 = #{defined10,jdbcType=VARCHAR} 
				</if>
				<if test="defined11 != null and defined11 != ''">
					AND R1.DEFINED11 = #{defined11,jdbcType=VARCHAR} 
				</if>
				<if test="defined12 != null and defined12 != ''">
					AND R1.DEFINED12 = #{defined12,jdbcType=VARCHAR} 
				</if>
				<if test="defined13 != null and defined13 != ''">
					AND R1.DEFINED13 = #{defined13,jdbcType=VARCHAR} 
				</if>
				<if test="defined14 != null and defined14 != ''">
					AND R1.DEFINED14 = #{defined14,jdbcType=VARCHAR} 
				</if>
				<if test="defined15 != null and defined15 != ''">
					AND R1.DEFINED15 = #{defined15,jdbcType=VARCHAR} 
				</if>
		       <if test="startdefined16!= null and startdefined16 !=''">
					AND R1.DEFINED16 >=
					 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test=" enddefined16 != null and enddefined16 !=''">
					AND R1.DEFINED16 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="startdefined17!= null and startdefined17 !=''">
					AND R1.DEFINED17 >=
					 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined17 != null and enddefined17 !=''">
					AND R1.DEFINED17 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>	
				<if test="startdefined18!= null and startdefined18 !=''">
					AND R1.DEFINED18 >=
					 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined18 != null and enddefined18 !=''">
					AND R1.DEFINED18 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="source != null">
					AND R1.SOURCE = #{source,jdbcType=DECIMAL} 
			    </if>
				<if test="queryText != null and queryText != ''">
		       		<choose>
		       			<when test='queryType != null and queryType == "custName"'>
		       				AND R1.NAME LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<when test='queryType != null and queryType == "mainLinkman"'>
		       				AND R1.MAIN_LINKMAN LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<when test='queryType != null and queryType == "reason"'>
		       				AND R1.RECUCLING_TYPE_DETAILS LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<when test='queryType != null and queryType == "company"'>
		       				AND R1.COMPANY LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<otherwise>
		       				AND R1.${queryType } LIKE CONCAT('%',#{queryText},'%')
		       			</otherwise>
		       		</choose>
		       </if>
			    <if test="opreateType != null">
			       AND	R1.OPREATE_TYPE = ${opreateType} 
			    </if>
			    <if test="saleProcessId != null and saleProcessId != ''">
					AND R1.LAST_OPTION_ID =#{saleProcessId}
				</if>
				<if test="labels != null and labels.size() > 0">
		       		<foreach collection="labels" item="label" separator=" " >
		       			AND R1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
		       		</foreach> 
		       </if>
		       <if test='notContactedType == "2"'>
		       		AND R1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
		       </if>
		       <if test='notContactedType == "3"'>
	       			AND R1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -30 DAY)
		       </if>
		       <if test='notContactedType == "4"'>
		       		AND R1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -90 DAY)
		       </if>
		       <if test='notContactedType == "5"'>
		       		AND R1.ACTION_DATE &lt; DATE_ADD(NOW(),INTERVAL -90 DAY)
		       </if>
		       <if test='noteType == "2"'>
		       		AND R1.INPUT_DATE &gt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
		       </if>
		       <if test='noteType == "3"'>
		       		AND R1.INPUT_DATE &gt;= DATE_ADD(NOW(),INTERVAL -30 DAY)
		       </if>
		       <if test='noteType == "4"'>
		       		AND R1.INPUT_DATE &gt;= DATE_ADD(NOW(),INTERVAL -90 DAY)
		       </if>
		       <if test='noteType == "5"'>
		       		AND R1.INPUT_DATE &lt; DATE_ADD(NOW(),INTERVAL -90 DAY)
		       </if>
		       <!-- 所在地区查询 -->
				<if test="provinceId != null">
					AND R1.PROVINCE_ID = #{provinceId,jdbcType=DECIMAL}
				</if>
				<if test="cityId != null">
					AND R1.CITY_ID = #{cityId,jdbcType=DECIMAL}
				</if>
				<if test="countyId != null">
					AND R1.COUNTY_ID = #{countyId,jdbcType=DECIMAL}
				</if>
			ORDER BY R1.UPDATE_DATE DESC,R1.RES_CUST_ID DESC 
	</select>
	
	<select id="findClearPoolResPhoneListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
			  SELECT 
			  	R1.RES_CUST_ID 
			  	FROM TSM_RES_CUST_INFO R1 
			  	WHERE R1.ORG_ID = #{orgId} 
			  	 AND R1.IS_DEL = 0 
			     AND R1.TYPE = 1
			     AND R1.STATUS = 1 
			     AND R1.MOBILEPHONE = #{queryText} 
			     <if test="custIds != null and custIds.size() > 0">
			   		AND R1.RES_CUST_ID IN 
			   			<foreach collection="custIds" item="cid" open="(" separator="," close=")">
			   				#{cid}
			   			</foreach>
			      </if>
			     AND R1.RES_GROUP_ID IN (
	    	   		SELECT 
					  RES_GROUP_ID 
					FROM
					  TSM_RES_GROUP 
					WHERE ORG_ID = #{orgId }  
					AND is_share_pool = 1 
	    	    )
			    <if test="authGroupIds != null and authGroupIds.size() > 0">
				 	AND R1.import_dept_id IN 
			 		<foreach collection="authGroupIds" item="authGroupId" open="(" separator="," close=")">
			 			#{authGroupId}
			 		</foreach>
				</if>
				<if test="ownerAcc != null and ownerAcc != ''">
				   	AND R1.OWNER_ACC = #{ownerAcc }
			    </if>
				<if test="ownerAccs!=null">
		       		AND R1.OWNER_ACC IN 
					<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
						#{item}
					</foreach>
		        </if>
				<if test="startDate != null and startDate != '' ">
		            AND R1.UPDATE_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'), '%Y-%m-%d %H:%i:%s') 	       						
				</if>
				<if test="endDate != null and endDate != ''">
		             AND R1.UPDATE_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'), '%Y-%m-%d %H:%i:%s') 	       			
				</if>
				<if test="recuclingTypeDetails != null and recuclingTypeDetails != ''">
					AND R1.RECUCLING_TYPE_DETAILS LIKE CONCAT ('%',#{recuclingTypeDetails},'%')
				</if>
				<if test="resGroupId != null and resGroupId != ''">
				   AND R1.RES_GROUP_ID = #{resGroupId}
				</if>
				<if test="groupIds != null and groupIds.size() > 0">
					 AND R1.RES_GROUP_ID IN 
					 <foreach collection="groupIds" item="groupId" open="(" separator="," close=")">#{groupId}</foreach>
				</if>
				<if test="isUnGroup != null and isUnGroup != ''">
				   AND R1.RES_GROUP_ID  IS NULL
				</if>
			    <if test="opreateType != null">
			       AND	R1.OPREATE_TYPE = ${opreateType} 
			    </if>
			    <if test="saleProcessId != null and saleProcessId != ''">
					AND R1.LAST_OPTION_ID =#{saleProcessId}
				</if> 
				<if test="startActionDate != null and startActionDate != '' ">
		            AND R1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'), '%Y-%m-%d %H:%i:%s') 	       						
				</if>
				<if test="endActionDate != null and endActionDate != ''">
		             AND R1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'), '%Y-%m-%d %H:%i:%s') 	       			
				</if>
				<if test="updateAcc != null and updateAcc != ''">
		        	AND R1.UPDATE_ACC = #{updateAcc} 
		        </if>
		        <if test="updateAccs != null and updateAccs.size() > 0 ">
		        	AND R1.UPDATE_ACC IN 
		        	<foreach collection="updateAccs" item="upa" open="(" separator="," close=")">
		        		#{upa} 
		        	</foreach>
		        </if>
		        <if test="defined1 != null and defined1 != ''">
				   AND R1.DEFINED1 = #{defined1,jdbcType=VARCHAR} 
				</if>
				<if test="defined2 != null and defined2 != ''">
				   AND R1.DEFINED2 = #{defined2,jdbcType=VARCHAR} 
				</if>
				<if test="defined3 != null and defined3 != ''">
					AND R1.DEFINED3 = #{defined3,jdbcType=VARCHAR} 
				</if>
				<if test="defined4 != null and defined4 != ''">
					AND R1.DEFINED4 = #{defined4,jdbcType=VARCHAR}  
				</if>
				<if test="defined5 != null and defined5 != ''">
					AND R1.DEFINED5 = #{defined5,jdbcType=VARCHAR} 
				</if>
				<if test="defined6 != null and defined6 != ''">
					AND R1.DEFINED6 = #{defined6,jdbcType=VARCHAR} 
				</if>
				<if test="defined7 != null and defined7 != ''">
					AND R1.DEFINED7 = #{defined7,jdbcType=VARCHAR} 
				</if>
				<if test="defined8 != null and defined8 != ''">
					AND R1.DEFINED8 = #{defined8,jdbcType=VARCHAR} 
				</if>
				<if test="defined9 != null and defined9 != ''">
					AND R1.DEFINED9 = #{defined9,jdbcType=VARCHAR} 
				</if>
				<if test="defined10 != null and defined10 != ''">
					AND R1.DEFINED10 = #{defined10,jdbcType=VARCHAR} 
				</if>
				<if test="defined11 != null and defined11 != ''">
					AND R1.DEFINED11 = #{defined11,jdbcType=VARCHAR} 
				</if>
				<if test="defined12 != null and defined12 != ''">
					AND R1.DEFINED12 = #{defined12,jdbcType=VARCHAR} 
				</if>
				<if test="defined13 != null and defined13 != ''">
					AND R1.DEFINED13 = #{defined13,jdbcType=VARCHAR} 
				</if>
				<if test="defined14 != null and defined14 != ''">
					AND R1.DEFINED14 = #{defined14,jdbcType=VARCHAR} 
				</if>
				<if test="defined15 != null and defined15 != ''">
					AND R1.DEFINED15 = #{defined15,jdbcType=VARCHAR} 
				</if>
		       <if test="startdefined16!= null and startdefined16 !=''">
					AND R1.DEFINED16 >=
					 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test=" enddefined16 != null and enddefined16 !=''">
					AND R1.DEFINED16 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="startdefined17!= null and startdefined17 !=''">
					AND R1.DEFINED17 >=
					 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined17 != null and enddefined17 !=''">
					AND R1.DEFINED17 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>	
				<if test="startdefined18!= null and startdefined18 !=''">
					AND R1.DEFINED18 >=
					 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined18 != null and enddefined18 !=''">
					AND R1.DEFINED18 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="labels != null and labels.size() > 0">
		       		<foreach collection="labels" item="label" separator=" " >
		       			AND R1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
		       		</foreach> 
		       </if>
		       <if test='notContactedType == "2"'>
		       		AND R1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
		       </if>
		       <if test='notContactedType == "3"'>
	       			AND R1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -30 DAY)
		       </if>
		       <if test='notContactedType == "4"'>
		       		AND R1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -90 DAY)
		       </if>
		       <if test='notContactedType == "5"'>
		       		AND R1.ACTION_DATE &lt; DATE_ADD(NOW(),INTERVAL -90 DAY)
		       </if>
		       <if test='noteType == "2"'>
		       		AND R1.INPUT_DATE &gt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
		       </if>
		       <if test='noteType == "3"'>
		       		AND R1.INPUT_DATE &gt;= DATE_ADD(NOW(),INTERVAL -30 DAY)
		       </if>
		       <if test='noteType == "4"'>
		       		AND R1.INPUT_DATE &gt;= DATE_ADD(NOW(),INTERVAL -90 DAY)
		       </if>
		       <if test='noteType == "5"'>
		       		AND R1.INPUT_DATE &lt; DATE_ADD(NOW(),INTERVAL -90 DAY)
		       </if>
		       <if test="source != null">
					AND R1.SOURCE = #{source,jdbcType=DECIMAL} 
			    </if>
			    <!-- 所在地区查询 -->
				<if test="provinceId != null">
					AND R1.PROVINCE_ID = #{provinceId,jdbcType=DECIMAL}
				</if>
				<if test="cityId != null">
					AND R1.CITY_ID = #{cityId,jdbcType=DECIMAL}
				</if>
				<if test="countyId != null">
					AND R1.COUNTY_ID = #{countyId,jdbcType=DECIMAL}
				</if>
				UNION 
				SELECT 
				  	R1.RES_CUST_ID 
				  	FROM TSM_RES_CUST_INFO R1 
				  	WHERE R1.ORG_ID = #{orgId} 
				  	 AND R1.IS_DEL = 0 
				     AND R1.TYPE = 1
				     AND R1.STATUS = 1 
				     AND R1.TELPHONE = #{queryText} 
				     <if test="custIds != null and custIds.size() > 0">
				   		AND R1.RES_CUST_ID IN 
				   			<foreach collection="custIds" item="cid" open="(" separator="," close=")">
				   				#{cid}
				   			</foreach>
				      </if>
				     AND R1.RES_GROUP_ID IN (
		    	   		SELECT 
						  RES_GROUP_ID 
						FROM
						  TSM_RES_GROUP 
						WHERE ORG_ID = #{orgId }  
						AND is_share_pool = 1 
		    	    )
				    <if test="authGroupIds != null and authGroupIds.size() > 0">
					 	AND R1.import_dept_id IN 
				 		<foreach collection="authGroupIds" item="authGroupId" open="(" separator="," close=")">
				 			#{authGroupId}
				 		</foreach>
					</if>
					<if test="ownerAcc != null and ownerAcc != ''">
					   	AND R1.OWNER_ACC = #{ownerAcc }
				    </if>
					<if test="ownerAccs!=null">
			       		AND R1.OWNER_ACC IN 
						<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
							#{item}
						</foreach>
			        </if>
					<if test="startDate != null and startDate != '' ">
			            AND R1.UPDATE_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'), '%Y-%m-%d %H:%i:%s') 	       						
					</if>
					<if test="endDate != null and endDate != ''">
			             AND R1.UPDATE_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'), '%Y-%m-%d %H:%i:%s') 	       			
					</if>
					<if test="recuclingTypeDetails != null and recuclingTypeDetails != ''">
						AND R1.RECUCLING_TYPE_DETAILS LIKE CONCAT ('%',#{recuclingTypeDetails},'%')
					</if>
					<if test="resGroupId != null and resGroupId != ''">
					   AND R1.RES_GROUP_ID = #{resGroupId}
					</if>
					<if test="groupIds != null and groupIds.size() > 0">
						 AND R1.RES_GROUP_ID IN 
						 <foreach collection="groupIds" item="groupId" open="(" separator="," close=")">#{groupId}</foreach>
					</if>
					<if test="isUnGroup != null and isUnGroup != ''">
					   AND R1.RES_GROUP_ID  IS NULL
					</if>
				    <if test="opreateType != null">
				       AND	R1.OPREATE_TYPE = ${opreateType} 
				    </if>
				    <if test="saleProcessId != null and saleProcessId != ''">
						AND R1.LAST_OPTION_ID =#{saleProcessId}
					</if>
					<if test="startActionDate != null and startActionDate != '' ">
			            AND R1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'), '%Y-%m-%d %H:%i:%s') 	       						
					</if>
					<if test="endActionDate != null and endActionDate != ''">
			             AND R1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'), '%Y-%m-%d %H:%i:%s') 	       			
					</if>
					<if test="updateAcc != null and updateAcc != ''">
			        	AND R1.UPDATE_ACC = #{updateAcc} 
			        </if>
			        <if test="updateAccs != null and updateAccs.size() > 0 ">
			        	AND R1.UPDATE_ACC IN 
			        	<foreach collection="updateAccs" item="upa" open="(" separator="," close=")">
			        		#{upa} 
			        	</foreach>
			        </if>
			        <if test="defined1 != null and defined1 != ''">
					   AND R1.DEFINED1 = #{defined1,jdbcType=VARCHAR} 
					</if>
					<if test="defined2 != null and defined2 != ''">
					   AND R1.DEFINED2 = #{defined2,jdbcType=VARCHAR} 
					</if>
					<if test="defined3 != null and defined3 != ''">
						AND R1.DEFINED3 = #{defined3,jdbcType=VARCHAR} 
					</if>
					<if test="defined4 != null and defined4 != ''">
						AND R1.DEFINED4 = #{defined4,jdbcType=VARCHAR}  
					</if>
					<if test="defined5 != null and defined5 != ''">
						AND R1.DEFINED5 = #{defined5,jdbcType=VARCHAR} 
					</if>
					<if test="defined6 != null and defined6 != ''">
						AND R1.DEFINED6 = #{defined6,jdbcType=VARCHAR} 
					</if>
					<if test="defined7 != null and defined7 != ''">
						AND R1.DEFINED7 = #{defined7,jdbcType=VARCHAR} 
					</if>
					<if test="defined8 != null and defined8 != ''">
						AND R1.DEFINED8 = #{defined8,jdbcType=VARCHAR} 
					</if>
					<if test="defined9 != null and defined9 != ''">
						AND R1.DEFINED9 = #{defined9,jdbcType=VARCHAR} 
					</if>
					<if test="defined10 != null and defined10 != ''">
						AND R1.DEFINED10 = #{defined10,jdbcType=VARCHAR} 
					</if>
					<if test="defined11 != null and defined11 != ''">
						AND R1.DEFINED11 = #{defined11,jdbcType=VARCHAR} 
					</if>
					<if test="defined12 != null and defined12 != ''">
						AND R1.DEFINED12 = #{defined12,jdbcType=VARCHAR} 
					</if>
					<if test="defined13 != null and defined13 != ''">
						AND R1.DEFINED13 = #{defined13,jdbcType=VARCHAR} 
					</if>
					<if test="defined14 != null and defined14 != ''">
						AND R1.DEFINED14 = #{defined14,jdbcType=VARCHAR} 
					</if>
					<if test="defined15 != null and defined15 != ''">
						AND R1.DEFINED15 = #{defined15,jdbcType=VARCHAR} 
					</if>
			       <if test="startdefined16!= null and startdefined16 !=''">
						AND R1.DEFINED16 >=
						 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
			                                       '%Y-%m-%d %H:%i:%s')
					</if>
					<if test=" enddefined16 != null and enddefined16 !=''">
						AND R1.DEFINED16 <![CDATA[ <= ]]>
						STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
			                                       '%Y-%m-%d %H:%i:%s')
					</if>
					<if test="startdefined17!= null and startdefined17 !=''">
						AND R1.DEFINED17 >=
						 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
			                                       '%Y-%m-%d %H:%i:%s')
					</if>
					<if test="enddefined17 != null and enddefined17 !=''">
						AND R1.DEFINED17 <![CDATA[ <= ]]>
						STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
			                                       '%Y-%m-%d %H:%i:%s')
					</if>	
					<if test="startdefined18!= null and startdefined18 !=''">
						AND R1.DEFINED18 >=
						 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
			                                       '%Y-%m-%d %H:%i:%s')
					</if>
					<if test="enddefined18 != null and enddefined18 !=''">
						AND R1.DEFINED18 <![CDATA[ <= ]]>
						STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
			                                       '%Y-%m-%d %H:%i:%s')
					</if>
					<if test="labels != null and labels.size() > 0">
			       		<foreach collection="labels" item="label" separator=" " >
			       			AND R1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
			       		</foreach> 
			       </if>
			       <if test='notContactedType == "2"'>
		       		AND R1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
			       </if>
			       <if test='notContactedType == "3"'>
		       			AND R1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -30 DAY)
			       </if>
			       <if test='notContactedType == "4"'>
			       		AND R1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -90 DAY)
			       </if>
			       <if test='notContactedType == "5"'>
			       		AND R1.ACTION_DATE &lt; DATE_ADD(NOW(),INTERVAL -90 DAY)
			       </if>
			       <if test='noteType == "2"'>
			       		AND R1.INPUT_DATE &gt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
			       </if>
			       <if test='noteType == "3"'>
			       		AND R1.INPUT_DATE &gt;= DATE_ADD(NOW(),INTERVAL -30 DAY)
			       </if>
			       <if test='noteType == "4"'>
			       		AND R1.INPUT_DATE &gt;= DATE_ADD(NOW(),INTERVAL -90 DAY)
			       </if>
			       <if test='noteType == "5"'>
			       		AND R1.INPUT_DATE &lt; DATE_ADD(NOW(),INTERVAL -90 DAY)
			       </if>
			       <if test="source != null">
						AND R1.SOURCE = #{source,jdbcType=DECIMAL} 
				  </if>
				  <!-- 所在地区查询 -->
				<if test="provinceId != null">
					AND R1.PROVINCE_ID = #{provinceId,jdbcType=DECIMAL}
				</if>
				<if test="cityId != null">
					AND R1.CITY_ID = #{cityId,jdbcType=DECIMAL}
				</if>
				<if test="countyId != null">
					AND R1.COUNTY_ID = #{countyId,jdbcType=DECIMAL}
				</if>
	</select>
	
	<!-- 批量设置优先级  -->
	<update id="setPrecedenceBatch" parameterType="map">
		UPDATE
		<include refid="table_name" />
		SET UPDATE_ACC =#{updateAcc,jdbcType=VARCHAR},UPDATE_DATE = NOW(),IS_PRECEDENCE=#{isPrecedence,jdbcType=DECIMAL} 
		WHERE ORG_ID = #{orgId} AND RES_CUST_ID
		IN
		<foreach collection="ids" item="id" open="(" separator=","
			close=")">
			#{id}
		</foreach>
	</update>
	
	<select id="findTeamCustByCustId" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
			SELECT 
			    C1.RES_CUST_ID,
			    C1.NAME,
			    C1.MOBILEPHONE,
			    C1.TELPHONE,
			    C1.COMPANY,
			    C1.DUTY,
			    C1.SEX,
			    C1.COMPANY_ADDR,
			    C1.COMPANY_ORG,
			    C1.REMARK,
			    C1.TYPE,
			    C1.IS_DEL,
			    C1.STATE,
			    C1.RES_LAST_CALL_DATE,
			    C1.INPUT_DATE,
			    C1.INPUT_ACC,
			    C1.UPDATE_DATE,
			    C1.UPDATE_ACC,
			    C1.IS_MAJOR,
			    C1.RES_GROUP_ID,
			    C1.OWNER_ACC,
			    C1.STATUS,
			    C1.ORG_ID,
			    C1.SIGN_DATE,
			    C1.INPUT_STATUS,
			    C1.LAST_OPTION_ID,
			    C1.LOSING_ID 
			  FROM
			    TSM_RES_CUST_INFO C1 
			  WHERE C1.ORG_ID = #{orgId}  
			    AND C1.RES_CUST_ID = #{resCustId} 
	</select>
	
	<!-- 批量客户交接（某个客户交接给另一个人去跟进） -->
	<update id="updateMoveCust" parameterType="map">
		update
		<include refid="table_name" />
		set SOURCE=2,UPDATE_ACC =#{logAct},UPDATE_DATE =
		now(),OWNER_ACC=#{ownerAcc},OWNER_START_DATE=now(),COMMON_ACC = NULL,ACTION_DATE=NULL,OWNER_ACTION_DATE = NULL   
		where ORG_ID=#{orgId} AND 
		RES_CUST_ID in
		<foreach collection="ids" item="id" open="(" separator=","
			close=")">
			#{id}
		</foreach>
	</update>
	
	<!-- 批量客户交接（某个签约客户交接给另一个客户去跟进） -->
	<update id="updateMoveSignCust" parameterType="map">
		update
		<include refid="table_name" />
		set UPDATE_ACC =#{logAct},UPDATE_DATE = now(),OWNER_ACC=#{ownerAcc},COMMON_ACC = NULL 
		where ORG_ID=#{orgId} AND RES_CUST_ID in
		<foreach collection="ids" item="id" open="(" separator=","
			close=")">
			#{id}
		</foreach>
	</update>

	<select id="findCustGiveUpReasonList" parameterType="map" resultType="String">
		SELECT T.RECUCLING_TYPE_DETAILS FROM
		TSM_RES_CUST_INFO T
		WHERE T.ORG_ID=#{orgId}
		AND T.IS_DEL = 0
		AND T.RECUCLING_TYPE_DETAILS != ''
		AND T.RECUCLING_TYPE_DETAILS IS NOT NULL
		GROUP BY T.RECUCLING_TYPE_DETAILS
	</select>

	<!-- 批量放弃客户（将该客户放到公海客户池中） -->
	<update id="updateBatchCust" parameterType="map">
		update
		<include refid="table_name" />
		set STATUS=${status},FILTER_TYPE=1,UPDATE_ACC =#{logAct},UPDATE_DATE =
		now(),OPREATE_TYPE = ${operateType},OWNER_START_DATE=null,ACTION_DATE=ifnull(ACTION_DATE,NOW()),
		COMMON_ACC = null
		<choose>
				<when test="reason != null and reason != ''">
					,RECUCLING_TYPE_DETAILS=#{reason}
				</when>
				<otherwise>
					,RECUCLING_TYPE_DETAILS=NULL 
				</otherwise>
		</choose>
		where ORG_ID=#{orgId} AND RES_CUST_ID in
		<foreach collection="ids" item="id" open="(" separator=","
			close=")">
			#{id}
		</foreach>
	</update>

	<!-- 资源客户呼叫数统计 清除 -->
	<select id="cleanCallCustCountByCustId" parameterType="map">
		DELETE FROM TSM_CALL_COUNT_CUST WHERE ORG_ID=#{orgId} AND CUST_ID IN 
		<foreach collection="custIds" item="id" open="(" separator="," close=")">
			#{id}
		</foreach>
	</select>
	
	<!-- 根据Id批量修改 -->
	<update id="updateByIds" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto">
		UPDATE
		<include refid="table_name" />
		<include refid="trents_update_set_sql_batch" />
		<if test=" source == 2 ">
			,OWNER_ACTION_DATE = NULL  
		</if>
		WHERE ORG_ID=#{orgId} 
		<if test="ids != null">
			AND RES_CUST_ID IN 
			<foreach collection="ids" item="id" open="(" separator="," close=")">
				#{id}
			</foreach>
		</if>
		<if test="resCustId != null and resCustId != ''">
			AND RES_CUST_ID = #{resCustId} 
		</if>
	</update>
	
	<!-- 取得个人剩余资源数 -->
	<select id="findMyResSum" parameterType="map" resultType="Integer">
		SELECT COUNT(1) 
			FROM TSM_RES_CUST_INFO A 
		  WHERE A.ORG_ID = #{orgId} 
		  	AND A.STATUS = 2 
		 	AND A.IS_DEL = 0 
		 	AND A.TYPE IN (1,3) 
			AND A.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR}
	</select>
	
		<!-- 取得个人剩余意向数 -->
	<select id="findMyCustSum" parameterType="map" resultType="Integer">
		SELECT COUNT(1) 
			FROM TSM_RES_CUST_INFO A 
		  WHERE A.ORG_ID = #{orgId} 
		  	AND A.STATUS IN (2,3) 
		 	AND A.IS_DEL = 0 
		 	AND A.TYPE = 2
			AND A.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR}
	</select>
	<update id="updatePlanDate" parameterType="map">
		UPDATE TSM_RES_CUST_INFO SET PLAN_DATE = #{planDate,jdbcType=TIMESTAMP} 
			WHERE ORG_ID = #{orgId,jdbcType=VARCHAR} AND RES_CUST_ID = #{custId,jdbcType=VARCHAR} 
	</update>
	
	<!-- 延后呼叫提醒 -->
	<select id="findDelayCallAlert" parameterType="map" resultMap="BaseResultMap">
		SELECT T.RES_CUST_ID,T.ORG_ID,T.OWNER_ACC,T.NAME,T.COMPANY,T.REASON_FOR_CALLDELAY,T.CALL_DATE_POSTPONED,
	       ifnull(T.MOBILEPHONE, T.TELPHONE) AS TELPHONE
	  FROM TSM_RES_CUST_INFO T
	 WHERE T.ORG_ID = #{orgId} 
	 and  T.CALL_DATE_POSTPONED = str_to_date(#{start_time,jdbcType=VARCHAR}, '%Y-%m-%d %H:%i') 
	</select>
	
	<!-- 沉默客户筛选 -->
	<select id="silentCustsSxListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		SELECT
			T.RES_CUST_ID,
			T.NAME,
			T.OWNER_ACC,
			T.COMPANY,
			C.CODE AS CONTRACT_CODE,
			DATEDIFF(NOW(),T.ACTION_DATE) DAYS,
			C.INVALID_DATE AS CONTRACT_END_DATE
		FROM
			(SELECT 
			    T1.RES_CUST_ID,
			    T1.NAME,
			    T1.ACTION_DATE,
			    T1.OWNER_ACC,
			    T1.COMPANY 
			  FROM
			    TSM_RES_CUST_INFO T1 
			  WHERE T1.ORG_ID = #{orgId}  
			    AND T1.STATUS = 6 
			    AND T1.TYPE = 2 
			    AND T1.IS_DEL = 0 
			    <if test="adminAcc != null and adminAcc != ''">
				   AND T1.OWNER_ACC IN (SELECT TTGM.MEMBER_ACC
				          FROM TSM_GROUP_SHAREINFO TGS
				         RIGHT JOIN TSM_TEAM_GROUP_MEMBER TTGM
				            ON  TGS.ORG_ID= #{orgId} and TTGM.ORG_ID= #{orgId} and TTGM.GROUP_ID = TGS.GROUP_ID
				         WHERE SHARE_ACC = #{adminAcc,jdbcType=VARCHAR})
				</if> 
				<if test="ownerAcc != null and ownerAcc != ''">
			  		AND T1.OWNER_ACC = #{ownerAcc} 
				</if>
				<if test="ownerAccs!=null">
		       		AND T1.OWNER_ACC IN 
					<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
						#{item}
					</foreach>
		        </if>
				<if test='noteType == "2"'>
					AND T1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -7 DAY) 
				</if>
				<if test='noteType == "3"'>
					AND T1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -30 DAY) 
				</if>
				<if test='noteType == "4"'>
					AND T1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -90 DAY) 
				</if>
			) T 
			LEFT JOIN (
				SELECT C1.CUST_ID,C1.CODE,C1.INVALID_DATE,C1.IS_DEL FROM CONTRACT C1 
				WHERE C1.ORG_ID = #{orgId} 
		     	<if test="pstartDate != null and pstartDate != ''">
					AND C1.INVALID_DATE >= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
				</if>
				<if test="pendDate != null and pendDate != ''">
					AND C1.INVALID_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
				</if>
		     ) C ON T.RES_CUST_ID = C.CUST_ID 
		WHERE C.IS_DEL = 0 
			<if test="queryText != null and queryText != ''">
				<choose>
					<when test='queryType != null and queryType == "1"'>
						AND T.NAME LIKE CONCAT('%',#{queryText},'%')
					</when>
					<when test='queryType != null and queryType == "2"'>
						AND C.CODE LIKE CONCAT('%',#{queryText},'%') 
					</when>
					<otherwise>
						AND T.COMPANY LIKE CONCAT('%',#{queryText},'%')
					</otherwise>
				</choose>
			</if>
			ORDER BY C.INVALID_DATE ASC,T.RES_CUST_ID DESC
	</select>
	
	<!-- 撞单查询 -->
	<select id="hitSigleList" parameterType="map" resultMap="DtoResultMap">
		SELECT  T1.RES_CUST_ID,
			    T1.NAME,
			    T1.MAIN_LINKMAN, 
			    T1.TELPHONE,
			    T1.MOBILEPHONE,
			    T1.ADDRESS,
			    T1.OWNER_ACC,
			    T1.TYPE,
			    T1.STATUS,
			    T1.LAST_OPTION_ID,
			    T1.RES_GROUP_ID,
			    T1.COMPANY  
			  FROM TSM_RES_CUST_INFO T1
	  			WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
	  			   AND T1.IS_DEL = 0 
				   AND T1.RES_CUST_ID IN 
				 <foreach collection="ids" item="resCustId" open="(" separator="," close=")">
				 	#{resCustId} 
				 </foreach>
	</select>
	<select id="hitSigleListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		SELECT  T1.RES_CUST_ID 
			  FROM
			    TSM_RES_CUST_INFO T1 
			  WHERE T1.ORG_ID = #{orgId} 
			    AND T1.IS_DEL = 0 
			    <if test="queryText != null and queryText != ''">
		       		<choose>
		       			<when test='queryType != null and queryType == "1"'>
		       				AND T1.NAME LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<when test='queryType != null and queryType == "2"'>
		       				AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<when test='queryType != null and queryType == "4"'>
		       				AND T1.KEYWORD LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<otherwise>
		       				AND T1.COMPANY LIKE CONCAT('%',#{queryText},'%') 
		       			</otherwise>
		       		</choose>
		       </if>
	</select>
	
	<select id="hitSiglePhoneListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		SELECT  T1.RES_CUST_ID 
			  FROM
			    TSM_RES_CUST_INFO T1 
			  WHERE T1.ORG_ID = #{orgId} 
			    AND T1.IS_DEL = 0 
			    AND T1.MOBILEPHONE = #{queryText} 
			UNION 
	    SELECT  T1.RES_CUST_ID 
			  FROM
			    TSM_RES_CUST_INFO T1 
			  WHERE T1.ORG_ID = #{orgId} 
			    AND T1.IS_DEL = 0 
			    AND T1.TELPHONE = #{queryText} 
	</select>
	
	<update id="rebackSignBeforeStatus" parameterType="com.qftx.tsm.cust.bean.ResCustInfoBean">
		UPDATE TSM_RES_CUST_INFO SET 
		<choose>
			<when test="signBeforeType == null">
				TYPE=2,
				STATUS=2,
			</when>
			<otherwise>
				TYPE=${signBeforeType},
				STATUS=#{signBeforeStatus},
			</otherwise>
		</choose>
		UPDATE_DATE=NOW(),
			UPDATE_ACC=#{updateAcc},SIGN_DATE=null,SIGN_ACC=null,SIGN_BEFORE_TYPE=null,SIGN_BEFORE_STATUS=NULL
			<if test="lastOptionId != null and lastOptionId != ''">
				,LAST_OPTION_ID = #{lastOptionId} 
			</if> 
		 WHERE ORG_ID = #{orgId} AND RES_CUST_ID = #{resCustId} 
	</update>	
	
	<update id="modifyQuHui" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto">
		UPDATE TSM_RES_CUST_INFO SET  
			OWNER_ACC=#{ownerAcc,jdbcType=VARCHAR},
			TYPE=1,
			STATUS=2,
			OWNER_START_DATE=NOW(),
			NEXTFOLLOW_DATE = NULL,
			ACTION_DATE = NULL,
			IS_CONCAT = 0,
			OPREATE_TYPE=3,
			SOURCE=3,
			IS_PRECEDENCE=0,
			LIFE_CODE=REPLACE(UUID(),'-',''),
			UPDATE_DATE=NOW(),
			UPDATE_ACC=#{updateAcc,jdbcType=VARCHAR},
			OWNER_ACTION_DATE = NULL 
		WHERE ORG_ID = #{orgId,jdbcType=VARCHAR} 
		AND RES_CUST_ID in
		<foreach collection="ids" item="id" open="(" separator=","
			close=")">
			#{id}
		</foreach>
	</update>
	
	<select id="findQuHuiIds" parameterType="map" resultType="java.lang.String">
		select res_cust_id 
			from TSM_RES_CUST_INFO 
			where ORG_ID = #{orgId,jdbcType=VARCHAR} 
				AND RES_CUST_ID in
				<foreach collection="ids" item="id" open="(" separator=","
					close=")">
					#{id}
				</foreach>
				<choose>
					<when test='isShare == "1"'>
						and (status in (4,5) or (type = 1 and status = 1))
					</when>
					<otherwise>
						and status in (4,5) 
					</otherwise>
				</choose>
				and is_del = 0 
	</select>
	
	
		<update id="modifyQuHuiYx" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto">
		UPDATE TSM_RES_CUST_INFO SET  
			OWNER_ACC=#{ownerAcc,jdbcType=VARCHAR},
			TYPE=2,
			STATUS=3,
			OWNER_START_DATE=NOW(),
			NEXTFOLLOW_DATE = #{nextFollowDate,jdbcType=TIMESTAMP},
			last_Option_Id = #{lastOptionId,jdbcType=VARCHAR},
			SOURCE=#{source,jdbcType=DECIMAL},
			AMOYTOCUSTOMER_DATE=NOW(),
			ACTION_DATE = NULL,
			IS_CONCAT = 0,
			OPREATE_TYPE=21,
			IS_PRECEDENCE=0,
			LIFE_CODE=REPLACE(UUID(),'-',''),
			UPDATE_DATE=NOW(),
			UPDATE_ACC=#{updateAcc,jdbcType=VARCHAR}，
			OWNER_ACTION_DATE = NULL
		WHERE ORG_ID = #{orgId,jdbcType=VARCHAR} 
		AND RES_CUST_ID in
		<foreach collection="ids" item="id" open="(" separator=","
			close=")">
			#{id}
		</foreach>
	</update>
	
	<!--收件箱短信接口调用 通话电话号码和机构id获取客户资源信息) -->
	<select id="findInterfaceCust" parameterType="com.qftx.tsm.cust.dto.CustDto"
		resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		FROM TSM_RES_CUST_INFO c
		WHERE c.ORG_ID = #{orgId,jdbcType=VARCHAR} and c.IS_DEL=0 and c.status!='1'
		<if test="phone!=null and phone!=''">
			AND (c.MOBILEPHONE = #{phone} or c.TELPHONE = #{phone} or
			c.alternate_phone2 = #{phone} )
		</if>
		<if test="ownerAcc != null and ownerAcc != ''">
			AND OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR}
		</if>
		<if test="isCust == 1">
			AND TYPE = 2
		</if>
		order by c.status
	</select>
	
	<!-- ************************************************************************* -->
	<!-- *******************************团队客户分布报表****************************** -->
	<!-- ************************************************************************* -->
	<resultMap type="map" id="ChartNumMap">
		<result column="OPTIONLIST_ID" property="optionlistId" jdbcType="VARCHAR" />
		<result column="OPTION_NAME" property="optionName" jdbcType="VARCHAR" />
		<result column="CUST_NUMS" property="custNums" jdbcType="DECIMAL" />
	</resultMap>
	<!-- 销售进程分布图 -->
	<select id="findSaleProcLayoutChart" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="ChartNumMap">
		SELECT
			OP.OPTION_NAME,
			OP.OPTIONLIST_ID,
			IFNULL(W.CUST_NUMS,0) CUST_NUMS 
		FROM
			TSM_DATA_OPTIONLIST OP
		LEFT JOIN (
			SELECT
				T.LAST_OPTION_ID,
				COUNT(*) CUST_NUMS
			FROM
				TSM_RES_CUST_INFO T
			WHERE
				T.ORG_ID = #{orgId} 
			<if test="ownerAcc != null and ownerAcc != ''">
				AND T.OWNER_ACC = #{ownerAcc} 
			</if>
			<if test="adminAcc != null and adminAcc != ''">
			   AND T.OWNER_ACC IN (SELECT TTGM.MEMBER_ACC
			          FROM TSM_GROUP_SHAREINFO TGS
			         RIGHT JOIN TSM_TEAM_GROUP_MEMBER TTGM
			            ON TTGM.GROUP_ID = TGS.GROUP_ID
			         WHERE SHARE_ACC = #{adminAcc} 
			         <if test="groupId != null and groupId != ''">
			         	AND TTGM.GROUP_ID = #{groupId} 
			         </if>
			         )
			</if>
			AND T.TYPE = 2
			AND T. STATUS IN (2, 3)
			AND T.IS_DEL = 0
			AND T.LAST_OPTION_ID IS NOT NULL
			GROUP BY
				T.LAST_OPTION_ID
		) W ON OP.OPTIONLIST_ID = W.LAST_OPTION_ID 
		WHERE
			OP.ORG_ID = #{orgId}
		AND OP.ITEM_CODE = 'SALES_10001'
		ORDER BY
			OP.SORT ASC
	</select>
	
	<!-- 客户类型分布图 -->
	<select id="findCustTypeLayoutChart" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="ChartNumMap">
		SELECT
			OP.OPTIONLIST_ID,
			OP.OPTION_NAME,
			IFNULL(W.CUST_NUMS,0) CUST_NUMS 
		FROM
			TSM_DATA_OPTIONLIST OP LEFT JOIN 
			(SELECT
				G.CUST_TYPE_ID OPTIONLIST_ID,
				COUNT(*) CUST_NUMS 
			FROM
				TSM_RES_CUST_INFO T
			LEFT JOIN TSM_CUST_GUIDE G ON G.ORG_ID = #{orgId} AND T.RES_CUST_ID = G.CUST_ID 
			WHERE
				T.ORG_ID = #{orgId} 
			<if test="ownerAcc != null and ownerAcc != ''">
				AND T.OWNER_ACC = #{ownerAcc} 
			</if>
			<if test="adminAcc != null and adminAcc != ''">
			   AND T.OWNER_ACC IN (SELECT TTGM.MEMBER_ACC
			          FROM TSM_GROUP_SHAREINFO TGS
			         RIGHT JOIN TSM_TEAM_GROUP_MEMBER TTGM
			            ON TTGM.GROUP_ID = TGS.GROUP_ID
			         WHERE SHARE_ACC = #{adminAcc} 
			         <if test="groupId != null and groupId != ''">
			         	AND TTGM.GROUP_ID = #{groupId} 
			         </if>
			         )
			</if>
			AND T.TYPE = 2
			AND T.STATUS IN (2, 3 , 6)
			AND T.IS_DEL = 0 
			AND G.CUST_TYPE_ID IS NOT NULL 
			GROUP BY
				G.CUST_TYPE_ID) W ON OP.OPTIONLIST_ID = W.OPTIONLIST_ID 
			WHERE
				OP.ORG_ID = #{orgId} 
			AND OP.ITEM_CODE = 'SALES_10002' 
			ORDER BY
				OP.SORT ASC
	</select>
	
	<resultMap type="map" id="NumsMap">
		<result column="PRODUCT_ID" property="productId" jdbcType="VARCHAR"/>
		<result column="PRODUCT_NAME" property="productName" jdbcType="VARCHAR"/>
		<result column="CUST_NUMS" property="custNums" jdbcType="DECIMAL"/>
	</resultMap>
	
	<select id="findProductChart" parameterType="map" resultMap="NumsMap">
		SELECT
			SP.ID AS PRODUCT_ID,
			SP. NAME AS PRODUCT_NAME,
			IFNULL(W.CUST_NUMS, 0) CUST_NUMS
		FROM
			SYS_PRODUCT SP
		LEFT JOIN (
			SELECT
				P.PROC_ID PROC_ID,
				COUNT(*) CUST_NUMS
			FROM
				TSM_RES_CUST_INFO T
			LEFT JOIN TSM_CUST_GUIDE G ON G.ORG_ID = #{orgId} 
			AND T.RES_CUST_ID = G.CUST_ID
			LEFT JOIN TSM_CUST_GUIDE_PROC P ON P.ORG_ID = #{orgId} 
			AND G.CUST_GUIDE_ID = P.GUIDE_ID
			WHERE
				T.ORG_ID = #{orgId} 
			<if test="ownerAcc != null and ownerAcc != ''">
				AND T.OWNER_ACC = #{ownerAcc} 
			</if>
			<if test="adminAcc != null and adminAcc != ''">
			   AND T.OWNER_ACC IN (SELECT TTGM.MEMBER_ACC
			          FROM TSM_GROUP_SHAREINFO TGS
			         RIGHT JOIN TSM_TEAM_GROUP_MEMBER TTGM
			            ON TTGM.GROUP_ID = TGS.GROUP_ID
			         WHERE SHARE_ACC = #{adminAcc} 
			         <if test="groupId != null and groupId != ''">
			         	AND TTGM.GROUP_ID = #{groupId} 
			         </if>
			         )
			</if>
			AND T.TYPE = 2
			AND T. STATUS IN (2, 3)
			AND T.IS_DEL = 0
			AND P.ID IS NOT NULL
			GROUP BY
				P.PROC_ID
		) W ON SP.ID = W.PROC_ID
		WHERE
			SP.ORG_ID = #{orgId} 
			AND SP.IS_DEL = 0 
		ORDER BY
			SP.SORT ASC
	</select>
	
	
	<resultMap type="com.qftx.tsm.report.dto.TeamCustStatusLayoutDto" id="LayoutDtoMap">
		<result column="USER_NAME" property="userName" jdbcType="VARCHAR"/>
		<result column="USER_ACCOUNT" property="userAccount" jdbcType="VARCHAR"/>
		<result column="GROUP_NAME" property="groupName" jdbcType="VARCHAR"/>
		<result column="GROUP_ID" property="groupId" jdbcType="VARCHAR"/>
		<result column="RES_NUM" property="resNum" jdbcType="DECIMAL"/>
		<result column="INT_NUM" property="intNum" jdbcType="DECIMAL"/>
		<result column="SIGN_NUM" property="signNum" jdbcType="DECIMAL"/>
		<result column="SILENT_NUM" property="silentNum" jdbcType="DECIMAL"/>
		<result column="LOSING_NUM" property="losingNum" jdbcType="DECIMAL"/>
		<result column="ALL_NUM" property="allNum" jdbcType="DECIMAL"/>
	</resultMap>
	
	<select id="findTeamCustStatusLayout" parameterType="map" resultMap="LayoutDtoMap">
		
		SELECT 
			Z.GROUP_NAME,
			Z.GROUP_ID,
			IFNULL(SUM(W.resNum),0) RES_NUM,
			IFNULL(SUM(W.intNum),0) INT_NUM,
			IFNULL(SUM(W.signNum),0) SIGN_NUM,
			IFNULL(SUM(W.silentNum),0) SILENT_NUM,
			IFNULL(SUM(W.losingNum),0) LOSING_NUM,
			IFNULL(SUM(W.allNum),0) ALL_NUM 
		 FROM 
		(SELECT
			TTGM.MEMBER_ACC,
			TTGM.USER_ID,
			IFNULL(
				AU.USER_NAME,
				AU.USER_ACCOUNT
			) USER_NAME,
			TTG.GROUP_ID,
			TTG.GROUP_NAME
		FROM
			TSM_GROUP_SHAREINFO TGS
		LEFT JOIN TSM_TEAM_GROUP_MEMBER TTGM ON TGS.ORG_ID= #{orgId} and TTGM.ORG_ID= #{orgId} and TTGM.GROUP_ID = TGS.GROUP_ID
		LEFT JOIN AUTH_USER AU ON TTGM.MEMBER_ACC = AU.USER_ACCOUNT
		LEFT JOIN TSM_TEAM_GROUP TTG ON TTG.ORG_ID=#{orgId} AND TGS.GROUP_ID = TTG.GROUP_ID
		WHERE
			TGS.SHARE_ACC = #{adminAcc} 
		<if test="groupIds != null and groupIds.size() > 0">
			<foreach collection="groupIds" item="groupId" index="index" open="AND TGS.GROUP_ID IN (" separator="," close=")">
				#{groupId} 
			</foreach>
		</if>
		<!-- AND AU.USER_ACCOUNT IS NOT NULL -->) Z LEFT JOIN 
		(SELECT
			T.OWNER_ACC,
			IFNULL(SUM((CASE WHEN T.STATUS IN (2,3) AND T.TYPE in (1,3) THEN 1 ELSE 0 END)),0) resNum,
		  IFNULL(SUM((CASE WHEN T.STATUS IN (2,3) AND T.TYPE = 2 THEN 1 ELSE 0 END)),0) intNum,
		  IFNULL(SUM((CASE WHEN T.STATUS = 6 THEN 1 ELSE 0 END )),0) signNum,
		  IFNULL(SUM((CASE WHEN T.STATUS = 7 THEN 1 ELSE 0 END )),0) silentNum,
		  IFNULL(SUM((CASE WHEN T.STATUS = 8 THEN 1 ELSE 0 END )),0) losingNum,
		  IFNULL(SUM((CASE WHEN T.STATUS IN (2,3,6,7,8) THEN 1 ELSE 0 END)),0) allNum
		FROM
			TSM_RES_CUST_INFO T
		WHERE
			T.ORG_ID = #{orgId}  
			AND T.IS_DEL = 0 
			AND T.OWNER_ACC IN (SELECT TTGM.MEMBER_ACC
					FROM TSM_GROUP_SHAREINFO TGS
				 RIGHT JOIN TSM_TEAM_GROUP_MEMBER TTGM
						ON TTGM.GROUP_ID = TGS.GROUP_ID
				 WHERE SHARE_ACC = #{adminAcc} 
				 <if test="groupIds != null and groupIds.size() > 0">
				 	<foreach collection="groupIds" item="groupId" index="index" open="AND TGS.GROUP_ID IN (" separator="," close=")">
						#{groupId} 
					</foreach>
				 </if>
			) 
			GROUP BY T.OWNER_ACC) W ON Z.MEMBER_ACC = W.OWNER_ACC GROUP BY Z.GROUP_ID,Z.GROUP_NAME
	</select>
	
	<select id="findTeamGroupStatusLayout" parameterType="map" resultMap="LayoutDtoMap">
		SELECT 
			IFNULL(SUM(W.resNum),0) RES_NUM,
			IFNULL(SUM(W.intNum),0) INT_NUM,
			IFNULL(SUM(W.signNum),0) SIGN_NUM,
			IFNULL(SUM(W.silentNum),0) SILENT_NUM,
			IFNULL(SUM(W.losingNum),0) LOSING_NUM,
			IFNULL(SUM(W.allNum),0) ALL_NUM 
		 FROM 
		(SELECT
			TTGM.MEMBER_ACC,
			TTGM.USER_ID,
			IFNULL(
				AU.USER_NAME,
				AU.USER_ACCOUNT
			) USER_NAME,
			TTG.GROUP_ID,
			TTG.GROUP_NAME
		FROM
			TSM_GROUP_SHAREINFO TGS
		LEFT JOIN TSM_TEAM_GROUP_MEMBER TTGM ON TGS.ORG_ID= #{orgId} and TTGM.ORG_ID= #{orgId} and TTGM.GROUP_ID = TGS.GROUP_ID
		LEFT JOIN AUTH_USER AU ON TTGM.MEMBER_ACC = AU.USER_ACCOUNT
		LEFT JOIN TSM_TEAM_GROUP TTG ON TTG.ORG_ID=#{orgId} AND TGS.GROUP_ID = TTG.GROUP_ID
		WHERE
			TGS.SHARE_ACC = #{adminAcc} 
		<if test="groupIds != null and groupIds.size() > 0">
			<foreach collection="groupIds" item="groupId" index="index" open="AND TGS.GROUP_ID IN (" separator="," close=")">
				#{groupId} 
			</foreach>
		</if>
		<!-- AND AU.USER_ACCOUNT IS NOT NULL -->) Z LEFT JOIN 
		(SELECT
			T.OWNER_ACC,
			IFNULL(SUM((CASE WHEN T.STATUS IN (2,3) AND T.TYPE in (1,3) THEN 1 ELSE 0 END)),0) resNum,
		  IFNULL(SUM((CASE WHEN T.STATUS IN (2,3) AND T.TYPE = 2 THEN 1 ELSE 0 END)),0) intNum,
		  IFNULL(SUM((CASE WHEN T.STATUS = 6 THEN 1 ELSE 0 END )),0) signNum,
		  IFNULL(SUM((CASE WHEN T.STATUS = 7 THEN 1 ELSE 0 END )),0) silentNum,
		  IFNULL(SUM((CASE WHEN T.STATUS = 8 THEN 1 ELSE 0 END )),0) losingNum,
		  IFNULL(SUM((CASE WHEN T.STATUS IN (2,3,6,7,8) THEN 1 ELSE 0 END)),0) allNum
		FROM
			TSM_RES_CUST_INFO T
		WHERE
			T.ORG_ID = #{orgId}  
			AND T.IS_DEL = 0 
			AND T.OWNER_ACC IN (SELECT TTGM.MEMBER_ACC
					FROM TSM_GROUP_SHAREINFO TGS
				 RIGHT JOIN TSM_TEAM_GROUP_MEMBER TTGM
						ON TTGM.GROUP_ID = TGS.GROUP_ID
				 WHERE SHARE_ACC = #{adminAcc} 
				 <if test="groupIds != null and groupIds.size() > 0">
				 	<foreach collection="groupIds" item="groupId" index="index" open="AND TGS.GROUP_ID IN (" separator="," close=")">
						#{groupId} 
					</foreach>
				 </if>
			) 
			GROUP BY T.OWNER_ACC) W ON Z.MEMBER_ACC = W.OWNER_ACC
	</select>
	
	<select id="findTeamMemberCustStatusLayout" parameterType="map" resultMap="LayoutDtoMap">
		SELECT 
			AU.USER_NAME,
			AU.USER_ACCOUNT,
			IFNULL(W.resNum,0) RES_NUM,
			IFNULL(W.intNum,0) INT_NUM,
			IFNULL(W.signNum,0) SIGN_NUM,
			IFNULL(W.silentNum,0) SILENT_NUM,
			IFNULL(W.losingNum,0) LOSING_NUM,
			IFNULL(W.allNum,0) ALL_NUM 
		 FROM(
			SELECT
			  T.OWNER_ACC,
			  IFNULL(SUM((CASE WHEN T.STATUS IN (2,3) AND T.TYPE in (1,3) THEN 1 ELSE 0 END)),0) resNum,
			  IFNULL(SUM((CASE WHEN T.STATUS IN (2,3) AND T.TYPE = 2 THEN 1 ELSE 0 END)),0) intNum,
			  IFNULL(SUM((CASE WHEN T.STATUS = 6 THEN 1 ELSE 0 END )),0) signNum,
			  IFNULL(SUM((CASE WHEN T.STATUS = 7 THEN 1 ELSE 0 END )),0) silentNum,
			  IFNULL(SUM((CASE WHEN T.STATUS = 8 THEN 1 ELSE 0 END )),0) losingNum,
			  IFNULL(SUM((CASE WHEN T.STATUS IN (2,3,6,7,8) THEN 1 ELSE 0 END)),0) allNum
			FROM
				TSM_RES_CUST_INFO T
			WHERE
				T.ORG_ID = #{orgId}  
				AND T.IS_DEL = 0 
				<choose>
					<when test="accounts != null and accounts.size() > 0">
						<foreach collection="accounts" item="account" open="AND T.OWNER_ACC IN (" separator="," close=")">
							#{account}
						</foreach>
					</when>
					<otherwise>
						AND T.OWNER_ACC IN (SELECT TTGM.MEMBER_ACC
								FROM  TSM_TEAM_GROUP_MEMBER TTGM 
							 WHERE TTGM.ORG_ID=#{orgId}
							 <foreach collection="groupIds" item="groupId" open="AND TTGM.GROUP_ID IN (" separator="," close=")">
								#{groupId}
							 </foreach>
						) 
					</otherwise>
				</choose>
				GROUP BY T.OWNER_ACC
			) AS W RIGHT JOIN (
				SELECT
					U.USER_NAME,
					U.USER_ACCOUNT
				FROM
					AUTH_USER U 
				WHERE
					U.ORG_ID = #{orgId} 
					<choose>
						<when test="accounts != null and accounts.size() > 0">
							<foreach collection="accounts" item="account" open="AND U.USER_ACCOUNT IN (" separator="," close=")">
								#{account}
							</foreach>
						</when>
						<otherwise>
							AND U.USER_ACCOUNT IN (
								SELECT
									TTGM.MEMBER_ACC
								FROM
									TSM_TEAM_GROUP_MEMBER TTGM
								WHERE TTGM.ORG_ID = #{orgId} 
								<foreach collection="groupIds" item="groupId" open="AND TTGM.GROUP_ID IN (" separator="," close=")">
									#{groupId}
								</foreach> 
							)
						</otherwise>
					</choose>
			) AS AU ON W.OWNER_ACC = AU.USER_ACCOUNT ORDER BY AU.USER_ACCOUNT ASC 
	</select>

	<select id="findSaleProcLayout" parameterType="map" resultMap="DtoResultMap">
		SELECT
			W.GROUP_ID AS RES_GROUP_ID,
			W.GROUP_NAME,
			Z.LAST_OPTION_ID,
			IFNULL(SUM(Z.CUST_NUMS),0) CUST_NUMS
		FROM
			(
				SELECT
					TTGM.MEMBER_ACC,
					TTG.GROUP_ID,
					TTG.GROUP_NAME,
					AU.USER_NAME
				FROM
					TSM_GROUP_SHAREINFO TGS
				LEFT JOIN TSM_TEAM_GROUP_MEMBER TTGM ON TGS.ORG_ID= #{orgId} and TTGM.ORG_ID= #{orgId} and TTGM.GROUP_ID = TGS.GROUP_ID
				LEFT JOIN AUTH_USER AU ON TTGM.MEMBER_ACC = AU.USER_ACCOUNT
				LEFT JOIN TSM_TEAM_GROUP TTG ON TGS.GROUP_ID = TTG.GROUP_ID
				WHERE
					TGS.SHARE_ACC = #{adminAcc} 
				<if test="groupIds != null and groupIds.size() > 0">
					<foreach collection="groupIds" item="groupId" index="index" open="AND TGS.GROUP_ID IN (" separator="," close=")">
						#{groupId} 
					</foreach>
				</if>
<!-- 				AND AU.USER_ACCOUNT IS NOT NULL  -->
			) W
		LEFT JOIN (
			SELECT
				T.OWNER_ACC,
				T.LAST_OPTION_ID,
				COUNT(*) CUST_NUMS
			FROM
				TSM_RES_CUST_INFO T
			WHERE
				T.ORG_ID = #{orgId} 
			AND T.TYPE = 2
			AND T. STATUS IN (2, 3)
			AND T.OWNER_ACC IN (
				SELECT
					TTGM.MEMBER_ACC
				FROM
					TSM_GROUP_SHAREINFO TGS
				RIGHT JOIN TSM_TEAM_GROUP_MEMBER TTGM ON  TGS.ORG_ID= #{orgId} and TTGM.ORG_ID= #{orgId} and TTGM.GROUP_ID = TGS.GROUP_ID
				WHERE
					SHARE_ACC = #{adminAcc} 
					<if test="groupIds != null and groupIds.size() > 0">
						<foreach collection="groupIds" item="groupId" index="index" open="AND TGS.GROUP_ID IN (" separator="," close=")">
							#{groupId} 
						</foreach>
					</if> 
			)
			AND T.IS_DEL = 0
			GROUP BY
				T.OWNER_ACC,
				T.LAST_OPTION_ID
		) Z ON W.MEMBER_ACC = Z.OWNER_ACC GROUP BY W.GROUP_ID,Z.LAST_OPTION_ID
	</select>
	
	<select id="findSaleGroupProcLayout" parameterType="map" resultMap="DtoResultMap">
		SELECT
			Z.LAST_OPTION_ID,
			IFNULL(SUM(Z.CUST_NUMS),0) CUST_NUMS
		FROM
			(
				SELECT
					TTGM.MEMBER_ACC,
					TTG.GROUP_ID,
					TTG.GROUP_NAME,
					AU.USER_NAME
				FROM
					TSM_GROUP_SHAREINFO TGS
				LEFT JOIN TSM_TEAM_GROUP_MEMBER TTGM ON TGS.ORG_ID= #{orgId} and TTGM.ORG_ID= #{orgId} and TTGM.GROUP_ID = TGS.GROUP_ID
				LEFT JOIN AUTH_USER AU ON TTGM.MEMBER_ACC = AU.USER_ACCOUNT
				LEFT JOIN TSM_TEAM_GROUP TTG ON TGS.GROUP_ID = TTG.GROUP_ID
				WHERE
					TGS.SHARE_ACC = #{adminAcc} 
				<if test="groupIds != null and groupIds.size() > 0">
					<foreach collection="groupIds" item="groupId" index="index" open="AND TGS.GROUP_ID IN (" separator="," close=")">
						#{groupId} 
					</foreach>
				</if>
<!-- 				AND AU.USER_ACCOUNT IS NOT NULL  -->
			) W
		LEFT JOIN (
			SELECT
				T.OWNER_ACC,
				T.LAST_OPTION_ID,
				COUNT(*) CUST_NUMS
			FROM
				TSM_RES_CUST_INFO T
			WHERE
				T.ORG_ID = #{orgId} 
			AND T.TYPE = 2
			AND T. STATUS IN (2, 3)
			AND T.OWNER_ACC IN (
				SELECT
					TTGM.MEMBER_ACC
				FROM
					TSM_GROUP_SHAREINFO TGS
				RIGHT JOIN TSM_TEAM_GROUP_MEMBER TTGM ON  TGS.ORG_ID= #{orgId} and TTGM.ORG_ID= #{orgId} and TTGM.GROUP_ID = TGS.GROUP_ID
				WHERE
					SHARE_ACC = #{adminAcc} 
					<if test="groupIds != null and groupIds.size() > 0">
						<foreach collection="groupIds" item="groupId" index="index" open="AND TGS.GROUP_ID IN (" separator="," close=")">
							#{groupId} 
						</foreach>
					</if> 
			)
			AND T.IS_DEL = 0
			GROUP BY
				T.OWNER_ACC,
				T.LAST_OPTION_ID
		) Z ON W.MEMBER_ACC = Z.OWNER_ACC GROUP BY Z.LAST_OPTION_ID
	</select>
	
	<select id="findSaleProcMemberLayout" parameterType="map" resultMap="DtoResultMap">
		SELECT 
			AU.USER_ACCOUNT AS OWNER_ACC,
			AU.USER_NAME AS OWNER_NAME,
			W.LAST_OPTION_ID,
			IFNULL(W.CUST_NUMS,0) AS CUST_NUMS
		 FROM 
			(
			SELECT
				T.OWNER_ACC,
				T.LAST_OPTION_ID,
				COUNT(*) CUST_NUMS
			FROM
				TSM_RES_CUST_INFO T
			WHERE
				T.ORG_ID = #{orgId} 
			AND T.TYPE = 2
			AND T. STATUS IN (2, 3)
			<choose>
				<when test="accounts != null and accounts.size() > 0">
					<foreach collection="accounts" item="account" open="AND T.OWNER_ACC IN (" separator="," close=")">
						#{account}
					</foreach>
				</when>
				<otherwise>
					AND T.OWNER_ACC IN (
						SELECT
							TTGM.MEMBER_ACC
						FROM
							TSM_TEAM_GROUP_MEMBER TTGM
						WHERE TTGM.ORG_ID = #{orgId} 
						<foreach collection="groupIds" item="groupId" open="AND TTGM.GROUP_ID IN (" separator="," close=")">
							#{groupId}
						</foreach>
					)
				</otherwise>
			</choose>
			AND T.IS_DEL = 0
			GROUP BY
				T.OWNER_ACC,
				T.LAST_OPTION_ID
			) AS W RIGHT JOIN (
				SELECT
					U.USER_NAME,
					U.USER_ACCOUNT
				FROM
					AUTH_USER U 
				WHERE
					U.ORG_ID = #{orgId} 
					<choose>
						<when test="accounts != null and accounts.size() > 0">
							<foreach collection="accounts" item="account" open="AND U.USER_ACCOUNT IN (" separator="," close=")">
								#{account}
							</foreach>
						</when>
						<otherwise>
							AND U.USER_ACCOUNT IN (
								SELECT
									TTGM.MEMBER_ACC
								FROM
									TSM_TEAM_GROUP_MEMBER TTGM
								WHERE TTGM.ORG_ID = #{orgId} 
								<foreach collection="groupIds" item="groupId" open="AND TTGM.GROUP_ID IN (" separator="," close=")">
									#{groupId}
								</foreach> 
							)
						</otherwise>
					</choose>
			) AS AU ON W.OWNER_ACC = AU.USER_ACCOUNT ORDER BY AU.USER_ACCOUNT ASC 
	</select>
	
	<select id="findCustTypeLayout" parameterType="map" resultMap="DtoResultMap">
		SELECT
			W.GROUP_ID AS RES_GROUP_ID,
			W.GROUP_NAME,
			Z.CUST_TYPE_ID,
			IFNULL(SUM(Z.CUST_NUMS),0) AS CUST_NUMS 
		FROM
			(
				SELECT
					TTGM.MEMBER_ACC,
					TTG.GROUP_ID,
					TTG.GROUP_NAME,
					AU.USER_NAME
				FROM
					TSM_GROUP_SHAREINFO TGS
				LEFT JOIN TSM_TEAM_GROUP_MEMBER TTGM ON TGS.ORG_ID= #{orgId} and TTGM.ORG_ID= #{orgId} and TTGM.GROUP_ID = TGS.GROUP_ID
				LEFT JOIN AUTH_USER AU ON TTGM.MEMBER_ACC = AU.USER_ACCOUNT
				LEFT JOIN TSM_TEAM_GROUP TTG ON TTG.ORG_ID= #{orgId} AND TGS.GROUP_ID = TTG.GROUP_ID
				WHERE
					TGS.SHARE_ACC = #{adminAcc} 
				<if test="groupIds != null and groupIds.size() > 0">
					<foreach collection="groupIds" item="groupId" index="index" open="AND TGS.GROUP_ID IN (" separator="," close=")">
						#{groupId} 
					</foreach>
				</if>
<!-- 				AND AU.USER_ACCOUNT IS NOT NULL  -->
			) W
		LEFT JOIN (SELECT
				T.OWNER_ACC,
				TCG.CUST_TYPE_ID,
				COUNT(*) CUST_NUMS
			FROM
				TSM_RES_CUST_INFO T
			LEFT JOIN TSM_CUST_GUIDE TCG ON TCG.ORG_ID = #{orgId} 
			AND TCG.CUST_ID = T.RES_CUST_ID
			WHERE
				T.ORG_ID = #{orgId} 
			AND T.TYPE = 2
			AND T. STATUS IN (2, 3,6)
			AND T.IS_DEL = 0
			AND T.OWNER_ACC IN (
				SELECT
					TTGM.MEMBER_ACC
				FROM
					TSM_GROUP_SHAREINFO TGS
				RIGHT JOIN TSM_TEAM_GROUP_MEMBER TTGM ON  TGS.ORG_ID= #{orgId} and TTGM.ORG_ID= #{orgId} and TTGM.GROUP_ID = TGS.GROUP_ID
				WHERE
					TGS.SHARE_ACC = #{adminAcc} 
					<if test="groupIds != null and groupIds.size() > 0">
						<foreach collection="groupIds" item="groupId" index="index" open="AND TGS.GROUP_ID IN (" separator="," close=")">
							#{groupId} 
						</foreach>
					</if>
			) 
			AND TCG.CUST_TYPE_ID IS NOT NULL 
			GROUP BY TCG.CUST_TYPE_ID , T.OWNER_ACC) Z ON W.MEMBER_ACC = Z.OWNER_ACC GROUP BY W.GROUP_ID,Z.CUST_TYPE_ID 
	</select>
	
	<select id="findCustTypeMemberLayout" parameterType="map" resultMap="DtoResultMap">
		SELECT AU.USER_ACCOUNT AS OWNER_ACC,
			   AU.USER_NAME AS OWNER_NAME,
			   W.CUST_TYPE_ID,
			   IFNULL(W.CUST_NUMS,0) AS CUST_NUMS
		 FROM (SELECT
				T.OWNER_ACC,
				TCG.CUST_TYPE_ID,
				COUNT(*) CUST_NUMS
			FROM
				TSM_RES_CUST_INFO T
			LEFT JOIN TSM_CUST_GUIDE TCG ON TCG.ORG_ID = #{orgId} 
			AND TCG.CUST_ID = T.RES_CUST_ID
			WHERE
				T.ORG_ID = #{orgId} 
			AND T.TYPE = 2
			AND T. STATUS IN (2, 3,6)
			AND T.IS_DEL = 0
			<choose>
				<when test="accounts != null and accounts.size() > 0">
					<foreach collection="accounts" item="account" open="AND T.OWNER_ACC IN (" separator="," close=")">
						#{account}
					</foreach>
				</when>
				<otherwise>
					AND T.OWNER_ACC IN (
						SELECT
							TTGM.MEMBER_ACC
						FROM
							TSM_TEAM_GROUP_MEMBER TTGM
						WHERE TTGM.ORG_ID = #{orgId} AND TTGM.GROUP_ID = #{groupId} 
					)
				</otherwise>
			</choose> 
			AND TCG.CUST_TYPE_ID IS NOT NULL 
			GROUP BY TCG.CUST_TYPE_ID , T.OWNER_ACC) AS W RIGHT JOIN (
				SELECT
					U.USER_NAME,
					U.USER_ACCOUNT
				FROM
					AUTH_USER U 
				WHERE
					U.ORG_ID = #{orgId} 
					<choose>
						<when test="accounts != null and accounts.size() > 0">
							<foreach collection="accounts" item="account" open="AND U.USER_ACCOUNT IN (" separator="," close=")">
								#{account}
							</foreach>
						</when>
						<otherwise>
							AND U.USER_ACCOUNT IN (
								SELECT
									TTGM.MEMBER_ACC
								FROM
									TSM_TEAM_GROUP_MEMBER TTGM
								WHERE TTGM.ORG_ID = #{orgId} AND TTGM.GROUP_ID = #{groupId} 
							)
						</otherwise>
					</choose>
			) AS AU ON W.OWNER_ACC = AU.USER_ACCOUNT ORDER BY AU.USER_ACCOUNT ASC 
	</select>
	
	<select id="findCustProductLayout" parameterType="map" resultMap="DtoResultMap" >
		SELECT
			W.GROUP_ID AS RES_GROUP_ID,
			W.GROUP_NAME,
			Z.PROC_ID,
			IFNULL(SUM(Z.CUST_NUMS),0) CUST_NUMS 
		FROM
			(
				SELECT
					TTGM.MEMBER_ACC,
					TTG.GROUP_ID,
					TTG.GROUP_NAME,
					AU.USER_NAME
				FROM
					TSM_GROUP_SHAREINFO TGS
				LEFT JOIN TSM_TEAM_GROUP_MEMBER TTGM ON TGS.ORG_ID= #{orgId} and TTGM.ORG_ID= #{orgId} and TTGM.GROUP_ID = TGS.GROUP_ID
				LEFT JOIN AUTH_USER AU ON TTGM.MEMBER_ACC = AU.USER_ACCOUNT
				LEFT JOIN TSM_TEAM_GROUP TTG ON TTG.ORG_ID= #{orgId} AND TGS.GROUP_ID = TTG.GROUP_ID
				WHERE
					TGS.SHARE_ACC = #{adminAcc} 
				<if test="groupIds != null and groupIds.size() > 0">
					<foreach collection="groupIds" item="groupId" index="index" open="AND TGS.GROUP_ID IN (" separator="," close=")">
						#{groupId} 
					</foreach>
				</if>
<!-- 				AND AU.USER_ACCOUNT IS NOT NULL  -->
			) W LEFT JOIN (
				SELECT
					T.OWNER_ACC,
					TCGP.PROC_ID,
					COUNT(*) CUST_NUMS
				FROM
					TSM_RES_CUST_INFO T
				LEFT JOIN TSM_CUST_GUIDE TCG ON TCG.ORG_ID = #{orgId} 
				AND TCG.CUST_ID = T.RES_CUST_ID
				LEFT JOIN TSM_CUST_GUIDE_PROC TCGP ON TCGP.ORG_ID = #{orgId} 
				AND TCGP.GUIDE_ID = TCG.CUST_GUIDE_ID
				WHERE
					T.ORG_ID = #{orgId}  
				AND T.TYPE = 2
				AND T. STATUS IN (2, 3)
				AND T.IS_DEL = 0
				AND T.OWNER_ACC IN (
					SELECT
						TTGM.MEMBER_ACC
					FROM
						TSM_GROUP_SHAREINFO TGS
					RIGHT JOIN TSM_TEAM_GROUP_MEMBER TTGM ON TGS.ORG_ID= #{orgId} and TTGM.ORG_ID= #{orgId} and TTGM.GROUP_ID = TGS.GROUP_ID
					WHERE
						TGS.SHARE_ACC = #{adminAcc} 
						<if test="groupIds != null and groupIds.size() > 0">
							<foreach collection="groupIds" item="groupId" index="index" open="AND TGS.GROUP_ID IN (" separator="," close=")">
								#{groupId} 
							</foreach>
						</if>
				)
				AND TCG.CUST_TYPE_ID IS NOT NULL
				GROUP BY
					TCGP.PROC_ID,
					T.OWNER_ACC
			) Z ON W.MEMBER_ACC = Z.OWNER_ACC GROUP BY W.GROUP_ID,Z.PROC_ID ASC  
	</select>
	
	<select id="findCustProductMemberLayout" parameterType="map" resultMap="DtoResultMap" >
		SELECT AU.USER_ACCOUNT AS OWNER_ACC,
			   AU.USER_NAME AS OWNER_NAME,
			   W.PROC_ID,
			   IFNULL(W.CUST_NUMS,0) AS CUST_NUMS
			  FROM (
				SELECT
					T.OWNER_ACC,
					TCGP.PROC_ID,
					COUNT(*) CUST_NUMS
				FROM
					TSM_RES_CUST_INFO T
				LEFT JOIN TSM_CUST_GUIDE TCG ON TCG.ORG_ID = #{orgId} 
				AND TCG.CUST_ID = T.RES_CUST_ID
				LEFT JOIN TSM_CUST_GUIDE_PROC TCGP ON TCGP.ORG_ID = #{orgId} 
				AND TCGP.GUIDE_ID = TCG.CUST_GUIDE_ID
				WHERE
					T.ORG_ID = #{orgId}  
				AND T.TYPE = 2
				AND T. STATUS IN (2, 3)
				AND T.IS_DEL = 0
				<if test="groupId != null and groupId != ''">
					AND T.OWNER_ACC IN (
						SELECT
							TTGM.MEMBER_ACC
						FROM
							TSM_TEAM_GROUP_MEMBER TTGM
						WHERE TTGM.ORG_ID = #{orgId} AND TTGM.GROUP_ID = #{groupId} 
					)
				</if>
				AND TCG.CUST_TYPE_ID IS NOT NULL
				GROUP BY
					TCGP.PROC_ID,
					T.OWNER_ACC
			)AS W RIGHT JOIN (
				SELECT
					U.USER_NAME,
					U.USER_ACCOUNT
				FROM
					AUTH_USER U 
				WHERE
					U.ORG_ID = #{orgId} 
					<if test="groupId != null and groupId != ''">
							AND U.USER_ACCOUNT IN (
								SELECT
									TTGM.MEMBER_ACC
								FROM
									TSM_TEAM_GROUP_MEMBER TTGM
								WHERE TTGM.ORG_ID = #{orgId} AND TTGM.GROUP_ID = #{groupId} 
							)
					</if>
			) AS AU ON W.OWNER_ACC = AU.USER_ACCOUNT ORDER BY AU.USER_ACCOUNT ASC  
	</select>
	<!-- ************************************ 导入时 查询是否重复 ************************************ -->
	<!-- 号码去重 -->
	<select id="getRepeatByPhone" resultType="Integer" parameterType="com.qftx.tsm.imp.dto.ImportRepeatDto">
		select count(*) from tsm_res_cust_info where org_id = #{orgId} and is_del = 0 
		<if test="isOpen == 1"> <!-- 资源去重开启 -->
			<if test="isPhone !=1"> <!-- 号码去重开启 -->
				<choose>
					<when test="isPhone == 2"> <!-- 对签约客户 号码去重 -->
							and (status = 6 or status = 7 or status = 8 )
					</when>
					<when test="isPhone == 3"> <!-- 对意向客户 号码去重 -->
							and TYPE = 2
					</when>
				</choose>
				<if test="mobelPhone != null and mobelPhone !='' and telPhone != null and telPhone !=''">
					and (mobilephone in (#{mobelPhone},#{telPhone}) or telphone in (#{mobelPhone},#{telPhone}))
				</if>	
				<if test="mobelPhone != null and mobelPhone !='' and (telPhone == null or telPhone =='' )">
					and (mobilephone = #{mobelPhone} or telphone = #{mobelPhone})
				</if>
				<if test="telPhone != null and telPhone !='' and (mobelPhone == null and mobelPhone =='')">
					and (mobilephone = #{telPhone} or telphone = #{telPhone})
				</if>			
			</if>
		</if>
	</select>
	
	<!-- 单位名称去重 -->
	<select id="getRepeatByName" resultType="Integer" parameterType="com.qftx.tsm.imp.dto.ImportRepeatDto">
		select count(*) from tsm_res_cust_info where org_id = #{orgId} and is_del = 0 
		<if test="isOpen == 1"> <!-- 资源去重开启 -->
			<if test="isCompanyName !=0"> <!-- 单位名称去重开启 -->
				<choose>
					<when test="isCompanyName == 1"> <!-- 对签约客户 号码去重 -->
							and (status = 6 or status = 7 or status = 8 )
					</when>
					<when test="isCompanyName == 2"> <!-- 对意向客户 号码去重 -->
							and TYPE = 2
					</when>
				</choose>
				<!-- 个人资源 查询单位名称 -->
				<if test="isSys == 0 and comPanyName != null and comPanyName != ''">
						and (COMPANY = #{comPanyName})
				</if>
				<!-- 企业资源 查询客户名称 -->
				<if test="isSys == 1 and custName != null and custName != ''">
						and (NAME = #{custName})
				</if>
			</if>
		</if>
	</select>
	
	<!-- 单位主页去重 -->
	<select id="getRepeatByUnitHome" resultType="Integer" parameterType="com.qftx.tsm.imp.dto.ImportRepeatDto">
		select count(*) from tsm_res_cust_info where org_id = #{orgId} and is_del = 0 
		<if test="isOpen == 1"> <!-- 资源去重开启 -->
			<if test="isUnithome !=0"> <!-- 单位主页去重开启 -->
				<choose>
					<when test="isUnithome == 1"> <!-- 对签约客户 号码去重 -->
							and (status = 6 or status = 7 or status = 8 )
					</when>
					<when test="isUnithome == 2"> <!-- 对意向客户 号码去重 -->
							and TYPE = 2
					</when>
				</choose>
				<if test="unitHome != null and unitHome !=''">
					and UNITHOME = #{unitHome}
				</if>				
			</if>
		</if>
	</select>
	
     <select id="findResByOrgId" parameterType="map" resultMap="BaseResultMap">
        select * from tsm_res_cust_info t where  org_id = #{orgId} and is_del = 0 
        <if test="type==1">
           and last_Option_Id is not null
        </if>
        <if test="type==2">
           and last_cust_type_id is not null
        </if>
         <if test="type==3">
           and LABEL_CODE is not null
        </if>
     </select>
     
     <!-- 根据资源ID集合，查询公海客户 -->
     <select id="findResByResId" parameterType="map" resultType="String">
        select RES_CUST_ID from tsm_res_cust_info t where  org_id = #{orgId} and is_del = 0 
         and T.RES_CUST_ID IN <foreach collection="ids" item="item" open="(" separator="," close=")">#{item}</foreach>
         and t.STATUS = 4
     </select>
     <!-- 修改资源拨通次数 -->
     <update id="updateCallNum" parameterType="com.qftx.tsm.cust.bean.ResCustInfoBean">
         update  tsm_res_cust_info t set t.tao_no= IFNULL(t.tao_no,0)+1  where  org_id=#{orgId} and t.RES_CUST_ID=#{resCustId}
     </update>
     <!-- 根据导入部门id查询资源数量 -->
	<select id="findResCountByGroupId" resultType="Integer">
		select
		count(1)
		from
		<include refid="table_name" />
		where 1=1
		AND ORG_ID = #{orgId}
		AND import_dept_id in (#{importDeptId},#{importDeptIdsStr})
	</select>
	
	<!-- 设置共有者 -->
	<update id="updateCustsCommonAcc" parameterType="map">
		update tsm_res_cust_info
			set 
			<choose>
				<when test="commonAcc != null and commonAcc != ''">
					common_acc = #{commonAcc} 
				</when>
				<otherwise>
					common_acc = null 
				</otherwise>
			</choose>
		  where org_id = #{orgId} 
		  and res_cust_id in 
		  <foreach collection="custIds" item="custId" open="(" separator="," close=")">
		  	#{custId} 
		  </foreach>
	</update>
	
	
		<!-- 跟新下次联系时间 -->
	<update id="updateCustsNextFollowDate" parameterType="map">
		update tsm_res_cust_info
			set 
          nextfollow_date= #{nextFollowDate}
		  where org_id = #{orgId} 
		  and res_cust_id =#{custId} 
	</update>
	
	
	
	<!-- 我的客户（资源） 三天内回收 标签查询 -->
	<select id="findResExpireCount" resultType="java.lang.Integer" parameterType="map">
		SELECT
			count(1) 
		FROM TSM_RES_CUST_INFO t 
		WHERE t.org_id =  #{orgId} 
			AND t.is_del = 0 
			AND t.type = 1
			AND t.STATUS in (2,3) 
			<if test="ownerAcc != null and ownerAcc != ''">
				AND t.OWNER_ACC = #{ownerAcc} 
			</if>
			<if test="ownerAccs != null and ownerAccs.size() > 0">
				AND t.OWNER_ACC in 
				<foreach collection="ownerAccs" item="oa" open="(" separator="," close=")">
					#{oa } 
				</foreach>
			</if>
			<choose>
				<when test='expireType = "1"'>
					AND DATEDIFF(NOW(),t.OWNER_START_DATE) >= ${recyleDay }
				</when>
				<otherwise>
					AND DATEDIFF(NOW(),ifnull(t.ACTION_DATE,t.OWNER_START_DATE)) >= ${recyleDay }
				</otherwise>
			</choose>
	</select>
	
	<!-- 查询意向客户到期未跟进 -->
	<select id="findCustExpireCount" resultType="java.lang.Integer" parameterType="map">
		<choose>
			<when test="options != null">
				<foreach collection="options" item="option" open="select sum(w.num) from (" separator=" union " close=") as w">
					SELECT
						count(1) num  
					FROM
						tsm_res_cust_info t
					WHERE
						t.org_id = #{orgId}
					AND t.TYPE = 2
					AND t. STATUS in(2,3) 
					<if test="ownerAcc != null and ownerAcc != ''">
						AND t.OWNER_ACC = #{ownerAcc} 
					</if>
					<if test="ownerAccs != null and ownerAccs.size() > 0">
						AND t.OWNER_ACC in 
						<foreach collection="ownerAccs" item="oa" open="(" separator="," close=")">
							#{oa } 
						</foreach>
					</if>
					AND t.last_option_id = #{option.optionId}
					AND t.IS_DEL = 0
<!-- 					AND t.ACTION_DATE is not null  -->
					AND DATEDIFF(now(), ifnull(t.ACTION_DATE,t.AMOYTOCUSTOMER_DATE)) >= ${option.optionValue} 
				</foreach>
			</when>
			<otherwise>
				SELECT
						count(1) 
					FROM
						tsm_res_cust_info t
					WHERE
						t.org_id = #{orgId}
					AND t.TYPE = 2
					AND t. STATUS in(2,3) 
					<if test="ownerAcc != null and ownerAcc != ''">
						AND t.OWNER_ACC = #{ownerAcc} 
					</if>
					<if test="ownerAccs != null and ownerAccs.size() > 0">
						AND t.OWNER_ACC in 
						<foreach collection="ownerAccs" item="oa" open="(" separator="," close=")">
							#{oa } 
						</foreach>
					</if>
					AND t.IS_DEL = 0
					AND t.OWNER_START_DATE is not null 
					AND DATEDIFF(now(), t.OWNER_START_DATE) >= ${epDay} 
			</otherwise>
		</choose>
	</select>
	
	<!-- 查询意向客户到期未跟进 -->
	<select id="findCustExpireIds" resultType="java.lang.String" parameterType="map">
		<choose>
			<when test="options != null">
				<foreach collection="options" item="option" separator=" union ">
					SELECT
						t.res_cust_id 
					FROM
						tsm_res_cust_info t
					WHERE
						t.org_id = #{orgId}
					AND t.TYPE = 2
					AND t. STATUS in(2,3) 
					<if test="ownerAcc != null and ownerAcc != ''">
						AND t.OWNER_ACC = #{ownerAcc} 
					</if>
					<if test="ownerAccs != null and ownerAccs.size() > 0">
						AND t.OWNER_ACC in 
						<foreach collection="ownerAccs" item="oa" open="(" separator="," close=")">
							#{oa } 
						</foreach>
					</if>
					AND t.last_option_id = #{option.optionId}
					AND t.IS_DEL = 0
					AND DATEDIFF(now(), ifnull(t.ACTION_DATE,t.AMOYTOCUSTOMER_DATE)) >= ${option.optionValue} 
				</foreach>
			</when>
			<otherwise>
				SELECT
						t.res_cust_id 
					FROM
						tsm_res_cust_info t
					WHERE
						t.org_id = #{orgId}
					AND t.TYPE = 2
					AND t. STATUS in(2,3) 
					<if test="ownerAcc != null and ownerAcc != ''">
						AND t.OWNER_ACC = #{ownerAcc} 
					</if>
					<if test="ownerAccs != null and ownerAccs.size() > 0">
						AND t.OWNER_ACC in 
						<foreach collection="ownerAccs" item="oa" open="(" separator="," close=")">
							#{oa } 
						</foreach>
					</if>
					AND t.IS_DEL = 0
					AND t.OWNER_START_DATE is not null 
					AND DATEDIFF(now(), t.OWNER_START_DATE) >= ${epDay} 
			</otherwise>
		</choose>
	</select>
	
	<!-- 查询意向客户到期未跟进 提前提醒 -->
	<select id="findCucstFollowExpire1" resultMap="BaseResultMap" parameterType="map">
		SELECT
		t.RES_CUST_ID,
		t.OWNER_ACC,
		t.ORG_ID,
		t.NAME,
		ifnull(t.action_date,t.AMOYTOCUSTOMER_DATE) action_date,
		t.state, 
		t.mobilephone,
		t.telphone,
		t.company,
		t.last_Option_Id
		FROM
		tsm_res_cust_info t
		WHERE
		t.org_id = #{orgId}
		AND t.TYPE = 2
		AND t. STATUS in(2,3)
		AND t.last_Option_Id = #{optionId}
		AND t.owner_acc = #{ownerAcc}
		AND t.IS_DEL = 0
		AND DATEDIFF(now(), ifnull(t.action_date,t.AMOYTOCUSTOMER_DATE)) > #{day}
	</select>
	
	<select id="findNoChangeResExpire"  resultMap="BaseResultMap" parameterType="map">
		SELECT
		t.res_cust_id,
		t.org_id,
		t.owner_acc,
		t.OWNER_ACC
		FROM
		tsm_res_cust_info t
		WHERE
		DATEDIFF(now(), t.OWNER_START_DATE) > #{day}
		AND t.STATUS in (2,3)
		AND t.type = 1
		AND t.is_del = 0
		AND t.OWNER_ACC = #{ownerAcc}
		AND t.org_id =  #{orgId}
	</select>
	
	<select id="findNoLinkResExpire"  resultMap="BaseResultMap" parameterType="map">
		SELECT
		t.res_cust_id,
		t.org_id,
		t.owner_acc,
		t.OWNER_ACC
		FROM
		tsm_res_cust_info t
		WHERE
		DATEDIFF(now(), ifnull(t.ACTION_DATE,t.OWNER_START_DATE)) > #{day}
		AND t.STATUS IN (2,3)
		AND t.type = 1
		AND t.is_del = 0
		AND t.OWNER_ACC = #{ownerAcc}
		AND t.org_id =  #{orgId}
	</select>
	
	<select id="findSignOrderExpireCusts" parameterType="map" resultMap="BaseResultMap">
		select res_cust_id,owner_acc,last_option_id,name,mobilephone,company,telphone,state from tsm_res_cust_info where org_id=#{orgId} and is_del = 0 and status = 6 
		and res_cust_id in 
		<foreach collection="ids" item="id" open="(" separator="," close=")">
			#{id} 
		</foreach>
	</select>
	
	<select id="makeCustomReport2" parameterType="com.qftx.tsm.report.dto.ResCustReportDto" resultType="com.qftx.tsm.report.dto.CustomReportDoubleDto">
		select 
			<if test="groupByType1 != null and groupByType1 != ''">
				<choose>
					<when test="groupByType1 == 'qStatus'">
						case 
							when (type=1 and status = 1) then 1 
							<choose>
								<when test="qStatusMatch != null">
									<choose>
										<when test="qStatusMatch == 0">
											<if test="qStatusMap.containsKey(2)">
												when (type=1 and (status = 2 or status = 3)) then 2
											</if>
											<if test="qStatusMap.containsKey(3)">
												when (type=2 and (status = 2 or status = 3)) then 3
											</if>
										</when>
										<when test="qStatusMatch == 1">
											<if test="!qStatusMap.containsKey(2)">
												when (type=1 and (status = 2 or status = 3)) then 2
											</if>
											<if test="!qStatusMap.containsKey(3)">
												when (type=2 and (status = 2 or status = 3)) then 3
											</if>
										</when>
									</choose>
								</when>
								<otherwise>
									when (type=1 and (status = 2 or status = 3)) then 2
									when (type=2 and (status = 2 or status = 3)) then 3
								</otherwise>
							</choose>
							when (type=2 and status = 6) then 4
							when (type=2 and status = 8) then 5
							when (type=2 and status = 7) then 6
							when (status = 4 or status = 5) then 7
							end as singleName1,
					</when>
					<when test="groupByType1 == 'last_cust_type_id'">
						last_cust_type_id as singleName1,
					</when>
					<when test="groupByType1 == 'last_option_Id'">
						last_option_Id as singleName1,
					</when>
					<when test="groupByType1 == 'import_dept_id'">
						import_dept_id as singleName1,
					</when>
					<when test="groupByType1 == 'res_group_id'">
						res_group_id as singleName1,
					</when>
					<when test="groupByType1 == 'company_trade'">
						company_trade as singleName1,
					</when>
					<when test="groupByType1 == 'opreate_type'">
						opreate_type as singleName1,
					</when>
					<when test="groupByType1 == 'defined1'">
						defined1 as singleName1,
					</when>
					<when test="groupByType1 == 'defined2'">
						defined2 as singleName1,
					</when>
					<when test="groupByType1 == 'defined3'">
						defined3 as singleName1,
					</when>
					<when test="groupByType1 == 'defined4'">
						defined4 as singleName1,
					</when>
					<when test="groupByType1 == 'defined5'">
						defined5 as singleName1,
					</when>
					<when test="groupByType1 == 'defined6'">
						defined6 as singleName1,
					</when>
					<when test="groupByType1 == 'defined7'">
						defined7 as singleName1,
					</when>
					<when test="groupByType1 == 'defined8'">
						defined8 as singleName1,
					</when>
					<when test="groupByType1 == 'defined9'">
						defined9 as singleName1,
					</when>
					<when test="groupByType1 == 'defined10'">
						defined10 as singleName1,
					</when>
					<when test="groupByType1 == 'defined11'">
						defined12 as singleName1,
					</when>
					<when test="groupByType1 == 'defined12'">
						defined12 as singleName1,
					</when>
					<when test="groupByType1 == 'defined13'">
						defined13 as singleName1,
					</when>
					<when test="groupByType1 == 'defined14'">
						defined14 as singleName1,
					</when>
					<when test="groupByType1 == 'defined15'">
						defined15 as singleName1,
					</when>
				</choose>
			</if>
			<if test="groupByType2 != null and groupByType2 != ''">
				<choose>
					<when test="groupByType2 == 'qStatus'">
						case 
							when (type=1 and status = 1) then 1 
							<choose>
								<when test="qStatusMatch != null">
									<choose>
										<when test="qStatusMatch == 0">
											<if test="qStatusMap.containsKey(2)">
												when (type=1 and (status = 2 or status = 3)) then 2
											</if>
											<if test="qStatusMap.containsKey(3)">
												when (type=2 and (status = 2 or status = 3)) then 3
											</if>
										</when>
										<when test="qStatusMatch == 1">
											<if test="!qStatusMap.containsKey(2)">
												when (type=1 and (status = 2 or status = 3)) then 2
											</if>
											<if test="!qStatusMap.containsKey(3)">
												when (type=2 and (status = 2 or status = 3)) then 3
											</if>
										</when>
									</choose>
								</when>
								<otherwise>
									when (type=1 and (status = 2 or status = 3)) then 2
									when (type=2 and (status = 2 or status = 3)) then 3
								</otherwise>
							</choose>
							when (type=2 and status = 6) then 4
							when (type=2 and status = 8) then 5
							when (type=2 and status = 7) then 6
							when (status = 4 or status = 5) then 7
							end as singleName2,
					</when>
					<when test="groupByType2 == 'last_cust_type_id'">
						last_cust_type_id as singleName2,
					</when>
					<when test="groupByType2 == 'last_option_Id'">
						last_option_Id as singleName2,
					</when>
					<when test="groupByType2 == 'import_dept_id'">
						import_dept_id as singleName2,
					</when>
					<when test="groupByType2 == 'res_group_id'">
						res_group_id as singleName2,
					</when>
					<when test="groupByType2 == 'company_trade'">
						company_trade as singleName2,
					</when>
					<when test="groupByType2 == 'opreate_type'">
						opreate_type as singleName2,
					</when>
					<when test="groupByType2 == 'defined1'">
						defined1 as singleName2,
					</when>
					<when test="groupByType2 == 'defined2'">
						defined2 as singleName2,
					</when>
					<when test="groupByType2 == 'defined3'">
						defined3 as singleName2,
					</when>
					<when test="groupByType2 == 'defined4'">
						defined4 as singleName2,
					</when>
					<when test="groupByType2 == 'defined5'">
						defined5 as singleName2,
					</when>
					<when test="groupByType2 == 'defined6'">
						defined6 as singleName2,
					</when>
					<when test="groupByType2 == 'defined7'">
						defined7 as singleName2,
					</when>
					<when test="groupByType2 == 'defined8'">
						defined8 as singleName2,
					</when>
					<when test="groupByType2 == 'defined9'">
						defined9 as singleName2,
					</when>
					<when test="groupByType2 == 'defined10'">
						defined10 as singleName2,
					</when>
					<when test="groupByType2 == 'defined11'">
						defined12 as singleName2,
					</when>
					<when test="groupByType2 == 'defined12'">
						defined12 as singleName2,
					</when>
					<when test="groupByType2 == 'defined13'">
						defined13 as singleName2,
					</when>
					<when test="groupByType2 == 'defined14'">
						defined14 as singleName2,
					</when>
					<when test="groupByType2 == 'defined15'">
						defined15 as singleName2,
					</when>
				</choose>
			</if>
			count(1) as count
		from tsm_res_cust_info
		where org_id = #{orgId}
			and is_del = 0
			<if test="groupByType2 == 'opreate_type' or groupByType1 == 'opreate_type'">
				and status = 4
			</if>
			<if test="custIds != null and custIds.size() > 0">
		   		AND RES_CUST_ID IN 
		   			<foreach collection="custIds" item="cid" open="(" separator="," close=")">
		   				#{cid}
		   			</foreach>
		   	</if>
			<if test="custTypeIds != null and custTypeIds.size() > 0 and custTypeMatch != null">
				<choose>
					<when test="custTypeMatch == 0">
						AND last_cust_type_id in 
						<foreach collection="custTypeIds" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="custTypeMatch == 1">
						AND last_cust_type_id is not null AND last_cust_type_id != ''
						AND last_cust_type_id not in 
						<foreach collection="custTypeIds" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test=" qStatus != null and qStatus != '' and qStatusMatch != null">
				<choose>
					<when test="qStatusMatch == 0">
						<if test="types != null and types.size() > 0 ">
							and type in
							<foreach collection="types" index="index" item="item" open="(" separator="," close=")">
								#{item}
							</foreach>
						</if>
						<if test="statuss != null and statuss.size() > 0 ">
							and status in
							<foreach collection="statuss" index="index" item="item" open="(" separator="," close=")">
								#{item}
							</foreach>
						</if>
					</when>
					<when test="qStatusMatch == 1">
						<if test="types != null and types.size() > 0 ">
							and type in
							<foreach collection="types" index="index" item="item" open="(" separator="," close=")">
								#{item}
							</foreach>
						</if>
						<choose>
							<when test="statuss != null and statuss.size() > 0">
								and status in
								<foreach collection="statuss" index="index" item="item" open="(" separator="," close=")">
									#{item}
								</foreach>
							</when>
							<otherwise>
								and status not in (1,2,3,4,6,7,8)
							</otherwise>
						</choose>
					</when>
				</choose>
			</if>
			<if test=" optionlistIds != null and optionlistIds.size() > 0  and optionlistMatch != null">
				<choose>
					<when test="optionlistMatch == 0">
						AND last_option_Id in 
						<foreach collection="optionlistIds" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="optionlistMatch == 1">
						AND last_option_Id is not null AND last_option_Id != ''
						AND last_option_Id not in 
						<foreach collection="optionlistIds" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test=" ownerAccs != null and ownerAccs.size() > 0 and ownerAccMatch != null">
				<choose>
					<when test="ownerAccMatch == 0">
						and OWNER_ACC in
						<foreach collection="ownerAccs" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="ownerAccMatch == 1">
						and OWNER_ACC is not null and OWNER_ACC != ''
						and OWNER_ACC not in 
						<foreach collection="ownerAccs" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="resGroupIds != null and resGroupIds.size() > 0 and resGroupMatch != null">
				<choose>
					<when test="resGroupMatch == 0">
						and RES_GROUP_ID in
						<foreach collection="resGroupIds" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="resGroupMatch == 1">
						and RES_GROUP_ID is not null and RES_GROUP_ID != ''
						and RES_GROUP_ID not in
						<foreach collection="resGroupIds" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="companyTrades != null and companyTrades.size() > 0 and companyTradeMatch != null">
				<choose>
					<when test="companyTradeMatch == 0">
						and company_trade in
						<foreach collection="companyTrades" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="companyTradeMatch == 1">
						and company_trade is not null and company_trade != ''
						and company_trade not in
						<foreach collection="companyTrades" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test=" importDeptIds != null and importDeptIds.size() > 0 and importDeptMatch != null">
				<choose>
					<when test="importDeptMatch == 0">
						and import_dept_id in
						<foreach collection="importDeptIds" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="importDeptMatch == 1">
						and import_dept_id is not null and import_dept_id != ''
						and import_dept_id not in
						<foreach collection="importDeptIds" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="sources != null and sources.size() > 0 and sourceMatch != null">
				<choose>
					<when test="sourceMatch == 0">
						and source in
						<foreach collection="sources" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="sourceMatch == 1">
						and source is not null and source != ''
						and source not in
						<foreach collection="sources" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="opreateTypes != null and opreateTypes.size() > 0 and opreateTypeMatch != null">
				<choose>
					<when test="opreateTypeMatch == 0">
						and STATUS = 4
						and OPREATE_TYPE in
						<foreach collection="opreateTypes" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="opreateTypeMatch == 1">
						and STATUS = 4
						and OPREATE_TYPE is not null and OPREATE_TYPE != ''
						and OPREATE_TYPE not in
						<foreach collection="opreateTypes" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="areaMatch != null">
				<choose>
					<when test="areaMatch == 0">
						<if test="provinceId != null and provinceId != ''">
							and province_id = #{provinceId}
						</if>		
						<if test="cityId != null and cityId != ''">
							and city_id = #{cityId}
						</if>	
						<if test="countyId != null and countyId != ''">
							and county_id = #{countyId}
						</if>				
					</when>
					<when test="areaMatch == 1">
						<choose>
							<when test="countyId != null and countyId != ''">
								and county_id is not null
								and county_id != #{countyId}
							</when>
							<otherwise>
								<choose>
									<when test="cityId != null and cityId != ''">
										and city_id is not null
										and city_id != #{cityId}
									</when>
									<otherwise>
										<choose>
											<when test="provinceId != null and provinceId != ''">
												and province_id is not null
												and province_id != #{provinceId}
											</when>	
										</choose>
									</otherwise>
								</choose>
							</otherwise>
						</choose>	
					</when>
				</choose>
			</if>
			<!-- 上次联系时间 -->
			<if test=" actionDateStart != null and actionDateStart !='' ">
				AND ACTION_DATE >=
				str_to_date(concat(#{actionDateStart,jdbcType=VARCHAR},
				'00:00:00'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<if test=" actionDateEnd != null and actionDateEnd !='' ">
				AND ACTION_DATE <![CDATA[ <= ]]>
				str_to_date(concat(#{actionDateEnd,jdbcType=VARCHAR},
				'23:59:59'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<!-- 下次联系时间 -->
			<if test=" nextFollowDateStart != null and nextFollowDateStart !='' ">
				AND NEXTFOLLOW_DATE >=
				str_to_date(concat(#{nextFollowDateStart,jdbcType=VARCHAR},
				'00:00:00'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<if test=" nextFollowDateEnd != null and nextFollowDateEnd !='' ">
				AND NEXTFOLLOW_DATE <![CDATA[ <= ]]>
				str_to_date(concat(#{nextFollowDateEnd,jdbcType=VARCHAR},
				'23:59:59'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<!-- 淘到客户时间 -->
			<if test=" amoytocustomerDateStart != null and amoytocustomerDateStart !='' ">
				AND AMOYTOCUSTOMER_DATE >=
				str_to_date(concat(#{amoytocustomerDateStart,jdbcType=VARCHAR},
				'00:00:00'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<if test=" amoytocustomerDateEnd != null and amoytocustomerDateEnd !='' ">
				AND AMOYTOCUSTOMER_DATE <![CDATA[ <= ]]>
				str_to_date(concat(#{amoytocustomerDateEnd,jdbcType=VARCHAR},
				'23:59:59'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<!-- 创建时间 -->
			<if test=" inputDateStart != null and inputDateStart !='' ">
				AND INPUT_DATE >=
				str_to_date(concat(#{inputDateStart,jdbcType=VARCHAR},
				'00:00:00'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<if test=" inputDateEnd != null and inputDateEnd !='' ">
				AND INPUT_DATE <![CDATA[ <= ]]>
				str_to_date(concat(#{inputDateEnd,jdbcType=VARCHAR},
				'23:59:59'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<!-- 签约时间 -->
			<if test=" signDateStart != null and signDateStart !='' ">
				AND SIGN_DATE >=
				str_to_date(concat(#{signDateStart,jdbcType=VARCHAR},
				'00:00:00'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<if test=" signDateEnd != null and signDateEnd !='' ">
				AND SIGN_DATE <![CDATA[ <= ]]>
				str_to_date(concat(#{signDateEnd,jdbcType=VARCHAR},
				'23:59:59'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<!-- 分配时间 -->
			<if test=" ownerStartDateStart != null and ownerStartDateStart !='' ">
				AND OWNER_START_DATE >=
				str_to_date(concat(#{ownerStartDateStart,jdbcType=VARCHAR},
				'00:00:00'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<if test=" ownerStartDateEnd != null and ownerStartDateEnd !='' ">
				AND OWNER_START_DATE <![CDATA[ <= ]]>
				str_to_date(concat(#{ownerStartDateEnd,jdbcType=VARCHAR},
				'23:59:59'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<if test="defined1s != null and defined1s.size() > 0 and defined1Match != null">
				<choose>
					<when test="defined1Match == 0">
						and defined1 in
						<foreach collection="defined1s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined1Match == 1">
						and defined1 is not null and defined1 != ''
						and defined1 not in
						<foreach collection="defined1s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined2s != null and defined2s.size() > 0 and defined2Match != null">
				<choose>
					<when test="defined2Match == 0">
						AND defined2 in
						<foreach collection="defined2s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined2Match == 1">
						and defined2 is not null and defined2 != ''
						AND defined2 not in
						<foreach collection="defined2s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined3s != null and defined3s.size() > 0 and defined3Match != null">
				<choose>
					<when test="defined3Match == 0">
						AND defined3 in
						<foreach collection="defined3s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined3Match == 1">
						and defined3 is not null and defined3 != ''
						AND defined3 not in
						<foreach collection="defined3s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined4s != null and defined4s.size() > 0 and defined4Match != null">
				<choose>
					<when test="defined4Match == 0">
						AND defined4 in
						<foreach collection="defined4s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined4Match == 1">
						and defined4 is not null and defined4 != ''
						AND defined4 not in
						<foreach collection="defined4s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined5s != null and defined5s.size() > 0 and defined5Match != null">
				<choose>
					<when test="defined5Match == 0">
						AND defined5 in
						<foreach collection="defined5s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined5Match == 1">
						and defined5 is not null and defined5 != ''
						AND defined5 not in
						<foreach collection="defined5s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined6s != null and defined6s.size() > 0 and defined6Match != null">
				<choose>
					<when test="defined6Match == 0">
						AND defined6 in
						<foreach collection="defined6s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined6Match == 1">
						and defined6 is not null and defined6 != ''
						AND defined6 not in
						<foreach collection="defined6s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined7s != null and defined7s.size() > 0 and defined7Match != null">
				<choose>
					<when test="defined7Match == 0">
						AND defined7 in
						<foreach collection="defined7s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined7Match == 1">
						and defined7 is not null and defined7 != ''
						AND defined7 not in
						<foreach collection="defined7s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined8s != null and defined8s.size() > 0 and defined8Match != null">
				<choose>
					<when test="defined8Match == 0">
						AND defined8 in
						<foreach collection="defined8s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined8Match == 1">
						and defined8 is not null and defined8 != ''
						AND defined8 not in
						<foreach collection="defined8s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined9s != null and defined9s.size() > 0 and defined9Match != null">
				<choose>
					<when test="defined9Match == 0">
						AND defined9 in
						<foreach collection="defined9s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined9Match == 1">
						and defined9 is not null and defined9 != ''
						AND defined9 not in
						<foreach collection="defined9s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined10s != null and defined10s.size() > 0 and defined10Match != null">
				<choose>
					<when test="defined10Match == 0">
						AND defined10 in
						<foreach collection="defined10s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined10Match == 1">
						and defined10 is not null and defined10 != ''
						AND defined10 not in
						<foreach collection="defined10s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined11s != null and defined11s.size() > 0 and defined11Match != null">
				<choose>
					<when test="defined11Match == 0">
						AND defined11 in
						<foreach collection="defined11s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined11Match == 1">
						and defined11 is not null and defined11 != ''
						AND defined11 not in
						<foreach collection="defined11s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined12s != null and defined12s.size() > 0 and defined12Match != null">
				<choose>
					<when test="defined12Match == 0">
						AND defined12 in
						<foreach collection="defined12s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined12Match == 1">
						and defined12 is not null and defined12 != ''
						AND defined12 not in
						<foreach collection="defined12s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined13s != null and defined13s.size() > 0 and defined13Match != null">
				<choose>
					<when test="defined13Match == 0">
						AND defined13 in
						<foreach collection="defined13s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined13Match == 1">
						and defined13 is not null and defined13 != ''
						AND defined13 not in
						<foreach collection="defined13s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined14s != null and defined14s.size() > 0 and defined14Match != null">
				<choose>
					<when test="defined14Match == 0">
						AND defined14 in
						<foreach collection="defined14s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined14Match == 1">
						and defined14 is not null and defined14 != ''
						AND defined14 not in
						<foreach collection="defined14s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined15s != null and defined15s.size() > 0 and defined15Match != null">
				<choose>
					<when test="defined15Match == 0">
						AND defined15 in
						<foreach collection="defined15s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined15Match == 1">
						and defined15 is not null and defined15 != ''
						AND defined15 not in
						<foreach collection="defined15s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
		group by singleName1,singleName2
	</select>
	
	<select id="makeCustomReport1" parameterType="com.qftx.tsm.report.dto.ResCustReportDto" resultType="com.qftx.tsm.report.dto.CustomReportSingleDto">
		select 
			<if test="groupByType1 != null and groupByType1 != ''">
				<choose>
					<when test="groupByType1 == 'qStatus'">
						case 
							when (type=1 and status = 1) then 1 
							<choose>
								<when test="qStatusMatch != null">
									<choose>
										<when test="qStatusMatch == 0">
											<if test="qStatusMap.containsKey(2)">
												when (type=1 and (status = 2 or status = 3)) then 2
											</if>
											<if test="qStatusMap.containsKey(3)">
												when (type=2 and (status = 2 or status = 3)) then 3
											</if>
										</when>
										<when test="qStatusMatch == 1">
											<if test="!qStatusMap.containsKey(2)">
												when (type=1 and (status = 2 or status = 3)) then 2
											</if>
											<if test="!qStatusMap.containsKey(3)">
												when (type=2 and (status = 2 or status = 3)) then 3
											</if>
										</when>
									</choose>
								</when>
								<otherwise>
									when (type=1 and (status = 2 or status = 3)) then 2
									when (type=2 and (status = 2 or status = 3)) then 3
								</otherwise>
							</choose>
							<!-- <if test="qStatusMatch != null">
								<choose>
									<when test="qStatusMatch == 0">
										<if test="qStatusMap.containsKey(2)">
											when (type=1 and (status = 2 or status = 3)) then 2
										</if>
										<if test="qStatusMap.containsKey(3)">
											when (type=2 and (status = 2 or status = 3)) then 3
										</if>
									</when>
									<when test="qStatusMatch == 1">
										<if test="!qStatusMap.containsKey(2)">
											when (type=1 and (status = 2 or status = 3)) then 2
										</if>
										<if test="!qStatusMap.containsKey(3)">
											when (type=2 and (status = 2 or status = 3)) then 3
										</if>
									</when>
								</choose>
							</if> -->
							when (type=2 and status = 6) then 4
							when (type=2 and status = 8) then 5
							when (type=2 and status = 7) then 6
							when (status = 4 or status = 5) then 7
							end as singleName,
					</when>
					<when test="groupByType1 == 'last_cust_type_id'">
						last_cust_type_id as singleName,
					</when>
					<when test="groupByType1 == 'last_option_Id'">
						last_option_Id as singleName,
					</when>
					<when test="groupByType1 == 'import_dept_id'">
						import_dept_id as singleName,
					</when>
					<when test="groupByType1 == 'res_group_id'">
						res_group_id as singleName,
					</when>
					<when test="groupByType1 == 'company_trade'">
						company_trade as singleName,
					</when>
					<when test="groupByType1 == 'opreate_type'">
						opreate_type as singleName,
					</when>
					<when test="groupByType1 == 'defined1'">
						defined1 as singleName,
					</when>
					<when test="groupByType1 == 'defined2'">
						defined2 as singleName,
					</when>
					<when test="groupByType1 == 'defined3'">
						defined3 as singleName,
					</when>
					<when test="groupByType1 == 'defined4'">
						defined4 as singleName,
					</when>
					<when test="groupByType1 == 'defined5'">
						defined5 as singleName,
					</when>
					<when test="groupByType1 == 'defined6'">
						defined6 as singleName,
					</when>
					<when test="groupByType1 == 'defined7'">
						defined7 as singleName,
					</when>
					<when test="groupByType1 == 'defined8'">
						defined8 as singleName,
					</when>
					<when test="groupByType1 == 'defined9'">
						defined9 as singleName,
					</when>
					<when test="groupByType1 == 'defined10'">
						defined10 as singleName,
					</when>
					<when test="groupByType1 == 'defined11'">
						defined12 as singleName,
					</when>
					<when test="groupByType1 == 'defined12'">
						defined12 as singleName,
					</when>
					<when test="groupByType1 == 'defined13'">
						defined13 as singleName,
					</when>
					<when test="groupByType1 == 'defined14'">
						defined14 as singleName,
					</when>
					<when test="groupByType1 == 'defined15'">
						defined15 as singleName,
					</when>
				</choose>
			</if>
			count(1) as count
		from tsm_res_cust_info
		where org_id = #{orgId}
			and is_del = 0
			<if test="groupByType1 == 'opreate_type'">
				and status = 4
			</if>
			<if test="custIds != null and custIds.size() > 0">
		   		AND RES_CUST_ID IN 
		   			<foreach collection="custIds" item="cid" open="(" separator="," close=")">
		   				#{cid}
		   			</foreach>
		   	</if>
			<if test="custTypeIds != null and custTypeIds.size() > 0 and custTypeMatch != null">
				<choose>
					<when test="custTypeMatch == 0">
						AND last_cust_type_id in 
						<foreach collection="custTypeIds" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="custTypeMatch == 1">
						AND last_cust_type_id is not null AND last_cust_type_id != ''
						AND last_cust_type_id not in 
						<foreach collection="custTypeIds" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test=" qStatus != null and qStatus != '' and qStatusMatch != null">
				<choose>
					<when test="qStatusMatch == 0">
						<if test="types != null and types.size() > 0 ">
							and type in
							<foreach collection="types" index="index" item="item" open="(" separator="," close=")">
								#{item}
							</foreach>
						</if>
						<if test="statuss != null and statuss.size() > 0 ">
							and status in
							<foreach collection="statuss" index="index" item="item" open="(" separator="," close=")">
								#{item}
							</foreach>
						</if>
					</when>
					<when test="qStatusMatch == 1">
						<if test="types != null and types.size() > 0 ">
							and type in
							<foreach collection="types" index="index" item="item" open="(" separator="," close=")">
								#{item}
							</foreach>
						</if>
						<choose>
							<when test="statuss != null and statuss.size() > 0">
								and status in
								<foreach collection="statuss" index="index" item="item" open="(" separator="," close=")">
									#{item}
								</foreach>
							</when>
							<otherwise>
								and status not in (1,2,3,4,6,7,8)
							</otherwise>
						</choose>
					</when>
				</choose>
			</if>
			<if test=" optionlistIds != null and optionlistIds.size() > 0  and optionlistMatch != null">
				<choose>
					<when test="optionlistMatch == 0">
						AND last_option_Id in 
						<foreach collection="optionlistIds" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="optionlistMatch == 1">
						AND last_option_Id is not null AND last_option_Id != ''
						AND last_option_Id not in 
						<foreach collection="optionlistIds" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test=" ownerAccs != null and ownerAccs.size() > 0 and ownerAccMatch != null">
				<choose>
					<when test="ownerAccMatch == 0">
						and OWNER_ACC in
						<foreach collection="ownerAccs" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="ownerAccMatch == 1">
						and OWNER_ACC is not null and OWNER_ACC != ''
						and OWNER_ACC not in 
						<foreach collection="ownerAccs" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="resGroupIds != null and resGroupIds.size() > 0 and resGroupMatch != null">
				<choose>
					<when test="resGroupMatch == 0">
						and RES_GROUP_ID in
						<foreach collection="resGroupIds" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="resGroupMatch == 1">
						and RES_GROUP_ID is not null and RES_GROUP_ID != ''
						and RES_GROUP_ID not in
						<foreach collection="resGroupIds" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="companyTrades != null and companyTrades.size() > 0 and companyTradeMatch != null">
				<choose>
					<when test="companyTradeMatch == 0">
						and company_trade in
						<foreach collection="companyTrades" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="companyTradeMatch == 1">
						and company_trade is not null and company_trade != ''
						and company_trade not in
						<foreach collection="companyTrades" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test=" importDeptIds != null and importDeptIds.size() > 0 and importDeptMatch != null">
				<choose>
					<when test="importDeptMatch == 0">
						and import_dept_id in
						<foreach collection="importDeptIds" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="importDeptMatch == 1">
						and import_dept_id is not null and import_dept_id != ''
						and import_dept_id not in
						<foreach collection="importDeptIds" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="sources != null and sources.size() > 0 and sourceMatch != null">
				<choose>
					<when test="sourceMatch == 0">
						and source in
						<foreach collection="sources" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="sourceMatch == 1">
						and source is not null and source != ''
						and source not in
						<foreach collection="sources" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="opreateTypes != null and opreateTypes.size() > 0 and opreateTypeMatch != null">
				<choose>
					<when test="opreateTypeMatch == 0">
						and STATUS = 4
						and OPREATE_TYPE in
						<foreach collection="opreateTypes" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="opreateTypeMatch == 1">
						and STATUS = 4
						and OPREATE_TYPE is not null and OPREATE_TYPE != ''
						and OPREATE_TYPE not in
						<foreach collection="opreateTypes" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="areaMatch != null">
				<choose>
					<when test="areaMatch == 0">
						<if test="provinceId != null and provinceId != ''">
							and province_id = #{provinceId}
						</if>		
						<if test="cityId != null and cityId != ''">
							and city_id = #{cityId}
						</if>	
						<if test="countyId != null and countyId != ''">
							and county_id = #{countyId}
						</if>				
					</when>
					<when test="areaMatch == 1">
						<choose>
							<when test="countyId != null and countyId != ''">
								and county_id is not null
								and county_id != #{countyId}
							</when>
							<otherwise>
								<choose>
									<when test="cityId != null and cityId != ''">
										and city_id is not null
										and city_id != #{cityId}
									</when>
									<otherwise>
										<choose>
											<when test="provinceId != null and provinceId != ''">
												and province_id is not null
												and province_id != #{provinceId}
											</when>	
										</choose>
									</otherwise>
								</choose>
							</otherwise>
						</choose>	
					</when>
				</choose>
			</if>
			<!-- 上次联系时间 -->
			<if test=" actionDateStart != null and actionDateStart !='' ">
				AND ACTION_DATE >=
				str_to_date(concat(#{actionDateStart,jdbcType=VARCHAR},
				'00:00:00'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<if test=" actionDateEnd != null and actionDateEnd !='' ">
				AND ACTION_DATE <![CDATA[ <= ]]>
				str_to_date(concat(#{actionDateEnd,jdbcType=VARCHAR},
				'23:59:59'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<!-- 下次联系时间 -->
			<if test=" nextFollowDateStart != null and nextFollowDateStart !='' ">
				AND NEXTFOLLOW_DATE >=
				str_to_date(concat(#{nextFollowDateStart,jdbcType=VARCHAR},
				'00:00:00'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<if test=" nextFollowDateEnd != null and nextFollowDateEnd !='' ">
				AND NEXTFOLLOW_DATE <![CDATA[ <= ]]>
				str_to_date(concat(#{nextFollowDateEnd,jdbcType=VARCHAR},
				'23:59:59'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<!-- 淘到客户时间 -->
			<if test=" amoytocustomerDateStart != null and amoytocustomerDateStart !='' ">
				AND AMOYTOCUSTOMER_DATE >=
				str_to_date(concat(#{amoytocustomerDateStart,jdbcType=VARCHAR},
				'00:00:00'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<if test=" amoytocustomerDateEnd != null and amoytocustomerDateEnd !='' ">
				AND AMOYTOCUSTOMER_DATE <![CDATA[ <= ]]>
				str_to_date(concat(#{amoytocustomerDateEnd,jdbcType=VARCHAR},
				'23:59:59'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<!-- 创建时间 -->
			<if test=" inputDateStart != null and inputDateStart !='' ">
				AND INPUT_DATE >=
				str_to_date(concat(#{inputDateStart,jdbcType=VARCHAR},
				'00:00:00'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<if test=" inputDateEnd != null and inputDateEnd !='' ">
				AND INPUT_DATE <![CDATA[ <= ]]>
				str_to_date(concat(#{inputDateEnd,jdbcType=VARCHAR},
				'23:59:59'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<!-- 签约时间 -->
			<if test=" signDateStart != null and signDateStart !='' ">
				AND SIGN_DATE >=
				str_to_date(concat(#{signDateStart,jdbcType=VARCHAR},
				'00:00:00'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<if test=" signDateEnd != null and signDateEnd !='' ">
				AND SIGN_DATE <![CDATA[ <= ]]>
				str_to_date(concat(#{signDateEnd,jdbcType=VARCHAR},
				'23:59:59'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<!-- 分配时间 -->
			<if test=" ownerStartDateStart != null and ownerStartDateStart !='' ">
				AND OWNER_START_DATE >=
				str_to_date(concat(#{ownerStartDateStart,jdbcType=VARCHAR},
				'00:00:00'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<if test=" ownerStartDateEnd != null and ownerStartDateEnd !='' ">
				AND OWNER_START_DATE <![CDATA[ <= ]]>
				str_to_date(concat(#{ownerStartDateEnd,jdbcType=VARCHAR},
				'23:59:59'),
				'%Y-%m-%d %H:%i:%s')
			</if>
			<if test="defined1s != null and defined1s.size() > 0 and defined1Match != null">
				<choose>
					<when test="defined1Match == 0">
						and defined1 in
						<foreach collection="defined1s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined1Match == 1">
						and defined1 is not null and defined1 != ''
						and defined1 not in
						<foreach collection="defined1s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined2s != null and defined2s.size() > 0 and defined2Match != null">
				<choose>
					<when test="defined2Match == 0">
						AND defined2 in
						<foreach collection="defined2s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined2Match == 1">
						and defined2 is not null and defined2 != ''
						AND defined2 not in
						<foreach collection="defined2s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined3s != null and defined3s.size() > 0 and defined3Match != null">
				<choose>
					<when test="defined3Match == 0">
						AND defined3 in
						<foreach collection="defined3s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined3Match == 1">
						and defined3 is not null and defined3 != ''
						AND defined3 not in
						<foreach collection="defined3s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined4s != null and defined4s.size() > 0 and defined4Match != null">
				<choose>
					<when test="defined4Match == 0">
						AND defined4 in
						<foreach collection="defined4s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined4Match == 1">
						and defined4 is not null and defined4 != ''
						AND defined4 not in
						<foreach collection="defined4s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined5s != null and defined5s.size() > 0 and defined5Match != null">
				<choose>
					<when test="defined5Match == 0">
						AND defined5 in
						<foreach collection="defined5s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined5Match == 1">
						and defined5 is not null and defined5 != ''
						AND defined5 not in
						<foreach collection="defined5s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined6s != null and defined6s.size() > 0 and defined6Match != null">
				<choose>
					<when test="defined6Match == 0">
						AND defined6 in
						<foreach collection="defined6s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined6Match == 1">
						and defined6 is not null and defined6 != ''
						AND defined6 not in
						<foreach collection="defined6s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined7s != null and defined7s.size() > 0 and defined7Match != null">
				<choose>
					<when test="defined7Match == 0">
						AND defined7 in
						<foreach collection="defined7s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined7Match == 1">
						and defined7 is not null and defined7 != ''
						AND defined7 not in
						<foreach collection="defined7s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined8s != null and defined8s.size() > 0 and defined8Match != null">
				<choose>
					<when test="defined8Match == 0">
						AND defined8 in
						<foreach collection="defined8s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined8Match == 1">
						and defined8 is not null and defined8 != ''
						AND defined8 not in
						<foreach collection="defined8s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined9s != null and defined9s.size() > 0 and defined9Match != null">
				<choose>
					<when test="defined9Match == 0">
						AND defined9 in
						<foreach collection="defined9s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined9Match == 1">
						and defined9 is not null and defined9 != ''
						AND defined9 not in
						<foreach collection="defined9s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined10s != null and defined10s.size() > 0 and defined10Match != null">
				<choose>
					<when test="defined10Match == 0">
						AND defined10 in
						<foreach collection="defined10s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined10Match == 1">
						and defined10 is not null and defined10 != ''
						AND defined10 not in
						<foreach collection="defined10s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined11s != null and defined11s.size() > 0 and defined11Match != null">
				<choose>
					<when test="defined11Match == 0">
						AND defined11 in
						<foreach collection="defined11s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined11Match == 1">
						and defined11 is not null and defined11 != ''
						AND defined11 not in
						<foreach collection="defined11s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined12s != null and defined12s.size() > 0 and defined12Match != null">
				<choose>
					<when test="defined12Match == 0">
						AND defined12 in
						<foreach collection="defined12s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined12Match == 1">
						and defined12 is not null and defined12 != ''
						AND defined12 not in
						<foreach collection="defined12s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined13s != null and defined13s.size() > 0 and defined13Match != null">
				<choose>
					<when test="defined13Match == 0">
						AND defined13 in
						<foreach collection="defined13s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined13Match == 1">
						and defined13 is not null and defined13 != ''
						AND defined13 not in
						<foreach collection="defined13s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined14s != null and defined14s.size() > 0 and defined14Match != null">
				<choose>
					<when test="defined14Match == 0">
						AND defined14 in
						<foreach collection="defined14s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined14Match == 1">
						and defined14 is not null and defined14 != ''
						AND defined14 not in
						<foreach collection="defined14s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
			<if test="defined15s != null and defined15s.size() > 0 and defined15Match != null">
				<choose>
					<when test="defined15Match == 0">
						AND defined15 in
						<foreach collection="defined15s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
					<when test="defined15Match == 1">
						and defined15 is not null and defined15 != ''
						AND defined15 not in
						<foreach collection="defined15s" index="index" item="item" open="(" separator="," close=")">
							#{item}
						</foreach>
					</when>
				</choose>
			</if>
		group by singleName
	</select>
	
	
		<select id="findAllTypeCustByOrgId" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		  		SELECT 
					T1.ORG_ID,
					T1.NAME,
					T1.RES_CUST_ID,
					T1.COMPANY,
					T1.COMPANY_ADDR,
					T1.QQ,
					T1.address,
					T1.OWNER_ACC,
					T1.MOBILEPHONE,
					T1.TELPHONE,
					T1.TYPE,
					T1.`STATUS`,
					T1.MAIN_LINKMAN
				 FROM TSM_RES_CUST_INFO T1
		  		WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
				AND T1.IS_DEL = 0 
				LIMIT #{min,jdbcType=DECIMAL},#{max,jdbcType=DECIMAL}  
	</select>
	
			<select id="findAllTypeCustByCount" parameterType="String" resultType="Integer">
		  		SELECT 
	             COUNT(1)
				 FROM TSM_RES_CUST_INFO T1
		  		WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
				AND T1.IS_DEL = 0 
	</select>
	
	
		<select id="findAllByCustIds" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="BaseResultMap">
               SELECT
	  		   T1.NAME,
		       T1.RES_CUST_ID,
		       T1.COMPANY,
		       T1.OWNER_ACC,
		       T1.STATUS,
		       T1.TYPE,
		       T1.RES_GROUP_ID,
		       T1.MAIN_LINKMAN
		FROM TSM_RES_CUST_INFO T1
		  	WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
			    AND T1.IS_DEL = 0 
			   <if test="ids != null and ids.size() > 0">
			   		AND T1.RES_CUST_ID IN 
			   			<foreach collection="ids" item="cid" open="(" separator="," close=")">
			   				#{cid}
			   			</foreach>
			   </if>
	</select>
	
	<!-- 趣牌 -->
	<select id="findQupaiSignCustListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		SELECT T.NAME,
		       T.RES_CUST_ID,
		       T.RES_GROUP_ID,
		       T.COMPANY,
		       T.OWNER_ACC,
		       T.STATUS,
		       T.TYPE,
		       T.OWNER_START_DATE,
		       T.MOBILEPHONE,
		       T.TELPHONE,
		       T.ALTERNATE_PHONE2,
		       T.IS_MAJOR,
		       T.ACTION_DATE,
		       T.NEXTFOLLOW_DATE,
		       T.SIGN_ACC,
		       T.SIGN_DATE,
		       T.LAST_CUST_TYPE_ID AS CUST_TYPE_ID,
		       <if test="!queryContract">IFNULL(CM.MONEY,0) AS TOTAL_ORDER_AMOUNT,</if>
		       <if test="queryContract"> TD.CONTRACT_END_DATE,</if>
		       T.MAIN_LINKMAN,
		       T.COMMON_ACC,
		       T.DEFINED1,
		       T.DEFINED2,
		       T.DEFINED3,
		       T.DEFINED4,
		       T.DEFINED5,
		       T.DEFINED6,
		       T.DEFINED7,
		       T.DEFINED8,
		       T.DEFINED9,
		       T.DEFINED10,
		       T.DEFINED11,
		       T.DEFINED12,
		       T.DEFINED13,
		       T.DEFINED14,
		       T.DEFINED15, 
       	       T.DEFINED16, 
               T.DEFINED17, 
               T.DEFINED18,
               T.IMPORT_DEPT_ID,
               T.COMPANY_MONEY,
               T.COMPANY_USER,
               T.COMPANY_FAX,
               T.PROVINCE_ID,
               T.CITY_ID,
               T.COUNTY_ID,
               T.KEYWORD,
               T.COMPANY_TRADE,
               T.SERVICE_ACC,
               T.SOURCE,
               	T.ORG_ID,
				T.BIRTHDAY,
				T.DUTY,
				T.SEX,
				T.COMPANY_ADDR,
				T.COMPANY_ORG,
				T.REMARK,
				T.RES_LAST_CALL_DATE,
				T.INPUT_DATE,
				T.INPUT_ACC,
				T.UPDATE_DATE,
				T.UPDATE_ACC,
				T.INPUT_STATUS,
				T.FILTER_COUNT,
				T.OPREATE_TYPE,
				T.FILTER_TYPE,
				T.COORDINATES,
				T.FAX,
				T.EMAIL,
				T.UNITHOME,
				T.UNITINTRODUCTION,
				T.AMOYTOCUSTOMER_DATE,
				T.EFFECTIVE_FOLLOWUP_DATE,
				T.FOLLOWUP_DATE,
				T.QQ,
				T.CONTRACT_NUMBER,
				T.SIGN_NAME,
				T.CALL_DATE_POSTPONED,
				T.REASON_FOR_CALLDELAY,
				T.RECUCLING_TYPE_DETAILS,
				T.AGAINWASH_COUNT,
				T.LAST_CUST_FOLLOW_ID,
				T.SERVICE_NAME,
				T.SERVICE_LEVEL,
				T.VISITING_DATE,
				T.NEXT_VISITING_DATE,
				T.SERVICE_LABEL_CODE,
				T.SERVICE_LABEL_NAME,
				T.IS_PRECEDENCE,
				T.FOR_THE_CUSTOMER_TIME,
				T.LAST_VISIT_ACC,
				T.IS_DEL,
				T.plan_date,
				T.address,
				T.state,
				T.losing_id,
				T.losing_remark,
				T.last_log_id,
				T.is_concat,
				T.wangwang,
				T.scope,
				T.tao_no,
				T.SIGN_BEFORE_STATUS,
				T.SIGN_BEFORE_TYPE,
				T.life_code,
				T.last_Option_Id,
				T.last_cust_type_id,
				T.last_Loss_Date,
				T.LABEL_CODE,
				T.LABEL_NAME,
				T.service_assign_type,
				T.service_assign_date,
				T.service_assign_groups,
				T.OWNER_ACTION_DATE        
		  FROM (
		  	<include refid="findSignCustSql" />
       		<if test="queryText != null and queryText != ''">
	       		<choose>
	       			<when test='queryType != null and queryType == "custName"'>
	       				AND T1.NAME LIKE CONCAT('%',#{queryText},'%') 
	       			</when>
	       			<when test='queryType != null and queryType == "mainLinkman"'>
	       				AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{queryText},'%') 
	       			</when>
	       			<when test='queryType != null and queryType == "company"'>
	       				AND T1.COMPANY LIKE CONCAT('%',#{queryText},'%') 
	       			</when>
	       			<otherwise>
	       				AND T1.${queryType} LIKE CONCAT('%',#{queryText},'%') 
	       			</otherwise>
	       		</choose>
	       </if>
		  ) T 
	      <if test="!queryContract">LEFT JOIN (SELECT CM1.MONEY,CM1.CUST_ID FROM CONTRACT_MONEY CM1 WHERE CM1.ORG_ID=#{orgId}) CM 
			ON T.RES_CUST_ID = CM.CUST_ID 
		</if>
		 <if test="queryContract"> 			
			LEFT JOIN (SELECT CT.CUST_ID,MAX(CT.INVALID_DATE) AS CONTRACT_END_DATE FROM CONTRACT CT 
		  	WHERE CT.ORG_ID = #{orgId,jdbcType=VARCHAR}  AND CT.IS_DEL = 0 
		  	and CT.sign_userid = #{ownerAcc,jdbcType=VARCHAR} 
		  	<!-- 查询结果排除ids-->
	       <if test="rejectIds != null and rejectIds.size()>0">
	       		<foreach collection="rejectIds" item="id">
	       			and CT.cust_id !=#{id}
	       		</foreach>
	       </if>
		  	GROUP BY CT.CUST_ID) TD on T.RES_CUST_ID = TD.CUST_ID 
		  	WHERE 1=1 
	       <if test="startContractEndDate != null and startContractEndDate != ''"> AND TD.CONTRACT_END_DATE &gt;= STR_TO_DATE(CONCAT(#{startContractEndDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s') </if>
	       <if test="endContractEndDate != null and endContractEndDate != ''"> AND TD.CONTRACT_END_DATE &lt;= STR_TO_DATE(CONCAT(#{endContractEndDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s') </if>
       </if>
	      <if test="orderKey != null and orderKey != ''">
			   ORDER BY ${orderKey } 
		   </if>
	</select>
	
	<select id="findQupaiSignCustPhoneListPage" parameterType="com.qftx.tsm.cust.dto.ResCustInfoDto" resultMap="DtoResultMap">
		SELECT T.NAME,
		       T.RES_CUST_ID,
		       T.RES_GROUP_ID,
		       T.COMPANY,
		       T.OWNER_ACC,
		       T.STATUS,
		       T.TYPE,
		       T.OWNER_START_DATE,
		       T.MOBILEPHONE,
		       T.TELPHONE,
		       T.ALTERNATE_PHONE2,
		       T.IS_MAJOR,
		       T.ACTION_DATE,
		       T.NEXTFOLLOW_DATE,
		       T.SIGN_ACC,
		       T.SIGN_DATE,
		       T.LAST_CUST_TYPE_ID AS CUST_TYPE_ID,
		       <if test="!queryContract">IFNULL(CM.MONEY,0) AS TOTAL_ORDER_AMOUNT,</if>
		       <if test="queryContract"> TD.CONTRACT_END_DATE,</if>
		       T.MAIN_LINKMAN,
		       T.COMMON_ACC,
		       T.DEFINED1,
	           T.DEFINED2,
	           T.DEFINED3,
	           T.DEFINED4,
	           T.DEFINED5,
	           T.DEFINED6,
	           T.DEFINED7,
	           T.DEFINED8,
	           T.DEFINED9,
	           T.DEFINED10,
	           T.DEFINED11,
	           T.DEFINED12,
	           T.DEFINED13,
	           T.DEFINED14,
	           T.DEFINED15, 
       	       T.DEFINED16, 
               T.DEFINED17, 
               T.DEFINED18,
               T.IMPORT_DEPT_ID,
               T.COMPANY_MONEY,
               T.COMPANY_USER,
               T.COMPANY_FAX,
               T.PROVINCE_ID,
               T.CITY_ID,
               T.COUNTY_ID,
               T.KEYWORD,
               T.COMPANY_TRADE,
               T.SERVICE_ACC,
               T.SOURCE,
               	T.ORG_ID,
				T.BIRTHDAY,
				T.DUTY,
				T.SEX,
				T.COMPANY_ADDR,
				T.COMPANY_ORG,
				T.REMARK,
				T.RES_LAST_CALL_DATE,
				T.INPUT_DATE,
				T.INPUT_ACC,
				T.UPDATE_DATE,
				T.UPDATE_ACC,
				T.INPUT_STATUS,
				T.FILTER_COUNT,
				T.OPREATE_TYPE,
				T.FILTER_TYPE,
				T.COORDINATES,
				T.FAX,
				T.EMAIL,
				T.UNITHOME,
				T.UNITINTRODUCTION,
				T.AMOYTOCUSTOMER_DATE,
				T.EFFECTIVE_FOLLOWUP_DATE,
				T.FOLLOWUP_DATE,
				T.QQ,
				T.CONTRACT_NUMBER,
				T.SIGN_NAME,
				T.CALL_DATE_POSTPONED,
				T.REASON_FOR_CALLDELAY,
				T.RECUCLING_TYPE_DETAILS,
				T.AGAINWASH_COUNT,
				T.LAST_CUST_FOLLOW_ID,
				T.SERVICE_NAME,
				T.SERVICE_LEVEL,
				T.VISITING_DATE,
				T.NEXT_VISITING_DATE,
				T.SERVICE_LABEL_CODE,
				T.SERVICE_LABEL_NAME,
				T.IS_PRECEDENCE,
				T.FOR_THE_CUSTOMER_TIME,
				T.LAST_VISIT_ACC,
				T.IS_DEL,
				T.plan_date,
				T.address,
				T.state,
				T.losing_id,
				T.losing_remark,
				T.last_log_id,
				T.is_concat,
				T.wangwang,
				T.scope,
				T.tao_no,
				T.SIGN_BEFORE_STATUS,
				T.SIGN_BEFORE_TYPE,
				T.life_code,
				T.last_Option_Id,
				T.last_cust_type_id,
				T.last_Loss_Date,
				T.LABEL_CODE,
				T.LABEL_NAME,
				T.service_assign_type,
				T.service_assign_date,
				T.service_assign_groups,
				T.OWNER_ACTION_DATE            
		  FROM (
	  			  <include refid="findSignCustSql" />
				    AND T1.MOBILEPHONE = #{queryText} 
			      UNION 
			      <include refid="findSignCustSql" />
				    AND T1.TELPHONE = #{queryText} 
		  ) T 
	      <if test="!queryContract">LEFT JOIN (SELECT CM1.MONEY,CM1.CUST_ID FROM CONTRACT_MONEY CM1 WHERE CM1.ORG_ID=#{orgId}) CM 
			ON T.RES_CUST_ID = CM.CUST_ID 
		</if>
		 <if test="queryContract"> 			
			LEFT JOIN (SELECT CT.CUST_ID,MAX(CT.INVALID_DATE) AS CONTRACT_END_DATE FROM CONTRACT CT 
		  	WHERE CT.ORG_ID = #{orgId,jdbcType=VARCHAR}  AND CT.IS_DEL = 0 
		  	and CT.sign_userid = #{ownerAcc,jdbcType=VARCHAR} 
		  	<!-- 查询结果排除ids-->
	       <if test="rejectIds != null and rejectIds.size()>0">
	       		<foreach collection="rejectIds" item="id">
	       			and CT.cust_id !=#{id}
	       		</foreach>
	       </if>
		  	GROUP BY CT.CUST_ID) TD on T.RES_CUST_ID = TD.CUST_ID 
		  	WHERE 1=1 
	       <if test="startContractEndDate != null and startContractEndDate != ''"> AND TD.CONTRACT_END_DATE &gt;= STR_TO_DATE(CONCAT(#{startContractEndDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s') </if>
	       <if test="endContractEndDate != null and endContractEndDate != ''"> AND TD.CONTRACT_END_DATE &lt;= STR_TO_DATE(CONCAT(#{endContractEndDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s') </if>
       </if>
	       ORDER BY T.SIGN_DATE DESC,T.RES_CUST_ID DESC
	</select>


	<select id="findChooseCount" parameterType="String" resultType="Integer">
			SELECT COUNT(1) FROM tsm_res_cust_info WHERE ORG_ID=#{orgId,jdbcType=VARCHAR}  AND INPUT_STATUS in (1,2,3,4) AND is_del=0
	</select>

	<!-- 根据Id批量修改 -->
	<update id="updateChooseByOrgId" parameterType="String">
		UPDATE tsm_res_cust_info
		SET INPUT_STATUS = 0
		WHERE
			ORG_ID = #{orgId,jdbcType=VARCHAR}
		AND INPUT_STATUS IN (1, 2, 3, 4)
		AND is_del=0
		LIMIT 30000
	</update>

	<!-- 批量删除黄山德通 -->
	<delete id="deleteIsDel" >
		DELETE FROM tsm_res_cust_info WHERE ORG_ID='dttx' AND  IS_DEL='1'  LIMIT 5000
	</delete>

	<!-- 批量删除黄山德通资源明细表 -->
	<delete id="deleteDetail" parameterType="map">
		<if test="idList !=null and idList.size()>0">
			DELETE FROM tsm_res_cust_info_detail WHERE ORG_ID='dttx'
			  AND rci_id in
			<foreach collection="idList" item="id" open="(" separator="," close=")">
				#{id}
			</foreach>
		</if>

	</delete>
	<select id="selectDttxDetailIds" resultType="String" parameterType="Integer">
		SELECT rci_id FROM tsm_res_cust_info_detail WHERE ORG_ID='dttx'  AND is_del='0'  LIMIT #{startVal},#{endVal}
	</select>

	<select id="selectDttxCustIds" resultType="String" parameterType="map">
		SELECT
			RES_CUST_ID
		FROM
			tsm_res_cust_info
		WHERE
		<if test="custIdList !=null and custIdList.size()>0">
			RES_CUST_ID  IN
			<foreach collection="custIdList" item="id" open="(" separator="," close=")">
				#{id}
			</foreach>
		</if>
	</select>
	
	<!-- 淘到客户时间改为交接时间 -->
	<update id="updateAmoytocustomerDate" parameterType="list">
		<foreach collection="list" item="item" index="index" separator=";">
        	UPDATE
			<include refid="table_name" />
			  SET AMOYTOCUSTOMER_DATE = #{item.amoytocustomerDate,jdbcType=TIMESTAMP}
			WHERE ORG_ID = #{item.orgId} 
			  AND RES_CUST_ID = #{item.resCustId}
    	</foreach>
	</update>
</mapper>