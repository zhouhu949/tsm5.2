<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.qftx.tsm.follow.dao.CustFollowMapper">
	<resultMap id="BaseResultMap" type="com.qftx.tsm.follow.bean.CustFollowBean">
		<id column="CUST_FOLLOW_ID" property="custFollowId" jdbcType="VARCHAR" />
		<result column="CUST_ID" property="custId" jdbcType="VARCHAR" />
		<result column="ACTION_TYPE" property="actionType" jdbcType="VARCHAR" />
		<result column="ACTION_DATE" property="actionDate" jdbcType="TIMESTAMP" />
		<result column="FEEDBACK_INFO_ID" property="feedbackInfoId" jdbcType="VARCHAR" />
		<result column="FEEDBACK_COMMENT" property="feedbackComment" jdbcType="VARCHAR" />
		<result column="IS_FOLLOW" property="isFollow" jdbcType="DECIMAL" />
		<result column="FOLLOW_DATE" property="followDate" jdbcType="TIMESTAMP" />
		<result column="FOLLOW_TYPE" property="followType" jdbcType="VARCHAR" />
		<result column="FOLLOW_ACC" property="followAcc" jdbcType="VARCHAR" />
		<result column="INPUT_DATE" property="inputDate" jdbcType="TIMESTAMP" />
		<result column="INPUT_ACC" property="inputAcc" jdbcType="VARCHAR" />
		<result column="ORG_ID" property="orgId" jdbcType="VARCHAR" />
		<result column="SALE_PROCESS_ID" property="saleProcessId" jdbcType="VARCHAR" />
		<result column="LAST_SALE_PROCESS_ID" property="lastSaleProcessId" jdbcType="VARCHAR" />
		<result column="LABEL_CODE" property="labelCode" jdbcType="VARCHAR" />
		<result column="LABEL_NAME" property="labelName" jdbcType="VARCHAR" />
		<result column="effectiveness" property="effectiveness" jdbcType="DECIMAL" />
		<result column="CUST_STATUS" property="custStatus" jdbcType="DECIMAL" />	
		<result column="CUST_DETAIL_NAME" property="custDetailName" jdbcType="VARCHAR" />
		<result column="CUST_DETAIL_MOBLIEPHONE" property="custDetailMobile" jdbcType="VARCHAR" />	
		<result column="CUST_TYPE_ID" property="custTypeId" jdbcType="VARCHAR" />
		<result column="CUST_NAME" property="oldCustName" jdbcType="VARCHAR" />
		<!-- 5.1新增 -->
		<result column="SALE_CHANCE_ID" property="saleChanceId" jdbcType="VARCHAR" />
		<result column="FEEDBACK_IMG" property="feedbackImg" jdbcType="VARCHAR" />
		
	</resultMap>

	<resultMap id="DtoResultMap" type="com.qftx.tsm.follow.dto.CustFollowDto" extends="BaseResultMap">
		<result column="OPTION_NAME" property="optionName" jdbcType="VARCHAR" />
		<result column="OPTIONLIST_ID" property="optionlistId" jdbcType="VARCHAR" />
		<result column="RECORD_URL" property="recordUrl" jdbcType="VARCHAR" />
		<result column="TIME_LENGTH" property="timeLength" jdbcType="DECIMAL" />
		<result column="CALL_ID" property="callId" jdbcType="VARCHAR" />
		<result column="CALL_TYPE" property="callType" jdbcType="DECIMAL" />
		<result column="CALLER_NUM" property="callerNum" jdbcType="VARCHAR" />
		<result column="CALLED_NUM" property="calledNum" jdbcType="VARCHAR" />
		<result column="LAST_OPTION_NAME" property="lastSaleProcess" jdbcType="VARCHAR" />
		<result column="LAST_ACTION_DATE" property="lastActionDate" jdbcType="TIMESTAMP" />
		<result column="NEXT_ACTION_DATE" property="nextActionDate" jdbcType="TIMESTAMP" />
		<result column="MIN_ACTION_DATE" property="minActionDate" jdbcType="TIMESTAMP" />
		<result column="RES_CUST_ID" property="resCustId" jdbcType="VARCHAR" />
		<result column="NAME" property="custName" jdbcType="VARCHAR" />
		<result column="custName" property="name" jdbcType="VARCHAR" />
		<result column="MOBILEPHONE" property="custMobilephone" jdbcType="VARCHAR" />
		<result column="TELPHONE" property="telphone" jdbcType="VARCHAR" />
		<result column="DAYS_AFTER_DATE_COUNT" property="daysAfterDateCount" jdbcType="DECIMAL" />
		<result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
		<result column="STATUS_EXTENDED" property="statusExtended" jdbcType="DECIMAL" />
		<result column="STATUS" property="status" jdbcType="DECIMAL" />
		<result column="COMPANY" property="company" jdbcType="VARCHAR" />
		<result column="GROUP_NAME" property="groupName" jdbcType="VARCHAR" />
		<result column="RES_GROUP_ID" property="groupId" jdbcType="VARCHAR" />
		<result column="OWNER_NAME" property="ownerName" jdbcType="VARCHAR" />
		<result column="IS_MAJOR" property="isMajor" jdbcType="VARCHAR" />
		<result column="DEFINED1" property="defined1" jdbcType="VARCHAR" />
		<result column="DEFINED2" property="defined2" jdbcType="VARCHAR" />
		<result column="DEFINED3" property="defined3" jdbcType="VARCHAR" />
		<result column="DEFINED4" property="defined4" jdbcType="VARCHAR" />
		<result column="DEFINED5" property="defined5" jdbcType="VARCHAR" />
		<result column="DEFINED6" property="defined6" jdbcType="VARCHAR" />
		<result column="DEFINED7" property="defined7" jdbcType="VARCHAR" />
		<result column="DEFINED8" property="defined8" jdbcType="VARCHAR" />
		<result column="DEFINED9" property="defined9" jdbcType="VARCHAR" />
		<result column="DEFINED10" property="defined10" jdbcType="VARCHAR" />
		<result column="DEFINED11" property="defined11" jdbcType="VARCHAR" />
		<result column="DEFINED12" property="defined12" jdbcType="VARCHAR" />
		<result column="DEFINED13" property="defined13" jdbcType="VARCHAR" />
		<result column="DEFINED14" property="defined14" jdbcType="VARCHAR" />
		<result column="DEFINED15" property="defined15" jdbcType="VARCHAR" />
		<result column="DEFINED16" property="defined16" jdbcType="TIMESTAMP" />
		<result column="DEFINED17" property="defined17" jdbcType="TIMESTAMP" />
		<result column="DEFINED18" property="defined18" jdbcType="TIMESTAMP" />
		<result column="COMPANY_MONEY" jdbcType="VARCHAR" property="companyMoney"/>
		<result column="COMPANY_USER" jdbcType="VARCHAR" property="companyUser"/>
		<result column="COMPANY_TRADE" jdbcType="VARCHAR" property="companyTrade"/>
		<result column="COMPANY_FAX" jdbcType="VARCHAR" property="fax"/>
		<result column="KEYWORD" property="keyWord" jdbcType="VARCHAR" />
		<result column="TYPE" property="type" jdbcType="DECIMAL" />
		<result column="MAIN_LINKMAN" property="linkName" jdbcType="VARCHAR" />
		<result column="PROVINCE_ID" property="provinceId" jdbcType="VARCHAR" />
		<result column="CITY_ID" property="cityId" jdbcType="VARCHAR" />
		<result column="COUNTY_ID" property="countyId" jdbcType="VARCHAR" />
		<result column="SOURCE" property="source" jdbcType="DECIMAL" />
	</resultMap>
	
	<!-- 跟进详细页面 右侧待跟进列表 -->
	<resultMap type="com.qftx.tsm.follow.dto.RestDto" id="RestDtoMap">
		<result column="RES_CUST_ID" property="resCustId" jdbcType="VARCHAR" />
		<result column="NAME" property="custName" jdbcType="VARCHAR" />
		<result column="TELPHONE" property="telphone" jdbcType="VARCHAR" />
		<result column="NEXT_ACTION_DATE" property="nextActionDate" jdbcType="TIMESTAMP" />
		<result column="DAYS_AFTER_DATE_COUNT" property="daysAfterDateCount" jdbcType="DECIMAL" />
		<result column="ACTION_DATE" property="actionDate" jdbcType="TIMESTAMP" />
		<result column="AMOYTOCUSTOMER_DATE" property="amoyToCustomrDate" jdbcType="TIMESTAMP" />
	</resultMap>
	
	<!-- 实体表名 -->
	<sql id="table_name">TSM_CUST_FOLLOW</sql>

	<!-- 实体条件查询组装 -->
	<sql id="entity_condition_orderby">
		<if test="custFollowId != null and custFollowId !=''">
			and CUST_FOLLOW_ID = #{custFollowId,jdbcType=VARCHAR}
		</if>
		<if test="custId != null and custId !=''">
			and CUST_ID = #{custId,jdbcType=VARCHAR}
		</if>
		<if test="actionType != null and actionType !=''">
			and ACTION_TYPE = #{actionType,jdbcType=VARCHAR}
		</if>
		<if test="actionDate != null ">
			and ACTION_DATE = #{actionDate,jdbcType=TIMESTAMP}
		</if>
		<if test="feedbackInfoId != null and feedbackInfoId !=''">
			and FEEDBACK_INFO_ID = #{feedbackInfoId,jdbcType=VARCHAR}
		</if>
		<if test="feedbackComment != null and feedbackComment !=''">
			and FEEDBACK_COMMENT = #{feedbackComment,jdbcType=VARCHAR}
		</if>
		<if test="isFollow != null">
			and IS_FOLLOW = #{isFollow,jdbcType=DECIMAL}
		</if>
		<if test="followDate != null">
			and FOLLOW_DATE = #{followDate,jdbcType=TIMESTAMP}
		</if>
		<if test="followType != null">
			and FOLLOW_TYPE = #{followType,jdbcType=VARCHAR}
		</if>
		<if test="followAcc != null and followAcc !=''">
			and FOLLOW_ACC = #{followAcc,jdbcType=VARCHAR}
		</if>
		<if test="inputDate != null">
			and INPUT_DATE = #{inputDate,jdbcType=TIMESTAMP}
		</if>
		<if test="inputAcc != null and inputAcc !=''">
			and INPUT_ACC = #{inputAcc,jdbcType=VARCHAR}
		</if>
		<if test="orgId != null and orgId !=''">
			and ORG_ID = #{orgId,jdbcType=VARCHAR}
		</if>
		<if test="saleProcessId != null and saleProcessId !=''">
			and SALE_PROCESS_ID = #{saleProcessId,jdbcType=VARCHAR}
		</if>
		<if test="lastSaleProcessId != null and lastSaleProcessId !=''">
			and LAST_SALE_PROCESS_ID = #{lastSaleProcessId,jdbcType=VARCHAR}
		</if>
		<if test="labelCode != null and labelCode !=''">
			and LABEL_CODE = #{labelCode,jdbcType=VARCHAR}
		</if>
		<if test="labelName != null and labelName !=''">
			and LABEL_NAME = #{labelName,jdbcType=VARCHAR}
		</if>
		<if test="effectiveness != null ">
			and effectiveness = #{effectiveness,jdbcType=DECIMAL}
		</if>
		<if test="custDetailName != null ">
			and CUST_DETAIL_NAME = #{custDetailName,jdbcType=VARCHAR}
		</if>
		<if test="custDetailMobile != null ">
			and CUST_DETAIL_MOBLIEPHONE = #{custDetailMobile,jdbcType=VARCHAR}
		</if>
		<if test="custStatus!= null ">
			and CUST_STATUS = #{custStatus,jdbcType=DECIMAL}
		</if>	
		<if test="custTypeId !=null ">
			and CUST_TYPE_ID = #{custTypeId,jdbcType=VARCHAR}
		</if>	
		<if test="oldCustName !=null ">
			and CUST_NAME = #{oldCustName,jdbcType=VARCHAR}
		</if>		
		<if test="saleChanceId !=null ">
			and SALE_CHANCE_ID = #{saleChanceId,jdbcType=VARCHAR}
		</if>		
	</sql>

	<!-- 修改实体对应set语句 -->
	<sql id="trents_update_set_sql">
		<trim prefix="set" suffixOverrides=",">
			<if test="custFollowId != null and custFollowId !=''">
				CUST_FOLLOW_ID = #{custFollowId,jdbcType=VARCHAR},
			</if>
			<if test="custId != null">
				CUST_ID = #{custId,jdbcType=VARCHAR},
			</if>
			<if test="actionType != null">
				ACTION_TYPE = #{actionType,jdbcType=VARCHAR},
			</if>
			<if test="actionDate != null">
				ACTION_DATE = #{actionDate,jdbcType=TIMESTAMP},
			</if>
			<if test="feedbackInfoId != null">
				FEEDBACK_INFO_ID = #{feedbackInfoId,jdbcType=VARCHAR},
			</if>
			<if test="feedbackComment != null">
				FEEDBACK_COMMENT = #{feedbackComment,jdbcType=VARCHAR},
			</if>
			<if test="isFollow != null">
				IS_FOLLOW = #{isFollow,jdbcType=DECIMAL},
			</if>
			<if test="followDate != null">
				FOLLOW_DATE = #{followDate,jdbcType=TIMESTAMP},
			</if>
			<if test="followType != null">
				FOLLOW_TYPE = #{followType,jdbcType=VARCHAR},
			</if>
			<if test="followAcc != null">
				FOLLOW_ACC = #{followAcc,jdbcType=VARCHAR},
			</if>
			<if test="inputDate != null">
				INPUT_DATE = #{inputDate,jdbcType=TIMESTAMP},
			</if>
			<if test="inputAcc != null">
				INPUT_ACC = #{inputAcc,jdbcType=VARCHAR},
			</if>
			<if test="saleProcessId != null">
				SALE_PROCESS_ID = #{saleProcessId,jdbcType=VARCHAR},
			</if>
			<if test="lastSaleProcessId != null">
				LAST_SALE_PROCESS_ID = #{lastSaleProcessId,jdbcType=VARCHAR},
			</if>
			<if test="labelCode != null">
				LABEL_CODE = #{labelCode,jdbcType=VARCHAR},
			</if>
			<if test="labelName != null">
				LABEL_NAME = #{labelName,jdbcType=VARCHAR},
			</if>
			<if test="effectiveness != null ">
				effectiveness = #{effectiveness,jdbcType=DECIMAL},
			</if>
			<if test="custDetailName != null ">
				CUST_DETAIL_NAME = #{custDetailName,jdbcType=VARCHAR},
			</if>
			<if test="custDetailMobile != null ">
				CUST_DETAIL_MOBLIEPHONE = #{custDetailMobile,jdbcType=VARCHAR},
			</if>
			<if test="custStatus!= null ">
				CUST_STATUS = #{custStatus,jdbcType=DECIMAL},
			</if>
			<if test="custTypeId !=null ">
				CUST_TYPE_ID = #{custTypeId,jdbcType=VARCHAR},
			</if>	
			<if test="oldCustName !=null ">
				CUST_NAME = #{oldCustName,jdbcType=VARCHAR},
			</if>	
			<if test="saleChanceId !=null ">
				SALE_CHANCE_ID = #{saleChanceId,jdbcType=VARCHAR},
			</if>
			<if test="feedbackImg !=null ">
				FEEDBACK_IMG = #{feedbackImg,jdbcType=VARCHAR},
			</if>
		</trim>
	</sql>

	<!-- 插入实体对应的字段语句 -->
	<sql id="insert_into_field">
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="custFollowId != null and custFollowId != '' ">
				CUST_FOLLOW_ID,
			</if>
			<if test="custId != null and custId != '' ">
				CUST_ID,
			</if>
			<if test="actionType != null and actionType != '' ">
				ACTION_TYPE,
			</if>
			<if test="actionDate != null ">
				ACTION_DATE,
			</if>
			<if test="feedbackInfoId != null and feedbackInfoId != '' ">
				FEEDBACK_INFO_ID,
			</if>
			<if test="feedbackComment != null and feedbackComment != '' ">
				FEEDBACK_COMMENT,
			</if>
			<if test="isFollow != null and isFollow != '' ">
				IS_FOLLOW,
			</if>
			<if test="followDate != null">
				FOLLOW_DATE,
			</if>
			<if test="followType != null and followType != '' ">
				FOLLOW_TYPE,
			</if>
			<if test="followAcc != null and followAcc != '' ">
				FOLLOW_ACC,
			</if>
			<if test="inputDate != null ">
				INPUT_DATE,
			</if>
			<if test="inputAcc != null and inputAcc != '' ">
				INPUT_ACC,
			</if>
			<if test="orgId != null and orgId != '' ">
				ORG_ID,
			</if>
			<if test="saleProcessId != null and saleProcessId !='' ">
				SALE_PROCESS_ID,
			</if>
			<if test="lastSaleProcessId != null and lastSaleProcessId !='' ">
				LAST_SALE_PROCESS_ID,
			</if>
			<if test="labelCode != null and labelCode !='' ">
				LABEL_CODE,
			</if>
			<if test="labelName != null and labelName !='' ">
				LABEL_NAME,
			</if>
			<if test="effectiveness != null ">
				effectiveness,
			</if>
			<if test="custDetailName != null ">
				CUST_DETAIL_NAME,
			</if>
			<if test="custDetailMobile != null ">
				CUST_DETAIL_MOBLIEPHONE,
			</if>
			<if test="custStatus!= null ">
				CUST_STATUS,
			</if>
			<if test="custTypeId !=null ">
				CUST_TYPE_ID,
			</if>	
			<if test="oldCustName !=null ">
				CUST_NAME,
			</if>
			<if test="saleChanceId !=null ">
				SALE_CHANCE_ID,
			</if>
			<if test="feedbackImg !=null ">
				FEEDBACK_IMG,
			</if>
			
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="custFollowId != null and custFollowId != '' ">
				#{custFollowId,jdbcType=VARCHAR},
			</if>
			<if test="custId != null and custId != '' ">
				#{custId,jdbcType=VARCHAR},
			</if>
			<if test="actionType != null and actionType != '' ">
				#{actionType,jdbcType=VARCHAR},
			</if>
			<if test="actionDate != null ">
				#{actionDate,jdbcType=TIMESTAMP},
			</if>
			<if test="feedbackInfoId != null and feedbackInfoId != '' ">
				#{feedbackInfoId,jdbcType=VARCHAR},
			</if>
			<if test="feedbackComment != null and feedbackComment != '' ">
				#{feedbackComment,jdbcType=VARCHAR},
			</if>
			<if test="isFollow != null and isFollow != '' ">
				#{isFollow,jdbcType=DECIMAL},
			</if>
			<if test="followDate != null ">
				#{followDate,jdbcType=TIMESTAMP},
			</if>
			<if test="followType != null and followType != '' ">
				#{followType,jdbcType=VARCHAR},
			</if>
			<if test="followAcc != null and followAcc != '' ">
				#{followAcc,jdbcType=VARCHAR},
			</if>
			<if test="inputDate != null">
				#{inputDate,jdbcType=TIMESTAMP},
			</if>
			<if test="inputAcc != null and inputAcc != '' ">
				#{inputAcc,jdbcType=VARCHAR},
			</if>
			<if test="orgId != null and orgId != '' ">
				#{orgId,jdbcType=VARCHAR},
			</if>
			<if test="saleProcessId != null and saleProcessId !=''">
				#{saleProcessId,jdbcType=VARCHAR},
			</if>
			<if test="lastSaleProcessId != null and lastSaleProcessId !=''">
				#{lastSaleProcessId,jdbcType=VARCHAR},
			</if>
			<if test="labelCode != null and labelCode !=''">
				#{labelCode,jdbcType=VARCHAR},
			</if>
			<if test="labelName != null and labelName !=''">
				#{labelName,jdbcType=VARCHAR},
			</if>
			<if test="effectiveness != null">
				#{effectiveness,jdbcType=DECIMAL},
			</if>
			<if test="custDetailName != null ">
				#{custDetailName,jdbcType=VARCHAR},
			</if>
			<if test="custDetailMobile != null ">
				#{custDetailMobile,jdbcType=VARCHAR},
			</if>
			<if test="custStatus!= null ">
				#{custStatus,jdbcType=DECIMAL},
			</if>	
			<if test="custTypeId !=null ">
				#{custTypeId,jdbcType=VARCHAR},
			</if>
			<if test="oldCustName !=null ">
				 #{oldCustName,jdbcType=VARCHAR},
			</if>
			<if test="saleChanceId !=null ">
				 #{saleChanceId,jdbcType=VARCHAR},
			</if>
			<if test="feedbackImg !=null ">
				#{feedbackImg,jdbcType=VARCHAR},
			</if>
		</trim>
	</sql>

	<!-- 批量插入实体对应的字段语句 -->
	<sql id="Base_Column_List">
		CUST_FOLLOW_ID, CUST_ID, ACTION_TYPE, ACTION_DATE, FEEDBACK_INFO_ID,
		FEEDBACK_COMMENT,
		IS_FOLLOW, FOLLOW_DATE, FOLLOW_TYPE,
		FOLLOW_ACC,INPUT_DATE,INPUT_ACC,ORG_ID,SALE_PROCESS_ID,LAST_SALE_PROCESS_ID,
		LABEL_CODE,LABEL_NAME,effectiveness,CUST_DETAIL_NAME,CUST_DETAIL_MOBLIEPHONE,
		CUST_STATUS,CUST_TYPE_ID,CUST_NAME,SALE_CHANCE_ID
	</sql>



	<!-- ################################################################################################## 
		#########################基础定义配置 通用脚本（无需修改，单resultType需要替换）############# ################################################################################################## -->

	<!-- 查询所有实体信息，对应接口中的find方法 -->
	<select id="find" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from
		<include refid="table_name" />
	</select>

	<select id="findListPage" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from
		<include refid="table_name" />
		where 1=1
		<include refid="entity_condition_orderby" />
	</select>

	<!-- 根据条件查询所有实体信息，对应接口中的findByCondtion方法 -->
	<select id="findByCondtion" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from
		<include refid="table_name" />
		where 1=1
		<include refid="entity_condition_orderby" />
	</select>

	<!-- 按编号获取实体信息，对应接口中的getByPrimaryKey方法 -->
	<select id="getByPrimaryKey" parameterType="string" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from
		<include refid="table_name" />
		where CUST_FOLLOW_ID = #{custFollowId,jdbcType=VARCHAR}
	</select>

	<!-- 按条件查询获取实体信息，对应接口中的getByCondtion方法 -->
	<select id="getByCondtion" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from
		<include refid="table_name" />
		where 1=1
		<include refid="entity_condition_orderby" />
	</select>

	<!-- 添加实体 -->
	<insert id="insert" parameterType="com.qftx.tsm.follow.bean.CustFollowBean">
		insert into
		<include refid="table_name" />
		<include refid="insert_into_field" />
	</insert>

	<!-- 修改实体 -->
	<update id="update" parameterType="com.qftx.tsm.follow.bean.CustFollowBean">
		update
		<include refid="table_name" />
		<include refid="trents_update_set_sql" />
		where ORG_ID = #{orgId,jdbcType=VARCHAR} and CUST_FOLLOW_ID = #{custFollowId,jdbcType=VARCHAR}
	</update>

	<!-- 动态修改实体 -->
	<update id="updateTrends" parameterType="com.qftx.tsm.follow.bean.CustFollowBean">
		update
		<include refid="table_name" />
		<include refid="trents_update_set_sql" />
		where ORG_ID = #{orgId,jdbcType=VARCHAR} and CUST_FOLLOW_ID = #{custFollowId,jdbcType=VARCHAR}
	</update>

	<!-- 删除 -->
	<delete id="delete" parameterType="string">
		delete
		<include refid="table_name" />
		where CUST_FOLLOW_ID = #{custFollowId,jdbcType=VARCHAR}
	</delete>

	<delete id="deleteCustFollows" parameterType="map">
		delete from <include refid="table_name" /> where org_id = #{orgId} 
			and  cust_id in 
			<foreach collection="custIds" item="custId" open="(" separator="," close=")">
				#{custId}
			</foreach>
	</delete>
	<!-- ################################################################################################## 
		#########################客户跟进操作方法 开始。。。。。。。。 ################################## 
		################################################################################################## -->
	<!-- 根据资源ID，查询跟进记录 -->
	<select id="queryCustFollowByCustId" parameterType="Map"  resultMap="DtoResultMap">
		SELECT T.SALE_PROCESS_ID OPTIONLIST_ID,
		       T.ACTION_DATE LAST_ACTION_DATE,
		       T.FOLLOW_DATE NEXT_ACTION_DATE,
		       T.ACTION_TYPE,
		       T.FOLLOW_TYPE,
		       T.LABEL_NAME,
		       T.LABEL_CODE,
		       T.CUST_FOLLOW_ID,
		       T.EFFECTIVENESS,
		       T.FOLLOW_ACC,
		       T.FEEDBACK_COMMENT,
		       T.SALE_PROCESS_ID,
		       T.CUST_ID,
		       T.INPUT_DATE,
		       T.CUST_TYPE_ID,
			   T.FEEDBACK_IMG,
		       <!-- 企业客户，个人客户 获取联系人，联系电话 -->
			  <choose>
			  	<when test="state != null and state == 1 ">
			  		<!--  企业客户 -->
			  		trci.name custName,
			  		T.CUST_DETAIL_NAME name,
			  		T.CUST_DETAIL_MOBLIEPHONE as MOBILEPHONE
			  	</when>
			  	<otherwise>
			  		<!--  个人客户 -->	
			  		trci.name custName,		  		
			  		trci.MOBILEPHONE,
			  		trci.company
			  	</otherwise>
			  </choose>
		  FROM TSM_CUST_FOLLOW T
		  <!-- 企业客户，个人客户 获取联系人，联系电话 -->
		 <!--  <choose>
		  	<when test="state != null and state == 1 ">
		  	</when>
		  	<otherwise> -->
		  		<!--  个人客户，关联资源表 -->
		  		left join (select trci1.RES_CUST_ID,trci1.name,trci1.company,trci1.MOBILEPHONE from tsm_res_cust_info trci1 where trci1.org_id = #{orgId} and trci1.res_cust_id = #{custId}) trci 
		  		on t.cust_id = trci.RES_CUST_ID 
		  	<!-- </otherwise>
		  </choose> -->
		 WHERE T.ORG_ID = #{orgId} and T.CUST_ID = #{custId}
		 <if test="showCount != null and showCount == 1">
			 <if test="custFollowId != null and custFollowId != ''">
			 	AND T.CUST_FOLLOW_ID = #{custFollowId} 
			 </if>
		 </if> 
		 <if test="saleChanceId != null and saleChanceId != ''">
			 AND T.SALE_CHANCE_ID = #{saleChanceId} 
		 </if> 
		 ORDER BY T.ACTION_DATE DESC
	</select>
	
	<!-- 分页查询跟进记录 -->
	<select id="queryCustFollowsListPage" parameterType="com.qftx.tsm.follow.dto.CustFollowDto"  resultMap="DtoResultMap">
			<include refid="public_sql_follow_list" />
	</select>
	<!-- 分页查询跟进记录(phone||linkName) -->
	<select id="queryCustFollowsPhoneListPage" parameterType="com.qftx.tsm.follow.dto.CustFollowDto"  resultMap="DtoResultMap">
			<include refid="public_sql_follow_list_phone" />
	</select>
	
	<!-- 客户跟进 -->
	<sql id="public_sql_follow">
	SELECT TRCI.RES_CUST_ID CUST_ID,
	TRCI.RES_CUST_ID,
	TRCI.LAST_CUST_FOLLOW_ID CUST_FOLLOW_ID,
	TRCI.LAST_CUST_TYPE_ID CUST_TYPE_ID,
	TRCI.TYPE,
	TRCI.MAIN_LINKMAN,
	TRCI.MOBILEPHONE,
	TRCI.TELPHONE,
	TRCI.LABEL_CODE,
	TRCI.LABEL_NAME,
	TRCI.AMOYTOCUSTOMER_DATE MIN_ACTION_DATE,
	TRCI.INPUT_DATE CREATE_TIME,
	TRCI.NAME,
	ifnull(TRCI.IS_MAJOR,0) IS_MAJOR,
	TRCI.OWNER_ACC OWNER_NAME,
	TRCI.STATUS,
	TRCI.last_Option_Id OPTIONLIST_ID,
	TRCI.ACTION_DATE LAST_ACTION_DATE,
	TRCI.NEXTFOLLOW_DATE NEXT_ACTION_DATE,
	TRCI.COMPANY,
	TRCI.DEFINED1,
	TRCI.DEFINED2,
	TRCI.DEFINED3,
	TRCI.DEFINED4,
	TRCI.DEFINED5,
	TRCI.DEFINED6,
	TRCI.DEFINED7,
	TRCI.DEFINED8,
	TRCI.DEFINED9,
	TRCI.DEFINED10,
	TRCI.DEFINED11,
	TRCI.DEFINED12,
	TRCI.DEFINED13,
	TRCI.DEFINED14,
	TRCI.DEFINED15,
	TRCI.DEFINED16,
	TRCI.DEFINED17,
	TRCI.DEFINED18,
	TRCI.RES_GROUP_ID,
	TRCI.PROVINCE_ID,
	TRCI.CITY_ID,
	TRCI.COUNTY_ID,
	TRCI.COMPANY_MONEY,
	TRCI.COMPANY_USER,
	TRCI.COMPANY_TRADE,
	TRCI.COMPANY_FAX,
	TRCI.KEYWORD,
	TRCI.SOURCE
	FROM TSM_RES_CUST_INFO TRCI
	WHERE TRCI.ORG_ID = #{orgId} and TRCI.IS_DEL = 0
	and TRCI.LAST_CUST_FOLLOW_ID IS NOT NULL
	<if test="source != null and source != 0">
		and TRCI.SOURCE = #{source}
	</if>
	<choose>
		<when test="status != null">
			<choose>
				<!-- 意向客户 -->
				<when test="status== 2">and TRCI.STATUS in(3,2)</when>
				<!-- 签约客户 -->
				<when test="status== 3">and TRCI.STATUS = 6</when>
				<when test="status== 4">and TRCI.STATUS = 7</when>
				<when test="status== 5">and TRCI.STATUS = 8</when>
				<otherwise> AND TRCI.STATUS in(3,2,6,7,8)</otherwise>
			</choose>
		</when>
		<otherwise>
			AND TRCI.STATUS in(3,2,6,7,8)
		</otherwise>
	</choose>
	 <if test="custIds != null and custIds.size() > 0">
   		AND TRCI.RES_CUST_ID IN 
   			<foreach collection="custIds" item="cid" open="(" separator="," close=")">
   				#{cid}
   			</foreach>
   </if>
	<if test=" queryText != null and queryText != '' ">
		<choose>
			<when test="queryType == 'custName'">
				AND (TRCI.NAME LIKE concat('%',#{queryText},'%'))
			</when>
			<when test="queryType == 'company'"><!-- 单位名称 -->
				AND (TRCI.COMPANY LIKE concat('%',#{queryText},'%'))
			</when>
			<when test="queryType == 'linkName' and (state == null or state == 0)"><!-- 联系人 -->
				AND (TRCI.main_linkman LIKE concat('%',#{queryText},'%'))
			</when>
			<otherwise>
				and ${queryType} LIKE CONCAT('%',#{queryText},'%')
			</otherwise>
		</choose>
	</if>
	<if test="isMajor != null and isMajor !=''">
		AND TRCI.IS_MAJOR = #{isMajor}
	</if>
	AND TRCI.TYPE = 2
	<choose>
		<when test="roleType!= null and roleType == 1"><!-- 管理者 拥有查看所管理部门资源的权限 -->
			<choose>
				<when test="ownerAccs != null"> <!-- 有选择指定拥有者 -->
					and TRCI.OWNER_ACC in
					<foreach collection="ownerAccs" index="index" item="item"
						open="(" separator="," close=")">
						#{item}
					</foreach>
				</when>
				<otherwise>
					AND TRCI.OWNER_ACC = #{ownerAcc}
				</otherwise>
			</choose>
		</when>
		<otherwise><!-- 只能查看自己的资源 -->
			AND TRCI.OWNER_ACC = #{ownerAcc}
		</otherwise>
	</choose>
	<!-- 本次跟进时间 -->
	<if test=" lastStartActionDate != null and lastStartActionDate !='' ">
		AND TRCI.ACTION_DATE >=
		str_to_date(concat(#{lastStartActionDate,jdbcType=VARCHAR},
		'00:00:00'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" lastEndActionDate != null and lastEndActionDate !='' ">
		AND TRCI.ACTION_DATE <![CDATA[ <= ]]>
		str_to_date(concat(#{lastEndActionDate,jdbcType=VARCHAR}, '23:59:59'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<!-- 本次所有者跟进时间 -->
	<if test=" lastStartOwnerActionDate != null and lastStartOwnerActionDate !='' ">
		AND TRCI.OWNER_ACTION_DATE >=
		str_to_date(concat(#{lastStartOwnerActionDate,jdbcType=VARCHAR},
		'00:00:00'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" lastEndOwnerActionDate != null and lastEndOwnerActionDate !='' ">
		AND TRCI.OWNER_ACTION_DATE <![CDATA[ <= ]]>
		str_to_date(concat(#{lastEndOwnerActionDate,jdbcType=VARCHAR}, '23:59:59'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<!-- 本次跟进时间 -->
	<if test=" nextStartActionDate != null and nextStartActionDate !='' ">
		AND TRCI.NEXTFOLLOW_DATE >=
		str_to_date(concat(#{nextStartActionDate,jdbcType=VARCHAR},
		'00:00:00'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" nextEndActionDate != null and nextEndActionDate !='' ">
		AND TRCI.NEXTFOLLOW_DATE <![CDATA[ <= ]]>
		str_to_date(concat(#{nextEndActionDate,jdbcType=VARCHAR},
		'23:59:59'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<!-- 开始联系时间 -->
	<if test=" initStartFollowDate != null and initStartFollowDate !='' ">
		AND TRCI.AMOYTOCUSTOMER_DATE >=
		str_to_date(concat(#{initStartFollowDate,jdbcType=VARCHAR},
		'00:00:00'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" initEndFollowDate != null and initEndFollowDate !='' ">
		AND TRCI.AMOYTOCUSTOMER_DATE <![CDATA[ <= ]]>
		str_to_date(concat(#{initEndFollowDate,jdbcType=VARCHAR}, '23:59:59'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" custTypeId != null and custTypeId != '' ">
		AND TRCI.last_cust_type_id = #{custTypeId,jdbcType=VARCHAR}
	</if>
	<if test=" resGroup != null and resGroup != '' ">
		AND TRCI.RES_GROUP_ID = #{resGroup,jdbcType=VARCHAR}
	</if>
	<if test=" optionlistId != null and optionlistId != '' ">
		AND TRCI.last_Option_Id = #{optionlistId,jdbcType=VARCHAR}
	</if>
	<if test=" companyTrade != null and companyTrade != '' ">
		AND TRCI.company_trade = #{companyTrade,jdbcType=VARCHAR}
	</if>
	<if test=" provinceId != null and provinceId != '' ">
		AND TRCI.province_id = #{provinceId,jdbcType=VARCHAR}
	</if>
	<if test=" cityId != null and cityId != '' ">
		AND TRCI.city_id = #{cityId,jdbcType=VARCHAR}
	</if>
	<if test=" countyId != null and countyId != '' ">
		AND TRCI.county_id = #{countyId,jdbcType=VARCHAR}
	</if>
	<if test="defined1 != null and defined1 != ''">
		AND TRCI.defined1 =#{defined1}
	</if>	
	<if test="defined2 != null and defined2 != ''">
		AND TRCI.defined2 =#{defined2}
	</if>	
	<if test="defined3 != null and defined3 != ''">
		AND TRCI.defined3 =#{defined3}
	</if>	
	<if test="defined4 != null and defined4 != ''">
		AND TRCI.defined4 =#{defined4}
	</if>	
	<if test="defined5 != null and defined5 != ''">
		AND TRCI.defined5 =#{defined5}
	</if>	
	<if test="defined6 != null and defined6 != ''">
		AND TRCI.defined6 =#{defined6}
	</if>	
	<if test="defined7 != null and defined7 != ''">
		AND TRCI.defined7 =#{defined7}
	</if>	
	<if test="defined8 != null and defined8 != ''">
		AND TRCI.defined8 =#{defined8}
	</if>	
	<if test="defined9 != null and defined9 != ''">
		AND TRCI.defined9 =#{defined9}
	</if>	
	<if test="defined10 != null and defined10 != ''">
		AND TRCI.defined10 =#{defined10}
	</if>	
	<if test="defined11 != null and defined11 != ''">
		AND TRCI.defined11 =#{defined11}
	</if>	
	<if test="defined12 != null and defined12 != ''">
		AND TRCI.defined12 =#{defined12}
	</if>	
	<if test="defined13 != null and defined13 != ''">
		AND TRCI.defined13 =#{defined13}
	</if>	
	<if test="defined14 != null and defined14 != ''">
		AND TRCI.defined14 =#{defined14}
	</if>	
	<if test="defined15 != null and defined15 != ''">
		AND TRCI.defined15 =#{defined15}
	</if>	
	<if test=" startdefined16!= null and startdefined16 !='' ">
		AND TRCI.defined16 >=
		str_to_date(concat(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" enddefined16 != null and enddefined16 !='' ">
		AND TRCI.defined16 <![CDATA[ <= ]]>
		str_to_date(concat(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" startdefined17!= null and startdefined17 !='' ">
		AND TRCI.defined17 >=
		str_to_date(concat(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" enddefined17 != null and enddefined17 !='' ">
		AND TRCI.defined17 <![CDATA[ <= ]]>
		str_to_date(concat(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" startdefined18!= null and startdefined18 !='' ">
		AND TRCI.defined18 >=
		str_to_date(concat(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" enddefined18 != null and enddefined18 !='' ">
		AND TRCI.defined18 <![CDATA[ <= ]]>
		str_to_date(concat(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test="orderKey != null and orderKey != ''">
	   ORDER BY ${orderKey } 
   	</if>
	</sql>
	
	
	<!-- 客户跟进 -->
	<sql id="public_sql_followByPhone">
	SELECT t.CUST_ID,
	t.RES_CUST_ID,
	t.CUST_FOLLOW_ID,
	t.CUST_TYPE_ID,
	t.MAIN_LINKMAN,
	t.MOBILEPHONE,
	t.TELPHONE,
	t.TYPE,
	t.LABEL_CODE,
	t.LABEL_NAME,
	t.MIN_ACTION_DATE,
	t.CREATE_TIME,
	t.NAME,
	t.IS_MAJOR,
	t.OWNER_NAME,
	t.STATUS,
	t.OPTIONLIST_ID,
	t.LAST_ACTION_DATE,
	t.NEXT_ACTION_DATE,
	t.COMPANY,
	t.DEFINED1,
	t.DEFINED2,
	t.DEFINED3,
	t.DEFINED4,
	t.DEFINED5,
	t.DEFINED6,
	t.DEFINED7,
	t.DEFINED8,
	t.DEFINED9,
	t.DEFINED10,
	t.DEFINED11,
	t.DEFINED12,
	t.DEFINED13,
	t.DEFINED14,
	t.DEFINED15,
	t.DEFINED16,
	t.DEFINED17,
	t.DEFINED18,
	t.RES_GROUP_ID,
	t.PROVINCE_ID,
	t.CITY_ID,
	t.COUNTY_ID,
	t.COMPANY_MONEY,
	t.COMPANY_USER,
	t.COMPANY_TRADE,
	t.COMPANY_FAX,
	t.KEYWORD,
	t.source
	from 
	(SELECT TRCI.RES_CUST_ID CUST_ID,
	TRCI.RES_CUST_ID,
	TRCI.LAST_CUST_FOLLOW_ID CUST_FOLLOW_ID,
	TRCI.LAST_CUST_TYPE_ID CUST_TYPE_ID,
	TRCI.TYPE,
	TRCI.MAIN_LINKMAN,
	TRCI.MOBILEPHONE,
	TRCI.TELPHONE,
	TRCI.LABEL_CODE,
	TRCI.LABEL_NAME,
	TRCI.AMOYTOCUSTOMER_DATE MIN_ACTION_DATE,
	TRCI.INPUT_DATE CREATE_TIME,
	TRCI.NAME,
	ifnull(TRCI.IS_MAJOR,0) IS_MAJOR,
	TRCI.OWNER_ACC OWNER_NAME,
	TRCI.STATUS,
	TRCI.last_Option_Id OPTIONLIST_ID,
	TRCI.ACTION_DATE LAST_ACTION_DATE,
	TRCI.NEXTFOLLOW_DATE NEXT_ACTION_DATE,
	TRCI.COMPANY,
	TRCI.DEFINED1,
	TRCI.DEFINED2,
	TRCI.DEFINED3,
	TRCI.DEFINED4,
	TRCI.DEFINED5,
	TRCI.DEFINED6,
	TRCI.DEFINED7,
	TRCI.DEFINED8,
	TRCI.DEFINED9,
	TRCI.DEFINED10,
	TRCI.DEFINED11,
	TRCI.DEFINED12,
	TRCI.DEFINED13,
	TRCI.DEFINED14,
	TRCI.DEFINED15,
	TRCI.DEFINED16,
	TRCI.DEFINED17,
	TRCI.DEFINED18,
	TRCI.RES_GROUP_ID,
	TRCI.PROVINCE_ID,
	TRCI.CITY_ID,
	TRCI.COUNTY_ID,
	TRCI.COMPANY_MONEY,
	TRCI.COMPANY_USER,
	TRCI.COMPANY_TRADE,
	TRCI.COMPANY_FAX,
	TRCI.KEYWORD,
	TRCI.SOURCE
	FROM TSM_RES_CUST_INFO TRCI
	WHERE TRCI.ORG_ID = #{orgId} and TRCI.IS_DEL = 0
	and TRCI.LAST_CUST_FOLLOW_ID IS NOT NULL
	<if test="source != null and source != 0">
		and trci.source = #{source}
	</if>
	<choose>
		<when test="status != null">
			<choose>
				<!-- 意向客户 -->
				<when test="status== 2">and TRCI.STATUS in(3,2)</when>
				<!-- 签约客户 -->
				<when test="status== 3">and TRCI.STATUS = 6</when>
				<when test="status== 4">and TRCI.STATUS = 7</when>
				<when test="status== 5">and TRCI.STATUS = 8</when>
				<otherwise> AND TRCI.STATUS in(3,2,6,7,8)</otherwise>
			</choose>
		</when>
		<otherwise>
			AND TRCI.STATUS in(3,2,6,7,8)
		</otherwise>
	</choose>
	<if test="state == 0 and queryText != null and queryText != '' and queryType == 'phone'">
		<choose>
			<when test="queryType == 'phone'">
				AND TRCI.MOBILEPHONE = #{queryText}
			</when>
		</choose>
	</if>
	<if test="custIds != null and custIds.size() > 0">
   		AND TRCI.RES_CUST_ID IN 
   			<foreach collection="custIds" item="cid" open="(" separator="," close=")">
   				#{cid}
   			</foreach>
   	</if>
	<if test="isMajor != null and isMajor !=''">
		AND TRCI.IS_MAJOR = #{isMajor}
	</if>
	AND TRCI.TYPE = 2
	<choose>
		<when test="roleType!= null and roleType == 1"><!-- 管理者 拥有查看所管理部门资源的权限 -->
			<choose>
				<when test="ownerAccs != null"> <!-- 有选择指定拥有者 -->
					and TRCI.OWNER_ACC in
					<foreach collection="ownerAccs" index="index" item="item"
						open="(" separator="," close=")">
						#{item}
					</foreach>
				</when>
				<otherwise>
					AND TRCI.OWNER_ACC = #{ownerAcc}
				</otherwise>
			</choose>
		</when>
		<otherwise><!-- 只能查看自己的资源 -->
			AND TRCI.OWNER_ACC = #{ownerAcc}
		</otherwise>
	</choose>
	<!-- 本次跟进时间 -->
	<if test=" lastStartActionDate != null and lastStartActionDate !='' ">
		AND TRCI.ACTION_DATE >=
		str_to_date(concat(#{lastStartActionDate,jdbcType=VARCHAR},
		'00:00:00'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" lastEndActionDate != null and lastEndActionDate !='' ">
		AND TRCI.ACTION_DATE <![CDATA[ <= ]]>
		str_to_date(concat(#{lastEndActionDate,jdbcType=VARCHAR}, '23:59:59'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<!-- 本次所有者跟进时间 -->
	<if test=" lastStartOwnerActionDate != null and lastStartOwnerActionDate !='' ">
		AND TRCI.OWNER_ACTION_DATE >=
		str_to_date(concat(#{lastStartOwnerActionDate,jdbcType=VARCHAR},
		'00:00:00'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" lastEndOwnerActionDate != null and lastEndOwnerActionDate !='' ">
		AND TRCI.OWNER_ACTION_DATE <![CDATA[ <= ]]>
		str_to_date(concat(#{lastEndOwnerActionDate,jdbcType=VARCHAR}, '23:59:59'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<!-- 下次跟进时间 -->
	<if test=" nextStartActionDate != null and nextStartActionDate !='' ">
		AND TRCI.NEXTFOLLOW_DATE >=
		str_to_date(concat(#{nextStartActionDate,jdbcType=VARCHAR},
		'00:00:00'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" nextEndActionDate != null and nextEndActionDate !='' ">
		AND TRCI.NEXTFOLLOW_DATE <![CDATA[ <= ]]>
		str_to_date(concat(#{nextEndActionDate,jdbcType=VARCHAR},
		'23:59:59'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<!-- 开始联系时间 -->
	<if test=" initStartFollowDate != null and initStartFollowDate !='' ">
		AND TRCI.AMOYTOCUSTOMER_DATE >=
		str_to_date(concat(#{initStartFollowDate,jdbcType=VARCHAR},
		'00:00:00'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" initEndFollowDate != null and initEndFollowDate !='' ">
		AND TRCI.AMOYTOCUSTOMER_DATE <![CDATA[ <= ]]>
		str_to_date(concat(#{initEndFollowDate,jdbcType=VARCHAR}, '23:59:59'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" custTypeId != null and custTypeId != '' ">
		AND TRCI.last_cust_type_id = #{custTypeId,jdbcType=VARCHAR}
	</if>
	<if test=" resGroup != null and resGroup != '' ">
		AND TRCI.RES_GROUP_ID = #{resGroup,jdbcType=VARCHAR}
	</if>
	<if test=" optionlistId != null and optionlistId != '' ">
		AND TRCI.last_Option_Id = #{optionlistId,jdbcType=VARCHAR}
	</if>
	<if test=" companyTrade != null and companyTrade != '' ">
		AND TRCI.company_trade = #{companyTrade,jdbcType=VARCHAR}
	</if>
	<if test=" provinceId != null and provinceId != '' ">
		AND TRCI.province_id = #{provinceId,jdbcType=VARCHAR}
	</if>
	<if test=" cityId != null and cityId != '' ">
		AND TRCI.city_id = #{cityId,jdbcType=VARCHAR}
	</if>
	<if test=" countyId != null and countyId != '' ">
		AND TRCI.county_id = #{countyId,jdbcType=VARCHAR}
	</if>
	<if test="defined1 != null and defined1 != ''">
		AND TRCI.defined1 =#{defined1}
	</if>	
	<if test="defined2 != null and defined2 != ''">
		AND TRCI.defined2 =#{defined2}
	</if>	
	<if test="defined3 != null and defined3 != ''">
		AND TRCI.defined3 =#{defined3}
	</if>	
	<if test="defined4 != null and defined4 != ''">
		AND TRCI.defined4 =#{defined4}
	</if>	
	<if test="defined5 != null and defined5 != ''">
		AND TRCI.defined5 =#{defined5}
	</if>	
	<if test="defined6 != null and defined6 != ''">
		AND TRCI.defined6 =#{defined6}
	</if>	
	<if test="defined7 != null and defined7 != ''">
		AND TRCI.defined7 =#{defined7}
	</if>	
	<if test="defined8 != null and defined8 != ''">
		AND TRCI.defined8 =#{defined8}
	</if>	
	<if test="defined9 != null and defined9 != ''">
		AND TRCI.defined9 =#{defined9}
	</if>	
	<if test="defined10 != null and defined10 != ''">
		AND TRCI.defined10 =#{defined10}
	</if>	
	<if test="defined11 != null and defined11 != ''">
		AND TRCI.defined11 =#{defined11}
	</if>	
	<if test="defined12 != null and defined12 != ''">
		AND TRCI.defined12 =#{defined12}
	</if>	
	<if test="defined13 != null and defined13 != ''">
		AND TRCI.defined13 =#{defined13}
	</if>	
	<if test="defined14 != null and defined14 != ''">
		AND TRCI.defined14 =#{defined14}
	</if>	
	<if test="defined15 != null and defined15 != ''">
		AND TRCI.defined15 =#{defined15}
	</if>	
	<if test=" startdefined16!= null and startdefined16 !='' ">
		AND TRCI.defined16 >=
		str_to_date(concat(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" enddefined16 != null and enddefined16 !='' ">
		AND TRCI.defined16 <![CDATA[ <= ]]>
		str_to_date(concat(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" startdefined17!= null and startdefined17 !='' ">
		AND TRCI.defined17 >=
		str_to_date(concat(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" enddefined17 != null and enddefined17 !='' ">
		AND TRCI.defined17 <![CDATA[ <= ]]>
		str_to_date(concat(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" startdefined18!= null and startdefined18 !='' ">
		AND TRCI.defined18 >=
		str_to_date(concat(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" enddefined18 != null and enddefined18 !='' ">
		AND TRCI.defined18 <![CDATA[ <= ]]>
		str_to_date(concat(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test="state == 0 and queryText != null and queryText != '' and queryType == 'phone'">
	union
	SELECT TRCI.RES_CUST_ID CUST_ID,
	TRCI.RES_CUST_ID,
	TRCI.LAST_CUST_FOLLOW_ID CUST_FOLLOW_ID,
	TRCI.LAST_CUST_TYPE_ID CUST_TYPE_ID,
	TRCI.TYPE,
	TRCI.MAIN_LINKMAN,
	TRCI.MOBILEPHONE,
	TRCI.TELPHONE,
	TRCI.LABEL_CODE,
	TRCI.LABEL_NAME,
	TRCI.AMOYTOCUSTOMER_DATE MIN_ACTION_DATE,
	TRCI.INPUT_DATE CREATE_TIME,
	TRCI.NAME,
	ifnull(TRCI.IS_MAJOR,0) IS_MAJOR,
	TRCI.OWNER_ACC OWNER_NAME,
	TRCI.STATUS,
	TRCI.last_Option_Id OPTIONLIST_ID,
	TRCI.ACTION_DATE LAST_ACTION_DATE,
	TRCI.NEXTFOLLOW_DATE NEXT_ACTION_DATE,
	TRCI.COMPANY,
	TRCI.DEFINED1,
	TRCI.DEFINED2,
	TRCI.DEFINED3,
	TRCI.DEFINED4,
	TRCI.DEFINED5,
	TRCI.DEFINED6,
	TRCI.DEFINED7,
	TRCI.DEFINED8,
	TRCI.DEFINED9,
	TRCI.DEFINED10,
	TRCI.DEFINED11,
	TRCI.DEFINED12,
	TRCI.DEFINED13,
	TRCI.DEFINED14,
	TRCI.DEFINED15,
	TRCI.DEFINED16,
	TRCI.DEFINED17,
	TRCI.DEFINED18,
	TRCI.RES_GROUP_ID,
	TRCI.PROVINCE_ID,
	TRCI.CITY_ID,
	TRCI.COUNTY_ID,
	TRCI.COMPANY_MONEY,
	TRCI.COMPANY_USER,
	TRCI.COMPANY_TRADE,
	TRCI.COMPANY_FAX,
	TRCI.KEYWORD,
	TRCI.SOURCE
	FROM TSM_RES_CUST_INFO TRCI
	WHERE TRCI.ORG_ID = #{orgId} and TRCI.IS_DEL = 0
	and TRCI.LAST_CUST_FOLLOW_ID IS NOT NULL
	<if test="source != null and source != 0">
		and trci.source = #{source}
	</if>
	<choose>
		<when test="status != null">
			<choose>
				<!-- 意向客户 -->
				<when test="status== 2">and TRCI.STATUS in(3,2)</when>
				<!-- 签约客户 -->
				<when test="status== 3">and TRCI.STATUS = 6</when>
				<when test="status== 4">and TRCI.STATUS = 7</when>
				<when test="status== 5">and TRCI.STATUS = 8</when>
				<otherwise> AND TRCI.STATUS in(3,2,6,7,8)</otherwise>
			</choose>
		</when>
		<otherwise>
			AND TRCI.STATUS in(3,2,6,7,8)
		</otherwise>
	</choose>
	<if test="state == 0 and queryText != null and queryText != '' and queryType == 'phone'">
		<choose>
			<when test="queryType == 'phone'">
				AND TRCI.telphone = #{queryText}
			</when>
		</choose>
	</if>
	<if test="custIds != null and custIds.size() > 0">
   		AND TRCI.RES_CUST_ID IN 
   			<foreach collection="custIds" item="cid" open="(" separator="," close=")">
   				#{cid}
   			</foreach>
   	</if>
	<if test="isMajor != null and isMajor !=''">
		AND TRCI.IS_MAJOR = #{isMajor}
	</if>
	AND TRCI.TYPE = 2
	<choose>
		<when test="roleType!= null and roleType == 1"><!-- 管理者 拥有查看所管理部门资源的权限 -->
			<choose>
				<when test="ownerAccs != null"> <!-- 有选择指定拥有者 -->
					and TRCI.OWNER_ACC in
					<foreach collection="ownerAccs" index="index" item="item"
						open="(" separator="," close=")">
						#{item}
					</foreach>
				</when>
				<otherwise>
					AND TRCI.OWNER_ACC = #{ownerAcc}
				</otherwise>
			</choose>
		</when>
		<otherwise><!-- 只能查看自己的资源 -->
			AND TRCI.OWNER_ACC = #{ownerAcc}
		</otherwise>
	</choose>
	<!-- 本次跟进时间 -->
	<if test=" lastStartActionDate != null and lastStartActionDate !='' ">
		AND TRCI.ACTION_DATE >=
		str_to_date(concat(#{lastStartActionDate,jdbcType=VARCHAR},
		'00:00:00'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" lastEndActionDate != null and lastEndActionDate !='' ">
		AND TRCI.ACTION_DATE <![CDATA[ <= ]]>
		str_to_date(concat(#{lastEndActionDate,jdbcType=VARCHAR}, '23:59:59'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<!-- 本次所有者跟进时间 -->
	<if test=" lastStartOwnerActionDate != null and lastStartOwnerActionDate !='' ">
		AND TRCI.OWNER_ACTION_DATE >=
		str_to_date(concat(#{lastStartOwnerActionDate,jdbcType=VARCHAR},
		'00:00:00'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" lastEndOwnerActionDate != null and lastEndOwnerActionDate !='' ">
		AND TRCI.OWNER_ACTION_DATE <![CDATA[ <= ]]>
		str_to_date(concat(#{lastEndOwnerActionDate,jdbcType=VARCHAR}, '23:59:59'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<!-- 下次跟进时间 -->
	<if test=" nextStartActionDate != null and nextStartActionDate !='' ">
		AND TRCI.NEXTFOLLOW_DATE >=
		str_to_date(concat(#{nextStartActionDate,jdbcType=VARCHAR},
		'00:00:00'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" nextEndActionDate != null and nextEndActionDate !='' ">
		AND TRCI.NEXTFOLLOW_DATE <![CDATA[ <= ]]>
		str_to_date(concat(#{nextEndActionDate,jdbcType=VARCHAR},
		'23:59:59'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<!-- 开始联系时间 -->
	<if test=" initStartFollowDate != null and initStartFollowDate !='' ">
		AND TRCI.AMOYTOCUSTOMER_DATE >=
		str_to_date(concat(#{initStartFollowDate,jdbcType=VARCHAR},
		'00:00:00'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" initEndFollowDate != null and initEndFollowDate !='' ">
		AND TRCI.AMOYTOCUSTOMER_DATE <![CDATA[ <= ]]>
		str_to_date(concat(#{initEndFollowDate,jdbcType=VARCHAR}, '23:59:59'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" custTypeId != null and custTypeId != '' ">
		AND TRCI.last_cust_type_id = #{custTypeId,jdbcType=VARCHAR}
	</if>
	<if test=" resGroup != null and resGroup != '' ">
		AND TRCI.RES_GROUP_ID = #{resGroup,jdbcType=VARCHAR}
	</if>
	<if test=" optionlistId != null and optionlistId != '' ">
		AND TRCI.last_Option_Id = #{optionlistId,jdbcType=VARCHAR}
	</if>
	<if test=" companyTrade != null and companyTrade != '' ">
		AND TRCI.company_trade = #{companyTrade,jdbcType=VARCHAR}
	</if>
	<if test=" provinceId != null and provinceId != '' ">
		AND TRCI.province_id = #{provinceId,jdbcType=VARCHAR}
	</if>
	<if test=" cityId != null and cityId != '' ">
		AND TRCI.city_id = #{cityId,jdbcType=VARCHAR}
	</if>
	<if test=" countyId != null and countyId != '' ">
		AND TRCI.county_id = #{countyId,jdbcType=VARCHAR}
	</if>
	<!-- 标签判断 -->
	<!-- <if test=" labels != null and labels !='' ">
		<foreach collection="labels" item="label" separator=" ">
			AND TRCI.LABEL_CODE LIKE CONCAT('%',#{label},'%')
		</foreach>
	</if> -->
	<if test="defined1 != null and defined1 != ''">
		AND TRCI.defined1 =#{defined1}
	</if>	
	<if test="defined2 != null and defined2 != ''">
		AND TRCI.defined2 =#{defined2}
	</if>	
	<if test="defined3 != null and defined3 != ''">
		AND TRCI.defined3 =#{defined3}
	</if>	
	<if test="defined4 != null and defined4 != ''">
		AND TRCI.defined4 =#{defined4}
	</if>	
	<if test="defined5 != null and defined5 != ''">
		AND TRCI.defined5 =#{defined5}
	</if>	
	<if test="defined6 != null and defined6 != ''">
		AND TRCI.defined6 =#{defined6}
	</if>	
	<if test="defined7 != null and defined7 != ''">
		AND TRCI.defined7 =#{defined7}
	</if>	
	<if test="defined8 != null and defined8 != ''">
		AND TRCI.defined8 =#{defined8}
	</if>	
	<if test="defined9 != null and defined9 != ''">
		AND TRCI.defined9 =#{defined9}
	</if>	
	<if test="defined10 != null and defined10 != ''">
		AND TRCI.defined10 =#{defined10}
	</if>	
	<if test="defined11 != null and defined11 != ''">
		AND TRCI.defined11 =#{defined11}
	</if>	
	<if test="defined12 != null and defined12 != ''">
		AND TRCI.defined12 =#{defined12}
	</if>	
	<if test="defined13 != null and defined13 != ''">
		AND TRCI.defined13 =#{defined13}
	</if>	
	<if test="defined14 != null and defined14 != ''">
		AND TRCI.defined14 =#{defined14}
	</if>	
	<if test="defined15 != null and defined15 != ''">
		AND TRCI.defined15 =#{defined15}
	</if>	
	<if test=" startdefined16!= null and startdefined16 !='' ">
		AND TRCI.defined16 >=
		str_to_date(concat(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" enddefined16 != null and enddefined16 !='' ">
		AND TRCI.defined16 <![CDATA[ <= ]]>
		str_to_date(concat(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" startdefined17!= null and startdefined17 !='' ">
		AND TRCI.defined17 >=
		str_to_date(concat(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" enddefined17 != null and enddefined17 !='' ">
		AND TRCI.defined17 <![CDATA[ <= ]]>
		str_to_date(concat(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" startdefined18!= null and startdefined18 !='' ">
		AND TRCI.defined18 >=
		str_to_date(concat(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	<if test=" enddefined18 != null and enddefined18 !='' ">
		AND TRCI.defined18 <![CDATA[ <= ]]>
		str_to_date(concat(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
		'%Y-%m-%d %H:%i:%s')
	</if>
	</if>
	)t
	</sql>
	
	<!-- 跟进记录 -->
	<sql id="public_sql_follow_list">
		SELECT fc.CUST_ID,
		fc.cust_follow_id,
		fc.ACTION_TYPE,
		fc.FOLLOW_TYPE,
		fc.CUST_STATUS,		
		fc.FEEDBACK_COMMENT,
		fc.effectiveness,
		fc.ACTION_DATE LAST_ACTION_DATE,
		fc.FOLLOW_DATE NEXT_ACTION_DATE,
		fc.sale_process_id AS OPTIONLIST_ID,
		fc.CUST_NAME,
		fc.CUST_DETAIL_NAME,
		fc.FOLLOW_ACC,
		fc.cust_type_id,
		CASE 
			WHEN
			fc.SALE_PROCESS_ID=fc.LAST_SALE_PROCESS_ID 
			THEN 3 
			ELSE 2 
		END changeType
		FROM TSM_CUST_FOLLOW fc
		WHERE fc.ORG_ID = #{orgId}
		<if test="ids != null and ids.size() > 0">
   			AND fc.cust_follow_id IN 
   			<foreach collection="ids" item="id" open="(" separator="," close=")">
   				#{id}
   			</foreach>
   		</if>
		and fc.cust_id in(
		select 
			trci.RES_CUST_ID
			FROM TSM_RES_CUST_INFO trci 
			WHERE trci.ORG_ID = #{orgId} and trci.IS_DEL = 0
			AND trci.STATUS in(3,2,6,7,8)	
			 and trci.TYPE = 2 
			 <!-- <if test="custIds != null and custIds.size() > 0">
	   		      AND trci.RES_CUST_ID IN 
	   			  <foreach collection="custIds" item="cid" open="(" separator="," close=")">
	   				  #{cid}
	   			  </foreach>
	        </if> -->  
			 <if test=" resGroup != null and resGroup != '' ">
				AND TRCI.RES_GROUP_ID = #{resGroup,jdbcType=VARCHAR}
			 </if>
			 <if test=" companyTrade != null and companyTrade != '' ">
				AND TRCI.company_trade = #{companyTrade,jdbcType=VARCHAR}
			</if>
			<if test=" provinceId != null and provinceId != '' ">
				AND TRCI.province_id = #{provinceId,jdbcType=VARCHAR}
			</if>
			<if test=" cityId != null and cityId != '' ">
				AND TRCI.city_id = #{cityId,jdbcType=VARCHAR}
			</if>
			<if test=" countyId != null and countyId != '' ">
				AND TRCI.county_id = #{countyId,jdbcType=VARCHAR}
			</if>
			 <choose>
                 	<when test="roleType!= null and roleType == 1"><!-- 管理者 拥有查看所管理部门资源的权限 -->                            		                   		
                 		<choose>
                 			<when test="ownerAccs != null"> <!-- 有选择指定拥有者 -->	                            			
                  			and trci.OWNER_ACC in
                  			<foreach collection="ownerAccs" index="index" item="item" open="("
										separator="," close=")">
							#{item}
						</foreach>
				    </when>
				    <otherwise>
						AND trci.OWNER_ACC = #{ownerAcc}
                 			</otherwise>
                 		</choose>                       	
                 	</when>
                 	<otherwise><!-- 只能查看自己的资源 -->
                 		AND trci.OWNER_ACC = #{ownerAcc}
                 	</otherwise>
               </choose>
               <choose>
                     <when test="state != null and state == 1 "><!-- 企业客户 关联联系人表 --></when>
                     <otherwise>
                          <if test=" queryText != null and queryText != '' ">
					  			<choose>
						       			<when test="queryType == 'custName'">
						       				AND trci.NAME LIKE concat('%',#{queryText},'%')
						       			</when>
						       			<when test="queryType == 'company'">
						       				AND trci.COMPANY LIKE concat('%',#{queryText},'%')
						       			</when>
						       			<when test="queryType == 'phone'">
						       				AND trci.MOBILEPHONE  = #{queryText}
						       			</when>
						       		</choose>										
						    </if>
                      </otherwise>
                </choose>
		)
		<!-- 标签判断 -->
		<!-- <if test=" labels != null and labels !='' ">
			<foreach collection="labels" item="label" separator=" " >
       			AND fc.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
       		</foreach> 											
		</if> -->
		<if test="followAccs != null"> <!-- 有选择指定跟进者 -->	                            			
                and fc.FOLLOW_ACC in
                <foreach collection="followAccs" index="index" item="item" open="("
								separator="," close=")">
					#{item}
				</foreach>
		</if>
		<!-- 联系方式 -->
		<if test=" actionType != null and actionType !='' ">
			AND fc.ACTION_TYPE = #{actionType,jdbcType=VARCHAR}
		</if>
		<!-- 下次联系方式 -->
		<if test=" followType != null and followType !='' ">
			AND fc.FOLLOW_TYPE = #{followType,jdbcType=VARCHAR}
		</if>
		<!-- 客户类型 -->
		<if test=" custTypeId != null and custTypeId != '' ">
			AND fc.CUST_TYPE_ID = #{custTypeId,jdbcType=VARCHAR}
		</if>
		<!--  有效性 -->
		<if test=" effectiveness != null ">
			AND fc.effectiveness = #{effectiveness,jdbcType=DECIMAL}
		</if>
		<!--  销售进程变化  -->
		<if test="changeType == 2 or changeType == '2' ">
			AND fc.LAST_SALE_PROCESS_ID<![CDATA[ <> ]]>fc.SALE_PROCESS_ID
		</if>
		<if test="changeType == 3 or changeType == '3' ">
			AND fc.LAST_SALE_PROCESS_ID=fc.SALE_PROCESS_ID
		</if>
     	<if test=" nextStartActionDate != null and nextStartActionDate !='' ">
			AND fc.FOLLOW_DATE >=str_to_date(concat(#{nextStartActionDate}, '00:00:00'), '%Y-%m-%d %H:%i:%s')
		</if>
		<if test=" nextEndActionDate != null and nextEndActionDate !='' ">
			AND fc.FOLLOW_DATE <![CDATA[ <= ]]> str_to_date(concat(#{nextEndActionDate}, '23:59:59'),'%Y-%m-%d %H:%i:%s')
		</if>
		<!-- 本次跟进时间 -->
		<if test=" lastStartActionDate != null and lastStartActionDate !='' ">
			AND fc.ACTION_DATE >=str_to_date(concat(#{lastStartActionDate}, '00:00:00'), '%Y-%m-%d %H:%i:%s')
		</if>
		<if test=" lastEndActionDate != null and lastEndActionDate !='' ">
			AND fc.ACTION_DATE <![CDATA[ <= ]]> str_to_date(concat(#{lastEndActionDate}, '23:59:59'),'%Y-%m-%d %H:%i:%s')
		</if>
		<if test=" optionlistId != null and optionlistId != '' ">
			AND fc.sale_process_id = #{optionlistId,jdbcType=VARCHAR}
		</if>
		<!-- 查询客户状态 -->
		<choose>
			<when test="status != null">
				<choose>
					<!-- 意向客户 -->
					<when test="status== 2">and fc.CUST_STATUS = 5</when>
					<!-- 签约客户 -->
					<when test="status== 3">and fc.CUST_STATUS = 6</when>
					<when test="status== 4">and fc.CUST_STATUS = 7</when>
					<when test="status== 5">and fc.CUST_STATUS = 8</when>
					<otherwise> AND fc.CUST_STATUS in(5,6,7,8)</otherwise>
				</choose>
			</when>
			<otherwise>
				AND fc.CUST_STATUS in(5,6,7,8)
			</otherwise>
		</choose>	
		<choose>
             <when test="state != null and state == 1 "><!-- 企业客户 关联联系人表 -->		                            
                    <if test=" queryText != null and queryText != '' ">
                    	<choose>
			       			<when test="queryType == 'custName'">
			       				AND (fc.CUST_NAME LIKE concat('%',#{queryText},'%'))
			       			</when>
			       			<when test="queryType == 'linkName'">
			       				AND (fc.CUST_DETAIL_NAME LIKE concat('%',#{queryText},'%'))
			       			</when>
			       			<when test="queryType == 'phone'">
			       				AND (fc.CUST_DETAIL_MOBLIEPHONE  = #{queryText})
			       			</when>
			       		</choose>						
					</if>
             </when>                            	
         </choose>	                	
		<if test=" orderKey != null and orderKey != '' ">
				ORDER BY ${orderKey}
		</if>
	</sql>
	
	<!-- 跟进记录 -->
	<sql id="public_sql_follow_list_phone">
		SELECT fc.CUST_ID,
		fc.cust_follow_id,
		fc.ACTION_TYPE,
		fc.FOLLOW_TYPE,
		fc.CUST_STATUS,		
		fc.FEEDBACK_COMMENT,
		fc.effectiveness,
		fc.ACTION_DATE LAST_ACTION_DATE,
		fc.FOLLOW_DATE NEXT_ACTION_DATE,
		fc.sale_process_id AS OPTIONLIST_ID,
		fc.CUST_NAME,
		fc.CUST_DETAIL_NAME,
		fc.FOLLOW_ACC,
		fc.cust_type_id,
		CASE 
			WHEN
			fc.SALE_PROCESS_ID=fc.LAST_SALE_PROCESS_ID 
			THEN 3 
			ELSE 2 
		END changeType
		FROM TSM_CUST_FOLLOW fc
		WHERE fc.ORG_ID = #{orgId}
		<if test="ids != null and ids.size() > 0">
   			AND fc.cust_follow_id IN 
   			<foreach collection="ids" item="id" open="(" separator="," close=")">
   				#{id}
   			</foreach>
   		</if>
		and fc.cust_id in(
		select 
			trci.RES_CUST_ID
			FROM TSM_RES_CUST_INFO trci 
			WHERE trci.ORG_ID = #{orgId} and trci.IS_DEL = 0
			AND trci.STATUS in(3,2,6,7,8)	
			 and trci.TYPE = 2 
			 <!-- <if test="custIds != null and custIds.size() > 0">
	   		      AND trci.RES_CUST_ID IN 
	   			  <foreach collection="custIds" item="cid" open="(" separator="," close=")">
	   				  #{cid}
	   			  </foreach>
	        </if>  --> 
			 <if test=" resGroup != null and resGroup != '' ">
				AND TRCI.RES_GROUP_ID = #{resGroup,jdbcType=VARCHAR}
			 </if>
			<if test=" companyTrade != null and companyTrade != '' ">
				AND TRCI.company_trade = #{companyTrade,jdbcType=VARCHAR}
			</if>
			<if test=" provinceId != null and provinceId != '' ">
				AND TRCI.province_id = #{provinceId,jdbcType=VARCHAR}
			</if>
			<if test=" cityId != null and cityId != '' ">
				AND TRCI.city_id = #{cityId,jdbcType=VARCHAR}
			</if>
			<if test=" countyId != null and countyId != '' ">
				AND TRCI.county_id = #{countyId,jdbcType=VARCHAR}
			</if>
			 <choose>
                 	<when test="roleType!= null and roleType == 1"><!-- 管理者 拥有查看所管理部门资源的权限 -->                            		                   		
                 		<choose>
                 			<when test="ownerAccs != null"> <!-- 有选择指定拥有者 -->	                            			
                  			and trci.OWNER_ACC in
                  			<foreach collection="ownerAccs" index="index" item="item" open="("
										separator="," close=")">
							#{item}
						</foreach>
				    </when>
				    <otherwise>
						AND trci.OWNER_ACC = #{ownerAcc}
                 			</otherwise>
                 		</choose>                       	
                 	</when>
                 	<otherwise><!-- 只能查看自己的资源 -->
                 		AND trci.OWNER_ACC = #{ownerAcc}
                 	</otherwise>
               </choose>
               <choose>
                     <when test="state != null and state == 1 "><!-- 企业客户 关联联系人表 --></when>
                     <otherwise>
                          <if test=" queryText != null and queryText != '' ">
					  			<choose>
						       			<when test="queryType == 'custName'">
						       				AND trci.NAME LIKE concat('%',#{queryText},'%')
						       			</when>
						       			<when test="queryType == 'company'">
						       				AND trci.COMPANY LIKE concat('%',#{queryText},'%')
						       			</when>
						       			<when test="queryType == 'phone'">
						       				AND trci.MOBILEPHONE  = #{queryText}
						       			</when>
						       		</choose>										
						    </if>
                      </otherwise>
                </choose>
                <if test="state != null and state == 0 and queryText != null and queryText != '' and queryType =='phone'">
                 union 
                 select 
			trci.RES_CUST_ID
			FROM TSM_RES_CUST_INFO trci 
			WHERE trci.ORG_ID = #{orgId} and trci.IS_DEL = 0
			AND trci.STATUS in(3,2,6,7,8)	
			 and trci.TYPE = 2 
			 <!-- <if test="custIds != null and custIds.size() > 0">
	   		      AND trci.RES_CUST_ID IN 
	   			  <foreach collection="custIds" item="cid" open="(" separator="," close=")">
	   				  #{cid}
	   			  </foreach>
	        </if> -->  
			 <if test=" resGroup != null and resGroup != '' ">
				AND TRCI.RES_GROUP_ID = #{resGroup,jdbcType=VARCHAR}
			 </if>
			 <if test=" companyTrade != null and companyTrade != '' ">
				AND TRCI.company_trade = #{companyTrade,jdbcType=VARCHAR}
			</if>
			<if test=" provinceId != null and provinceId != '' ">
				AND TRCI.province_id = #{provinceId,jdbcType=VARCHAR}
			</if>
			<if test=" cityId != null and cityId != '' ">
				AND TRCI.city_id = #{cityId,jdbcType=VARCHAR}
			</if>
			<if test=" countyId != null and countyId != '' ">
				AND TRCI.county_id = #{countyId,jdbcType=VARCHAR}
			</if>
			 <choose>
                 	<when test="roleType!= null and roleType == 1"><!-- 管理者 拥有查看所管理部门资源的权限 -->                            		                   		
                 		<choose>
                 			<when test="ownerAccs != null"> <!-- 有选择指定拥有者 -->	                            			
                  			and trci.OWNER_ACC in
                  			<foreach collection="ownerAccs" index="index" item="item" open="("
										separator="," close=")">
							#{item}
						</foreach>
				    </when>
				    <otherwise>
						AND trci.OWNER_ACC = #{ownerAcc}
                 			</otherwise>
                 		</choose>                       	
                 	</when>
                 	<otherwise><!-- 只能查看自己的资源 -->
                 		AND trci.OWNER_ACC = #{ownerAcc}
                 	</otherwise>
               </choose>
               <choose>
                     <when test="state != null and state == 1 "><!-- 企业客户 关联联系人表 --></when>
                     <otherwise>
                          <if test=" queryText != null and queryText != '' ">
					  			<choose>
						       			<when test="queryType == 'custName'">
						       				AND trci.NAME LIKE concat('%',#{queryText},'%')
						       			</when>
						       			<when test="queryType == 'company'">
						       				AND trci.COMPANY LIKE concat('%',#{queryText},'%')
						       			</when>
						       			<when test="queryType == 'phone'">
						       				AND trci.telphone  = #{queryText}
						       			</when>
						       		</choose>										
						    </if>
                      </otherwise>
                </choose>
                </if>
		)
		<!-- 标签判断 -->
		<!-- <if test=" labels != null and labels !='' ">
			<foreach collection="labels" item="label" separator=" " >
       			AND fc.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
       		</foreach> 											
		</if> -->
		<if test="followAccs != null"> <!-- 有选择指定跟进者 -->	                            			
                and fc.FOLLOW_ACC in
                <foreach collection="followAccs" index="index" item="item" open="("
								separator="," close=")">
					#{item}
				</foreach>
		</if>
		<!-- 联系方式 -->
		<if test=" actionType != null and actionType !='' ">
			AND fc.ACTION_TYPE = #{actionType,jdbcType=VARCHAR}
		</if>
		<!-- 下次联系方式 -->
		<if test=" followType != null and followType !='' ">
			AND fc.FOLLOW_TYPE = #{followType,jdbcType=VARCHAR}
		</if>
		<!-- 客户类型 -->
		<if test=" custTypeId != null and custTypeId != '' ">
			AND fc.CUST_TYPE_ID = #{custTypeId,jdbcType=VARCHAR}
		</if>
		<!--  有效性 -->
		<if test=" effectiveness != null ">
			AND fc.effectiveness = #{effectiveness,jdbcType=DECIMAL}
		</if>
		<!--  销售进程变化  -->
		<if test="changeType == 2 or changeType == '2' ">
			AND fc.LAST_SALE_PROCESS_ID<![CDATA[ <> ]]>fc.SALE_PROCESS_ID
		</if>
		<if test="changeType == 3 or changeType == '3' ">
			AND fc.LAST_SALE_PROCESS_ID=fc.SALE_PROCESS_ID
		</if>
     	<if test=" nextStartActionDate != null and nextStartActionDate !='' ">
			AND fc.FOLLOW_DATE >=str_to_date(concat(#{nextStartActionDate}, '00:00:00'), '%Y-%m-%d %H:%i:%s')
		</if>
		<if test=" nextEndActionDate != null and nextEndActionDate !='' ">
			AND fc.FOLLOW_DATE <![CDATA[ <= ]]> str_to_date(concat(#{nextEndActionDate}, '23:59:59'),'%Y-%m-%d %H:%i:%s')
		</if>
		<!-- 本次跟进时间 -->
		<if test=" lastStartActionDate != null and lastStartActionDate !='' ">
			AND fc.ACTION_DATE >=str_to_date(concat(#{lastStartActionDate}, '00:00:00'), '%Y-%m-%d %H:%i:%s')
		</if>
		<if test=" lastEndActionDate != null and lastEndActionDate !='' ">
			AND fc.ACTION_DATE <![CDATA[ <= ]]> str_to_date(concat(#{lastEndActionDate}, '23:59:59'),'%Y-%m-%d %H:%i:%s')
		</if>
		<if test=" optionlistId != null and optionlistId != '' ">
			AND fc.sale_process_id = #{optionlistId,jdbcType=VARCHAR}
		</if>
		<!-- 查询客户状态 -->
		<choose>
			<when test="status != null">
				<choose>
					<!-- 意向客户 -->
					<when test="status== 2">and fc.CUST_STATUS = 5</when>
					<!-- 签约客户 -->
					<when test="status== 3">and fc.CUST_STATUS = 6</when>
					<when test="status== 4">and fc.CUST_STATUS = 7</when>
					<when test="status== 5">and fc.CUST_STATUS = 8</when>
					<otherwise> AND fc.CUST_STATUS in(5,6,7,8)</otherwise>
				</choose>
			</when>
			<otherwise>
				AND fc.CUST_STATUS in(5,6,7,8)
			</otherwise>
		</choose>	
		<choose>
             <when test="state != null and state == 1 "><!-- 企业客户 关联联系人表 -->		                            
                    <if test=" queryText != null and queryText != '' ">
                    	<choose>
			       			<when test="queryType == 'custName'">
			       				AND (fc.CUST_NAME LIKE concat('%',#{queryText},'%'))
			       			</when>
			       			<when test="queryType == 'linkName'">
			       				AND (fc.CUST_DETAIL_NAME LIKE concat('%',#{queryText},'%'))
			       			</when>
			       			<when test="queryType == 'phone'">
			       				AND (fc.CUST_DETAIL_MOBLIEPHONE  = #{queryText})
			       			</when>
			       		</choose>						
					</if>
             </when>                            	
         </choose>	                	
	</sql>
	
	<!-- 跟进警报 -->
	<sql id="public_alarm_sql_follow">
					SELECT  TRCI.CUST_ID, 
							   TRCI.CUST_FOLLOW_ID,
                               TRCI.CREATE_TIME,
                               TRCI.RES_CUST_ID,
                               TRCI.NAME,
                               TRCI.IS_MAJOR,
                               TRCI.OWNER_ACC,
                               TRCI.STATUS,
                               TRCI.OPTIONLIST_ID,
                               TRCI.LAST_ACTION_DATE,
                               TRCI.NEXT_ACTION_DATE,
                               TRCI.CUST_TYPE_ID,
								 TRCI.MOBILEPHONE,
			                   TRCI.TELPHONE,
                               CE.STATUS_EXTENDED,
                               ifnull(datediff(date_add(TRCI.OWNER_START_DATE, interval (1+
                                ifnull((CASE
                                                            WHEN CE.STATUS_EXTENDED = 1 THEN
                                                             CE.DAYS_EXTENSION
                                                            ELSE
                                                             NULL
                                                          END),
                                                          0) +
                                                     ifnull(#{dataDictionVal},0) ) day),date_format(now(), '%Y-%m-%d')),0) DAYS_AFTER_DATE_COUNT,
                              TRCI.COMPANY                        
                          FROM 
                          (
                          	  select T.RES_CUST_ID CUST_ID,
                          	   T.LAST_CUST_FOLLOW_ID CUST_FOLLOW_ID,
                               T.INPUT_DATE CREATE_TIME,
                               T.RES_CUST_ID,
                               T.NAME,
                               T.IS_MAJOR,
                               T.OWNER_ACC,
                               T.STATUS,
                               T.last_Option_Id OPTIONLIST_ID,
                               T.ACTION_DATE  LAST_ACTION_DATE,
                               T.NEXTFOLLOW_DATE  NEXT_ACTION_DATE,
                               T.last_cust_type_id CUST_TYPE_ID,
                               T.COMPANY,
                               T.OWNER_START_DATE, 						            	   
			                   T.MOBILEPHONE,
			                    T.TELPHONE
                               from TSM_RES_CUST_INFO T        
                                 WHERE T.ORG_ID = #{orgId}                          
                        			 and T.IS_DEL = 0
                         			 and T.LAST_CUST_FOLLOW_ID IS NOT NULL
                           				AND (T.STATUS = 3 or T.STATUS = 2)
                                		 AND T.OWNER_ACC = #{ownerAcc} 
                                		 and T.TYPE = 2  
                                	<if test="custIds != null and custIds.size() > 0">
							   		  AND T.RES_CUST_ID IN 
							   			  <foreach collection="custIds" item="cid" open="(" separator="," close=")">
							   				  #{cid}
							   			  </foreach>
							        </if>                             		 
                                      <!-- 下次跟进时间 -->
		                          <if test=" nextStartActionDate != null and nextStartActionDate !='' ">
		                         		  AND T.NEXTFOLLOW_DATE >= str_to_date(concat(#{nextStartActionDate}, '00:00:00'), '%Y-%m-%d %H:%i:%s')
		                          </if>
		                         <if test=" nextEndActionDate != null and nextEndActionDate !='' ">
		                         		  AND T.NEXTFOLLOW_DATE <![CDATA[ <= ]]>str_to_date(concat(#{nextEndActionDate}, '23:59:59'),'%Y-%m-%d %H:%i:%s')
		                         </if>
		                         <!-- 本次跟进时间 -->
								<if test=" lastStartActionDate != null and lastStartActionDate !='' ">
									AND T.ACTION_DATE >=
									 str_to_date(concat(#{lastStartActionDate,jdbcType=VARCHAR}, '00:00:00'),
						                                       '%Y-%m-%d %H:%i:%s')
								</if>
								<if test=" lastEndActionDate != null and lastEndActionDate !='' ">
									AND T.ACTION_DATE <![CDATA[ <= ]]>
									str_to_date(concat(#{lastEndActionDate,jdbcType=VARCHAR}, '23:59:59'),
						                                       '%Y-%m-%d %H:%i:%s')
								</if>
								<!-- 标签判断 -->
								<if test=" labels != null and labels !='' ">
									<foreach collection="labels" item="label" separator=" " >
						       			AND T.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
						       		</foreach> 											
								</if>
								 <if test=" custTypeId != null and custTypeId != '' ">
										AND T.last_cust_type_id = #{custTypeId,jdbcType=VARCHAR}
						  		</if>
						  		 <if test=" optionlistId != null and optionlistId != '' ">
										AND T.last_Option_Id = #{optionlistId,jdbcType=VARCHAR}
								</if>
								<if test=" queryText != null and queryText != '' and queryType != 2 and queryType != 3">
									<choose>
						       			<when test="queryType == 1">
						       				AND (T.NAME LIKE concat('%',#{queryText},'%'))
						       			</when>
						       			<when test="queryType == 2 and (state == null || state == 0)">
						       				AND (T.MAIN_LINKMAN LIKE concat('%',#{queryText},'%'))
						       			</when>
						       			<when test="queryType == 4"><!-- 单位名称 -->
						       				AND (T.COMPANY LIKE concat('%',#{queryText},'%'))
						       			</when>
						       		</choose>		
								</if>    	
                          ) TRCI
                          						                               
						  <!-- 根据（客户分组，延期申请时间倒叙），取最近一条记录 -->
                          LEFT JOIN (select fce.cust_id,fce.DAYS_EXTENSION,fce.STATUS_EXTENDED,fce.application_time_extension from
						   (select cust_id,DAYS_EXTENSION,STATUS_EXTENDED,application_time_extension from tsm_cust_extension 
						    where org_id = #{orgId}  order by application_time_extension desc)
						    fce group by fce.cust_id ) CE
                            ON CE.CUST_ID = TRCI.RES_CUST_ID                        
                         where date_add(TRCI.OWNER_START_DATE, interval (1+
                                ifnull((CASE
                                                            WHEN CE.STATUS_EXTENDED = 1 THEN
                                                             CE.DAYS_EXTENSION
                                                            ELSE
                                                             NULL
                                                          END),
                                                          0) +
                                                     ifnull(#{dataDictionVal},0)-ifnull(#{dataDictionVal1},0)
                                ) day) &lt;=
                               str_to_date(date_format(now(),
                                               '%Y-%m-%d %H:%i:%s'),
                                       '%Y-%m-%d %H:%i:%s')
                           
                           <if test=" orderKey != null and orderKey != '' ">
								ORDER BY ${orderKey}
							</if>		
						limit #{page.currentResult,jdbcType=DECIMAL},#{page.showCount,jdbcType=DECIMAL}								
	</sql>
	
	<!-- 跟进警报总数 -->
	<sql id="public_alarm_sql_follow_count">
		select count(1) from(
					SELECT  TRCI.CUST_ID, 
							   TRCI.CUST_FOLLOW_ID,
                               TRCI.CREATE_TIME,
                               TRCI.RES_CUST_ID,
                               TRCI.NAME,
                               TRCI.IS_MAJOR,
                               TRCI.OWNER_ACC,
                               TRCI.STATUS,
                               TRCI.OPTIONLIST_ID,
                               TRCI.LAST_ACTION_DATE,
                               TRCI.NEXT_ACTION_DATE,
                               TRCI.CUST_TYPE_ID,
								 TRCI.MOBILEPHONE,
			                   TRCI.TELPHONE,
                               CE.STATUS_EXTENDED,
                               ifnull(datediff(date_add(TRCI.OWNER_START_DATE, interval (1+
                                ifnull((CASE
                                                            WHEN CE.STATUS_EXTENDED = 1 THEN
                                                             CE.DAYS_EXTENSION
                                                            ELSE
                                                             NULL
                                                          END),
                                                          0) +
                                                     ifnull(#{dataDictionVal},0) ) day),date_format(now(), '%Y-%m-%d')),0) DAYS_AFTER_DATE_COUNT,
                              TRCI.COMPANY                        
                          FROM 
                          (
                          	  select T.RES_CUST_ID CUST_ID,
                          	   T.LAST_CUST_FOLLOW_ID CUST_FOLLOW_ID,
                               T.INPUT_DATE CREATE_TIME,
                               T.RES_CUST_ID,
                               T.NAME,
                               T.IS_MAJOR,
                               T.OWNER_ACC,
                               T.STATUS,
                               T.last_Option_Id OPTIONLIST_ID,
                               T.ACTION_DATE  LAST_ACTION_DATE,
                               T.NEXTFOLLOW_DATE  NEXT_ACTION_DATE,
                               T.last_cust_type_id CUST_TYPE_ID,
                               T.COMPANY,
                               T.OWNER_START_DATE, 						            	   
			                   T.MOBILEPHONE,
			                    T.TELPHONE
                               from TSM_RES_CUST_INFO T        
                                 WHERE T.ORG_ID = #{orgId}                          
                        			 and T.IS_DEL = 0
                         			 and T.LAST_CUST_FOLLOW_ID IS NOT NULL
                           				AND (T.STATUS = 3 or T.STATUS = 2)
                                		 AND T.OWNER_ACC = #{ownerAcc} 
                                		 and T.TYPE = 2 
								 <if test="custIds != null and custIds.size() > 0">
							   		  AND T.RES_CUST_ID IN 
							   			  <foreach collection="custIds" item="cid" open="(" separator="," close=")">
							   				  #{cid}
							   			  </foreach>
							        </if>   	
                                      <!-- 下次跟进时间 -->
		                          <if test=" nextStartActionDate != null and nextStartActionDate !='' ">
		                         		  AND T.NEXTFOLLOW_DATE >= str_to_date(concat(#{nextStartActionDate}, '00:00:00'), '%Y-%m-%d %H:%i:%s')
		                          </if>
		                         <if test=" nextEndActionDate != null and nextEndActionDate !='' ">
		                         		  AND T.NEXTFOLLOW_DATE <![CDATA[ <= ]]>str_to_date(concat(#{nextEndActionDate}, '23:59:59'),'%Y-%m-%d %H:%i:%s')
		                         </if>
		                         <!-- 本次跟进时间 -->
								<if test=" lastStartActionDate != null and lastStartActionDate !='' ">
									AND T.ACTION_DATE >=
									 str_to_date(concat(#{lastStartActionDate,jdbcType=VARCHAR}, '00:00:00'),
						                                       '%Y-%m-%d %H:%i:%s')
								</if>
								<if test=" lastEndActionDate != null and lastEndActionDate !='' ">
									AND T.ACTION_DATE <![CDATA[ <= ]]>
									str_to_date(concat(#{lastEndActionDate,jdbcType=VARCHAR}, '23:59:59'),
						                                       '%Y-%m-%d %H:%i:%s')
								</if>
								<!-- 标签判断 -->
								<if test=" labels != null and labels !='' ">
									<foreach collection="labels" item="label" separator=" " >
						       			AND T.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
						       		</foreach> 											
								</if>
								 <if test=" custTypeId != null and custTypeId != '' ">
										AND T.last_cust_type_id = #{custTypeId,jdbcType=VARCHAR}
						  		</if>
						  		 <if test=" optionlistId != null and optionlistId != '' ">
										AND T.last_Option_Id = #{optionlistId,jdbcType=VARCHAR}
								</if>
								<if test=" queryText != null and queryText != '' and queryType != 2 and queryType != 3">
									<choose>
						       			<when test="queryType == 1">
						       				AND (T.NAME LIKE concat('%',#{queryText},'%'))
						       			</when>
						       			<when test="queryType == 2 and (state == null || state == 0)">
						       				AND (T.MAIN_LINKMAN LIKE concat('%',#{queryText},'%'))
						       			</when>
						       			<when test="queryType == 4"><!-- 单位名称 -->
						       				AND (T.COMPANY LIKE concat('%',#{queryText},'%'))
						       			</when>
						       		</choose>		
								</if> 
                          ) TRCI
                          						                               
						  <!-- 根据（客户分组，延期申请时间倒叙），取最近一条记录 -->
                          LEFT JOIN (select fce.cust_id,fce.DAYS_EXTENSION,fce.STATUS_EXTENDED,fce.application_time_extension from
						   (select cust_id,DAYS_EXTENSION,STATUS_EXTENDED,application_time_extension from tsm_cust_extension 
						    where org_id = #{orgId}  order by application_time_extension desc)
						    fce group by fce.cust_id ) CE
                            ON CE.CUST_ID = TRCI.RES_CUST_ID                        
                         where date_add(TRCI.OWNER_START_DATE, interval (1+
                                ifnull((CASE
                                                            WHEN CE.STATUS_EXTENDED = 1 THEN
                                                             CE.DAYS_EXTENSION
                                                            ELSE
                                                             NULL
                                                          END),
                                                          0) +
                                                     ifnull(#{dataDictionVal},0)-ifnull(#{dataDictionVal1},0)
                                ) day) &lt;=
                               str_to_date(date_format(now(),
                                               '%Y-%m-%d %H:%i:%s'),
                                       '%Y-%m-%d %H:%i:%s')
                           )  t                       
			</sql>
	
	<!-- 跟进警报 -->
	<sql id="public_alarm_phone_sql_follow">
						SELECT  TRCI.CUST_ID, 
							   TRCI.CUST_FOLLOW_ID,
                               TRCI.CREATE_TIME,
                               TRCI.RES_CUST_ID,
                               TRCI.NAME,
                               TRCI.IS_MAJOR,
                               TRCI.OWNER_ACC,
                               TRCI.STATUS,
                               TRCI.OPTIONLIST_ID,
                               TRCI.LAST_ACTION_DATE,
                               TRCI.NEXT_ACTION_DATE,
                               TRCI.CUST_TYPE_ID,
								 TRCI.MOBILEPHONE,
			                   TRCI.TELPHONE,
                               CE.STATUS_EXTENDED,
                               ifnull(datediff(date_add(TRCI.OWNER_START_DATE, interval (1+
                                ifnull((CASE
                                                            WHEN CE.STATUS_EXTENDED = 1 THEN
                                                             CE.DAYS_EXTENSION
                                                            ELSE
                                                             NULL
                                                          END),
                                                          0) +
                                                     ifnull(#{dataDictionVal},0) ) day),date_format(now(), '%Y-%m-%d')),0) DAYS_AFTER_DATE_COUNT,
                              TRCI.COMPANY                        
                          FROM 
                          (
                          	  select T.RES_CUST_ID CUST_ID,
                          	   T.LAST_CUST_FOLLOW_ID CUST_FOLLOW_ID,
                               T.INPUT_DATE CREATE_TIME,
                               T.RES_CUST_ID,
                               T.NAME,
                               T.IS_MAJOR,
                               T.OWNER_ACC,
                               T.STATUS,
                               T.last_Option_Id OPTIONLIST_ID,
                               T.ACTION_DATE  LAST_ACTION_DATE,
                               T.NEXTFOLLOW_DATE  NEXT_ACTION_DATE,
                               T.last_cust_type_id CUST_TYPE_ID,
                               T.COMPANY,
                               T.OWNER_START_DATE, 						            	   
			                   T.MOBILEPHONE,
			                    T.TELPHONE
                               from TSM_RES_CUST_INFO T        
                                 WHERE T.ORG_ID = #{orgId}                          
                        			 and T.IS_DEL = 0
                         			 and T.LAST_CUST_FOLLOW_ID IS NOT NULL
                           				AND (T.STATUS = 3 or T.STATUS = 2)
                                		 AND T.OWNER_ACC = #{ownerAcc} 
                                		 and T.TYPE = 2   
                                 <if test="custIds != null and custIds.size() > 0">
							   		  AND T.RES_CUST_ID IN 
							   			  <foreach collection="custIds" item="cid" open="(" separator="," close=")">
							   				  #{cid}
							   			  </foreach>
							        </if>
							        <if test=" queryText != null and queryText != '' and queryType == 3">
										<choose>
							       			<when test="queryType == 3">
						       				AND T.MOBILEPHONE = #{queryText} 						       									
						       			</when>
							       		</choose>	
									</if>                           		 
                                      <!-- 下次跟进时间 -->
		                          <if test=" nextStartActionDate != null and nextStartActionDate !='' ">
		                         		  AND T.NEXTFOLLOW_DATE >= str_to_date(concat(#{nextStartActionDate}, '00:00:00'), '%Y-%m-%d %H:%i:%s')
		                          </if>
		                         <if test=" nextEndActionDate != null and nextEndActionDate !='' ">
		                         		  AND T.NEXTFOLLOW_DATE <![CDATA[ <= ]]>str_to_date(concat(#{nextEndActionDate}, '23:59:59'),'%Y-%m-%d %H:%i:%s')
		                         </if>
		                         <!-- 本次跟进时间 -->
								<if test=" lastStartActionDate != null and lastStartActionDate !='' ">
									AND T.ACTION_DATE >=
									 str_to_date(concat(#{lastStartActionDate,jdbcType=VARCHAR}, '00:00:00'),
						                                       '%Y-%m-%d %H:%i:%s')
								</if>
								<if test=" lastEndActionDate != null and lastEndActionDate !='' ">
									AND T.ACTION_DATE <![CDATA[ <= ]]>
									str_to_date(concat(#{lastEndActionDate,jdbcType=VARCHAR}, '23:59:59'),
						                                       '%Y-%m-%d %H:%i:%s')
								</if>
								<!-- 标签判断 -->
								<if test=" labels != null and labels !='' ">
									<foreach collection="labels" item="label" separator=" " >
						       			AND T.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
						       		</foreach> 											
								</if>
								 <if test=" custTypeId != null and custTypeId != '' ">
										AND T.last_cust_type_id = #{custTypeId,jdbcType=VARCHAR}
						  		</if>
						  		 <if test=" optionlistId != null and optionlistId != '' ">
										AND T.last_Option_Id = #{optionlistId,jdbcType=VARCHAR}
								</if>
								 union
								  select T.RES_CUST_ID CUST_ID,
                          	   T.LAST_CUST_FOLLOW_ID CUST_FOLLOW_ID,
                               T.INPUT_DATE CREATE_TIME,
                               T.RES_CUST_ID,
                               T.NAME,
                               T.IS_MAJOR,
                               T.OWNER_ACC,
                               T.STATUS,
                               T.last_Option_Id OPTIONLIST_ID,
                               T.ACTION_DATE  LAST_ACTION_DATE,
                               T.NEXTFOLLOW_DATE  NEXT_ACTION_DATE,
                               T.last_cust_type_id CUST_TYPE_ID,
                               T.COMPANY,
                               T.OWNER_START_DATE, 						            	   
			                   T.MOBILEPHONE,
			                    T.TELPHONE
                               from TSM_RES_CUST_INFO T        
                                 WHERE T.ORG_ID = #{orgId}                          
                        			 and T.IS_DEL = 0
                         			 and T.LAST_CUST_FOLLOW_ID IS NOT NULL
                           				AND (T.STATUS = 3 or T.STATUS = 2)
                                		 AND T.OWNER_ACC = #{ownerAcc} 
                                		 and T.TYPE = 2   
                                 <if test="custIds != null and custIds.size() > 0">
							   		  AND T.RES_CUST_ID IN 
							   			  <foreach collection="custIds" item="cid" open="(" separator="," close=")">
							   				  #{cid}
							   			  </foreach>
							        </if>
							        <if test=" queryText != null and queryText != '' and queryType == 3">
										<choose>
							       			<when test="queryType == 3">
						       				AND T.telphone = #{queryText} 						       									
						       			</when>
							       		</choose>	
									</if>                           		 
                                      <!-- 下次跟进时间 -->
		                          <if test=" nextStartActionDate != null and nextStartActionDate !='' ">
		                         		  AND T.NEXTFOLLOW_DATE >= str_to_date(concat(#{nextStartActionDate}, '00:00:00'), '%Y-%m-%d %H:%i:%s')
		                          </if>
		                         <if test=" nextEndActionDate != null and nextEndActionDate !='' ">
		                         		  AND T.NEXTFOLLOW_DATE <![CDATA[ <= ]]>str_to_date(concat(#{nextEndActionDate}, '23:59:59'),'%Y-%m-%d %H:%i:%s')
		                         </if>
		                         <!-- 本次跟进时间 -->
								<if test=" lastStartActionDate != null and lastStartActionDate !='' ">
									AND T.ACTION_DATE >=
									 str_to_date(concat(#{lastStartActionDate,jdbcType=VARCHAR}, '00:00:00'),
						                                       '%Y-%m-%d %H:%i:%s')
								</if>
								<if test=" lastEndActionDate != null and lastEndActionDate !='' ">
									AND T.ACTION_DATE <![CDATA[ <= ]]>
									str_to_date(concat(#{lastEndActionDate,jdbcType=VARCHAR}, '23:59:59'),
						                                       '%Y-%m-%d %H:%i:%s')
								</if>
								<!-- 标签判断 -->
								<if test=" labels != null and labels !='' ">
									<foreach collection="labels" item="label" separator=" " >
						       			AND T.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
						       		</foreach> 											
								</if>
								 <if test=" custTypeId != null and custTypeId != '' ">
										AND T.last_cust_type_id = #{custTypeId,jdbcType=VARCHAR}
						  		</if>
						  		 <if test=" optionlistId != null and optionlistId != '' ">
										AND T.last_Option_Id = #{optionlistId,jdbcType=VARCHAR}
								</if>   
								) TRCI
                          						                               
						  <!-- 根据（客户分组，延期申请时间倒叙），取最近一条记录 -->
                          LEFT JOIN (select fce.cust_id,fce.DAYS_EXTENSION,fce.STATUS_EXTENDED,fce.application_time_extension from
						   (select cust_id,DAYS_EXTENSION,STATUS_EXTENDED,application_time_extension from tsm_cust_extension 
						    where org_id = #{orgId}  order by application_time_extension desc)
						    fce group by fce.cust_id ) CE
                            ON CE.CUST_ID = TRCI.RES_CUST_ID                        
                         where date_add(TRCI.OWNER_START_DATE, interval (1+
                                ifnull((CASE
                                                            WHEN CE.STATUS_EXTENDED = 1 THEN
                                                             CE.DAYS_EXTENSION
                                                            ELSE
                                                             NULL
                                                          END),
                                                          0) +
                                                     ifnull(#{dataDictionVal},0)-ifnull(#{dataDictionVal1},0)
                                ) day) &lt;=
                               str_to_date(date_format(now(),
                                               '%Y-%m-%d %H:%i:%s'),
                                       '%Y-%m-%d %H:%i:%s')		
	</sql>
	
	<!--团队销售进程跟进 -->
	<sql id="team_sale_follow_list">
		SELECT f.CUST_ID,
		f.ACTION_TYPE,
		f.FOLLOW_TYPE,
		f.ACTION_DATE LAST_ACTION_DATE,
		f.FOLLOW_DATE NEXT_ACTION_DATE,
		f.FEEDBACK_COMMENT,
		f.SALE_PROCESS_ID,
		f.LAST_SALE_PROCESS_ID, 
		f.follow_acc, 
		CASE 
			WHEN
			 LAST_SALE_PROCESS_ID IS NULL
			THEN 4
			WHEN
			SALE_PROCESS_ID=LAST_SALE_PROCESS_ID 
			THEN 3 
			ELSE 2 
		END changeType
		FROM TSM_CUST_FOLLOW f	 
		WHERE  f.ORG_ID = #{orgId}	
		and f.cust_id in(
			select c.res_cust_id from tsm_res_cust_info c 
			WHERE c.ORG_ID = #{orgId,jdbcType=VARCHAR}
		<if test="custIds != null and custIds.size() > 0">
   		  AND c.RES_CUST_ID IN 
   			  <foreach collection="custIds" item="cid" open="(" separator="," close=")">
   				  #{cid}
   			  </foreach>
        </if>
		<if test=" queryText != null and queryText != ''">
			<choose>
       			<when test="queryType == 1">
       				AND  c.NAME LIKE concat('%',#{queryText},'%')
       			</when>
       			<when test="queryType == 2 and (state == null or state == 0)">
       				AND c.MAIN_LINKMAN LIKE concat('%',#{queryText},'%')
       			</when>
       			<when test="queryType == 3 and (state == null or state == 0)">
       				AND c.MOBILEPHONE = #{queryText} 						       									
       			</when>
       			<when test="queryType == 4"><!-- 单位名称 -->
       				AND c.COMPANY LIKE concat('%',#{queryText},'%')
       			</when>
       		</choose>	
		</if>
		AND c.STATUS in(2,3,6,7,8)
		AND c.type = 2  
		AND c.is_del = 0
		<choose>
            	<when test="roleType!= null and roleType == 1"><!-- 管理者 拥有查看所管理部门资源的权限 -->                            		                 		
            		<choose>                		
             			<when test="ownerAccs != null"> <!-- 有选择指定拥有者 -->	                            				                  			
               			and c.OWNER_ACC in
               			<foreach collection="ownerAccs" index="index" item="item" open="("
									separator="," close=")">
						#{item}
					</foreach>
			    </when>
			    <otherwise>
				AND c.OWNER_ACC = #{ownerAcc}
             			</otherwise>
             		</choose>                       	
             	</when>
             	<otherwise><!-- 只能查看自己的资源 -->
             		AND c.OWNER_ACC = #{ownerAcc}
             	</otherwise>
          </choose>
          <if test="queryText != null and queryText != '' and queryType ==3 and (state == null || state == 0)">
          	union select c.res_cust_id from tsm_res_cust_info c 
			WHERE c.ORG_ID = #{orgId,jdbcType=VARCHAR}
		<if test="custIds != null and custIds.size() > 0">
   		  AND c.RES_CUST_ID IN 
   			  <foreach collection="custIds" item="cid" open="(" separator="," close=")">
   				  #{cid}
   			  </foreach>
        </if>
		<if test=" queryText != null and queryText != ''">
			<choose>
       			<when test="queryType == 3 and (state == null or state == 0)">
       				AND c.telphone = #{queryText} 						       									
       			</when>
       		</choose>	
		</if>
		AND c.STATUS in(2,3,6,7,8)
		AND c.type = 2  
		AND c.is_del = 0
		<choose>
            	<when test="roleType!= null and roleType == 1"><!-- 管理者 拥有查看所管理部门资源的权限 -->                            		                 		
            		<choose>                		
             			<when test="ownerAccs != null"> <!-- 有选择指定拥有者 -->	                            				                  			
               			and c.OWNER_ACC in
               			<foreach collection="ownerAccs" index="index" item="item" open="("
									separator="," close=")">
						#{item}
					</foreach>
			    </when>
			    <otherwise>
				AND c.OWNER_ACC = #{ownerAcc}
             			</otherwise>
             		</choose>                       	
             	</when>
             	<otherwise><!-- 只能查看自己的资源 -->
             		AND c.OWNER_ACC = #{ownerAcc}
             	</otherwise>
          </choose>
          </if>
		)	
     	<!-- 下次联系方式 -->
		<if test=" followType != null and followType !='' ">
			AND f.FOLLOW_TYPE = #{followType,jdbcType=VARCHAR}
		</if>
		<!-- 本次联系方式 -->
		<if test=" actionType != null and actionType !='' ">
			AND f.ACTION_TYPE = #{actionType,jdbcType=VARCHAR}
		</if>
		<!-- 下次联系时间 -->	
		<if test=" nextStartActionDate != null and nextStartActionDate !='' ">			
			AND f.FOLLOW_DATE >=
			str_to_date(concat(#{nextStartActionDate,jdbcType=VARCHAR}, '00:00:00'),
				                                       '%Y-%m-%d %H:%i:%s')
		</if>
		<if test=" nextEndActionDate != null and nextEndActionDate !='' ">
			AND f.FOLLOW_DATE <![CDATA[ <= ]]>
			str_to_date(concat(#{nextEndActionDate,jdbcType=VARCHAR}, '23:59:59'),
				                                       '%Y-%m-%d %H:%i:%s')
		</if>
		<!-- 本次跟进时间 -->
		<if test=" lastStartActionDate != null and lastStartActionDate !='' ">
			AND f.ACTION_DATE >=
			str_to_date(concat(#{lastStartActionDate,jdbcType=VARCHAR}, '00:00:00'),
				                                       '%Y-%m-%d %H:%i:%s')
		</if>
		<if test=" lastEndActionDate != null and lastEndActionDate !='' ">
			AND f.ACTION_DATE <![CDATA[ <= ]]>
			str_to_date(concat(#{lastEndActionDate,jdbcType=VARCHAR}, '23:59:59'),
				                                       '%Y-%m-%d %H:%i:%s')
		</if>
		<!-- 本次销售进程 -->
		<if test=" optionlistId != null and optionlistId != '' ">
			AND f.SALE_PROCESS_ID = #{optionlistId,jdbcType=VARCHAR}
		</if>
		<!-- 上次销售进程 -->
		<if test=" lastSaleProcessId != null and lastSaleProcessId != '' ">
			AND f.LAST_SALE_PROCESS_ID = #{lastSaleProcessId,jdbcType=VARCHAR}
		</if>	
				<!--  销售进程变化  -->
		<if test="changeType == 2 or changeType == '2' ">
			AND f.LAST_SALE_PROCESS_ID<![CDATA[ <> ]]>f.SALE_PROCESS_ID
		</if>
		<if test="changeType == 3 or changeType == '3' ">
			AND f.LAST_SALE_PROCESS_ID = f.SALE_PROCESS_ID
		</if>	
		<if test="changeType == 4 or changeType == '4' ">
			AND f.LAST_SALE_PROCESS_ID IS NULL
		</if>
		<if test=" orderKey != null and orderKey != '' and queryType != 3">
			ORDER BY ${orderKey}
		</if>
	</sql>
	
	<!-- 客户跟进详细页面 右侧其他待跟进列表 待跟进客户 -->
	<select id="findFollowRightViewListPage" resultMap="RestDtoMap" parameterType="com.qftx.tsm.follow.dto.RestDto">
			<!-- SELECT tg.*
                  FROM ( -->SELECT 
                               TRCI.RES_CUST_ID,
                               TRCI.NAME,
                               TRCI.ACTION_DATE,
              				   TRCI.AMOYTOCUSTOMER_DATE,                             
                               TRCI.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
                               ifnull(TRCI.MOBILEPHONE, TRCI.TELPHONE) TELPHONE                             
                          FROM TSM_RES_CUST_INFO TRCI                     			                                    
                         WHERE TRCI.IS_DEL = 0                                                  
                           AND TRCI.ORG_ID = #{orgId}
                           AND TRCI.OWNER_ACC = #{ownerAcc}                          
                           	<!--  and TRCI.LAST_CUST_FOLLOW_ID is not null -->
                           		AND TRCI.STATUS in(2,3,6,7,8)	
			                   and TRCI.TYPE = 2   
			                   and TRCI.RES_CUST_ID != #{resCustId} 
			             <!-- 下次联系时间是否为空 -->
				  		<!-- <choose>
				  			<when test="dateIsNull == 0">
				  				<choose>
				  					<when test="orderType == 1 or orderType == 2">
						  				AND TRCI.NEXTFOLLOW_DATE IS NULL
				  					</when>
				  					<when test="orderType == 3">
				  						AND TRCI.ACTION_DATE IS NULL
				  					</when>
				  				</choose>
				  			</when>
				  			<when test="dateIsNull == 1">
				  				<choose>
				  					<when test="orderType == 1 or orderType == 2">
						  				AND TRCI.NEXTFOLLOW_DATE IS NOT NULL
				  					</when>
				  					<when test="orderType == 3">
				  						AND TRCI.ACTION_DATE IS NOT NULL
				  					</when>
				  				</choose>
				  			</when>
				  		</choose> -->
				  		<choose>
							<when test="isContact == 1">
								and DATE_FORMAT(TRCI.OWNER_ACTION_DATE, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')   
							</when>
							<when test="isContact == 0">
								<if test="ids.size() > 0">
									AND TRCI.RES_CUST_ID NOT IN
									<foreach collection="ids" item="item" open="(" separator="," close=")">
										#{item} 
									</foreach>
								</if>
							</when>
						</choose>	
			       		<!-- 下次跟进时间 -->
						<if test=" nextStartActionDate != null and nextStartActionDate !='' ">
							AND TRCI.NEXTFOLLOW_DATE >=
							   str_to_date(concat(#{nextStartActionDate,jdbcType=VARCHAR}, '00:00:00'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if>
						<if test=" nextEndActionDate != null and nextEndActionDate !='' ">
							AND TRCI.NEXTFOLLOW_DATE <![CDATA[ <= ]]>
							str_to_date(concat(#{nextEndActionDate,jdbcType=VARCHAR}, '23:59:59'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if>
						<!-- 本次跟进时间 -->
						<if test=" lastStartActionDate != null and lastStartActionDate !='' ">
							AND TRCI.ACTION_DATE >=
							 str_to_date(concat(#{lastStartActionDate,jdbcType=VARCHAR}, '00:00:00'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if>
						<if test=" lastEndActionDate != null and lastEndActionDate !='' ">
							AND TRCI.ACTION_DATE <![CDATA[ <= ]]>
							str_to_date(concat(#{lastEndActionDate,jdbcType=VARCHAR}, '23:59:59'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if> 	
						<!-- 最近跟进客户类型ID -->
					  <if test=" lastCustType != null and lastCustType != '' ">
							AND TRCI.last_cust_type_id = #{lastCustType,jdbcType=VARCHAR}
					  </if>
						<!-- 最近跟进销售进程ID -->
						<if test=" lastOptionId != null and lastOptionId != '' ">
							AND TRCI.last_Option_Id = #{lastOptionId,jdbcType=VARCHAR}
						</if> 
						 <!-- 资源分组ID -->
					  <if test=" resGroupId != null and resGroupId != '' ">
							AND TRCI.RES_GROUP_ID = #{resGroupId,jdbcType=VARCHAR}
					  </if>
					  <if test="taoStartDate!=null and taoStartDate!=''">
					       <![CDATA[
						   		AND str_to_date(date_format(TRCI.AMOYTOCUSTOMER_DATE,'%Y-%m-%d'),'%Y-%m-%d')>=str_to_date(#{taoStartDate}, '%Y-%m-%d')  
						   ]]>
						</if>  
						<if test="taoEndDate!=null and taoEndDate!=''">
						   <![CDATA[
						   		AND str_to_date(date_format(TRCI.AMOYTOCUSTOMER_DATE,'%Y-%m-%d'),'%Y-%m-%d')<=str_to_date(#{taoEndDate}, '%Y-%m-%d') 
						   ]]>
						</if>	
						 <if test=" orderType != null and orderType != '' ">
							<choose>
				      			<when test="orderType == 1">
				      				order by TRCI.NEXTFOLLOW_DATE asc
				      			</when>
				      			<when test="orderType == 2">
				      				order by TRCI.NEXTFOLLOW_DATE desc
				      			</when>
				      			<when test="orderType == 3">
				      				order by TRCI.ACTION_DATE asc
				      			</when>
				      			<when test="orderType == 4">
				      				order by TRCI.ACTION_DATE desc
				      			</when>
				      			<when test="orderType == 5">
				      				order by TRCI.AMOYTOCUSTOMER_DATE asc
				      			</when>
				      			<when test="orderType == 6">
				      				order by TRCI.AMOYTOCUSTOMER_DATE desc
				      			</when>
			      			</choose>
					 	 </if>
                         <!-- ORDER BY TRCI.NEXTFOLLOW_DATE ASC,CONVERT(TRCI.NAME USING GBK) --><!-- ) tg -->
                 <!-- WHERE 
                  tg.RES_CUST_ID != #{resCustId} -->
                  
                	<!-- limit #{startPage},#{endPage} -->
	</select>
	
	<!-- 客户跟进详细页面 右侧其他待跟进列表 待跟进警报客户 -->
	<select id="findFollowRightAralmView" resultMap="RestDtoMap" parameterType="com.qftx.tsm.follow.dto.RestDto">
			SELECT tg.RES_CUST_ID,
						tg.NAME,
						tg.NEXT_ACTION_DATE,
						tg.TELPHONE
                  FROM (SELECT 
                               TRCI.RES_CUST_ID,
                               TRCI.NAME,                             
                               TRCI.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
                               ifnull(TRCI.MOBILEPHONE, TRCI.TELPHONE) TELPHONE,                            
                               ifnull(datediff(date_add(TRCI.OWNER_START_DATE, interval (1+
                                ifnull((CASE
                                                            WHEN CE.STATUS_EXTENDED = 1 THEN
                                                             CE.DAYS_EXTENSION
                                                            ELSE
                                                             NULL
                                                          END),
                                                          0) +
                                                     ifnull(#{dataDictionVal},0) )  day),date_format(now(), '%Y-%m-%d')),0) DAYS_AFTER_DATE_COUNT 
                          FROM TSM_RES_CUST_INFO TRCI                                     	
                           <!-- 根据（客户分组，延期申请时间倒叙），取最近一条记录 -->
                            LEFT JOIN (select fce.cust_id,fce.DAYS_EXTENSION,fce.STATUS_EXTENDED,fce.application_time_extension from
						   (select cust_id,DAYS_EXTENSION,STATUS_EXTENDED,application_time_extension from tsm_cust_extension 
						    where org_id = #{orgId}  order by application_time_extension desc)
						    fce group by fce.cust_id ) CE
                            ON CE.CUST_ID = TRCI.RES_CUST_ID                   
                         WHERE TRCI.IS_DEL = 0
                           and TRCI.NEXTFOLLOW_DATE IS NOT NULL
                           AND TRCI.ORG_ID = #{orgId}
                           AND TRCI.OWNER_ACC = #{ownerAcc}                         
                           AND (TRCI.STATUS = 3 or TRCI.STATUS = 2 )	
			             		  AND date_add(TRCI.OWNER_START_DATE, interval (1+
                                ifnull((CASE
                                                            WHEN CE.STATUS_EXTENDED = 1 THEN
                                                             CE.DAYS_EXTENSION
                                                            ELSE
                                                             NULL
                                                          END),
                                                          0) +
                                                     ifnull(#{dataDictionVal},0)-ifnull(#{dataDictionVal1},0)
                                ) day) &lt;=
                               str_to_date(date_format(now(),
                                               '%Y-%m-%d %H:%i:%s'),
                                       '%Y-%m-%d %H:%i:%s')
                           and TRCI.TYPE = 2      		
                          ORDER BY DAYS_AFTER_DATE_COUNT ASC,CONVERT(TRCI.NAME USING GBK)) tg
                 WHERE 
                  tg.RES_CUST_ID != #{resCustId} 
                	limit #{startPage},#{endPage}
	</select>
	
	<!-- 客户跟进详细页面 右侧其他待跟进列表 今日计划意向客户 -->
	<select id="findFollowPlanWill" resultMap="RestDtoMap" parameterType="com.qftx.tsm.follow.dto.RestDto">
			SELECT 
			  trci.RES_CUST_ID,
			  trci.ACTION_DATE,
              trci.AMOYTOCUSTOMER_DATE,
			  trci.NAME,
			  trci.NEXTFOLLOW_DATE NEXT_ACTION_DATE,
			  IFNULL(trci.MOBILEPHONE, trci.TELPHONE) TELPHONE 
			FROM
			  tsm_res_cust_info trci 
			WHERE
			   trci.ORG_ID = #{orgId} 
			  AND trci.owner_acc = #{ownerAcc}
			  <!-- 最近跟进客户类型ID -->
			  <if test=" lastCustType != null and lastCustType != '' ">
					AND trci.last_cust_type_id = #{lastCustType,jdbcType=VARCHAR}
			  </if>
				<!-- 最近跟进销售进程ID -->
				<if test=" lastOptionId != null and lastOptionId != '' ">
					AND trci.last_Option_Id = #{lastOptionId,jdbcType=VARCHAR}
				</if> 
			  <!-- 资源分组ID -->
			  <if test=" resGroupId != null and resGroupId != '' ">
					AND trci.RES_GROUP_ID = #{resGroupId,jdbcType=VARCHAR}
			  </if>
			  <if test="taoStartDate!=null and taoStartDate!=''">
			       <![CDATA[
				   		AND str_to_date(date_format(trci.AMOYTOCUSTOMER_DATE,'%Y-%m-%d'),'%Y-%m-%d')>=str_to_date(#{taoStartDate}, '%Y-%m-%d')  
				   ]]>
				</if>  
				<if test="taoEndDate!=null and taoEndDate!=''">
				   <![CDATA[
				   		AND str_to_date(date_format(trci.AMOYTOCUSTOMER_DATE,'%Y-%m-%d'),'%Y-%m-%d')<=str_to_date(#{taoEndDate}, '%Y-%m-%d') 
				   ]]>
				</if>
			  AND TRCI.res_cust_id IN(
			  select o.cust_id from(
				SELECT t.cust_id FROM plan_userday_willcust t WHERE
				 t.org_id = #{orgId} 
				AND t.is_del = 0 
				AND t.sud_id = #{sudId}
				AND t.status = 0 
				AND t.state IN (0, 1) 
				AND t.cust_id != #{resCustId} 
				LIMIT #{startPage},#{endPage}
			  ) as o
			  )
			  AND trci.IS_DEL = 0 
			  <if test=" orderType != null and orderType != '' ">
					<choose>
		      			<when test="orderType == 1">
		       				order by trci.NEXTFOLLOW_DATE asc
		      			</when>
		      			<when test="orderType == 2">
		      				order by trci.NEXTFOLLOW_DATE desc
		      			</when>
		      			<when test="orderType == 3">
		      				order by trci.ACTION_DATE asc
		      			</when>
		      			<when test="orderType == 4">
		      				order by trci.ACTION_DATE desc
		      			</when>
		      			<when test="orderType == 5">
		      				order by trci.AMOYTOCUSTOMER_DATE asc
		      			</when>
		      			<when test="orderType == 6">
		      				order by trci.AMOYTOCUSTOMER_DATE desc
		      			</when>
	      			</choose>
			  </if>
	</select>
	
	<!-- 客户跟进详细页面 右侧其他待跟进列表 今日计划签约客户 -->
	<select id="findFollowPlanSign" resultMap="RestDtoMap" parameterType="com.qftx.tsm.follow.dto.RestDto">				
			SELECT 
			  trci.RES_CUST_ID,
			  trci.ACTION_DATE,
              trci.AMOYTOCUSTOMER_DATE,
			  trci.NAME,
			  trci.NEXTFOLLOW_DATE NEXT_ACTION_DATE,
			  IFNULL(trci.MOBILEPHONE, trci.TELPHONE) TELPHONE 
			FROM
			  tsm_res_cust_info trci 
			WHERE
			   trci.ORG_ID = #{orgId} 
			   AND trci.owner_acc = #{ownerAcc}
			    <!-- 最近跟进客户类型ID -->
			  <if test=" lastCustType != null and lastCustType != '' ">
					AND trci.last_cust_type_id = #{lastCustType,jdbcType=VARCHAR}
			  </if>
				<!-- 最近跟进销售进程ID -->
				<if test=" lastOptionId != null and lastOptionId != '' ">
					AND trci.last_Option_Id = #{lastOptionId,jdbcType=VARCHAR}
				</if> 
				 <!-- 资源分组ID -->
			  <if test=" resGroupId != null and resGroupId != '' ">
					AND trci.RES_GROUP_ID = #{resGroupId,jdbcType=VARCHAR}
			  </if>
			  <if test="taoStartDate!=null and taoStartDate!=''">
			       <![CDATA[
				   		AND str_to_date(date_format(trci.AMOYTOCUSTOMER_DATE,'%Y-%m-%d'),'%Y-%m-%d')>=str_to_date(#{taoStartDate}, '%Y-%m-%d')  
				   ]]>
				</if>  
				<if test="taoEndDate!=null and taoEndDate!=''">
				   <![CDATA[
				   		AND str_to_date(date_format(trci.AMOYTOCUSTOMER_DATE,'%Y-%m-%d'),'%Y-%m-%d')<=str_to_date(#{taoEndDate}, '%Y-%m-%d') 
				   ]]>
				</if>
			  AND TRCI.res_cust_id IN(
			  select o.cust_id from(
				SELECT t.cust_id FROM plan_userday_signcust t WHERE
				 t.org_id = #{orgId} 
				AND t.is_del = 0 
				AND t.sud_id = #{sudId}
				AND t.status = 0 
				AND t.state IN (0, 1) 
				AND t.cust_id != #{resCustId} 
				LIMIT #{startPage},#{endPage}
				) as o
			  )
			  AND TRCI.IS_DEL = 0 
			   <if test=" orderType != null and orderType != '' ">
					<choose>
		      			<when test="orderType == 1">
		      				order by trci.NEXTFOLLOW_DATE asc
		      			</when>
		      			<when test="orderType == 2">
		      				order by trci.NEXTFOLLOW_DATE desc
		      			</when>
		      			<when test="orderType == 3">
		      				order by trci.ACTION_DATE asc
		      			</when>
		      			<when test="orderType == 4">
		      				order by trci.ACTION_DATE desc
		      			</when>
		      			<when test="orderType == 5">
		      				order by trci.AMOYTOCUSTOMER_DATE asc
		      			</when>
		      			<when test="orderType == 6">
		      				order by trci.AMOYTOCUSTOMER_DATE desc
		      			</when>
	      			</choose>
			  </if>
	</select>
	
	<!-- 客户跟进详细页面 右侧其他待跟进列表 签约未跟进客户 -->
	<select id="findSignFollowRightView" resultMap="RestDtoMap" parameterType="com.qftx.tsm.follow.dto.RestDto">
			SELECT tg.*
                  FROM (SELECT 
                               TRCI.RES_CUST_ID,
                               TRCI.NAME,                             
                               TRCI.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
                               <choose>
                               	<when test="state != null and state == 1 ">
                               		tcf.CUST_DETAIL_MOBLIEPHONE TELPHONE
                               	</when>
                               	<otherwise>
                               		ifnull(TRCI.MOBILEPHONE, TRCI.TELPHONE) TELPHONE
                               	</otherwise>
                               </choose>                              
                          FROM TSM_RES_CUST_INFO TRCI    
                          LEFT JOIN TSM_CUST_FOLLOW tcf on tcf.org_id = #{orgId}
                           and tcf.CUST_FOLLOW_ID = trci.LAST_CUST_FOLLOW_ID
                           and tcf.CUST_STATUS != TRCI.STATUS  <!-- 最新跟进信息的客户状态与客户最新的状态不一致 -->                      				                                    
                         WHERE TRCI.IS_DEL = 0
                           and TRCI.NEXTFOLLOW_DATE IS NOT NULL
                           AND TRCI.ORG_ID = #{orgId}
                           AND TRCI.OWNER_ACC = #{ownerAcc}  
                           		AND TRCI.STATUS = 6		
			                   and TRCI.TYPE = 2   			                      		
                         ORDER BY TRCI.NEXTFOLLOW_DATE ASC,CONVERT(TRCI.NAME USING GBK)) tg
                 WHERE 
                  tg.RES_CUST_ID != #{resCustId}                   
                   and tg.CUST_FOLLOW_ID is not null 
                	limit #{startPage},#{endPage}
	</select>
	
	<!-- 客户跟进详细页面 右侧其他待跟进列表 下次跟进时间等于当日的数据-->
	<select id="findDayFollowRightViewListPage" resultMap="RestDtoMap" parameterType="com.qftx.tsm.follow.dto.RestDto">
						SELECT 
                               TRCI.RES_CUST_ID,
                               TRCI.NAME,                             
                               TRCI.ACTION_DATE,
                               TRCI.AMOYTOCUSTOMER_DATE,
                               TRCI.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
                               ifnull(TRCI.MOBILEPHONE, TRCI.TELPHONE) TELPHONE                         
                          	FROM TSM_RES_CUST_INFO TRCI                          
                         	WHERE TRCI.IS_DEL = 0
                           	AND TRCI.ORG_ID = #{orgId}
                           	AND TRCI.OWNER_ACC = #{ownerAcc}  
                            <!-- 下次联系时间是否为空 -->
				  			<!-- <choose>
				  				<when test="dateIsNull == 0">
				  					<choose>
				  						<when test="orderType == 1 or orderType == 2">
						  					AND TRCI.NEXTFOLLOW_DATE IS NULL
				  						</when>
				  						<when test="orderType == 3">
				  							AND TRCI.ACTION_DATE IS NULL
				  						</when>
				  					</choose>
				  				</when>
				  			    <when test="dateIsNull == 1">
				  					<choose>
				  						<when test="orderType == 1 or orderType == 2">
						  					AND TRCI.NEXTFOLLOW_DATE IS NOT NULL
				  						</when>
				  						<when test="orderType == 3">
				  							AND TRCI.ACTION_DATE IS NOT NULL
				  						</when>
				  					</choose>
				  			    </when>
				  		    </choose> -->
                            <!-- 最近跟进客户类型ID -->
						    <if test=" lastCustType != null and lastCustType != '' ">
								AND TRCI.last_cust_type_id = #{lastCustType,jdbcType=VARCHAR}
						    </if>
							<!-- 最近跟进销售进程ID -->
							<if test=" lastOptionId != null and lastOptionId != '' ">
								AND TRCI.last_Option_Id = #{lastOptionId,jdbcType=VARCHAR}
							</if> 
							<!-- 资源分组ID -->
							<if test=" resGroupId != null and resGroupId != '' ">
								AND TRCI.RES_GROUP_ID = #{resGroupId,jdbcType=VARCHAR}
							</if>
							<if test="taoStartDate!=null and taoStartDate!=''">
						       <![CDATA[
							   		AND str_to_date(date_format(TRCI.AMOYTOCUSTOMER_DATE,'%Y-%m-%d'),'%Y-%m-%d')>=str_to_date(#{taoStartDate}, '%Y-%m-%d')  
							   ]]>
							</if>  
							<if test="taoEndDate!=null and taoEndDate!=''">
							   <![CDATA[
							   		AND str_to_date(date_format(TRCI.AMOYTOCUSTOMER_DATE,'%Y-%m-%d'),'%Y-%m-%d')<=str_to_date(#{taoEndDate}, '%Y-%m-%d') 
							   ]]>
							</if>
							<choose>
								<when test="isContact == 1">
									and DATE_FORMAT(TRCI.OWNER_ACTION_DATE, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')   
								</when>
								<when test="isContact == 0">
									<if test="ids.size() > 0">
										AND TRCI.RES_CUST_ID NOT IN
										<foreach collection="ids" item="item" open="(" separator="," close=")">
											#{item} 
										</foreach>
									</if>
								</when>
							</choose>
			               and TRCI.TYPE = 2   			
			               and DATE_FORMAT(TRCI.NEXTFOLLOW_DATE, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')                      		
    						and TRCI.RES_CUST_ID != #{resCustId}
    						AND TRCI.STATUS in(3,2,6)
    						 <if test=" orderType != null and orderType != '' ">
								<choose>
					      			<when test="orderType == 1">
					      				order by TRCI.NEXTFOLLOW_DATE asc
					      			</when>
					      			<when test="orderType == 2">
					      				order by TRCI.NEXTFOLLOW_DATE desc
					      			</when>
					      			<when test="orderType == 3">
					      				order by TRCI.ACTION_DATE asc
					      			</when>
					      			<when test="orderType == 4">
					      				order by TRCI.ACTION_DATE desc
					      			</when>
					      			<when test="orderType == 5">
					      				order by TRCI.AMOYTOCUSTOMER_DATE asc
					      			</when>
					      			<when test="orderType == 6">
					      				order by TRCI.AMOYTOCUSTOMER_DATE desc
					      			</when>
				      			</choose>
						  </if>	
	</select>
	
	<!-- 分页查询客户跟进 -->
	<select id="findTsmCustFollowListPage" resultMap="DtoResultMap">
		<include refid="public_sql_follow" />
	</select>
	
	<!-- 分页查询客户跟进根据号码查询 -->
	<select id="findTsmCustFollowPhoneListPage" resultMap="DtoResultMap">
		<include refid="public_sql_followByPhone" />
	</select>
	
		<!-- 分页查询跟进警报 -->
	<select id="findTsmCustFollowAlarmPageList" resultMap="DtoResultMap">
		<include refid="public_alarm_sql_follow" />
	</select>
	
	<select id="findTsmCustFollowAlarmPhonePageList" resultMap="DtoResultMap">
		<include refid="public_alarm_phone_sql_follow" />
		 limit #{page.currentResult,jdbcType=DECIMAL},#{page.showCount,jdbcType=DECIMAL}			
	</select>
	
	<select id="findTsmCustFollowAlarmCount" resultType="int">
		<include refid="public_alarm_sql_follow_count" />
	</select>
	
	<select id="findTsmCustFollowAlarmPhoneCount" resultType="int">
		 select count(1) from(
		 	<include refid="public_alarm_phone_sql_follow" />
		 ) t		
	</select>
	
	<!-- 销售进程信息列表 -->
	<select id="findTeamSaleAndFollowListPage" resultMap="DtoResultMap">
		<include refid="team_sale_follow_list" />
	</select>
	
	<!-- 获取下次跟进记录 -->
	<select id="findNextFollowList" parameterType="map" resultMap="DtoResultMap">
		SELECT T.CUST_ID,T.CUST_FOLLOW_ID,T.ORG_ID,T.FOLLOW_DATE,T.FOLLOW_TYPE, T.FOLLOW_ACC
		  FROM TSM_CUST_FOLLOW T 
		  where t.org_id = #{orgId}
			AND T.CUST_ID IN (
				select C.RES_CUST_ID from TSM_RES_CUST_INFO C where c.org_id = #{orgId} and
				 c.status in (3,6,7,8) and c.type = 2 
				 and c.NEXTFOLLOW_DATE = str_to_date(#{start_time,jdbcType=VARCHAR}, '%Y-%m-%d %H:%i') 	
			)	
	</select>
	
	<!-- 最近一条跟进信息  -->
	<select id="queryLastCustFollowByCustId" parameterType="Map"  resultMap="DtoResultMap">
		SELECT T.SALE_PROCESS_ID OPTIONLIST_ID,
		       T.ACTION_DATE LAST_ACTION_DATE,
		       T.FOLLOW_DATE NEXT_ACTION_DATE,
		       T.ACTION_TYPE,
		       T.FOLLOW_TYPE,
		       T.LABEL_NAME,
		       T.LABEL_CODE,
		       T.CUST_FOLLOW_ID,
		       T.EFFECTIVENESS,
		       T.FOLLOW_ACC,
		       T.FEEDBACK_COMMENT,
		       T.CUST_ID,
		       t.FEEDBACK_COMMENT,
		  		<!--  企业客户 -->
		  	   t.CUST_DETAIL_NAME name,
		  	   t.CUST_DETAIL_MOBLIEPHONE as MOBILEPHONE		  		
		  FROM TSM_CUST_FOLLOW T
		 WHERE T.ORG_ID = #{orgId} and T.CUST_ID = #{custId} and t.CUST_FOLLOW_ID = #{custFollowId}
		 limit 0,1
	</select>
	
		<!--根据客户ID 获取最近跟进的标签和销售进程 -->
		<select id="findLabelByCustId" parameterType="map" resultMap="BaseResultMap">
				select f.label_code,f.label_name, f.sale_process_id,f.effectiveness
				  from tsm_res_cust_info c, tsm_cust_follow f
				 where c.res_cust_id = #{custId}
				   and c.org_id=#{orgId}
				   and c.last_cust_follow_id = f.cust_follow_id
				   limit 0,1
		</select>	
		
		<!-- 根据客户Id 单位ID 查询销售进程 -->
		<select id="findSalesProcessByCustId" parameterType="map" resultType="java.lang.String">
			SELECT D.OPTION_NAME
			  FROM TSM_RES_CUST_INFO T, TSM_CUST_FOLLOW F, TSM_DATA_OPTIONLIST D
			 WHERE T.ORG_ID = #{orgId}  
			   AND T.LAST_CUST_FOLLOW_ID = F.CUST_FOLLOW_ID
			   AND F.SALE_PROCESS_ID = D.OPTIONLIST_ID
			   AND T.RES_CUST_ID = #{custId} 
		</select>
		
		<!-- 根据客户Id 单位ID 查询最近联系 的时间 -->
		<select id="findLastConcatDay" parameterType="map" resultType="map">
			SELECT
				date_format(inputtime, '%Y-%m-%d') as startTime,date_format(now(), '%Y-%m-%d') as endTime
			FROM
				(
					SELECT
						a.inputtime
					FROM
						tsm_res_custinfo_log a
					WHERE
						a.org_id = #{orgId}
					AND a.ses_id = #{custId}
					AND a.is_del = 0
					UNION ALL
						SELECT
							a.ACTION_DATE AS inputtime
						FROM
						tsm_cust_follow a
					WHERE
			        a.ORG_ID=#{orgId}
			        and a.CUST_ID =#{custId}
				) w
			ORDER BY
				w.inputtime DESC
			LIMIT 0,
			 1
		</select>	
		
	<!-- 弹屏查询跟进记录 -->
	<select id="findCustFollows4TPListPage" parameterType="com.qftx.tsm.follow.dto.CustFollowDto"  resultMap="DtoResultMap">
			SELECT
				f.ACTION_DATE,
				f.ACTION_TYPE,
				f.EFFECTIVENESS,
				f.SALE_PROCESS_ID,
				f.LABEL_NAME,
				f.FEEDBACK_COMMENT,
			    t.OPTION_NAME,
			    f.CUST_FOLLOW_ID,
			    IFNULL(u.USER_NAME,f.FOLLOW_ACC) FOLLOW_ACC,
			    <choose>
			       <when test="state ==1">
			         f.CUST_DETAIL_NAME as name
			       </when>
			       <otherwise>
			        f.CUST_NAME as name
			       </otherwise>
			    </choose>
			FROM
				tsm_cust_follow f 
			LEFT JOIN  tsm_data_optionlist t on  f.SALE_PROCESS_ID  = t.OPTIONLIST_ID and t.ORG_ID=#{orgId} 
			LEFT JOIN  auth_user  u on u.ORG_ID=#{orgId}  and  f.FOLLOW_ACC=u.USER_ACCOUNT  
			LEFT JOIN  tsm_res_cust_info_detail d on  f.CUST_DETAIL_ID= d.tscid_id and d.org_id=#{orgId} 
			left JOIN  tsm_res_cust_info  c on  f.CUST_ID=c.RES_CUST_ID and c.ORG_ID=#{orgId} 
			WHERE
				f.ORG_ID = #{orgId} 
			<if test="custId!=null and custId!='' ">
			    and f.CUST_ID = #{custId}
			</if>
			order by  f.ACTION_DATE desc
	</select>
		
		<!-- 根据计划id获取签约客户计划 资源集合-->
		<select id="queryCustIdBySignPlanIds" resultType="String" parameterType="Map">
			select t.cust_id from plan_userday_signcust t 
				where t.org_id=#{orgId} and t.is_del = 0 and t.status =0 
				 and t.state in (0,1)	 and t.sud_id = #{sudId}
		</select>
		
		<!-- 根据计划id获取意向客户计划 资源集合-->
		<select id="queryCustIdByWillPlanIds" resultType="String" parameterType="Map">
			select t.cust_id from plan_userday_willcust t 
				where t.org_id=#{orgId} and t.is_del = 0 and t.status =0 
				 and t.state in (0,1)	 and t.sud_id = #{sudId}
		</select>
		
		<select id="getSignBeforeSaleProcessId" parameterType="map" resultType="java.lang.String">
			SELECT
				SALE_PROCESS_ID 
			FROM
				tsm_cust_follow
			WHERE
				org_id = #{orgId } 
			and cust_id = #{custId} 
			and INPUT_DATE &lt; STR_TO_DATE(#{inputDate },'%Y-%m-%d %H:%i:%s') 
			LIMIT 0,1  
		</select>
		
		<!-- 根据资源IDS 查询资源信息 -->
		<select id="findResCustsByCustIds"  parameterType="com.qftx.tsm.follow.dto.CustFollowDto"  resultMap="DtoResultMap">
			select trci.INPUT_DATE CREATE_TIME,
			trci.RES_CUST_ID,
			trci.NAME,         	
			trci.MOBILEPHONE,
			trci.TELPHONE,
			trci.IS_MAJOR,
			trci.COMPANY,
			trci.STATUS,
			trci.company_trade,
			trci.city_id,
			trci.province_id,
			trci.county_id,
			trci.main_linkman,
			trci.mobilephone,
			trci.res_group_id,
			trci.owner_acc OWNER_NAME
			FROM TSM_RES_CUST_INFO trci 
			WHERE trci.ORG_ID = #{orgId} and trci.IS_DEL = 0
			 and trci.RES_CUST_ID in
			<foreach collection="resCustIds" item="custId" open="(" separator="," close=")">
					#{custId}
			</foreach>
		</select>


	<!-- *******************************客户跟进详情右侧列表******************************** -->
	
	<!-- 客户跟进列表点击 跟进操作 -->
	<select id="findFollowRightViewByFollowRecordListPage" resultMap="RestDtoMap" parameterType="com.qftx.tsm.follow.dto.RestDto">
		<!-- select tg.RES_CUST_ID,tg.NAME,tg.ACTION_DATE,
              			  tg.AMOYTOCUSTOMER_DATE,tg.NEXT_ACTION_DATE,tg.TELPHONE from( -->
			select trci.RES_CUST_ID,trci.NAME,trci.ACTION_DATE,
              			  trci.AMOYTOCUSTOMER_DATE, trci.NEXT_ACTION_DATE,trci.TELPHONE from(
		      SELECT TRCI.RES_CUST_ID,
						  TRCI.NAME,
						  TRCI.ACTION_DATE,
              			  TRCI.AMOYTOCUSTOMER_DATE,  
						  TRCI.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
						   ifnull(TRCI.MOBILEPHONE, TRCI.TELPHONE) TELPHONE
                          FROM TSM_RES_CUST_INFO TRCI                            
                         WHERE TRCI.ORG_ID = #{orgId} and TRCI.IS_DEL = 0
                           and TRCI.LAST_CUST_FOLLOW_ID IS NOT NULL  
                            <!-- 下次联系时间是否为空 -->
					  		<!-- <choose>
					  			<when test="dateIsNull == 0">
					  				<choose>
					  					<when test="orderType == 1 or orderType == 2">
							  				AND TRCI.NEXTFOLLOW_DATE IS NULL
					  					</when>
					  					<when test="orderType == 3">
					  						AND TRCI.ACTION_DATE IS NULL
					  					</when>
					  				</choose>
					  			</when>
					  			<when test="dateIsNull == 1">
					  				<choose>
					  					<when test="orderType == 1 or orderType == 2">
							  				AND TRCI.NEXTFOLLOW_DATE IS NOT NULL
					  					</when>
					  					<when test="orderType == 3">
					  						AND TRCI.ACTION_DATE IS NOT NULL
					  					</when>
					  				</choose>
					  			</when>
					  		</choose>   -->
					  		<choose>
								<when test="isContact == 1">
									and DATE_FORMAT(TRCI.OWNER_ACTION_DATE, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')   
								</when>
								<when test="isContact == 0">
									<if test="ids.size() > 0">
										AND TRCI.RES_CUST_ID NOT IN
										<foreach collection="ids" item="item" open="(" separator="," close=")">
											#{item} 
										</foreach>
									</if>
								</when>
							</choose>                   
                           <choose>
							<when test="status != null">
								<choose>
									<!--  意向客户  -->
									<when test="status== 2">and TRCI.STATUS in(3,2)</when>
									<!--  签约客户  -->
									<when test="status== 3">and TRCI.STATUS = 6</when>
									<when test="status== 4">and TRCI.STATUS = 7</when>
									<when test="status== 5">and TRCI.STATUS = 8</when>
									<otherwise>	AND TRCI.STATUS in(3,2,6,7,8)</otherwise>
								</choose>				
							</when>
							<otherwise>
								AND TRCI.STATUS in(3,2,6,7,8)
							</otherwise>
						</choose>	
						<if test="resIds != null and resIds.size() > 0">
					   		AND TRCI.RES_CUST_ID IN 
					   			<foreach collection="resIds" item="rid" open="(" separator="," close=")">
					   				#{rid}
					   			</foreach>
					   	</if>
							<if test=" companyTrade != null and companyTrade != '' ">
								AND TRCI.company_trade = #{companyTrade,jdbcType=VARCHAR}
							</if>
						  		<if test=" queryText != null and queryText != ''">
						  			<choose>
						       			<when test="queryType == 'custName'">
						       				AND (TRCI.NAME LIKE concat('%',#{queryText},'%'))
						       			</when>
						       			<when test="queryType == 'linkName' and (state == null or state == 0)">
						       				AND (TRCI.MAIN_LINKMAN LIKE concat('%',#{queryText},'%'))
						       			</when>
						       			<when test="queryType == 'phone' and (state == null or state == 0)">
						       				AND TRCI.MOBILEPHONE = #{queryText} 						       									
						       			</when>
						       			<when test="queryType == 'company'"><!-- 单位名称 -->
						       				AND (TRCI.COMPANY LIKE concat('%',#{queryText},'%'))
						       			</when>
						       			 <otherwise>
			                               and ${queryType} LIKE CONCAT('%',#{queryText},'%')
			                            </otherwise>
						       		</choose>									
								</if>
								<if test="isMajor != null and isMajor !=''">
										AND TRCI.IS_MAJOR = #{isMajor}
								</if>								 
 							AND TRCI.TYPE = 2 
     		                            		
                            		<choose>
                            			<when test="ownerAccs != null"> <!-- 有选择指定拥有者 -->	                            			
	                            			and TRCI.OWNER_ACC in
	                            			<foreach collection="ownerAccs" index="index" item="item" open="("
															separator="," close=")">
												#{item}
											</foreach>
		                            	</when>
                            			<otherwise>										
											AND TRCI.OWNER_ACC = #{ownerAcc}											
                            			</otherwise>
                            		</choose>                       	                        	                         
							<!-- 本次跟进时间 -->
							<if test=" lastStartActionDate != null and lastStartActionDate !='' ">
								AND TRCI.ACTION_DATE >=
								 str_to_date(concat(#{lastStartActionDate,jdbcType=VARCHAR}, '00:00:00'),
					                                       '%Y-%m-%d %H:%i:%s')
							</if>
							<if test=" lastEndActionDate != null and lastEndActionDate !='' ">
								AND TRCI.ACTION_DATE <![CDATA[ <= ]]>
								str_to_date(concat(#{lastEndActionDate,jdbcType=VARCHAR}, '23:59:59'),
					                                       '%Y-%m-%d %H:%i:%s')
							</if>
							<!-- 本次所有者跟进时间 -->
							<if test=" lastStartOwnerActionDate != null and lastStartOwnerActionDate !='' ">
								AND TRCI.OWNER_ACTION_DATE >=
								str_to_date(concat(#{lastStartOwnerActionDate,jdbcType=VARCHAR},
								'00:00:00'),
								'%Y-%m-%d %H:%i:%s')
							</if>
							<if test=" lastEndOwnerActionDate != null and lastEndOwnerActionDate !='' ">
								AND TRCI.OWNER_ACTION_DATE <![CDATA[ <= ]]>
								str_to_date(concat(#{lastEndOwnerActionDate,jdbcType=VARCHAR}, '23:59:59'),
								'%Y-%m-%d %H:%i:%s')
							</if>
							<!-- 开始联系时间 -->
							<if test=" initStartFollowDate != null and initStartFollowDate !='' ">
								AND TRCI.AMOYTOCUSTOMER_DATE >=
								str_to_date(concat(#{initStartFollowDate,jdbcType=VARCHAR},
								'00:00:00'),
								'%Y-%m-%d %H:%i:%s')
							</if>
							<if test=" initEndFollowDate != null and initEndFollowDate !='' ">
								AND TRCI.AMOYTOCUSTOMER_DATE <![CDATA[ <= ]]>
								str_to_date(concat(#{initEndFollowDate,jdbcType=VARCHAR}, '23:59:59'),
								'%Y-%m-%d %H:%i:%s')
							</if>
							<!-- 下次跟进时间 -->							
							<choose>
									<!-- 1 表示今日待联系，还需查询计划为今日的数据 -->
									<when test="contactStatus == 1">
										<if test=" nextStartActionDate != null and nextStartActionDate !='' and nextEndActionDate != null and nextEndActionDate !=''  ">
											AND ((TRCI.NEXTFOLLOW_DATE >=
											   str_to_date(concat(#{nextStartActionDate,jdbcType=VARCHAR}, '00:00:00'),
								                                       '%Y-%m-%d %H:%i:%s')			
								             	AND TRCI.NEXTFOLLOW_DATE <![CDATA[ <= ]]>
											str_to_date(concat(#{nextEndActionDate,jdbcType=VARCHAR}, '23:59:59'),
								                                       '%Y-%m-%d %H:%i:%s')
								                   <if test="resCustIds != null"> <!-- 计划中的不查询 -->                   			
					                    			 and TRCI.RES_CUST_ID  not in
					                    			<foreach collection="resCustIds" index="index" item="item" open="("
															separator="," close=")">
															#{item}
													</foreach>
							       				</if>   )                        
								            <if test="resCustIds != null"> <!-- 查询计划中的客户 -->                   			
					                    			 or (
						                    			 TRCI.RES_CUST_ID  in
						                    			<foreach collection="resCustIds" index="index" item="item" open="("
																separator="," close=")">
																#{item}
														</foreach>
														)
							       				</if>  
								                )                         				                
										</if>
									</when>
									<otherwise>
										<if test=" nextStartActionDate != null and nextStartActionDate !='' ">
											AND TRCI.NEXTFOLLOW_DATE >=
											   str_to_date(concat(#{nextStartActionDate,jdbcType=VARCHAR}, '00:00:00'),
								                                       '%Y-%m-%d %H:%i:%s')
										</if>
										<if test=" nextEndActionDate != null and nextEndActionDate !='' ">
											AND TRCI.NEXTFOLLOW_DATE <![CDATA[ <= ]]>
											str_to_date(concat(#{nextEndActionDate,jdbcType=VARCHAR}, '23:59:59'),
								                                       '%Y-%m-%d %H:%i:%s')
										</if>
									</otherwise>
								</choose>
								<if test=" resGroup != null and resGroup != '' ">
									AND TRCI.RES_GROUP_ID = #{resGroup,jdbcType=VARCHAR}
								</if>
								<if test=" custTypeId != null and custTypeId != '' ">
										AND TRCI.last_cust_type_id = #{custTypeId,jdbcType=VARCHAR}
			  					</if>
			  					<if test=" optionlistId != null and optionlistId != '' ">
										AND TRCI.last_Option_Id = #{optionlistId,jdbcType=VARCHAR}
								</if> 
								<if test=" provinceId != null and provinceId != '' ">
									AND TRCI.province_id = #{provinceId,jdbcType=VARCHAR}
								</if>
								<if test=" cityId != null and cityId != '' ">
									AND TRCI.city_id = #{cityId,jdbcType=VARCHAR}
								</if>
								<if test=" countyId != null and countyId != '' ">
									AND TRCI.county_id = #{countyId,jdbcType=VARCHAR}
								</if>
								<if test=" source != null and source != '' ">
									AND TRCI.source = #{source}
								</if>
								<!-- 标签判断 -->
								<!-- <if test=" labels != null and labels !='' ">
									<foreach collection="labels" item="label" separator=" " >
						       			AND TRCI.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
						       		</foreach> 											
								</if> -->
								<if test="defined1 != null and defined1 != ''">
									AND TRCI.defined1 =#{defined1}
								</if>	
								<if test="defined2 != null and defined2 != ''">
									AND TRCI.defined2 =#{defined2}
								</if>	
								<if test="defined3 != null and defined3 != ''">
									AND TRCI.defined3 =#{defined3}
								</if>	
								<if test="defined4 != null and defined4 != ''">
									AND TRCI.defined4 =#{defined4}
								</if>	
								<if test="defined5 != null and defined5 != ''">
									AND TRCI.defined5 =#{defined5}
								</if>	
								<if test="defined6 != null and defined6 != ''">
									AND TRCI.defined6 =#{defined6}
								</if>	
								<if test="defined7 != null and defined7 != ''">
									AND TRCI.defined7 =#{defined7}
								</if>	
								<if test="defined8 != null and defined8 != ''">
									AND TRCI.defined8 =#{defined8}
								</if>	
								<if test="defined9 != null and defined9 != ''">
									AND TRCI.defined9 =#{defined9}
								</if>	
								<if test="defined10 != null and defined10 != ''">
									AND TRCI.defined10 =#{defined10}
								</if>	
								<if test="defined11 != null and defined11 != ''">
									AND TRCI.defined11 =#{defined11}
								</if>	
								<if test="defined12 != null and defined12 != ''">
									AND TRCI.defined12 =#{defined12}
								</if>	
								<if test="defined13 != null and defined13 != ''">
									AND TRCI.defined13 =#{defined13}
								</if>	
								<if test="defined14 != null and defined14 != ''">
									AND TRCI.defined14 =#{defined14}
								</if>	
								<if test="defined15 != null and defined15 != ''">
									AND TRCI.defined15 =#{defined15}
								</if>					
								<if test="startdefined16!= null and startdefined16 !=''">
									AND T1.DEFINED16 >=
									 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
						                                       '%Y-%m-%d %H:%i:%s')
								</if>
								<if test=" enddefined16 != null and enddefined16 !=''">
									AND T1.DEFINED16 <![CDATA[ <= ]]>
									STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
						                                       '%Y-%m-%d %H:%i:%s')
								</if>
								<if test="startdefined17!= null and startdefined17 !=''">
									AND T1.DEFINED17 >=
									 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
						                                       '%Y-%m-%d %H:%i:%s')
								</if>
								<if test="enddefined17 != null and enddefined17 !=''">
									AND T1.DEFINED17 <![CDATA[ <= ]]>
									STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
						                                       '%Y-%m-%d %H:%i:%s')
								</if>	
								<if test="startdefined18!= null and startdefined18 !=''">
									AND T1.DEFINED18 >=
									 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
						                                       '%Y-%m-%d %H:%i:%s')
								</if>
								<if test="enddefined18 != null and enddefined18 !=''">
									AND T1.DEFINED18 <![CDATA[ <= ]]>
									STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
						                                       '%Y-%m-%d %H:%i:%s')
								</if>
								<if test="queryText != null and queryText != '' and queryType == 'phone' and (state == null or state == 0)">
								union
							SELECT TRCI.RES_CUST_ID,
							  TRCI.NAME,
							  TRCI.ACTION_DATE,
	              			  TRCI.AMOYTOCUSTOMER_DATE,  
							  TRCI.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
							   ifnull(TRCI.MOBILEPHONE, TRCI.TELPHONE) TELPHONE
	                          FROM TSM_RES_CUST_INFO TRCI                            
	                         WHERE TRCI.ORG_ID = #{orgId} and TRCI.IS_DEL = 0
	                           and TRCI.LAST_CUST_FOLLOW_ID IS NOT NULL  
	                            <!-- 下次联系时间是否为空 -->
					  		<!-- <choose>
					  			<when test="dateIsNull == 0">
					  				<choose>
					  					<when test="orderType == 1 or orderType == 2">
							  				AND TRCI.NEXTFOLLOW_DATE IS NULL
					  					</when>
					  					<when test="orderType == 3">
					  						AND TRCI.ACTION_DATE IS NULL
					  					</when>
					  				</choose>
					  			</when>
					  			<when test="dateIsNull == 1">
					  				<choose>
					  					<when test="orderType == 1 or orderType == 2">
							  				AND TRCI.NEXTFOLLOW_DATE IS NOT NULL
					  					</when>
					  					<when test="orderType == 3">
					  						AND TRCI.ACTION_DATE IS NOT NULL
					  					</when>
					  				</choose>
					  			</when>
					  		</choose> -->
					  		<choose>
								<when test="isContact == 1">
									and DATE_FORMAT(TRCI.OWNER_ACTION_DATE, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')   
								</when>
								<when test="isContact == 0">
									<if test="ids.size() > 0">
										AND TRCI.RES_CUST_ID NOT IN
										<foreach collection="ids" item="item" open="(" separator="," close=")">
											#{item} 
										</foreach>
									</if>
								</when>
							</choose>                    
                           <choose>
							<when test="status != null">
								<choose>
									<!--  意向客户  -->
									<when test="status== 2">and TRCI.STATUS in(3,2)</when>
									<!--  签约客户  -->
									<when test="status== 3">and TRCI.STATUS = 6</when>
									<when test="status== 4">and TRCI.STATUS = 7</when>
									<when test="status== 5">and TRCI.STATUS = 8</when>
									<otherwise>	AND TRCI.STATUS in(3,2,6,7,8)</otherwise>
								</choose>				
							</when>
							<otherwise>
								AND TRCI.STATUS in(3,2,6,7,8)
							</otherwise>
						</choose>	
						<if test="resIds != null and resIds.size() > 0">
					   		AND TRCI.RES_CUST_ID IN 
					   			<foreach collection="resIds" item="rid" open="(" separator="," close=")">
					   				#{rid}
					   			</foreach>
					   	</if>
					   		<if test=" companyTrade != null and companyTrade != '' ">
								AND TRCI.company_trade = #{companyTrade,jdbcType=VARCHAR}
							</if>
						  		<if test=" queryText != null and queryText != ''">
						  			<choose>
						       			<when test="queryType == 'phone' and (state == null or state == 0)">
						       				AND TRCI.telphone = #{queryText} 						       									
						       			</when>
						       		</choose>									
								</if>
								<if test="isMajor != null and isMajor !=''">
										AND TRCI.IS_MAJOR = #{isMajor}
								</if>								 
 							AND TRCI.TYPE = 2 
                            		<choose>
                            			<when test="ownerAccs != null"> <!-- 有选择指定拥有者 -->	                            			
	                            			and TRCI.OWNER_ACC in
	                            			<foreach collection="ownerAccs" index="index" item="item" open="("
															separator="," close=")">
												#{item}
											</foreach>
		                            	</when>
                            			<otherwise>										
											AND TRCI.OWNER_ACC = #{ownerAcc}											
                            			</otherwise>
                            		</choose>                       	                        	                         
							<!-- 本次跟进时间 -->
							<if test=" lastStartActionDate != null and lastStartActionDate !='' ">
								AND TRCI.ACTION_DATE >=
								 str_to_date(concat(#{lastStartActionDate,jdbcType=VARCHAR}, '00:00:00'),
					                                       '%Y-%m-%d %H:%i:%s')
							</if>
							<if test=" lastEndActionDate != null and lastEndActionDate !='' ">
								AND TRCI.ACTION_DATE <![CDATA[ <= ]]>
								str_to_date(concat(#{lastEndActionDate,jdbcType=VARCHAR}, '23:59:59'),
					                                       '%Y-%m-%d %H:%i:%s')
							</if>
							<!-- 本次所有者跟进时间 -->
							<if test=" lastStartOwnerActionDate != null and lastStartOwnerActionDate !='' ">
								AND TRCI.OWNER_ACTION_DATE >=
								str_to_date(concat(#{lastStartOwnerActionDate,jdbcType=VARCHAR},
								'00:00:00'),
								'%Y-%m-%d %H:%i:%s')
							</if>
							<if test=" lastEndOwnerActionDate != null and lastEndOwnerActionDate !='' ">
								AND TRCI.OWNER_ACTION_DATE <![CDATA[ <= ]]>
								str_to_date(concat(#{lastEndOwnerActionDate,jdbcType=VARCHAR}, '23:59:59'),
								'%Y-%m-%d %H:%i:%s')
							</if>
							<!-- 开始联系时间 -->
							<if test=" initStartFollowDate != null and initStartFollowDate !='' ">
								AND TRCI.AMOYTOCUSTOMER_DATE >=
								str_to_date(concat(#{initStartFollowDate,jdbcType=VARCHAR},
								'00:00:00'),
								'%Y-%m-%d %H:%i:%s')
							</if>
							<if test=" initEndFollowDate != null and initEndFollowDate !='' ">
								AND TRCI.AMOYTOCUSTOMER_DATE <![CDATA[ <= ]]>
								str_to_date(concat(#{initEndFollowDate,jdbcType=VARCHAR}, '23:59:59'),
								'%Y-%m-%d %H:%i:%s')
							</if>
							<!-- 下次跟进时间 -->							
							<choose>
									<!-- 1 表示今日待联系，还需查询计划为今日的数据 -->
									<when test="contactStatus == 1">
										<if test=" nextStartActionDate != null and nextStartActionDate !='' and nextEndActionDate != null and nextEndActionDate !=''  ">
											AND ((TRCI.NEXTFOLLOW_DATE >=
											   str_to_date(concat(#{nextStartActionDate,jdbcType=VARCHAR}, '00:00:00'),
								                                       '%Y-%m-%d %H:%i:%s')			
								             	AND TRCI.NEXTFOLLOW_DATE <![CDATA[ <= ]]>
											str_to_date(concat(#{nextEndActionDate,jdbcType=VARCHAR}, '23:59:59'),
								                                       '%Y-%m-%d %H:%i:%s')
								                   <if test="resCustIds != null"> <!-- 计划中的不查询 -->                   			
					                    			 and TRCI.RES_CUST_ID  not in
					                    			<foreach collection="resCustIds" index="index" item="item" open="("
															separator="," close=")">
															#{item}
													</foreach>
							       				</if>   )                        
								            <if test="resCustIds != null"> <!-- 查询计划中的客户 -->                   			
					                    			 or (
						                    			 TRCI.RES_CUST_ID  in
						                    			<foreach collection="resCustIds" index="index" item="item" open="("
																separator="," close=")">
																#{item}
														</foreach>
														)
							       				</if>  
								                )                         				                
										</if>
									</when>
									<otherwise>
										<if test=" nextStartActionDate != null and nextStartActionDate !='' ">
											AND TRCI.NEXTFOLLOW_DATE >=
											   str_to_date(concat(#{nextStartActionDate,jdbcType=VARCHAR}, '00:00:00'),
								                                       '%Y-%m-%d %H:%i:%s')
										</if>
										<if test=" nextEndActionDate != null and nextEndActionDate !='' ">
											AND TRCI.NEXTFOLLOW_DATE <![CDATA[ <= ]]>
											str_to_date(concat(#{nextEndActionDate,jdbcType=VARCHAR}, '23:59:59'),
								                                       '%Y-%m-%d %H:%i:%s')
										</if>
									</otherwise>
								</choose>
								<if test=" resGroup != null and resGroup != '' ">
									AND TRCI.RES_GROUP_ID = #{resGroup,jdbcType=VARCHAR}
								</if>
								<if test=" custTypeId != null and custTypeId != '' ">
										AND TRCI.last_cust_type_id = #{custTypeId,jdbcType=VARCHAR}
			  					</if>
			  					<if test=" optionlistId != null and optionlistId != '' ">
										AND TRCI.last_Option_Id = #{optionlistId,jdbcType=VARCHAR}
								</if> 
								<if test=" provinceId != null and provinceId != '' ">
									AND TRCI.province_id = #{provinceId,jdbcType=VARCHAR}
								</if>
								<if test=" cityId != null and cityId != '' ">
									AND TRCI.city_id = #{cityId,jdbcType=VARCHAR}
								</if>
								<if test=" countyId != null and countyId != '' ">
									AND TRCI.county_id = #{countyId,jdbcType=VARCHAR}
								</if>
								<if test=" source != null and source != '' ">
									AND TRCI.source = #{source}
								</if>
								<!-- 标签判断 -->
								<!-- <if test=" labels != null and labels !='' ">
									<foreach collection="labels" item="label" separator=" " >
						       			AND TRCI.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
						       		</foreach> 											
								</if> -->
								<if test="defined1 != null and defined1 != ''">
									AND TRCI.defined1 =#{defined1}
								</if>	
								<if test="defined2 != null and defined2 != ''">
									AND TRCI.defined2 =#{defined2}
								</if>	
								<if test="defined3 != null and defined3 != ''">
									AND TRCI.defined3 =#{defined3}
								</if>	
								<if test="defined4 != null and defined4 != ''">
									AND TRCI.defined4 =#{defined4}
								</if>	
								<if test="defined5 != null and defined5 != ''">
									AND TRCI.defined5 =#{defined5}
								</if>	
								<if test="defined6 != null and defined6 != ''">
									AND TRCI.defined6 =#{defined6}
								</if>	
								<if test="defined7 != null and defined7 != ''">
									AND TRCI.defined7 =#{defined7}
								</if>	
								<if test="defined8 != null and defined8 != ''">
									AND TRCI.defined8 =#{defined8}
								</if>	
								<if test="defined9 != null and defined9 != ''">
									AND TRCI.defined9 =#{defined9}
								</if>	
								<if test="defined10 != null and defined10 != ''">
									AND TRCI.defined10 =#{defined10}
								</if>	
								<if test="defined11 != null and defined11 != ''">
									AND TRCI.defined11 =#{defined11}
								</if>	
								<if test="defined12 != null and defined12 != ''">
									AND TRCI.defined12 =#{defined12}
								</if>	
								<if test="defined13 != null and defined13 != ''">
									AND TRCI.defined13 =#{defined13}
								</if>	
								<if test="defined14 != null and defined14 != ''">
									AND TRCI.defined14 =#{defined14}
								</if>	
								<if test="defined15 != null and defined15 != ''">
									AND TRCI.defined15 =#{defined15}
								</if>					
								<if test="startdefined16!= null and startdefined16 !=''">
									AND T1.DEFINED16 >=
									 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
						                                       '%Y-%m-%d %H:%i:%s')
								</if>
								<if test=" enddefined16 != null and enddefined16 !=''">
									AND T1.DEFINED16 <![CDATA[ <= ]]>
									STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
						                                       '%Y-%m-%d %H:%i:%s')
								</if>
								<if test="startdefined17!= null and startdefined17 !=''">
									AND T1.DEFINED17 >=
									 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
						                                       '%Y-%m-%d %H:%i:%s')
								</if>
								<if test="enddefined17 != null and enddefined17 !=''">
									AND T1.DEFINED17 <![CDATA[ <= ]]>
									STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
						                                       '%Y-%m-%d %H:%i:%s')
								</if>	
								<if test="startdefined18!= null and startdefined18 !=''">
									AND T1.DEFINED18 >=
									 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
						                                       '%Y-%m-%d %H:%i:%s')
								</if>
								<if test="enddefined18 != null and enddefined18 !=''">
									AND T1.DEFINED18 <![CDATA[ <= ]]>
									STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
						                                       '%Y-%m-%d %H:%i:%s')
								</if>
								</if>	
								)TRCI
								where TRCI.RES_CUST_ID != #{resCustId}
								 <if test=" orderType != null and orderType != '' ">
										<choose>
							      			<when test="orderType == 1">
							       				order by trci.NEXT_ACTION_DATE asc
							      			</when>
							      			<when test="orderType == 2">
							      				order by trci.NEXT_ACTION_DATE desc
							      			</when>
							      			<when test="orderType == 3">
							      				order by trci.ACTION_DATE asc
							      			</when>
							      			<when test="orderType == 4">
							      				order by trci.ACTION_DATE desc
							      			</when>
							      			<when test="orderType == 5">
							      				order by trci.AMOYTOCUSTOMER_DATE asc
							      			</when>
							      			<when test="orderType == 6">
							      				order by trci.AMOYTOCUSTOMER_DATE desc
							      			</when>
						      			</choose>
								  </if>
								 <!--  )tg
				                WHERE 
				                tg.RES_CUST_ID != #{resCustId} -->
				               <!--  limit #{startPage},#{endPage} -->														   
				</select>
		
		<!-- 我的客户 意向客户 点击 跟进操作 -->		
		<select id="findCustFollowRightByMyCustListPage" resultMap="RestDtoMap" parameterType="com.qftx.tsm.follow.dto.RestDto">
		  <!-- select tg.RES_CUST_ID,tg.NAME,tg.ACTION_DATE,
              			  tg.AMOYTOCUSTOMER_DATE,tg.NEXT_ACTION_DATE,tg.TELPHONE from( -->
		  select trci.RES_CUST_ID,trci.NAME, trci.ACTION_DATE,
              			  trci.AMOYTOCUSTOMER_DATE,  trci.NEXT_ACTION_DATE,trci.TELPHONE from(
		  SELECT
	  		 T1.RES_CUST_ID,
			 T1.NAME, 
			 T1.ACTION_DATE,
           	 T1.AMOYTOCUSTOMER_DATE,                             
			 T1.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
			 ifnull(T1.MOBILEPHONE, T1.TELPHONE) TELPHONE
		  FROM TSM_RES_CUST_INFO T1
		  WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
			   AND T1.TYPE = 2 
			   AND T1.STATUS IN (2,3) 	
			   AND T1.IS_DEL = 0 
			   <!-- 下次联系时间是否为空 -->
		  		<!-- <choose>
		  			<when test="dateIsNull == 0">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NULL
		  					</when>
		  				</choose>
		  			</when>
		  			<when test="dateIsNull == 1">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NOT NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NOT NULL
		  					</when>
		  				</choose>
		  			</when>
		  		</choose> -->
				<if test="resIds != null and resIds.size() > 0">
			   		AND T1.RES_CUST_ID IN 
			   			<foreach collection="resIds" item="rid" open="(" separator="," close=")">
			   				#{rid}
			   			</foreach>
			   	</if>
				<if test=" companyTrade != null and companyTrade != '' ">
					AND T1.company_trade = #{companyTrade,jdbcType=VARCHAR}
				</if>
				<choose>
					<when test="ownerAccs!=null and ownerAccs.size() > 0">
						<if test="ownerAccs!=null">
				       		AND T1.OWNER_ACC IN 
							<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
								#{item}
							</foreach>
				        </if>
					</when>
					<otherwise>
						AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
					</otherwise>
				</choose>
		       <if test="commonAccs != null and commonAccs.size() > 0">
					AND T1.COMMON_ACC IN 
						<foreach collection="commonAccs" item="ca" open="(" separator="," close=")">
							#{ca} 
						</foreach>
				</if>
		       <if test='noteType=="9"'>
		     		AND T1.COMMON_ACC IS NOT NULL  
		     	</if>
		       <if test='noteType == "2"'>
		       		AND T1.AMOYTOCUSTOMER_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "3"'>
		       		<choose>
		       			<when test="resCustIds != null and resCustIds.size() > 0">
		       				AND (
		       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       				OR T1.RES_CUST_ID IN <foreach collection="resCustIds" item="item" open="(" separator="," close=")">#{item}</foreach>
		       				)
		       			</when>
		       			<otherwise>
				       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
				       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
		       			</otherwise>
		       		</choose>
		       </if>
		       <if test='noteType == "5"'>
		       		AND T1.IS_MAJOR = 1  
		       </if>
			   <if test="startDate != null and startDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="endDate != null and endDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="pstartDate != null and pstartDate != ''">
		       		AND T1.AMOYTOCUSTOMER_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="pendDate != null and pendDate != ''">
		       		AND T1.AMOYTOCUSTOMER_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="isMajor != null and isMajor != ''">
		       		AND T1.IS_MAJOR = #{isMajor}
		       </if>
		       <if test='noteType == "4"'>
		       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "6"'>
		       		AND T1.ACTION_DATE  >= STR_TO_DATE(CONCAT(DATE_FORMAT(DATE_ADD(CURDATE(),INTERVAL -WEEKDAY(CURDATE())DAY),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "7"'>
		       		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
		       </if>
		       <if test='noteType == "8"'>
		       		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -30 DAY)
		       </if>
		       <if test="startActionDate != null and startActionDate != ''">
		       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="endActionDate != null and endActionDate != ''">
		       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="custTypeId != null and custTypeId != ''">
		       		AND T1.LAST_CUST_TYPE_ID = #{custTypeId,jdbcType=VARCHAR} 
		       </if>
		       <if test="saleProcessId != null and saleProcessId != ''">
		       		AND T1.LAST_OPTION_ID = #{saleProcessId,jdbcType=VARCHAR}
		       </if>
		       <if test='lDateType != null and lDateType == "6"'>
		       		AND T1.ACTION_DATE IS NULL 
		       </if>
		       <if test='nDateType != null and nDateType == "6"'>
		       		AND T1.NEXTFOLLOW_DATE IS NULL 
		       </if>
		       <!-- <if test=" labels != null and labels !='' ">
					<foreach collection="labels" item="label" separator=" " >
		       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
		       		</foreach> 											
				</if> -->
				 <choose>
					<when test="isContact == 1">
						and DATE_FORMAT(T1.OWNER_ACTION_DATE, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')   
					</when>
					<when test="isContact == 0">
						<if test="ids.size() > 0">
							AND T1.RES_CUST_ID NOT IN
							<foreach collection="ids" item="item" open="(" separator="," close=")">
								#{item} 
							</foreach>
						</if>
					</when>
				</choose>
				<if test="groupId != null and groupId != ''">
		       		AND T1.RES_GROUP_ID=#{groupId}
		       </if>
		       <if test="defined1 != null and defined1 != ''">
					AND T1.defined1 =#{defined1}
				</if>	
				<if test="defined2 != null and defined2 != ''">
					AND T1.defined2 =#{defined2}
				</if>	
				<if test="defined3 != null and defined3 != ''">
					AND T1.defined3 =#{defined3}
				</if>	
				<if test="defined4 != null and defined4 != ''">
					AND T1.defined4 =#{defined4}
				</if>	
				<if test="defined5 != null and defined5 != ''">
					AND T1.defined5 =#{defined5}
				</if>	
				<if test="defined6 != null and defined6 != ''">
					AND T1.defined6 =#{defined6}
				</if>	
				<if test="defined7 != null and defined7 != ''">
					AND T1.defined7 =#{defined7}
				</if>	
				<if test="defined8 != null and defined8 != ''">
					AND T1.defined8 =#{defined8}
				</if>	
				<if test="defined9 != null and defined9 != ''">
					AND T1.defined9 =#{defined9}
				</if>	
				<if test="defined10 != null and defined10 != ''">
					AND T1.defined10 =#{defined10}
				</if>	
				<if test="defined11 != null and defined11 != ''">
					AND T1.defined11 =#{defined11}
				</if>	
				<if test="defined12 != null and defined12 != ''">
					AND T1.defined12 =#{defined12}
				</if>	
				<if test="defined13 != null and defined13 != ''">
					AND T1.defined13 =#{defined13}
				</if>	
				<if test="defined14 != null and defined14 != ''">
					AND T1.defined14 =#{defined14}
				</if>	
				<if test="defined15 != null and defined15 != ''">
					AND T1.defined15 =#{defined15}
				</if>	
		       <if test="startdefined16!= null and startdefined16 !=''">
					AND T1.DEFINED16 >=
					 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test=" enddefined16 != null and enddefined16 !=''">
					AND T1.DEFINED16 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="startdefined17!= null and startdefined17 !=''">
					AND T1.DEFINED17 >=
					 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined17 != null and enddefined17 !=''">
					AND T1.DEFINED17 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>	
				<if test="startdefined18!= null and startdefined18 !=''">
					AND T1.DEFINED18 >=
					 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined18 != null and enddefined18 !=''">
					AND T1.DEFINED18 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<!-- 查询结果排除ids-->
		       <if test="rejectIds != null and rejectIds.size()>0">
		       		<foreach collection="rejectIds" item="id">
		       			and T1.RES_CUST_ID !=#{id}
		       		</foreach>
		       </if>
		      <if test="queryText != null and queryText != ''">
		       		<choose>
		       			<when test='queryType != null and queryType == "custName"'>
		       				AND T1.NAME LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<when test='queryType != null and queryType == "mainLinkman" and (state == null or state == 0)'>
		       				AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<when test='queryType != null and queryType == "company"'>
		       				AND T1.COMPANY LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<otherwise>
		       				AND T1.${queryType } LIKE CONCAT('%',#{queryText},'%') 
		       			</otherwise>
		       		</choose>
		       </if>
		       )TRCI
		       where TRCI.RES_CUST_ID != #{resCustId}
		       <if test=" orderType != null and orderType != '' ">
					<choose>
		      			<when test="orderType == 1">
		       				order by trci.NEXT_ACTION_DATE asc
		      			</when>
		      			<when test="orderType == 2">
		      				order by trci.NEXT_ACTION_DATE desc
		      			</when>
		      			<when test="orderType == 3">
		      				order by trci.ACTION_DATE asc
		      			</when>
		      			<when test="orderType == 4">
		      				order by trci.ACTION_DATE desc
		      			</when>
		      			<when test="orderType == 5">
		      				order by trci.AMOYTOCUSTOMER_DATE asc
		      			</when>
		      			<when test="orderType == 6">
		      				order by trci.AMOYTOCUSTOMER_DATE desc
		      			</when>
	      			</choose>
			  </if>
		       <!--  )tg
                 WHERE 
                 tg.RES_CUST_ID != #{resCustId}
                limit #{startPage},#{endPage}	 -->
		   
	</select>
	
	<!-- 我的客户 意向客户 点击 跟进操作 -->		
		<select id="findCustFollowRightByMyCustWithPhoneListPage" resultMap="RestDtoMap" parameterType="com.qftx.tsm.follow.dto.RestDto">
		 <!--  select tg.RES_CUST_ID,tg.NAME,tg.ACTION_DATE,
              			  tg.AMOYTOCUSTOMER_DATE,tg.NEXT_ACTION_DATE,tg.TELPHONE from( -->
		  select trci.RES_CUST_ID,trci.NAME, trci.ACTION_DATE,
              			  trci.AMOYTOCUSTOMER_DATE,  trci.NEXT_ACTION_DATE,trci.TELPHONE from(
		  SELECT
	  		 T1.RES_CUST_ID,
			 T1.NAME, 
			 T1.ACTION_DATE,
           	 T1.AMOYTOCUSTOMER_DATE,                             
			 T1.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
			 ifnull(T1.MOBILEPHONE, T1.TELPHONE) TELPHONE
		  FROM TSM_RES_CUST_INFO T1
		  WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
			   AND T1.TYPE = 2 
			   AND T1.STATUS IN (2,3) 	
			   AND T1.IS_DEL = 0 
			    <!-- 下次联系时间是否为空 -->
		  		<!-- <choose>
		  			<when test="dateIsNull == 0">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NULL
		  					</when>
		  				</choose>
		  			</when>
		  			<when test="dateIsNull == 1">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NOT NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NOT NULL
		  					</when>
		  				</choose>
		  			</when>
		  		</choose> -->
				<if test="resIds != null and resIds.size() > 0">
			   		AND T1.RES_CUST_ID IN 
			   			<foreach collection="resIds" item="rid" open="(" separator="," close=")">
			   				#{rid}
			   			</foreach>
			   	</if>
				<if test=" companyTrade != null and companyTrade != '' ">
					AND T1.company_trade = #{companyTrade,jdbcType=VARCHAR}
				</if>
				<choose>
					<when test="ownerAccs!=null and ownerAccs.size() > 0">
						<if test="ownerAccs!=null">
				       		AND T1.OWNER_ACC IN 
							<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
								#{item}
							</foreach>
				        </if>
					</when>
					<otherwise>
						AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
					</otherwise>
				</choose>
		       <if test="commonAccs != null and commonAccs.size() > 0">
					AND T1.COMMON_ACC IN 
						<foreach collection="commonAccs" item="ca" open="(" separator="," close=")">
							#{ca} 
						</foreach>
				</if>
		       <if test='noteType=="9"'>
		     		AND T1.COMMON_ACC IS NOT NULL  
		     	</if>
		       <if test='noteType == "2"'>
		       		AND T1.AMOYTOCUSTOMER_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "3"'>
		       		<choose>
		       			<when test="resCustIds != null and resCustIds.size() > 0">
		       				AND (
		       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       				OR T1.RES_CUST_ID IN <foreach collection="resCustIds" item="item" open="(" separator="," close=")">#{item}</foreach>
		       				)
		       			</when>
		       			<otherwise>
				       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
				       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
		       			</otherwise>
		       		</choose>
		       </if>
		       <if test='noteType == "5"'>
		       		AND T1.IS_MAJOR = 1  
		       </if>
			   <if test="startDate != null and startDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="endDate != null and endDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="pstartDate != null and pstartDate != ''">
		       		AND T1.AMOYTOCUSTOMER_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="pendDate != null and pendDate != ''">
		       		AND T1.AMOYTOCUSTOMER_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="isMajor != null and isMajor != ''">
		       		AND T1.IS_MAJOR = #{isMajor}
		       </if>
		       <if test='noteType == "4"'>
		       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "6"'>
		       		AND T1.ACTION_DATE  >= STR_TO_DATE(CONCAT(DATE_FORMAT(DATE_ADD(CURDATE(),INTERVAL -WEEKDAY(CURDATE())DAY),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "7"'>
		       		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
		       </if>
		       <if test='noteType == "8"'>
		       		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -30 DAY)
		       </if>
		       <if test="startActionDate != null and startActionDate != ''">
		       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="endActionDate != null and endActionDate != ''">
		       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="custTypeId != null and custTypeId != ''">
		       		AND T1.LAST_CUST_TYPE_ID = #{custTypeId,jdbcType=VARCHAR} 
		       </if>
		       <if test="saleProcessId != null and saleProcessId != ''">
		       		AND T1.LAST_OPTION_ID = #{saleProcessId,jdbcType=VARCHAR}
		       </if>
		       <if test='lDateType != null and lDateType == "6"'>
		       		AND T1.ACTION_DATE IS NULL 
		       </if>
		       <if test='nDateType != null and nDateType == "6"'>
		       		AND T1.NEXTFOLLOW_DATE IS NULL 
		       </if>
		      <!--  <if test=" labels != null and labels !='' ">
					<foreach collection="labels" item="label" separator=" " >
		       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
		       		</foreach> 											
				</if> -->
				<if test="groupId != null and groupId != ''">
		       		AND T1.RES_GROUP_ID=#{groupId}
		       </if>
		       <choose>
					<when test="isContact == 1">
						and DATE_FORMAT(T1.OWNER_ACTION_DATE, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')   
					</when>
					<when test="isContact == 0">
						<if test="ids.size() > 0">
							AND T1.RES_CUST_ID NOT IN
							<foreach collection="ids" item="item" open="(" separator="," close=")">
								#{item} 
							</foreach>
						</if>
					</when>
				</choose>
		        <if test="defined1 != null and defined1 != ''">
					AND T1.defined1 =#{defined1}
				</if>	
				<if test="defined2 != null and defined2 != ''">
					AND T1.defined2 =#{defined2}
				</if>	
				<if test="defined3 != null and defined3 != ''">
					AND T1.defined3 =#{defined3}
				</if>	
				<if test="defined4 != null and defined4 != ''">
					AND T1.defined4 =#{defined4}
				</if>	
				<if test="defined5 != null and defined5 != ''">
					AND T1.defined5 =#{defined5}
				</if>	
				<if test="defined6 != null and defined6 != ''">
					AND T1.defined6 =#{defined6}
				</if>	
				<if test="defined7 != null and defined7 != ''">
					AND T1.defined7 =#{defined7}
				</if>	
				<if test="defined8 != null and defined8 != ''">
					AND T1.defined8 =#{defined8}
				</if>	
				<if test="defined9 != null and defined9 != ''">
					AND T1.defined9 =#{defined9}
				</if>	
				<if test="defined10 != null and defined10 != ''">
					AND T1.defined10 =#{defined10}
				</if>	
				<if test="defined11 != null and defined11 != ''">
					AND T1.defined11 =#{defined11}
				</if>	
				<if test="defined12 != null and defined12 != ''">
					AND T1.defined12 =#{defined12}
				</if>	
				<if test="defined13 != null and defined13 != ''">
					AND T1.defined13 =#{defined13}
				</if>	
				<if test="defined14 != null and defined14 != ''">
					AND T1.defined14 =#{defined14}
				</if>	
				<if test="defined15 != null and defined15 != ''">
					AND T1.defined15 =#{defined15}
				</if>	
		       <if test="startdefined16!= null and startdefined16 !=''">
					AND T1.DEFINED16 >=
					 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test=" enddefined16 != null and enddefined16 !=''">
					AND T1.DEFINED16 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="startdefined17!= null and startdefined17 !=''">
					AND T1.DEFINED17 >=
					 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined17 != null and enddefined17 !=''">
					AND T1.DEFINED17 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>	
				<if test="startdefined18!= null and startdefined18 !=''">
					AND T1.DEFINED18 >=
					 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined18 != null and enddefined18 !=''">
					AND T1.DEFINED18 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<!-- 查询结果排除ids-->
		       <if test="rejectIds != null and rejectIds.size()>0">
		       		<foreach collection="rejectIds" item="id">
		       			and T1.RES_CUST_ID !=#{id}
		       		</foreach>
		       </if>
		      <if test="queryText != null and queryText != ''">
		       		<choose>
		       			<when test='queryType != null and queryType == "mobilephone" and (state == null or state == 0)'>
		       				AND T1.mobilephone = #{queryText} 
		       			</when>
		       		
		       		</choose>
		       </if>
		       <if test="queryText != null and queryText != '' and queryType != null and queryType == 'mobilephone' and (state == null or state == 0)">
		       	union
		       	SELECT
	  		 T1.RES_CUST_ID,
			 T1.NAME, 
			 T1.ACTION_DATE,
           	 T1.AMOYTOCUSTOMER_DATE,                             
			 T1.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
			 ifnull(T1.MOBILEPHONE, T1.TELPHONE) TELPHONE
		  FROM TSM_RES_CUST_INFO T1
		  WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
			   AND T1.TYPE = 2 
			   AND T1.STATUS IN (2,3) 	
			   AND T1.IS_DEL = 0 
			   <!-- 下次联系时间是否为空 -->
		  		<!-- <choose>
		  			<when test="dateIsNull == 0">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NULL
		  					</when>
		  				</choose>
		  			</when>
		  			<when test="dateIsNull == 1">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NOT NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NOT NULL
		  					</when>
		  				</choose>
		  			</when>
		  		</choose> -->
				<if test="resIds != null and resIds.size() > 0">
			   		AND T1.RES_CUST_ID IN 
			   			<foreach collection="resIds" item="rid" open="(" separator="," close=")">
			   				#{rid}
			   			</foreach>
			   	</if>
			   	<if test=" companyTrade != null and companyTrade != '' ">
					AND T1.company_trade = #{companyTrade,jdbcType=VARCHAR}
				</if>
				<choose>
					<when test="ownerAccs!=null and ownerAccs.size() > 0">
						<if test="ownerAccs!=null">
				       		AND T1.OWNER_ACC IN 
							<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
								#{item}
							</foreach>
				        </if>
					</when>
					<otherwise>
						AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
					</otherwise>
				</choose>
		       <if test="commonAccs != null and commonAccs.size() > 0">
					AND T1.COMMON_ACC IN 
						<foreach collection="commonAccs" item="ca" open="(" separator="," close=")">
							#{ca} 
						</foreach>
				</if>
		       <if test='noteType=="9"'>
		     		AND T1.COMMON_ACC IS NOT NULL  
		     	</if>
		       <if test='noteType == "2"'>
		       		AND T1.AMOYTOCUSTOMER_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "3"'>
		       		<choose>
		       			<when test="resCustIds != null and resCustIds.size() > 0">
		       				AND (
		       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       				OR T1.RES_CUST_ID IN <foreach collection="resCustIds" item="item" open="(" separator="," close=")">#{item}</foreach>
		       				)
		       			</when>
		       			<otherwise>
				       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
				       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
		       			</otherwise>
		       		</choose>
		       </if>
		       <if test='noteType == "5"'>
		       		AND T1.IS_MAJOR = 1  
		       </if>
			   <if test="startDate != null and startDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="endDate != null and endDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="pstartDate != null and pstartDate != ''">
		       		AND T1.AMOYTOCUSTOMER_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="pendDate != null and pendDate != ''">
		       		AND T1.AMOYTOCUSTOMER_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="isMajor != null and isMajor != ''">
		       		AND T1.IS_MAJOR = #{isMajor}
		       </if>
		       <if test='noteType == "4"'>
		       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "6"'>
		       		AND T1.ACTION_DATE  >= STR_TO_DATE(CONCAT(DATE_FORMAT(DATE_ADD(CURDATE(),INTERVAL -WEEKDAY(CURDATE())DAY),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "7"'>
		       		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
		       </if>
		       <if test='noteType == "8"'>
		       		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -30 DAY)
		       </if>
		       <if test="startActionDate != null and startActionDate != ''">
		       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="endActionDate != null and endActionDate != ''">
		       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="custTypeId != null and custTypeId != ''">
		       		AND T1.LAST_CUST_TYPE_ID = #{custTypeId,jdbcType=VARCHAR} 
		       </if>
		       <if test="saleProcessId != null and saleProcessId != ''">
		       		AND T1.LAST_OPTION_ID = #{saleProcessId,jdbcType=VARCHAR}
		       </if>
		       <if test='lDateType != null and lDateType == "6"'>
		       		AND T1.ACTION_DATE IS NULL 
		       </if>
		       <if test='nDateType != null and nDateType == "6"'>
		       		AND T1.NEXTFOLLOW_DATE IS NULL 
		       </if>
		      <!--  <if test=" labels != null and labels !='' ">
					<foreach collection="labels" item="label" separator=" " >
		       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
		       		</foreach> 											
				</if> -->
				<if test="groupId != null and groupId != ''">
		       		AND T1.RES_GROUP_ID=#{groupId}
		       </if>
		       <choose>
					<when test="isContact == 1">
						and DATE_FORMAT(T1.OWNER_ACTION_DATE, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')   
					</when>
					<when test="isContact == 0">
						<if test="ids.size() > 0">
							AND T1.RES_CUST_ID NOT IN
							<foreach collection="ids" item="item" open="(" separator="," close=")">
								#{item} 
							</foreach>
						</if>
					</when>
				</choose>
		       <if test="defined1 != null and defined1 != ''">
					AND T1.defined1 =#{defined1}
				</if>	
				<if test="defined2 != null and defined2 != ''">
					AND T1.defined2 =#{defined2}
				</if>	
				<if test="defined3 != null and defined3 != ''">
					AND T1.defined3 =#{defined3}
				</if>	
				<if test="defined4 != null and defined4 != ''">
					AND T1.defined4 =#{defined4}
				</if>	
				<if test="defined5 != null and defined5 != ''">
					AND T1.defined5 =#{defined5}
				</if>	
				<if test="defined6 != null and defined6 != ''">
					AND T1.defined6 =#{defined6}
				</if>	
				<if test="defined7 != null and defined7 != ''">
					AND T1.defined7 =#{defined7}
				</if>	
				<if test="defined8 != null and defined8 != ''">
					AND T1.defined8 =#{defined8}
				</if>	
				<if test="defined9 != null and defined9 != ''">
					AND T1.defined9 =#{defined9}
				</if>	
				<if test="defined10 != null and defined10 != ''">
					AND T1.defined10 =#{defined10}
				</if>	
				<if test="defined11 != null and defined11 != ''">
					AND T1.defined11 =#{defined11}
				</if>	
				<if test="defined12 != null and defined12 != ''">
					AND T1.defined12 =#{defined12}
				</if>	
				<if test="defined13 != null and defined13 != ''">
					AND T1.defined13 =#{defined13}
				</if>	
				<if test="defined14 != null and defined14 != ''">
					AND T1.defined14 =#{defined14}
				</if>	
				<if test="defined15 != null and defined15 != ''">
					AND T1.defined15 =#{defined15}
				</if>	
		       <if test="startdefined16!= null and startdefined16 !=''">
					AND T1.DEFINED16 >=
					 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test=" enddefined16 != null and enddefined16 !=''">
					AND T1.DEFINED16 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="startdefined17!= null and startdefined17 !=''">
					AND T1.DEFINED17 >=
					 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined17 != null and enddefined17 !=''">
					AND T1.DEFINED17 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>	
				<if test="startdefined18!= null and startdefined18 !=''">
					AND T1.DEFINED18 >=
					 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined18 != null and enddefined18 !=''">
					AND T1.DEFINED18 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<!-- 查询结果排除ids-->
		       <if test="rejectIds != null and rejectIds.size()>0">
		       		<foreach collection="rejectIds" item="id">
		       			and T1.RES_CUST_ID !=#{id}
		       		</foreach>
		       </if>
		      <if test="queryText != null and queryText != ''">
		       		<choose>
		       			<when test='queryType != null and queryType == "mobilephone" and (state == null or state == 0)'>
		       				AND T1.telphone = #{queryText} 
		       			</when>
		       		
		       		</choose>
		       </if>
		       </if>
		       )TRCI
		       where TRCI.RES_CUST_ID != #{resCustId}	
		       <if test=" orderType != null and orderType != '' ">
					<choose>
		      			<when test="orderType == 1">
		       				order by trci.NEXT_ACTION_DATE asc
		      			</when>
		      			<when test="orderType == 2">
		      				order by trci.NEXT_ACTION_DATE desc
		      			</when>
		      			<when test="orderType == 3">
		      				order by trci.ACTION_DATE asc
		      			</when>
		      			<when test="orderType == 4">
		      				order by trci.ACTION_DATE desc
		      			</when>
		      			<when test="orderType == 5">
		      				order by trci.AMOYTOCUSTOMER_DATE asc
		      			</when>
		      			<when test="orderType == 6">
		      				order by trci.AMOYTOCUSTOMER_DATE desc
		      			</when>
	      			</choose>
			  </if>
		        <!-- )tg
                 WHERE 
                 tg.RES_CUST_ID != #{resCustId} -->
               <!--  limit #{startPage},#{endPage} -->	
		   
	</select>
	
	<!-- 我的客户 签约客户 点击 跟进操作 -->
	<select id="findCustFollowRightByMySignListPage" resultMap="RestDtoMap" parameterType="com.qftx.tsm.follow.dto.RestDto">
		 <!--  select tg.RES_CUST_ID,tg.NAME,tg.ACTION_DATE,
              tg.AMOYTOCUSTOMER_DATE,tg.NEXT_ACTION_DATE,tg.TELPHONE from( -->
		  select trci.RES_CUST_ID,trci.NAME,trci.ACTION_DATE,
              trci.AMOYTOCUSTOMER_DATE,trci.NEXT_ACTION_DATE,trci.TELPHONE from (
		  select t.RES_CUST_ID,t.NAME,t.ACTION_DATE,
              t.AMOYTOCUSTOMER_DATE,t.NEXT_ACTION_DATE,t.TELPHONE from (
		  	select T1.RES_CUST_ID,
						  T1.NAME,
						  T1.ACTION_DATE,
              			  T1.AMOYTOCUSTOMER_DATE,                                
						  T1.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
						   ifnull(T1.MOBILEPHONE, T1.TELPHONE) TELPHONE
			FROM TSM_RES_CUST_INFO T1 
		  		WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
				  	AND T1.TYPE = 2 
				    AND T1.STATUS =6  	
				    AND T1.IS_DEL = 0 
				     <!-- 下次联系时间是否为空 -->
			  		<!-- <choose>
			  			<when test="dateIsNull == 0">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NULL
		  					</when>
		  				</choose>
		  			</when>
		  			<when test="dateIsNull == 1">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NOT NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NOT NULL
		  					</when>
		  				</choose>
		  			</when>
			  		</choose> -->
					<if test="resIds != null and resIds.size() > 0">
				   		AND T1.RES_CUST_ID IN 
				   			<foreach collection="resIds" item="rid" open="(" separator="," close=")">
				   				#{rid}
				   			</foreach>
				   	</if>
					<if test=" companyTrade != null and companyTrade != '' ">
							AND T1.company_trade = #{companyTrade,jdbcType=VARCHAR}
					</if>
					<choose>
						<when test="ownerAccs!=null and ownerAccs.size() > 0">
							<if test="ownerAccs!=null">
					       		AND T1.OWNER_ACC IN 
								<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
									#{item}
								</foreach>
					        </if>
						</when>
						<otherwise>
							AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
						</otherwise>
					</choose>
					<if test="commonAccs != null and commonAccs.size() > 0">
						AND T1.COMMON_ACC IN 
						<foreach collection="commonAccs" item="ca" open="(" separator="," close=")">
							#{ca} 
						</foreach>
					</if>
					   <if test='noteType=="8"'>
			     		AND T1.COMMON_ACC IS NOT NULL 
				   </if>
				   <if test="startActionDate != null and startActionDate != ''">
			       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
			       </if>
			       <if test="endActionDate != null and endActionDate != ''">
			       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
			       </if>
			       <if test="startDate != null and startDate != ''">
			       		AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
			       </if>
			       <if test="endDate != null and endDate != ''">
			       		AND T1.SIGN_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
			       </if>
		         	<if test="pstartDate != null and pstartDate != ''">
			       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
			       </if>
			       <if test="pendDate != null and pendDate != ''">
			       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
			       </if>
			       <if test='noteType == "2"'>
			        	AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(NOW(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
			       </if>
			       <if test='noteType == "3"'>
			        	AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(NOW(),'%Y-%m'),'-01 00:00:00'),'%Y-%m-%d %H:%i:%s') 
			       </if>
			       <if test='noteType == "4"'>
			        	<choose>
			       			<when test="resCustIds != null and resCustIds.size() > 0">
			       				AND (
			       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
			       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
			       				OR T1.RES_CUST_ID IN <foreach collection="resCustIds" item="item" open="(" separator="," close=")">#{item}</foreach>
			       				)
			       			</when>
			       			<otherwise>
					       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
					       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
			       			</otherwise>
			       		</choose>
			       </if>
			       <if test='noteType == "5"'>
			        	AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
			       </if>
			       <if test='noteType == "6"'>
			        	AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
			       </if>
			       <if test='noteType == "7"'>
			        	AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -30 DAY)
			       </if>
			       <if test="custTypeId != null and custTypeId != ''">
			       		AND T1.LAST_CUST_TYPE_ID = #{custTypeId,jdbcType=VARCHAR} 
			       </if>
			       <if test='lDateType != null and lDateType == 6'>
			       		AND T1.ACTION_DATE IS NULL 
			       </if>
			       <if test='oDateType != null and oDateType == 6'>
			       		AND T1.NEXTFOLLOW_DATE IS NULL 
			       </if>
			       <!-- <if test="labels != null and labels!=''">
			       		<foreach collection="labels" item="label" separator=" " >
			       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
			       		</foreach> 
			       </if> -->
			        <if test="groupId != null and groupId != ''">
		       		AND T1.RES_GROUP_ID=#{groupId}
		       </if>
		        <choose>
					<when test="isContact == 1">
						and DATE_FORMAT(T1.OWNER_ACTION_DATE, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')   
					</when>
					<when test="isContact == 0">
						<if test="ids.size() > 0">
							AND T1.RES_CUST_ID NOT IN
							<foreach collection="ids" item="item" open="(" separator="," close=")">
								#{item} 
							</foreach>
						</if>
					</when>
				</choose>
		       <if test="defined1 != null and defined1 != ''">
					AND T1.defined1 =#{defined1}
				</if>	
				<if test="defined2 != null and defined2 != ''">
					AND T1.defined2 =#{defined2}
				</if>	
				<if test="defined3 != null and defined3 != ''">
					AND T1.defined3 =#{defined3}
				</if>	
				<if test="defined4 != null and defined4 != ''">
					AND T1.defined4 =#{defined4}
				</if>	
				<if test="defined5 != null and defined5 != ''">
					AND T1.defined5 =#{defined5}
				</if>	
				<if test="defined6 != null and defined6 != ''">
					AND T1.defined6 =#{defined6}
				</if>	
				<if test="defined7 != null and defined7 != ''">
					AND T1.defined7 =#{defined7}
				</if>	
				<if test="defined8 != null and defined8 != ''">
					AND T1.defined8 =#{defined8}
				</if>	
				<if test="defined9 != null and defined9 != ''">
					AND T1.defined9 =#{defined9}
				</if>	
				<if test="defined10 != null and defined10 != ''">
					AND T1.defined10 =#{defined10}
				</if>	
				<if test="defined11 != null and defined11 != ''">
					AND T1.defined11 =#{defined11}
				</if>	
				<if test="defined12 != null and defined12 != ''">
					AND T1.defined12 =#{defined12}
				</if>	
				<if test="defined13 != null and defined13 != ''">
					AND T1.defined13 =#{defined13}
				</if>	
				<if test="defined14 != null and defined14 != ''">
					AND T1.defined14 =#{defined14}
				</if>	
				<if test="defined15 != null and defined15 != ''">
					AND T1.defined15 =#{defined15}
				</if>	
		       <if test="startdefined16!= null and startdefined16 !=''">
					AND T1.DEFINED16 >=
					 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test=" enddefined16 != null and enddefined16 !=''">
					AND T1.DEFINED16 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="startdefined17!= null and startdefined17 !=''">
					AND T1.DEFINED17 >=
					 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined17 != null and enddefined17 !=''">
					AND T1.DEFINED17 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>	
				<if test="startdefined18!= null and startdefined18 !=''">
					AND T1.DEFINED18 >=
					 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined18 != null and enddefined18 !=''">
					AND T1.DEFINED18 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
			       <if test="queryText != null and queryText != ''">
		       		<choose>
		       			<when test='queryType != null and queryType == "custName"'>
		       				AND T1.NAME LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<when test='queryType != null and queryType == "mainLinkman" and (state == null or state == 0)'>
		       				AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<when test='queryType != null and queryType == "company"'>
		       				AND T1.COMPANY LIKE CONCAT('%',#{queryText},'%') 
		       			</when>
		       			<otherwise>
		       				AND T1.${queryType } LIKE CONCAT('%',#{queryText},'%') 
		       			</otherwise>
		       		</choose>
		       </if>
		      <if test="rejectIds != null and rejectIds.size()>0">
		       		<foreach collection="rejectIds" item="id">
		       			and T1.RES_CUST_ID !=#{id}
		       		</foreach>
		       </if>
		       )T
		<if test="!queryContract">LEFT JOIN (SELECT CM1.MONEY,CM1.CUST_ID FROM CONTRACT_MONEY CM1 WHERE CM1.ORG_ID=#{orgId}) CM 
			ON T.RES_CUST_ID = CM.CUST_ID 
		</if>
		 <if test="queryContract"> 			
			LEFT JOIN (SELECT CT.CUST_ID,MAX(CT.INVALID_DATE) AS CONTRACT_END_DATE FROM CONTRACT CT 
		  	WHERE CT.ORG_ID = #{orgId,jdbcType=VARCHAR}  AND CT.IS_DEL = 0 
		  	and CT.sign_userid = #{ownerAcc,jdbcType=VARCHAR} 
		  	<!-- 查询结果排除ids-->
	       <if test="rejectIds != null and rejectIds.size()>0">
	       		<foreach collection="rejectIds" item="id">
	       			and CT.cust_id !=#{id}
	       		</foreach>
	       </if>
		  	GROUP BY CT.CUST_ID) TD on T.RES_CUST_ID = TD.CUST_ID 
		  	WHERE 1=1 
	       <if test="startContractEndDate != null and startContractEndDate != ''"> AND TD.CONTRACT_END_DATE &gt;= STR_TO_DATE(CONCAT(#{startContractEndDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s') </if>
	       <if test="endContractEndDate != null and endContractEndDate != ''"> AND TD.CONTRACT_END_DATE &lt;= STR_TO_DATE(CONCAT(#{endContractEndDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s') </if>
       </if>
	       )TRCI
	       where TRCI.RES_CUST_ID != #{resCustId}
	       	 <if test=" orderType != null and orderType != '' ">
				<choose>
	      			<when test="orderType == 1">
	       				order by trci.NEXT_ACTION_DATE asc
	      			</when>
	      			<when test="orderType == 2">
	      				order by trci.NEXT_ACTION_DATE desc
	      			</when>
	      			<when test="orderType == 3">
	      				order by trci.ACTION_DATE asc
	      			</when>
	      			<when test="orderType == 4">
	      				order by trci.ACTION_DATE desc
	      			</when>
	      			<when test="orderType == 5">
	      				order by trci.AMOYTOCUSTOMER_DATE asc
	      			</when>
	      			<when test="orderType == 6">
	      				order by trci.AMOYTOCUSTOMER_DATE desc
	      			</when>
      			</choose>
		  </if>
	       <!--  )tg
                 WHERE 
                 tg.RES_CUST_ID != #{resCustId}
                limit #{startPage},#{endPage} -->
	</select>
	
	<!-- 我的客户 签约客户电话查询 点击 跟进操作 -->
	<select id="findCustFollowRightByMySignWithPhoneListPage" resultMap="RestDtoMap" parameterType="com.qftx.tsm.follow.dto.RestDto">
		  <!-- select tg.RES_CUST_ID,tg.NAME,tg.ACTION_DATE,
              tg.AMOYTOCUSTOMER_DATE,tg.NEXT_ACTION_DATE,tg.TELPHONE from( -->
		  select trci.RES_CUST_ID,trci.NAME,trci.ACTION_DATE,
              trci.AMOYTOCUSTOMER_DATE,trci.NEXT_ACTION_DATE,trci.TELPHONE from (
		  select t.RES_CUST_ID,t.NAME,t.ACTION_DATE,
              t.AMOYTOCUSTOMER_DATE,t.NEXT_ACTION_DATE,t.TELPHONE from (
		  	select T1.RES_CUST_ID,
						  T1.NAME,
						  T1.ACTION_DATE,
              			  T1.AMOYTOCUSTOMER_DATE,                                
						  T1.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
						   ifnull(T1.MOBILEPHONE, T1.TELPHONE) TELPHONE
			FROM TSM_RES_CUST_INFO T1 
		  		WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
				  	AND T1.TYPE = 2 
				    AND T1.STATUS =6  	
				    AND T1.IS_DEL = 0 
				     <!-- 下次联系时间是否为空 -->
			  		<!-- <choose>
			  			<when test="dateIsNull == 0">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NULL
		  					</when>
		  				</choose>
		  			</when>
		  			<when test="dateIsNull == 1">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NOT NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NOT NULL
		  					</when>
		  				</choose>
		  			</when>
			  		</choose> -->
					<if test="resIds != null and resIds.size() > 0">
				   		AND T1.RES_CUST_ID IN 
				   			<foreach collection="resIds" item="rid" open="(" separator="," close=")">
				   				#{rid}
				   			</foreach>
				   	</if>
					<if test=" companyTrade != null and companyTrade != '' ">
							AND T1.company_trade = #{companyTrade,jdbcType=VARCHAR}
					</if>
					<choose>
						<when test="ownerAccs!=null and ownerAccs.size() > 0">
							<if test="ownerAccs!=null">
					       		AND T1.OWNER_ACC IN 
								<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
									#{item}
								</foreach>
					        </if>
						</when>
						<otherwise>
							AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
						</otherwise>
					</choose>
					<if test="commonAccs != null and commonAccs.size() > 0">
						AND T1.COMMON_ACC IN 
						<foreach collection="commonAccs" item="ca" open="(" separator="," close=")">
							#{ca} 
						</foreach>
					</if>
					   <if test='noteType=="8"'>
			     		AND T1.COMMON_ACC IS NOT NULL 
				   </if>
				   <if test="startActionDate != null and startActionDate != ''">
			       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
			       </if>
			       <if test="endActionDate != null and endActionDate != ''">
			       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
			       </if>
			       <if test="startDate != null and startDate != ''">
			       		AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
			       </if>
			       <if test="endDate != null and endDate != ''">
			       		AND T1.SIGN_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
			       </if>
		         	<if test="pstartDate != null and pstartDate != ''">
			       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
			       </if>
			       <if test="pendDate != null and pendDate != ''">
			       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
			       </if>
			       <if test='noteType == "2"'>
			        	AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(NOW(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
			       </if>
			       <if test='noteType == "3"'>
			        	AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(NOW(),'%Y-%m'),'-01 00:00:00'),'%Y-%m-%d %H:%i:%s') 
			       </if>
			       <if test='noteType == "4"'>
			        	<choose>
			       			<when test="resCustIds != null and resCustIds.size() > 0">
			       				AND (
			       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
			       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
			       				OR T1.RES_CUST_ID IN <foreach collection="resCustIds" item="item" open="(" separator="," close=")">#{item}</foreach>
			       				)
			       			</when>
			       			<otherwise>
					       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
					       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
			       			</otherwise>
			       		</choose>
			       </if>
			       <if test='noteType == "5"'>
			        	AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
			       </if>
			       <if test='noteType == "6"'>
			        	AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
			       </if>
			       <if test='noteType == "7"'>
			        	AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -30 DAY)
			       </if>
			       <if test="custTypeId != null and custTypeId != ''">
			       		AND T1.LAST_CUST_TYPE_ID = #{custTypeId,jdbcType=VARCHAR} 
			       </if>
			       <if test='lDateType != null and lDateType == 6'>
			       		AND T1.ACTION_DATE IS NULL 
			       </if>
			       <if test='oDateType != null and oDateType == 6'>
			       		AND T1.NEXTFOLLOW_DATE IS NULL 
			       </if>
			      <!--  <if test="labels != null and labels!=''">
			       		<foreach collection="labels" item="label" separator=" " >
			       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
			       		</foreach> 
			       </if> -->
			        <if test="groupId != null and groupId != ''">
		       		AND T1.RES_GROUP_ID=#{groupId}
		       </if>
		       <choose>
					<when test="isContact == 1">
						and DATE_FORMAT(T1.OWNER_ACTION_DATE, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')   
					</when>
					<when test="isContact == 0">
						<if test="ids.size() > 0">
							AND T1.RES_CUST_ID NOT IN
							<foreach collection="ids" item="item" open="(" separator="," close=")">
								#{item} 
							</foreach>
						</if>
					</when>
				</choose>
		       <if test="defined1 != null and defined1 != ''">
					AND T1.defined1 =#{defined1}
				</if>	
				<if test="defined2 != null and defined2 != ''">
					AND T1.defined2 =#{defined2}
				</if>	
				<if test="defined3 != null and defined3 != ''">
					AND T1.defined3 =#{defined3}
				</if>	
				<if test="defined4 != null and defined4 != ''">
					AND T1.defined4 =#{defined4}
				</if>	
				<if test="defined5 != null and defined5 != ''">
					AND T1.defined5 =#{defined5}
				</if>	
				<if test="defined6 != null and defined6 != ''">
					AND T1.defined6 =#{defined6}
				</if>	
				<if test="defined7 != null and defined7 != ''">
					AND T1.defined7 =#{defined7}
				</if>	
				<if test="defined8 != null and defined8 != ''">
					AND T1.defined8 =#{defined8}
				</if>	
				<if test="defined9 != null and defined9 != ''">
					AND T1.defined9 =#{defined9}
				</if>	
				<if test="defined10 != null and defined10 != ''">
					AND T1.defined10 =#{defined10}
				</if>	
				<if test="defined11 != null and defined11 != ''">
					AND T1.defined11 =#{defined11}
				</if>	
				<if test="defined12 != null and defined12 != ''">
					AND T1.defined12 =#{defined12}
				</if>	
				<if test="defined13 != null and defined13 != ''">
					AND T1.defined13 =#{defined13}
				</if>	
				<if test="defined14 != null and defined14 != ''">
					AND T1.defined14 =#{defined14}
				</if>	
				<if test="defined15 != null and defined15 != ''">
					AND T1.defined15 =#{defined15}
				</if>	
		       <if test="startdefined16!= null and startdefined16 !=''">
					AND T1.DEFINED16 >=
					 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test=" enddefined16 != null and enddefined16 !=''">
					AND T1.DEFINED16 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="startdefined17!= null and startdefined17 !=''">
					AND T1.DEFINED17 >=
					 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined17 != null and enddefined17 !=''">
					AND T1.DEFINED17 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>	
				<if test="startdefined18!= null and startdefined18 !=''">
					AND T1.DEFINED18 >=
					 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined18 != null and enddefined18 !=''">
					AND T1.DEFINED18 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
			       <if test="queryText != null and queryText != ''">
		       		<choose>
		       			<when test='queryType != null and queryType == "mobilephone"'>
		       				AND T1.mobilephone = #{queryText} 
		       			</when>
		       		</choose>
		       </if>
		      <if test="rejectIds != null and rejectIds.size()>0">
		       		<foreach collection="rejectIds" item="id">
		       			and T1.RES_CUST_ID !=#{id}
		       		</foreach>
		       </if>
		       <if test="queryText != null and queryText != '' and queryType == 'mobilephone' and (state == null or state == 0)">
		       union
		       select T1.RES_CUST_ID,
						  T1.NAME,
						  T1.ACTION_DATE,
              			  T1.AMOYTOCUSTOMER_DATE,                                
						  T1.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
						   ifnull(T1.MOBILEPHONE, T1.TELPHONE) TELPHONE
			FROM TSM_RES_CUST_INFO T1 
		  		WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
				  	AND T1.TYPE = 2 
				    AND T1.STATUS =6  	
				    AND T1.IS_DEL = 0 
				     <!-- 下次联系时间是否为空 -->
			  		<!-- <choose>
			  		<when test="dateIsNull == 0">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NULL
		  					</when>
		  				</choose>
		  			</when>
		  			<when test="dateIsNull == 1">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NOT NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NOT NULL
		  					</when>
		  				</choose>
		  			</when>
			  		</choose> -->
					<if test="resIds != null and resIds.size() > 0">
				   		AND T1.RES_CUST_ID IN 
				   			<foreach collection="resIds" item="rid" open="(" separator="," close=")">
				   				#{rid}
				   			</foreach>
				   	</if>
				   	<if test=" companyTrade != null and companyTrade != '' ">
							AND T1.company_trade = #{companyTrade,jdbcType=VARCHAR}
					</if>
					<choose>
						<when test="ownerAccs!=null and ownerAccs.size() > 0">
							<if test="ownerAccs!=null">
					       		AND T1.OWNER_ACC IN 
								<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
									#{item}
								</foreach>
					        </if>
						</when>
						<otherwise>
							AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
						</otherwise>
					</choose>
					<if test="commonAccs != null and commonAccs.size() > 0">
						AND T1.COMMON_ACC IN 
						<foreach collection="commonAccs" item="ca" open="(" separator="," close=")">
							#{ca} 
						</foreach>
					</if>
					   <if test='noteType=="8"'>
			     		AND T1.COMMON_ACC IS NOT NULL 
				   </if>
				   <if test="startActionDate != null and startActionDate != ''">
			       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
			       </if>
			       <if test="endActionDate != null and endActionDate != ''">
			       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
			       </if>
			       <if test="startDate != null and startDate != ''">
			       		AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
			       </if>
			       <if test="endDate != null and endDate != ''">
			       		AND T1.SIGN_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
			       </if>
		         	<if test="pstartDate != null and pstartDate != ''">
			       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
			       </if>
			       <if test="pendDate != null and pendDate != ''">
			       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
			       </if>
			       <if test='noteType == "2"'>
			        	AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(NOW(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
			       </if>
			       <if test='noteType == "3"'>
			        	AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(NOW(),'%Y-%m'),'-01 00:00:00'),'%Y-%m-%d %H:%i:%s') 
			       </if>
			       <if test='noteType == "4"'>
			        	<choose>
			       			<when test="resCustIds != null and resCustIds.size() > 0">
			       				AND (
			       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
			       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
			       				OR T1.RES_CUST_ID IN <foreach collection="resCustIds" item="item" open="(" separator="," close=")">#{item}</foreach>
			       				)
			       			</when>
			       			<otherwise>
					       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
					       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
			       			</otherwise>
			       		</choose>
			       </if>
			       <if test='noteType == "5"'>
			        	AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
			       </if>
			       <if test='noteType == "6"'>
			        	AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
			       </if>
			       <if test='noteType == "7"'>
			        	AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -30 DAY)
			       </if>
			       <if test="custTypeId != null and custTypeId != ''">
			       		AND T1.LAST_CUST_TYPE_ID = #{custTypeId,jdbcType=VARCHAR} 
			       </if>
			       <if test='lDateType != null and lDateType == 6'>
			       		AND T1.ACTION_DATE IS NULL 
			       </if>
			       <if test='oDateType != null and oDateType == 6'>
			       		AND T1.NEXTFOLLOW_DATE IS NULL 
			       </if>
			      <!--  <if test="labels != null and labels!=''">
			       		<foreach collection="labels" item="label" separator=" " >
			       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
			       		</foreach> 
			       </if> -->
			        <if test="groupId != null and groupId != ''">
		       		AND T1.RES_GROUP_ID=#{groupId}
		       </if>
		        <choose>
					<when test="isContact == 1">
						and DATE_FORMAT(T1.OWNER_ACTION_DATE, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')   
					</when>
					<when test="isContact == 0">
						<if test="ids.size() > 0">
							AND T1.RES_CUST_ID NOT IN
							<foreach collection="ids" item="item" open="(" separator="," close=")">
								#{item} 
							</foreach>
						</if>
					</when>
				</choose>
		       <if test="defined1 != null and defined1 != ''">
					AND T1.defined1 =#{defined1}
				</if>	
				<if test="defined2 != null and defined2 != ''">
					AND T1.defined2 =#{defined2}
				</if>	
				<if test="defined3 != null and defined3 != ''">
					AND T1.defined3 =#{defined3}
				</if>	
				<if test="defined4 != null and defined4 != ''">
					AND T1.defined4 =#{defined4}
				</if>	
				<if test="defined5 != null and defined5 != ''">
					AND T1.defined5 =#{defined5}
				</if>	
				<if test="defined6 != null and defined6 != ''">
					AND T1.defined6 =#{defined6}
				</if>	
				<if test="defined7 != null and defined7 != ''">
					AND T1.defined7 =#{defined7}
				</if>	
				<if test="defined8 != null and defined8 != ''">
					AND T1.defined8 =#{defined8}
				</if>	
				<if test="defined9 != null and defined9 != ''">
					AND T1.defined9 =#{defined9}
				</if>	
				<if test="defined10 != null and defined10 != ''">
					AND T1.defined10 =#{defined10}
				</if>	
				<if test="defined11 != null and defined11 != ''">
					AND T1.defined11 =#{defined11}
				</if>	
				<if test="defined12 != null and defined12 != ''">
					AND T1.defined12 =#{defined12}
				</if>	
				<if test="defined13 != null and defined13 != ''">
					AND T1.defined13 =#{defined13}
				</if>	
				<if test="defined14 != null and defined14 != ''">
					AND T1.defined14 =#{defined14}
				</if>	
				<if test="defined15 != null and defined15 != ''">
					AND T1.defined15 =#{defined15}
				</if>	
		       <if test="startdefined16!= null and startdefined16 !=''">
					AND T1.DEFINED16 >=
					 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test=" enddefined16 != null and enddefined16 !=''">
					AND T1.DEFINED16 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="startdefined17!= null and startdefined17 !=''">
					AND T1.DEFINED17 >=
					 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined17 != null and enddefined17 !=''">
					AND T1.DEFINED17 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>	
				<if test="startdefined18!= null and startdefined18 !=''">
					AND T1.DEFINED18 >=
					 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
				<if test="enddefined18 != null and enddefined18 !=''">
					AND T1.DEFINED18 <![CDATA[ <= ]]>
					STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
		                                       '%Y-%m-%d %H:%i:%s')
				</if>
			       <if test="queryText != null and queryText != ''">
		       		<choose>
		       			<when test='queryType != null and queryType == "mobilephone" and (state == null or state == 0)'>
		       				AND T1.telphone = #{queryText} 
		       			</when>
		       		</choose>
		       </if>
		      <if test="rejectIds != null and rejectIds.size()>0">
		       		<foreach collection="rejectIds" item="id">
		       			and T1.RES_CUST_ID !=#{id}
		       		</foreach>
		       </if>
		       </if>
		       )T
		<if test="!queryContract">LEFT JOIN (SELECT CM1.MONEY,CM1.CUST_ID FROM CONTRACT_MONEY CM1 WHERE CM1.ORG_ID=#{orgId}) CM 
			ON T.RES_CUST_ID = CM.CUST_ID 
		</if>
		 <if test="queryContract"> 			
			LEFT JOIN (SELECT CT.CUST_ID,MAX(CT.INVALID_DATE) AS CONTRACT_END_DATE FROM CONTRACT CT 
		  	WHERE CT.ORG_ID = #{orgId,jdbcType=VARCHAR}  AND CT.IS_DEL = 0 
		  	and CT.sign_userid = #{ownerAcc,jdbcType=VARCHAR} 
		  	<!-- 查询结果排除ids-->
	       <if test="rejectIds != null and rejectIds.size()>0">
	       		<foreach collection="rejectIds" item="id">
	       			and CT.cust_id !=#{id}
	       		</foreach>
	       </if>
		  	GROUP BY CT.CUST_ID) TD on T.RES_CUST_ID = TD.CUST_ID 
		  	WHERE 1=1 
	       <if test="startContractEndDate != null and startContractEndDate != ''"> AND TD.CONTRACT_END_DATE &gt;= STR_TO_DATE(CONCAT(#{startContractEndDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s') </if>
	       <if test="endContractEndDate != null and endContractEndDate != ''"> AND TD.CONTRACT_END_DATE &lt;= STR_TO_DATE(CONCAT(#{endContractEndDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s') </if>
       </if>
	       )TRCI
	       where TRCI.RES_CUST_ID != #{resCustId}
	       	 <if test=" orderType != null and orderType != '' ">
				<choose>
	      			<when test="orderType == 1">
	       				order by trci.NEXT_ACTION_DATE asc
	      			</when>
	      			<when test="orderType == 2">
	      				order by trci.NEXT_ACTION_DATE desc
	      			</when>
	      			<when test="orderType == 3">
	      				order by trci.ACTION_DATE asc
	      			</when>
	      			<when test="orderType == 4">
	      				order by trci.ACTION_DATE desc
	      			</when>
	      			<when test="orderType == 5">
	      				order by trci.AMOYTOCUSTOMER_DATE asc
	      			</when>
	      			<when test="orderType == 6">
	      				order by trci.AMOYTOCUSTOMER_DATE desc
	      			</when>
      			</choose>
		  </if>
	       <!--  )tg
                 WHERE 
                 tg.RES_CUST_ID != #{resCustId}
                limit #{startPage},#{endPage} -->
	</select>
	
	<!-- 我的客户 沉默客户 点击 跟进操作 -->
	<select id="findCustFollowRightByMySilentListPage" resultMap="RestDtoMap" parameterType="com.qftx.tsm.follow.dto.RestDto">
	<!-- 	SELECT tg.RES_CUST_ID,tg.NAME,tg.ACTION_DATE,
              			  tg.AMOYTOCUSTOMER_DATE,tg.NEXT_ACTION_DATE,tg.TELPHONE from( -->
			SELECT trci.RES_CUST_ID,trci.NAME,trci.ACTION_DATE,
              			  trci.AMOYTOCUSTOMER_DATE,trci.NEXT_ACTION_DATE,trci.TELPHONE FROM(
			SELECT T.RES_CUST_ID,T.NAME,T.ACTION_DATE,
              			  T.AMOYTOCUSTOMER_DATE,T.NEXT_ACTION_DATE,T.TELPHONE FROM (
		  		SELECT T1.RES_CUST_ID,
						  T1.NAME,  
  						  T1.ACTION_DATE,
              			  T1.AMOYTOCUSTOMER_DATE,                            
						  T1.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
						   ifnull(T1.MOBILEPHONE, T1.TELPHONE) TELPHONE
		        FROM TSM_RES_CUST_INFO T1
		  				WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
						  	AND T1.TYPE = 2 
						    AND T1.STATUS = 7   	
						    AND T1.IS_DEL = 0 
						     <!-- 下次联系时间是否为空 -->
					  		<!-- <choose>
					  			<when test="dateIsNull == 0">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NULL
		  					</when>
		  				</choose>
		  			</when>
		  			<when test="dateIsNull == 1">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NOT NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NOT NULL
		  					</when>
		  				</choose>
		  			</when>
					  		</choose>	 -->	
							<if test="resIds != null and resIds.size() > 0 and state == 1 and state != null">
						   		AND T1.RES_CUST_ID IN 
						   			<foreach collection="resIds" item="rid" open="(" separator="," close=")">
						   				#{rid}
						   			</foreach>
						   	</if>
							<choose>
								<when test="ownerAccs!=null and ownerAccs.size() > 0">
									<if test="ownerAccs!=null">
							       		AND T1.OWNER_ACC IN 
										<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
											#{item}
										</foreach>
							        </if>
								</when>
								<otherwise>
									AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
								</otherwise>
							</choose>
						   <if test="startActionDate != null and startActionDate != ''">
					       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					       </if>
					       <if test="endActionDate != null and endActionDate != ''">
					       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					       </if>
					       <if test='noteType == "2"'>
					       		AND T1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -7 DAY) 
					       </if>
					       <if test='noteType == "3"'>
					       	    AND T1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -30 DAY) 
					       </if>
					       <if test='noteType == "4"'>
					       		AND T1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -90 DAY) 
					       </if>
					       <!-- <if test="labels != null and labels!=''">
					       		<foreach collection="labels" item="label" separator=" " >
					       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
					       		</foreach> 
					       </if> -->
					         <if test="resGroupId != null and resGroupId != ''">
				       		AND T1.RES_GROUP_ID = #{resGroupId} 
				       		</if>
				       		 <choose>
								<when test="isContact == 1">
									and DATE_FORMAT(T1.OWNER_ACTION_DATE, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')   
								</when>
								<when test="isContact == 0">
									<if test="ids.size() > 0">
										AND T1.RES_CUST_ID NOT IN
										<foreach collection="ids" item="item" open="(" separator="," close=")">
											#{item} 
										</foreach>
									</if>
								</when>
							</choose>
					       <!-- 最近联系时间 -->
					       <if test="startActionDate != null and startActionDate != ''">
					       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					       </if>
					       <if test="endActionDate != null and endActionDate != ''">
					       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					       </if>
					       <if test="queryText != null and queryText != ''">
					       		<choose>
					       			<when test='queryType != null and queryType == "1"'>
					       				AND T1.NAME LIKE CONCAT('%',#{queryText},'%') 
					       			</when>
					       			<when test='queryType != null and queryType == "2" and (state == null or state == 0)'>
					       				AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{queryText},'%') 
					       			</when>
					       			<when test='queryType != null and queryType == "3" and (state == null or state == 0)'>
					       				AND T1.mobilephone = #{queryText} 
					       			</when>
					       			<when test='queryType != null and queryType == "4"'>
					       				AND T1.COMPANY LIKE CONCAT('%',#{queryText},'%') 
					       			</when>
					       			<otherwise>
					       				AND T1.${queryType } LIKE CONCAT('%',#{queryText},'%') 
					       			</otherwise>
					       		</choose>
		       			</if>
		       			<if test="queryText != null and queryText != '' and queryType != null and queryType == '3' and (state == null or state == 0)">
		       			union
		       			SELECT T1.RES_CUST_ID,
						  T1.NAME,  
  						  T1.ACTION_DATE,
              			  T1.AMOYTOCUSTOMER_DATE,                            
						  T1.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
						   ifnull(T1.MOBILEPHONE, T1.TELPHONE) TELPHONE
		        FROM TSM_RES_CUST_INFO T1
		  				WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
						  	AND T1.TYPE = 2 
						    AND T1.STATUS = 7   	
						    AND T1.IS_DEL = 0 
						     <!-- 下次联系时间是否为空 -->
					  		<!-- <choose>
					  			<when test="dateIsNull == 0">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NULL
		  					</when>
		  				</choose>
		  			</when>
		  			<when test="dateIsNull == 1">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NOT NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NOT NULL
		  					</when>
		  				</choose>
		  			</when>
					  		</choose> -->
							<if test="resIds != null and resIds.size() > 0 and state == 1 and state != null">
						   		AND T1.RES_CUST_ID IN 
						   			<foreach collection="resIds" item="rid" open="(" separator="," close=")">
						   				#{rid}
						   			</foreach>
						   	</if>
							<choose>
								<when test="ownerAccs!=null and ownerAccs.size() > 0">
									<if test="ownerAccs!=null">
							       		AND T1.OWNER_ACC IN 
										<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
											#{item}
										</foreach>
							        </if>
								</when>
								<otherwise>
									AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
								</otherwise>
							</choose>
						   <if test="startActionDate != null and startActionDate != ''">
					       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					       </if>
					       <if test="endActionDate != null and endActionDate != ''">
					       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					       </if>
					       <if test='noteType == "2"'>
					       		AND T1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -7 DAY) 
					       </if>
					       <if test='noteType == "3"'>
					       	    AND T1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -30 DAY) 
					       </if>
					       <if test='noteType == "4"'>
					       		AND T1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -90 DAY) 
					       </if>
					       <!-- <if test="labels != null and labels!=''">
					       		<foreach collection="labels" item="label" separator=" " >
					       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
					       		</foreach> 
					       </if> -->
					         <if test="resGroupId != null and resGroupId != ''">
				       		AND T1.RES_GROUP_ID = #{resGroupId} 
				       		</if>
				       		 <choose>
								<when test="isContact == 1">
									and DATE_FORMAT(T1.OWNER_ACTION_DATE, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')   
								</when>
								<when test="isContact == 0">
									<if test="ids.size() > 0">
										AND T1.RES_CUST_ID NOT IN
										<foreach collection="ids" item="item" open="(" separator="," close=")">
											#{item} 
										</foreach>
									</if>
								</when>
							</choose>
					       <!-- 最近联系时间 -->
					       <if test="startActionDate != null and startActionDate != ''">
					       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					       </if>
					       <if test="endActionDate != null and endActionDate != ''">
					       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					       </if>
					       <if test="queryText != null and queryText != ''">
					       		<choose>
					       			<when test='queryType != null and queryType == "3" and (state == null or state == 0)'>
					       				AND T1.telphone = #{queryText} 
					       			</when>
					       		</choose>
		       			</if>
		       			</if>
		       			
		  ) T 
		  LEFT JOIN (SELECT CM1.MONEY,CM1.CUST_ID FROM CONTRACT_MONEY CM1 WHERE CM1.ORG_ID=#{orgId}) CM 
			ON T.RES_CUST_ID = CM.CUST_ID 
		  LEFT JOIN (SELECT CT.CUST_ID,MAX(CT.INVALID_DATE) AS CONTRACT_END_DATE 
		  		FROM CONTRACT CT 
		  	WHERE CT.ORG_ID = #{orgId,jdbcType=VARCHAR} 
		  	AND CT.IS_DEL = 0 
		  GROUP BY CT.CUST_ID) TD 
			ON T.RES_CUST_ID = TD.CUST_ID 
		  WHERE 1=1 
	       <!-- 合同截止时间 -->
	       <if test="pstartDate != null and pstartDate != ''">
	       		AND TD.CONTRACT_END_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
	       </if>
	       <if test="pendDate != null and pendDate != ''">
	       		AND TD.CONTRACT_END_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
	       </if>
	       ) TRCI
	       where TRCI.RES_CUST_ID != #{resCustId}
	       	<if test=" orderType != null and orderType != '' ">
					<choose>
		      			<when test="orderType == 1">
		       				order by trci.NEXT_ACTION_DATE asc
		      			</when>
		      			<when test="orderType == 2">
		      				order by trci.NEXT_ACTION_DATE desc
		      			</when>
		      			<when test="orderType == 3">
		      				order by trci.ACTION_DATE asc
		      			</when>
		      			<when test="orderType == 4">
		      				order by trci.ACTION_DATE desc
		      			</when>
		      			<when test="orderType == 5">
		      				order by trci.AMOYTOCUSTOMER_DATE asc
		      			</when>
		      			<when test="orderType == 6">
		      				order by trci.AMOYTOCUSTOMER_DATE desc
		      			</when>
	      			</choose>
			  </if>
	      <!--  )tg
                 WHERE 
                 tg.RES_CUST_ID != #{resCustId}
                limit #{startPage},#{endPage} -->
	</select>
	
	<!-- 我的客户 流失客户 点击 跟进操作 -->
	<select id="findCustFollowRightByMyLosListPage" resultMap="RestDtoMap" parameterType="com.qftx.tsm.follow.dto.RestDto">
		<!-- select tg.RES_CUST_ID,tg.NAME,tg.ACTION_DATE,
		            tg.AMOYTOCUSTOMER_DATE,tg.NEXT_ACTION_DATE,tg.TELPHONE  from(  -->
		SELECT trci.RES_CUST_ID,trci.NAME,trci.ACTION_DATE,
		            trci.AMOYTOCUSTOMER_DATE,trci.NEXT_ACTION_DATE,trci.TELPHONE  FROM (
		select t.RES_CUST_ID,t.NAME,t.ACTION_DATE,
		            t.AMOYTOCUSTOMER_DATE,t.NEXT_ACTION_DATE,t.TELPHONE  FROM (
		  		SELECT 
				    T1.RES_CUST_ID,
			  		T1.NAME,
			   		T1.ACTION_DATE,
		            T1.AMOYTOCUSTOMER_DATE,                               
			  		T1.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
			   		ifnull(T1.MOBILEPHONE, T1.TELPHONE) TELPHONE
				 FROM TSM_RES_CUST_INFO T1 
		  				WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
					  	AND T1.TYPE = 2 
					    AND T1.STATUS = 8    	
					    AND T1.IS_DEL = 0 
					     <!-- 下次联系时间是否为空 -->
				  		<!-- <choose>
				  			<when test="dateIsNull == 0">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NULL
		  					</when>
		  				</choose>
		  			</when>
		  			<when test="dateIsNull == 1">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NOT NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NOT NULL
		  					</when>
		  				</choose>
		  			</when>
				  		</choose> -->
					    <if test="resIds != null and resIds.size() > 0 and state != null and state == 1">
				   		  AND T1.RES_CUST_ID IN 
				   			<foreach collection="resIds" item="rid" open="(" separator="," close=")">
				   				#{rid}
				   			</foreach>
				        </if>		
						<choose>
							<when test="ownerAccs!=null and ownerAccs.size() > 0">
								<if test="ownerAccs!=null">
						       		AND T1.OWNER_ACC IN 
									<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
										#{item}
									</foreach>
						        </if>
							</when>
							<otherwise>
								AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
							</otherwise>
						</choose>
					   <if test="startActionDate != null and startActionDate != ''">
				       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
				       </if>
				       <if test="endActionDate != null and endActionDate != ''">
				       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
				       </if>
				       <if test='noteType == "2"'>
				       		AND T1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -7 DAY) 
				       </if>
				       <if test='noteType == "3"'>
				       	    AND T1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -30 DAY)  
				       </if>
				       <if test='noteType == "4"'>
				       		AND T1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -90 DAY)  
				       </if>
				       <if test="losingId != null and losingId != ''">
				       		AND T1.LOSING_ID = #{losingId} 
				       </if>
				       <if test="resGroupId != null and resGroupId != ''">
				       		AND T1.RES_GROUP_ID = #{resGroupId} 
				       </if>
				       <choose>
							<when test="isContact == 1">
								and DATE_FORMAT(T1.OWNER_ACTION_DATE, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')   
							</when>
							<when test="isContact == 0">
								<if test="ids.size() > 0">
									AND T1.RES_CUST_ID NOT IN
									<foreach collection="ids" item="item" open="(" separator="," close=")">
										#{item} 
									</foreach>
								</if>
							</when>
						</choose>
				       <!-- <if test="labels != null and labels!= ''">
				       		<foreach collection="labels" item="label" separator=" " >
				       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
				       		</foreach> 
				       </if> -->
				        <if test="queryText != null and queryText != ''">
				       		<choose>
				       			<when test='queryType != null and queryType == "1"'>
				       				AND T1.NAME LIKE CONCAT('%',#{queryText},'%') 
				       			</when>
				       			<when test='queryType != null and queryType == "2" and (state == null or state == 0)'>
				       				AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{queryText},'%') 
				       			</when>
				       			<when test='queryType != null and queryType == "3" and (state == null or state == 0)'>
				       				AND T1.mobilephone = #{queryText} 
				       			</when>
				       			<when test='queryType != null and queryType == "4"'>
				       				AND T1.COMPANY LIKE CONCAT('%',#{queryText},'%') 
				       			</when>
				       			<otherwise>
				       				AND T1.${queryType } LIKE CONCAT('%',#{queryText},'%') 
				       			</otherwise>
				       		</choose>
		       			</if>
		       			 <if test="queryText != null and queryText != '' and queryType != null and queryType == '3' and (state == null or state == 0)">
		       			 union
		       			 SELECT 
				    T1.RES_CUST_ID,
			  		T1.NAME,
			   		T1.ACTION_DATE,
		            T1.AMOYTOCUSTOMER_DATE,                               
			  		T1.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
			   		ifnull(T1.MOBILEPHONE, T1.TELPHONE) TELPHONE
				 FROM TSM_RES_CUST_INFO T1 
		  				WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
					  	AND T1.TYPE = 2 
					    AND T1.STATUS = 8    	
					    AND T1.IS_DEL = 0 
					     <!-- 下次联系时间是否为空 -->
				  		<!-- <choose>
				  			<when test="dateIsNull == 0">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NULL
		  					</when>
		  				</choose>
		  			</when>
		  			<when test="dateIsNull == 1">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NOT NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NOT NULL
		  					</when>
		  				</choose>
		  			</when>
				  		</choose> -->
					    <if test="resIds != null and resIds.size() > 0 and state != null and state == 1">
				   		  AND T1.RES_CUST_ID IN 
				   			<foreach collection="resIds" item="rid" open="(" separator="," close=")">
				   				#{rid}
				   			</foreach>
				        </if>		
						<choose>
							<when test="ownerAccs!=null and ownerAccs.size() > 0">
								<if test="ownerAccs!=null">
						       		AND T1.OWNER_ACC IN 
									<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
										#{item}
									</foreach>
						        </if>
							</when>
							<otherwise>
								AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
							</otherwise>
						</choose>
					   <if test="startActionDate != null and startActionDate != ''">
				       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
				       </if>
				       <if test="endActionDate != null and endActionDate != ''">
				       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
				       </if>
				       <if test='noteType == "2"'>
				       		AND T1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -7 DAY) 
				       </if>
				       <if test='noteType == "3"'>
				       	    AND T1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -30 DAY)  
				       </if>
				       <if test='noteType == "4"'>
				       		AND T1.ACTION_DATE &gt;= DATE_ADD(NOW(),INTERVAL -90 DAY)  
				       </if>
				       <if test="losingId != null and losingId != ''">
				       		AND T1.LOSING_ID = #{losingId} 
				       </if>
				       <if test="resGroupId != null and resGroupId != ''">
				       		AND T1.RES_GROUP_ID = #{resGroupId} 
				       </if>
				        <choose>
							<when test="isContact == 1">
								and DATE_FORMAT(T1.OWNER_ACTION_DATE, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')   
							</when>
							<when test="isContact == 0">
								<if test="ids.size() > 0">
									AND T1.RES_CUST_ID NOT IN
									<foreach collection="ids" item="item" open="(" separator="," close=")">
										#{item} 
									</foreach>
								</if>
							</when>
						</choose>
				      <!--  <if test="labels != null and labels!= ''">
				       		<foreach collection="labels" item="label" separator=" " >
				       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
				       		</foreach> 
				       </if> -->
				        <if test="queryText != null and queryText != ''">
				       		<choose>
				       			<when test='queryType != null and queryType == "3" and (state == null or state == 0)'>
				       				AND T1.telphone = #{queryText} 
				       			</when>
				       		</choose>
		       			</if>
		       			 </if>
		  ) T 
		  LEFT JOIN (SELECT CM1.MONEY,CM1.CUST_ID FROM CONTRACT_MONEY CM1 WHERE CM1.ORG_ID=#{orgId}) CM ON T.RES_CUST_ID = CM.CUST_ID
		  LEFT JOIN (SELECT CT.CUST_ID,MAX(CT.INVALID_DATE) AS CONTRACT_END_DATE 
		  		FROM CONTRACT CT 
		  	WHERE CT.ORG_ID = #{orgId,jdbcType=VARCHAR} 
		  	AND CT.IS_DEL = 0 
		  GROUP BY CT.CUST_ID) TD 
			ON T.RES_CUST_ID = TD.CUST_ID 
		  WHERE 1=1 
		   <!-- 合同截止时间 -->
	       <if test="pstartDate != null and pstartDate != ''">
	       		AND TD.CONTRACT_END_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
	       </if>
	       <if test="pendDate != null and pendDate != ''">
	       		AND TD.CONTRACT_END_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
	       </if>
		   ) TRCI
		   where TRCI.RES_CUST_ID != #{resCustId}	
		   <if test=" orderType != null and orderType != '' ">
					<choose>
		      			<when test="orderType == 1">
		       				order by trci.NEXT_ACTION_DATE asc
		      			</when>
		      			<when test="orderType == 2">
		      				order by trci.NEXT_ACTION_DATE desc
		      			</when>
		      			<when test="orderType == 3">
		      				order by trci.ACTION_DATE asc
		      			</when>
		      			<when test="orderType == 4">
		      				order by trci.ACTION_DATE desc
		      			</when>
		      			<when test="orderType == 5">
		      				order by trci.AMOYTOCUSTOMER_DATE asc
		      			</when>
		      			<when test="orderType == 6">
		      				order by trci.AMOYTOCUSTOMER_DATE desc
		      			</when>
	      			</choose>
			  </if>
		   <!--  )tg
                 WHERE 
                 tg.RES_CUST_ID != #{resCustId}
                limit #{startPage},#{endPage} -->
	</select>
	
	
	<!-- 我的客户 全部客户 点击 跟进操作 -->
	<select id="findCustFollowRightByMyAllListPage" resultMap="RestDtoMap" parameterType="com.qftx.tsm.follow.dto.RestDto">
		  		<!-- select tg.RES_CUST_ID,tg.NAME,tg.ACTION_DATE,
		            tg.AMOYTOCUSTOMER_DATE,tg.NEXT_ACTION_DATE,tg.TELPHONE from( -->
		  		select trci.RES_CUST_ID,trci.NAME,trci.ACTION_DATE,
		            trci.AMOYTOCUSTOMER_DATE,trci.NEXT_ACTION_DATE,trci.TELPHONE from(
		  		SELECT 
				    T1.RES_CUST_ID,
			  		T1.NAME,
			  		T1.ACTION_DATE,
		            T1.AMOYTOCUSTOMER_DATE,                                 
			  		T1.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
			   		ifnull(T1.MOBILEPHONE, T1.TELPHONE) TELPHONE
				FROM TSM_RES_CUST_INFO T1
		  		WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
						 	AND T1.IS_DEL = 0 
						 	 <!-- 下次联系时间是否为空 -->
				  		<!-- <choose>
				  			<when test="dateIsNull == 0">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NULL
		  					</when>
		  				</choose>
		  			</when>
		  			<when test="dateIsNull == 1">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NOT NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NOT NULL
		  					</when>
		  				</choose>
		  			</when>
				  		</choose> -->
						<if test="resIds != null and resIds.size() > 0">
					   		AND T1.RES_CUST_ID IN 
					   			<foreach collection="resIds" item="rid" open="(" separator="," close=")">
					   				#{rid}
					   			</foreach>
					   	</if>
					   	<if test=" companyTrade != null and companyTrade != '' ">
						    AND T1.company_trade = #{companyTrade,jdbcType=VARCHAR}
						</if>
						<choose>
							<when test="ownerAccs!=null and ownerAccs.size() > 0">
								<if test="ownerAccs!=null">
						       		AND T1.OWNER_ACC IN 
									<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
										#{item}
									</foreach>
						        </if>
							</when>
							<otherwise>
								AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
							</otherwise>
						</choose>
						  <if test='custType == "0"'>
						  		AND T1.STATUS IN (2,3,6,7,8) 
						  </if>
						   <if test='custType == "1"'><!-- 资源 -->
								AND T1.STATUS IN (2,3) 
							    AND T1.TYPE in (1,3) 
							   <if test='noteType != null and noteType == "2"'>
							   		AND T1.ACTION_DATE IS NULL 
							   </if>
							   <if test='noteType != null and noteType == "3"'>
							   		AND T1.ACTION_DATE IS NOT NULL 
							   </if>
							   <if test='noteType != null and noteType == "4"'>
							   		<choose>
						       			<when test="ids != null and ids.size() > 0">
						       				AND (
						       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
						       				OR T1.RES_CUST_ID IN <foreach collection="ids" item="item" open="(" separator="," close=")">#{item}</foreach>
						       				)
						       			</when>
						       			<otherwise>
								       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
								       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
						       			</otherwise>
						       		</choose>
							   </if>
							   <if test='noteType != null and noteType == "5"'>
							   		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
							   </if>
							   <if test='noteType != null and noteType == "6"'>
							   		AND T1.IS_PRECEDENCE = 1 
							   </if>
							   <if test='noteType != null and noteType == "7"'>
							   		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
							   </if>
						  </if>
						  <if test='custType == "2"'><!-- 意向客户 -->
						    	AND T1.STATUS IN (2,3)  
						       	AND T1.TYPE = 2 
						       <if test='noteType == "2"'>
						       		AND T1.AMOYTOCUSTOMER_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "3"'>
						       		<choose>
						       			<when test="resCustIds != null and resCustIds.size() > 0">
						       				AND (
						       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
						       				OR T1.RES_CUST_ID IN <foreach collection="resCustIds" item="item" open="(" separator="," close=")">#{item}</foreach>
						       				)
						       			</when>
						       			<otherwise>
								       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
								       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
						       			</otherwise>
						       		</choose>
						       </if>
						       <if test='noteType == "4"'>
						       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "5"'>
						       		AND T1.IS_MAJOR = 1 
						       </if>
						       <if test='noteType == "6"'>
						       		AND T1.ACTION_DATE  >= STR_TO_DATE(CONCAT(DATE_FORMAT(DATE_ADD(CURDATE(),INTERVAL -WEEKDAY(CURDATE())DAY),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "7"'>
						       		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
						       </if>
						       <if test='noteType == "8"'>
						       		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -30 DAY)
						       </if>
						  </if>
						  <if test='custType == "3"'><!-- 签约客户 -->
						    	AND T1.STATUS = 6  
						       <if test='noteType == "2"'>
						        	AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(NOW(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "3"'>
						        	AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(NOW(),'%Y-%m'),'-01 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "4"'>
						        	<choose>
						       			<when test="resCustIds != null and resCustIds.size() > 0">
						       				AND (
						       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
						       				OR T1.RES_CUST_ID IN <foreach collection="resCustIds" item="item" open="(" separator="," close=")">#{item}</foreach>
						       				)
						       			</when>
						       			<otherwise>
								       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
								       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
						       			</otherwise>
						       		</choose>
						       </if>
						       <if test='noteType == "5"'>
						        	AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "6"'>
						        	AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
						       </if>
						       <if test='noteType == "7"'>
						        	AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -30 DAY)
						       </if>
						  </if>
						  <if test='custType == "4"'><!-- 沉默客户 -->
					    	AND T1.STATUS = 7  
						  </if>
						  <if test='custType == "5"'><!-- 流失客户 -->
					    	AND T1.STATUS = 8   
						  </if>
						  <if test='custType == "6"'><!-- 意向客户 签约客户 -->
						  	AND T1.STATUS IN (2,3,6) 
					       	AND T1.TYPE = 2 
						  </if>
					      <if test='resGroupId != null and resGroupId != "" and resGroupId != "0"'>
				       		AND T1.RES_GROUP_ID = #{resGroupId} 
				          </if>
				       	  <if test='resGroupId == "0"'>
				       		AND T1.RES_GROUP_ID IS NULL 
				          </if>
				          <if test="startActionDate != null and startActionDate != ''">
				       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="endActionDate != null and endActionDate != ''">
				       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="pstartDate != null and pstartDate != ''">
				       		AND T1.OWNER_START_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="pendDate != null and pendDate != ''">
				       		AND T1.OWNER_START_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="startNextContactDate != null and startNextContactDate != ''">
					       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{startNextContactDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="endNextContactDate != null and endNextContactDate != ''">
					       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{endNextContactDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					      </if>
					       <if test="startDate != null and startDate != ''">
					       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					       </if>
					       <if test="endDate != null and endDate != ''">
					       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					       </if>
					      <if test="nextFollowDate != null">
					      	AND T1.NEXTFOLLOW_DATE >= STR_TO_DATE(DATE_FORMAT(#{nextFollowDate,jdbcType=TIMESTAMP},'%Y-%m-%d 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		  					AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(DATE_FORMAT(#{nextFollowDate,jdbcType=TIMESTAMP},'%Y-%m-%d 23:59:59'),'%Y-%m-%d %H:%i:%s')
				          </if>
				          <choose>
							<when test="isContact == 1">
								and DATE_FORMAT(T1.OWNER_ACTION_DATE, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')   
							</when>
							<when test="isContact == 0">
								<if test="ids.size() > 0">
									AND T1.RES_CUST_ID NOT IN
									<foreach collection="ids" item="item" open="(" separator="," close=")">
										#{item} 
									</foreach>
								</if>
							</when>
						 </choose>
				         <if test="defined1 != null and defined1 != ''">
							AND T1.defined1 =#{defined1}
						</if>	
						<if test="defined2 != null and defined2 != ''">
							AND T1.defined2 =#{defined2}
						</if>	
						<if test="defined3 != null and defined3 != ''">
							AND T1.defined3 =#{defined3}
						</if>	
						<if test="defined4 != null and defined4 != ''">
							AND T1.defined4 =#{defined4}
						</if>	
						<if test="defined5 != null and defined5 != ''">
							AND T1.defined5 =#{defined5}
						</if>	
						<if test="defined6 != null and defined6 != ''">
							AND T1.defined6 =#{defined6}
						</if>	
						<if test="defined7 != null and defined7 != ''">
							AND T1.defined7 =#{defined7}
						</if>	
						<if test="defined8 != null and defined8 != ''">
							AND T1.defined8 =#{defined8}
						</if>	
						<if test="defined9 != null and defined9 != ''">
							AND T1.defined9 =#{defined9}
						</if>	
						<if test="defined10 != null and defined10 != ''">
							AND T1.defined10 =#{defined10}
						</if>	
						<if test="defined11 != null and defined11 != ''">
							AND T1.defined11 =#{defined11}
						</if>	
						<if test="defined12 != null and defined12 != ''">
							AND T1.defined12 =#{defined12}
						</if>	
						<if test="defined13 != null and defined13 != ''">
							AND T1.defined13 =#{defined13}
						</if>	
						<if test="defined14 != null and defined14 != ''">
							AND T1.defined14 =#{defined14}
						</if>	
						<if test="defined15 != null and defined15 != ''">
							AND T1.defined15 =#{defined15}
						</if>	
				       <if test="startdefined16!= null and startdefined16 !=''">
							AND T1.DEFINED16 >=
							 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if>
						<if test=" enddefined16 != null and enddefined16 !=''">
							AND T1.DEFINED16 <![CDATA[ <= ]]>
							STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if>
						<if test="startdefined17!= null and startdefined17 !=''">
							AND T1.DEFINED17 >=
							 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if>
						<if test="enddefined17 != null and enddefined17 !=''">
							AND T1.DEFINED17 <![CDATA[ <= ]]>
							STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if>	
						<if test="startdefined18!= null and startdefined18 !=''">
							AND T1.DEFINED18 >=
							 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if>
						<if test="enddefined18 != null and enddefined18 !=''">
							AND T1.DEFINED18 <![CDATA[ <= ]]>
							STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if>
					      <if test="isMajor != null">
					       	AND T1.IS_MAJOR = #{isMajor}
					      </if>
					      <if test="saleProcessId != null and saleProcessId != ''">
				       		AND T1.LAST_OPTION_ID = #{saleProcessId} 
				          </if>
				          <if test="custTypeId != null and custTypeId != ''">
				       		AND T1.LAST_CUST_TYPE_ID = #{custTypeId} 
				          </if>
				         <!--  <if test="labels != null and labels!= ''">
					       		<foreach collection="labels" item="label" separator=" " >
					       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
					       		</foreach> 
					       </if> -->
						  <if test="queryText != null and queryText != ''">
					       		<choose>
					       			<when test='queryType != null and queryType == "custName"'>
					       				AND T1.NAME LIKE CONCAT('%',#{queryText},'%') 
					       			</when>
					       			<when test='queryType != null and queryType == "mainLinkman"'>
					       				AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{queryText},'%') 
					       			</when>
					       			<when test='queryType != null and queryType == "company"'>
					       				AND T1.COMPANY LIKE CONCAT('%',#{queryText},'%') 
					       			</when>
					       			<otherwise>
					       				AND T1.${queryType } LIKE CONCAT('%',#{queryText},'%') 
					       			</otherwise>
					       		</choose>
		       			</if>
		       			<!-- 查询结果排除ids by lizhihui-->
					       <if test="rejectIds != null and rejectIds.size()>0">
					       		<foreach collection="rejectIds" item="id">
					       			and T1.RES_CUST_ID !=#{id}
					       		</foreach>
					       </if>
		       			) TRCI	
		       			where TRCI.RES_CUST_ID != #{resCustId}
		       			 <if test=" orderType != null and orderType != '' ">
							<choose>
				      			<when test="orderType == 1">
				       				order by trci.NEXT_ACTION_DATE asc
				      			</when>
				      			<when test="orderType == 2">
				      				order by trci.NEXT_ACTION_DATE desc
				      			</when>
				      			<when test="orderType == 3">
				      				order by trci.ACTION_DATE asc
				      			</when>
				      			<when test="orderType == 4">
				      				order by trci.ACTION_DATE desc
				      			</when>
				      			<when test="orderType == 5">
				      				order by trci.AMOYTOCUSTOMER_DATE asc
				      			</when>
				      			<when test="orderType == 6">
				      				order by trci.AMOYTOCUSTOMER_DATE desc
				      			</when>
			      			</choose>
					  </if>
		       <!-- 			 )tg
                 WHERE 
                 tg.RES_CUST_ID != #{resCustId}
                limit #{startPage},#{endPage}		    -->
	</select>
	
	<!-- 我的客户 全部客户 点击 跟进操作 -->
	<select id="findCustFollowRightByMyAllWithPhoneListPage" resultMap="RestDtoMap" parameterType="com.qftx.tsm.follow.dto.RestDto">
		  		<!-- select tg.RES_CUST_ID,tg.NAME,tg.ACTION_DATE,
		            tg.AMOYTOCUSTOMER_DATE,tg.NEXT_ACTION_DATE,tg.TELPHONE from( -->
		  		select trci.RES_CUST_ID,trci.NAME,trci.ACTION_DATE,
		            trci.AMOYTOCUSTOMER_DATE,trci.NEXT_ACTION_DATE,trci.TELPHONE from(
		  		SELECT 
				    T1.RES_CUST_ID,
			  		T1.NAME,
			  		T1.ACTION_DATE,
		            T1.AMOYTOCUSTOMER_DATE,                                 
			  		T1.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
			   		ifnull(T1.MOBILEPHONE, T1.TELPHONE) TELPHONE
				FROM TSM_RES_CUST_INFO T1
		  		WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
						 	AND T1.IS_DEL = 0 
						 	<!-- 下次联系时间是否为空 -->
				  		<!-- <choose>
				  			<when test="dateIsNull == 0">
				  				<choose>
				  					<when test="orderType == 1 or orderType == 2">
						  				AND T1.NEXTFOLLOW_DATE IS NULL
				  					</when>
				  					<when test="orderType == 3">
				  						AND T1.ACTION_DATE IS NULL
				  					</when>
				  				</choose>
				  			</when>
				  			<when test="dateIsNull == 1">
				  				<choose>
				  					<when test="orderType == 1 or orderType == 2">
						  				AND T1.NEXTFOLLOW_DATE IS NOT NULL
				  					</when>
				  					<when test="orderType == 3">
				  						AND T1.ACTION_DATE IS NOT NULL
				  					</when>
				  				</choose>
				  			</when>
				  		</choose> -->
						<if test="resIds != null and resIds.size() > 0">
					   		AND T1.RES_CUST_ID IN 
					   			<foreach collection="resIds" item="rid" open="(" separator="," close=")">
					   				#{rid}
					   			</foreach>
					   	</if>
						<if test=" companyTrade != null and companyTrade != '' ">
								AND T1.company_trade = #{companyTrade,jdbcType=VARCHAR}
						</if>
						<choose>
							<when test="ownerAccs!=null and ownerAccs.size() > 0">
								<if test="ownerAccs!=null">
						       		AND T1.OWNER_ACC IN 
									<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
										#{item}
									</foreach>
						        </if>
							</when>
							<otherwise>
								AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
							</otherwise>
						</choose>
						  <if test='custType == "0"'>
						  		AND T1.STATUS IN (2,3,6,7,8) 
						  </if>
						   <if test='custType == "1"'><!-- 资源 -->
								AND T1.STATUS IN (2,3) 
							    AND T1.TYPE in (1,3) 
							   <if test='noteType != null and noteType == "2"'>
							   		AND T1.ACTION_DATE IS NULL 
							   </if>
							   <if test='noteType != null and noteType == "3"'>
							   		AND T1.ACTION_DATE IS NOT NULL 
							   </if>
							   <if test='noteType != null and noteType == "4"'>
							   		<choose>
						       			<when test="ids != null and ids.size() > 0">
						       				AND (
						       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
						       				OR T1.RES_CUST_ID IN <foreach collection="ids" item="item" open="(" separator="," close=")">#{item}</foreach>
						       				)
						       			</when>
						       			<otherwise>
								       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
								       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
						       			</otherwise>
						       		</choose>
							   </if>
							   <if test='noteType != null and noteType == "5"'>
							   		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
							   </if>
							   <if test='noteType != null and noteType == "6"'>
							   		AND T1.IS_PRECEDENCE = 1 
							   </if>
							   <if test='noteType != null and noteType == "7"'>
							   		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
							   </if>
						  </if>
						  <if test='custType == "2"'><!-- 意向客户 -->
						    	AND T1.STATUS IN (2,3)  
						       	AND T1.TYPE = 2 
						       <if test='noteType == "2"'>
						       		AND T1.AMOYTOCUSTOMER_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "3"'>
						       		<choose>
						       			<when test="resCustIds != null and resCustIds.size() > 0">
						       				AND (
						       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
						       				OR T1.RES_CUST_ID IN <foreach collection="resCustIds" item="item" open="(" separator="," close=")">#{item}</foreach>
						       				)
						       			</when>
						       			<otherwise>
								       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
								       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
						       			</otherwise>
						       		</choose>
						       </if>
						       <if test='noteType == "4"'>
						       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "5"'>
						       		AND T1.IS_MAJOR = 1 
						       </if>
						       <if test='noteType == "6"'>
						       		AND T1.ACTION_DATE  >= STR_TO_DATE(CONCAT(DATE_FORMAT(DATE_ADD(CURDATE(),INTERVAL -WEEKDAY(CURDATE())DAY),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "7"'>
						       		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
						       </if>
						       <if test='noteType == "8"'>
						       		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -30 DAY)
						       </if>
						  </if>
						  <if test='custType == "3"'><!-- 签约客户 -->
						    	AND T1.STATUS = 6  
						       <if test='noteType == "2"'>
						        	AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(NOW(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "3"'>
						        	AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(NOW(),'%Y-%m'),'-01 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "4"'>
						        	<choose>
						       			<when test="resCustIds != null and resCustIds.size() > 0">
						       				AND (
						       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
						       				OR T1.RES_CUST_ID IN <foreach collection="resCustIds" item="item" open="(" separator="," close=")">#{item}</foreach>
						       				)
						       			</when>
						       			<otherwise>
								       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
								       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
						       			</otherwise>
						       		</choose>
						       </if>
						       <if test='noteType == "5"'>
						        	AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "6"'>
						        	AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
						       </if>
						       <if test='noteType == "7"'>
						        	AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -30 DAY)
						       </if>
						  </if>
						  <if test='custType == "4"'><!-- 沉默客户 -->
					    	AND T1.STATUS = 7  
						  </if>
						  <if test='custType == "5"'><!-- 流失客户 -->
					    	AND T1.STATUS = 8   
						  </if>
						  <if test='custType == "6"'><!-- 意向客户 签约客户 -->
						  	AND T1.STATUS IN (2,3,6) 
					       	AND T1.TYPE = 2 
						  </if>
					      <if test='resGroupId != null and resGroupId != "" and resGroupId != "0"'>
				       		AND T1.RES_GROUP_ID = #{resGroupId} 
				          </if>
				       	  <if test='resGroupId == "0"'>
				       		AND T1.RES_GROUP_ID IS NULL 
				          </if>
				          <if test="startActionDate != null and startActionDate != ''">
				       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="endActionDate != null and endActionDate != ''">
				       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="pstartDate != null and pstartDate != ''">
				       		AND T1.OWNER_START_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="pendDate != null and pendDate != ''">
				       		AND T1.OWNER_START_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="startNextContactDate != null and startNextContactDate != ''">
					       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{startNextContactDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="endNextContactDate != null and endNextContactDate != ''">
					       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{endNextContactDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					      </if>
					       <if test="startDate != null and startDate != ''">
					       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					       </if>
					       <if test="endDate != null and endDate != ''">
					       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					       </if>
					      <if test="nextFollowDate != null">
					      	AND T1.NEXTFOLLOW_DATE >= STR_TO_DATE(DATE_FORMAT(#{nextFollowDate,jdbcType=TIMESTAMP},'%Y-%m-%d 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		  					AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(DATE_FORMAT(#{nextFollowDate,jdbcType=TIMESTAMP},'%Y-%m-%d 23:59:59'),'%Y-%m-%d %H:%i:%s')
				          </if>
				          <choose>
							<when test="isContact == 1">
								and DATE_FORMAT(T1.OWNER_ACTION_DATE, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')   
							</when>
							<when test="isContact == 0">
								<if test="ids.size() > 0">
									AND T1.RES_CUST_ID NOT IN
									<foreach collection="ids" item="item" open="(" separator="," close=")">
										#{item} 
									</foreach>
								</if>
							</when>
						</choose>	
				         <if test="defined1 != null and defined1 != ''">
							AND T1.defined1 =#{defined1}
						</if>	
						<if test="defined2 != null and defined2 != ''">
							AND T1.defined2 =#{defined2}
						</if>	
						<if test="defined3 != null and defined3 != ''">
							AND T1.defined3 =#{defined3}
						</if>	
						<if test="defined4 != null and defined4 != ''">
							AND T1.defined4 =#{defined4}
						</if>	
						<if test="defined5 != null and defined5 != ''">
							AND T1.defined5 =#{defined5}
						</if>	
						<if test="defined6 != null and defined6 != ''">
							AND T1.defined6 =#{defined6}
						</if>	
						<if test="defined7 != null and defined7 != ''">
							AND T1.defined7 =#{defined7}
						</if>	
						<if test="defined8 != null and defined8 != ''">
							AND T1.defined8 =#{defined8}
						</if>	
						<if test="defined9 != null and defined9 != ''">
							AND T1.defined9 =#{defined9}
						</if>	
						<if test="defined10 != null and defined10 != ''">
							AND T1.defined10 =#{defined10}
						</if>	
						<if test="defined11 != null and defined11 != ''">
							AND T1.defined11 =#{defined11}
						</if>	
						<if test="defined12 != null and defined12 != ''">
							AND T1.defined12 =#{defined12}
						</if>	
						<if test="defined13 != null and defined13 != ''">
							AND T1.defined13 =#{defined13}
						</if>	
						<if test="defined14 != null and defined14 != ''">
							AND T1.defined14 =#{defined14}
						</if>	
						<if test="defined15 != null and defined15 != ''">
							AND T1.defined15 =#{defined15}
						</if>	
				       <if test="startdefined16!= null and startdefined16 !=''">
							AND T1.DEFINED16 >=
							 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if>
						<if test=" enddefined16 != null and enddefined16 !=''">
							AND T1.DEFINED16 <![CDATA[ <= ]]>
							STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if>
						<if test="startdefined17!= null and startdefined17 !=''">
							AND T1.DEFINED17 >=
							 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if>
						<if test="enddefined17 != null and enddefined17 !=''">
							AND T1.DEFINED17 <![CDATA[ <= ]]>
							STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if>	
						<if test="startdefined18!= null and startdefined18 !=''">
							AND T1.DEFINED18 >=
							 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if>
						<if test="enddefined18 != null and enddefined18 !=''">
							AND T1.DEFINED18 <![CDATA[ <= ]]>
							STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if>
					      <if test="isMajor != null">
					       	AND T1.IS_MAJOR = #{isMajor}
					      </if>
					      <if test="saleProcessId != null and saleProcessId != ''">
				       		AND T1.LAST_OPTION_ID = #{saleProcessId} 
				          </if>
				          <if test="custTypeId != null and custTypeId != ''">
				       		AND T1.LAST_CUST_TYPE_ID = #{custTypeId} 
				          </if>
				          <!-- <if test="labels != null and labels!= ''">
					       		<foreach collection="labels" item="label" separator=" " >
					       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
					       		</foreach> 
					       </if> -->
						  <if test="queryText != null and queryText != ''">
					       		<choose>
					       			<when test='queryType != null and queryType == "mobilephone"'>
					       				AND T1.mobilephone = #{queryText} 
					       			</when>
					       		</choose>
		       			</if>
		       			<!-- 查询结果排除ids by lizhihui-->
					       <if test="rejectIds != null and rejectIds.size()>0">
					       		<foreach collection="rejectIds" item="id">
					       			and T1.RES_CUST_ID !=#{id}
					       		</foreach>
					       </if>
					       <if test="queryText != null and queryText != '' and queryType != null and queryType == 'mobilephone' and (state == null or state == 0)">
					       union
					       SELECT 
				    T1.RES_CUST_ID,
			  		T1.NAME,
			  		T1.ACTION_DATE,
		            T1.AMOYTOCUSTOMER_DATE,                                 
			  		T1.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
			   		ifnull(T1.MOBILEPHONE, T1.TELPHONE) TELPHONE
				FROM TSM_RES_CUST_INFO T1
		  		WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
						 	AND T1.IS_DEL = 0 
						 	<!-- 下次联系时间是否为空 -->
				  		<!-- <choose>
				  			<when test="dateIsNull == 0">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NULL
		  					</when>
		  				</choose>
		  			</when>
		  			<when test="dateIsNull == 1">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NOT NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NOT NULL
		  					</when>
		  				</choose>
		  			</when>
				  		</choose> -->
						<if test="resIds != null and resIds.size() > 0">
					   		AND T1.RES_CUST_ID IN 
					   			<foreach collection="resIds" item="rid" open="(" separator="," close=")">
					   				#{rid}
					   			</foreach>
					   	</if>
					   	<if test=" companyTrade != null and companyTrade != '' ">
								AND T1.company_trade = #{companyTrade,jdbcType=VARCHAR}
						</if>
						<choose>
							<when test="ownerAccs!=null and ownerAccs.size() > 0">
								<if test="ownerAccs!=null">
						       		AND T1.OWNER_ACC IN 
									<foreach collection="ownerAccs" item="item" index="index" open="(" separator="," close=")">
										#{item}
									</foreach>
						        </if>
							</when>
							<otherwise>
								AND T1.OWNER_ACC = #{ownerAcc,jdbcType=VARCHAR} 
							</otherwise>
						</choose>
						  <if test='custType == "0"'>
						  		AND T1.STATUS IN (2,3,6,7,8) 
						  </if>
						   <if test='custType == "1"'><!-- 资源 -->
								AND T1.STATUS IN (2,3) 
							    AND T1.TYPE in (1,3) 
							   <if test='noteType != null and noteType == "2"'>
							   		AND T1.ACTION_DATE IS NULL 
							   </if>
							   <if test='noteType != null and noteType == "3"'>
							   		AND T1.ACTION_DATE IS NOT NULL 
							   </if>
							   <if test='noteType != null and noteType == "4"'>
							   		<choose>
						       			<when test="ids != null and ids.size() > 0">
						       				AND (
						       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
						       				OR T1.RES_CUST_ID IN <foreach collection="ids" item="item" open="(" separator="," close=")">#{item}</foreach>
						       				)
						       			</when>
						       			<otherwise>
								       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
								       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
						       			</otherwise>
						       		</choose>
							   </if>
							   <if test='noteType != null and noteType == "5"'>
							   		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
							   </if>
							   <if test='noteType != null and noteType == "6"'>
							   		AND T1.IS_PRECEDENCE = 1 
							   </if>
							   <if test='noteType != null and noteType == "7"'>
							   		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
							   </if>
						  </if>
						  <if test='custType == "2"'><!-- 意向客户 -->
						    	AND T1.STATUS IN (2,3)  
						       	AND T1.TYPE = 2 
						       <if test='noteType == "2"'>
						       		AND T1.AMOYTOCUSTOMER_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "3"'>
						       		<choose>
						       			<when test="resCustIds != null and resCustIds.size() > 0">
						       				AND (
						       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
						       				OR T1.RES_CUST_ID IN <foreach collection="resCustIds" item="item" open="(" separator="," close=")">#{item}</foreach>
						       				)
						       			</when>
						       			<otherwise>
								       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
								       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
						       			</otherwise>
						       		</choose>
						       </if>
						       <if test='noteType == "4"'>
						       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "5"'>
						       		AND T1.IS_MAJOR = 1 
						       </if>
						       <if test='noteType == "6"'>
						       		AND T1.ACTION_DATE  >= STR_TO_DATE(CONCAT(DATE_FORMAT(DATE_ADD(CURDATE(),INTERVAL -WEEKDAY(CURDATE())DAY),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "7"'>
						       		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
						       </if>
						       <if test='noteType == "8"'>
						       		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -30 DAY)
						       </if>
						  </if>
						  <if test='custType == "3"'><!-- 签约客户 -->
						    	AND T1.STATUS = 6  
						       <if test='noteType == "2"'>
						        	AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(NOW(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "3"'>
						        	AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(NOW(),'%Y-%m'),'-01 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "4"'>
						        	<choose>
						       			<when test="resCustIds != null and resCustIds.size() > 0">
						       				AND (
						       				T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       				AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s')
						       				OR T1.RES_CUST_ID IN <foreach collection="resCustIds" item="item" open="(" separator="," close=")">#{item}</foreach>
						       				)
						       			</when>
						       			<otherwise>
								       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
								       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
						       			</otherwise>
						       		</choose>
						       </if>
						       <if test='noteType == "5"'>
						        	AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
						       </if>
						       <if test='noteType == "6"'>
						        	AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
						       </if>
						       <if test='noteType == "7"'>
						        	AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -30 DAY)
						       </if>
						  </if>
						  <if test='custType == "4"'><!-- 沉默客户 -->
					    	AND T1.STATUS = 7  
						  </if>
						  <if test='custType == "5"'><!-- 流失客户 -->
					    	AND T1.STATUS = 8   
						  </if>
						  <if test='custType == "6"'><!-- 意向客户 签约客户 -->
						  	AND T1.STATUS IN (2,3,6) 
					       	AND T1.TYPE = 2 
						  </if>
					      <if test='resGroupId != null and resGroupId != "" and resGroupId != "0"'>
				       		AND T1.RES_GROUP_ID = #{resGroupId} 
				          </if>
				       	  <if test='resGroupId == "0"'>
				       		AND T1.RES_GROUP_ID IS NULL 
				          </if>
				          <if test="startActionDate != null and startActionDate != ''">
				       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="endActionDate != null and endActionDate != ''">
				       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="pstartDate != null and pstartDate != ''">
				       		AND T1.OWNER_START_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="pendDate != null and pendDate != ''">
				       		AND T1.OWNER_START_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="startNextContactDate != null and startNextContactDate != ''">
					       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{startNextContactDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					      </if>
					      <if test="endNextContactDate != null and endNextContactDate != ''">
					       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{endNextContactDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					      </if>
					       <if test="startDate != null and startDate != ''">
					       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
					       </if>
					       <if test="endDate != null and endDate != ''">
					       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
					       </if>
					      <if test="nextFollowDate != null">
					      	AND T1.NEXTFOLLOW_DATE >= STR_TO_DATE(DATE_FORMAT(#{nextFollowDate,jdbcType=TIMESTAMP},'%Y-%m-%d 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		  					AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(DATE_FORMAT(#{nextFollowDate,jdbcType=TIMESTAMP},'%Y-%m-%d 23:59:59'),'%Y-%m-%d %H:%i:%s')
				          </if>
				          <choose>
							<when test="isContact == 1">
								and DATE_FORMAT(T1.OWNER_ACTION_DATE, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')   
							</when>
							<when test="isContact == 0">
								<if test="ids.size() > 0">
									AND T1.RES_CUST_ID NOT IN
									<foreach collection="ids" item="item" open="(" separator="," close=")">
										#{item} 
									</foreach>
								</if>
							</when>
						</choose>
				         <if test="defined1 != null and defined1 != ''">
							AND T1.defined1 =#{defined1}
						</if>	
						<if test="defined2 != null and defined2 != ''">
							AND T1.defined2 =#{defined2}
						</if>	
						<if test="defined3 != null and defined3 != ''">
							AND T1.defined3 =#{defined3}
						</if>	
						<if test="defined4 != null and defined4 != ''">
							AND T1.defined4 =#{defined4}
						</if>	
						<if test="defined5 != null and defined5 != ''">
							AND T1.defined5 =#{defined5}
						</if>	
						<if test="defined6 != null and defined6 != ''">
							AND T1.defined6 =#{defined6}
						</if>	
						<if test="defined7 != null and defined7 != ''">
							AND T1.defined7 =#{defined7}
						</if>	
						<if test="defined8 != null and defined8 != ''">
							AND T1.defined8 =#{defined8}
						</if>	
						<if test="defined9 != null and defined9 != ''">
							AND T1.defined9 =#{defined9}
						</if>	
						<if test="defined10 != null and defined10 != ''">
							AND T1.defined10 =#{defined10}
						</if>	
						<if test="defined11 != null and defined11 != ''">
							AND T1.defined11 =#{defined11}
						</if>	
						<if test="defined12 != null and defined12 != ''">
							AND T1.defined12 =#{defined12}
						</if>	
						<if test="defined13 != null and defined13 != ''">
							AND T1.defined13 =#{defined13}
						</if>	
						<if test="defined14 != null and defined14 != ''">
							AND T1.defined14 =#{defined14}
						</if>	
						<if test="defined15 != null and defined15 != ''">
							AND T1.defined15 =#{defined15}
						</if>	
				       <if test="startdefined16!= null and startdefined16 !=''">
							AND T1.DEFINED16 >=
							 STR_TO_DATE(CONCAT(#{startdefined16,jdbcType=VARCHAR}, '00:00:00'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if>
						<if test=" enddefined16 != null and enddefined16 !=''">
							AND T1.DEFINED16 <![CDATA[ <= ]]>
							STR_TO_DATE(CONCAT(#{enddefined16,jdbcType=VARCHAR}, '23:59:59'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if>
						<if test="startdefined17!= null and startdefined17 !=''">
							AND T1.DEFINED17 >=
							 STR_TO_DATE(CONCAT(#{startdefined17,jdbcType=VARCHAR}, '00:00:00'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if>
						<if test="enddefined17 != null and enddefined17 !=''">
							AND T1.DEFINED17 <![CDATA[ <= ]]>
							STR_TO_DATE(CONCAT(#{enddefined17,jdbcType=VARCHAR}, '23:59:59'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if>	
						<if test="startdefined18!= null and startdefined18 !=''">
							AND T1.DEFINED18 >=
							 STR_TO_DATE(CONCAT(#{startdefined18,jdbcType=VARCHAR}, '00:00:00'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if>
						<if test="enddefined18 != null and enddefined18 !=''">
							AND T1.DEFINED18 <![CDATA[ <= ]]>
							STR_TO_DATE(CONCAT(#{enddefined18,jdbcType=VARCHAR}, '23:59:59'),
				                                       '%Y-%m-%d %H:%i:%s')
						</if>
					      <if test="isMajor != null">
					       	AND T1.IS_MAJOR = #{isMajor}
					      </if>
					      <if test="saleProcessId != null and saleProcessId != ''">
				       		AND T1.LAST_OPTION_ID = #{saleProcessId} 
				          </if>
				          <if test="custTypeId != null and custTypeId != ''">
				       		AND T1.LAST_CUST_TYPE_ID = #{custTypeId} 
				          </if>
				         <!--  <if test="labels != null and labels!= ''">
					       		<foreach collection="labels" item="label" separator=" " >
					       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
					       		</foreach> 
					       </if> -->
						  <if test="queryText != null and queryText != ''">
					       		<choose>
					       			<when test='queryType != null and queryType == "mobilephone"'>
					       				AND T1.telphone = #{queryText} 
					       			</when>
					       		</choose>
		       			</if>
		       			<!-- 查询结果排除ids by lizhihui-->
					       <if test="rejectIds != null and rejectIds.size()>0">
					       		<foreach collection="rejectIds" item="id">
					       			and T1.RES_CUST_ID !=#{id}
					       		</foreach>
					       </if>
					       </if>
		       			) TRCI	
		       			where TRCI.RES_CUST_ID != #{resCustId}
		       			 <if test=" orderType != null and orderType != '' ">
							<choose>
				      			<when test="orderType == 1">
				       				order by trci.NEXT_ACTION_DATE asc
				      			</when>
				      			<when test="orderType == 2">
				      				order by trci.NEXT_ACTION_DATE desc
				      			</when>
				      			<when test="orderType == 3">
				      				order by trci.ACTION_DATE asc
				      			</when>
				      			<when test="orderType == 4">
				      				order by trci.ACTION_DATE desc
				      			</when>
				      			<when test="orderType == 5">
				      				order by trci.AMOYTOCUSTOMER_DATE asc
				      			</when>
				      			<when test="orderType == 6">
				      				order by trci.AMOYTOCUSTOMER_DATE desc
				      			</when>
			      			</choose>
					  </if>
		       <!-- 			 )tg
                 WHERE 
                 tg.RES_CUST_ID != #{resCustId}
                limit #{startPage},#{endPage}	 -->	   
	</select>
	
	<!-- 我的客户 共有客户 点击 跟进操作 -->
	<select id="findCustFollowRightByMyComWithPhoneListPage" resultMap="RestDtoMap" parameterType="com.qftx.tsm.follow.dto.RestDto">
		SELECT
	  		TRCI.RES_CUST_ID,
		    TRCI.NAME,  
			TRCI.ACTION_DATE,
          	TRCI.AMOYTOCUSTOMER_DATE,                            
		    TRCI.NEXT_ACTION_DATE,
		    TRCI.TELPHONE
		    from
		(SELECT
	  		T1.RES_CUST_ID,
		    T1.NAME,  
			T1.ACTION_DATE,
          	T1.AMOYTOCUSTOMER_DATE,                            
		    T1.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
		    ifnull(T1.MOBILEPHONE, T1.TELPHONE) TELPHONE
		FROM TSM_RES_CUST_INFO T1
		  	WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
			   AND T1.TYPE = 2 
			    AND T1.IS_DEL = 0 
			   AND T1.COMMON_ACC = #{commonAcc} 
			   <choose>
			   		<when test='custType == "2"'>
			   			AND T1.STATUS IN (2,3) 
			   		</when>
			   		<when test='custType == "3"'>
			   			AND T1.STATUS = 6  
			   		</when>
			   		<otherwise>
			   			AND T1.STATUS IN (2,3,6) 
			   		</otherwise>
			   </choose>
			    <!-- 下次联系时间是否为空 -->
		  		<!-- <choose>
		  			<when test="dateIsNull == 0">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NULL
		  					</when>
		  				</choose>
		  			</when>
		  			<when test="dateIsNull == 1">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NOT NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NOT NULL
		  					</when>
		  				</choose>
		  			</when>
		  		</choose> -->
			    <if test="resIds != null and resIds.size() > 0">
			   		AND T1.RES_CUST_ID IN 
			   			<foreach collection="resIds" item="rid" open="(" separator="," close=")">
			   				#{rid}
			   			</foreach>
			   </if>
			   <if test=" companyTrade != null and companyTrade != '' ">
				    AND T1.company_trade = #{companyTrade,jdbcType=VARCHAR}
				</if>
			   <if test="commonAccs != null and commonAccs.size() > 0">
					AND T1.OWNER_ACC IN 
						<foreach collection="commonAccs" item="ca" open="(" separator="," close=")">
							#{ca} 
						</foreach>
			   </if>
			   <if test="custTypeId != null and custTypeId != ''">
		       		AND T1.LAST_CUST_TYPE_ID = #{custTypeId,jdbcType=VARCHAR} 
		       </if>
		       <if test="saleProcessId != null and saleProcessId != ''">
		       		AND T1.LAST_OPTION_ID = #{saleProcessId,jdbcType=VARCHAR}
		       </if>
		       <if test="resGroupId != null and resGroupId != ''">
		       		AND T1.RES_GROUP_ID = #{resGroupId,jdbcType=VARCHAR} 
		       </if>
		       <if test="startActionDate != null and startActionDate != ''">
		       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test="endActionDate != null and endActionDate != ''">
		       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="startDate != null and startDate != ''">
		       		AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="endDate != null and endDate != ''">
		       		AND T1.SIGN_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
	         	<if test="pstartDate != null and pstartDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="pendDate != null and pendDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test='lDateType != null and lDateType == "6"'>
		       		AND T1.ACTION_DATE IS NULL 
		       </if>
		       <if test='oDateType != null and oDateType == "6"'>
		       		AND T1.NEXTFOLLOW_DATE IS NULL 
		       </if>
		       <if test='noteType == "2"'>
		       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "3"'>
		       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "4"'>
		       		AND T1.ACTION_DATE  >= STR_TO_DATE(CONCAT(DATE_FORMAT(DATE_ADD(CURDATE(),INTERVAL -WEEKDAY(CURDATE())DAY),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test='noteType == "5"'>
		       		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
		       </if>
		       <if test='noteType == "6"'>
		       		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -30 DAY) 
		       </if>
		        <choose>
					<when test="isContact == 1">
						and DATE_FORMAT(T1.OWNER_ACTION_DATE, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')   
					</when>
					<when test="isContact == 0">
						<if test="ids.size() > 0">
							AND T1.RES_CUST_ID NOT IN
							<foreach collection="ids" item="item" open="(" separator="," close=")">
								#{item} 
							</foreach>
						</if>
					</when>
				</choose>
		     <!--   <if test="labels != null and labels.size() > 0">
		       		<foreach collection="labels" item="label" separator=" " >
		       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
		       		</foreach> 
		       </if> -->
	         <if test="queryText != null and queryText != ''">
		       		<choose>
		       			<when test='queryType != null and queryType == "3" and (state == null or state == 0)'>
		       				AND T1.mobilephone =  #{queryText} 
		       			</when>
		       		</choose>
      		</if>
      		union
      		SELECT
      		T1.RES_CUST_ID,
		    T1.NAME,  
			T1.ACTION_DATE,
          	T1.AMOYTOCUSTOMER_DATE,                            
		    T1.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
		    ifnull(T1.MOBILEPHONE, T1.TELPHONE) TELPHONE
		FROM TSM_RES_CUST_INFO T1
		  	WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
			   AND T1.TYPE = 2 
			    AND T1.IS_DEL = 0 
			   AND T1.COMMON_ACC = #{commonAcc} 
			   <choose>
			   		<when test='custType == "2"'>
			   			AND T1.STATUS IN (2,3) 
			   		</when>
			   		<when test='custType == "3"'>
			   			AND T1.STATUS = 6  
			   		</when>
			   		<otherwise>
			   			AND T1.STATUS IN (2,3,6) 
			   		</otherwise>
			   </choose>
			    <!-- 下次联系时间是否为空 -->
		  		<!-- <choose>
		  			<when test="dateIsNull == 0">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NULL
		  					</when>
		  				</choose>
		  			</when>
		  			<when test="dateIsNull == 1">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NOT NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NOT NULL
		  					</when>
		  				</choose>
		  			</when>
		  		</choose> -->
			    <if test="resIds != null and resIds.size() > 0">
			   		AND T1.RES_CUST_ID IN 
			   			<foreach collection="resIds" item="rid" open="(" separator="," close=")">
			   				#{rid}
			   			</foreach>
			   </if>
			   <if test=" companyTrade != null and companyTrade != '' ">
				    AND T1.company_trade = #{companyTrade,jdbcType=VARCHAR}
				</if>
			   <if test="commonAccs != null and commonAccs.size() > 0">
					AND T1.OWNER_ACC IN 
						<foreach collection="commonAccs" item="ca" open="(" separator="," close=")">
							#{ca} 
						</foreach>
			   </if>
			   <if test="custTypeId != null and custTypeId != ''">
		       		AND T1.LAST_CUST_TYPE_ID = #{custTypeId,jdbcType=VARCHAR} 
		       </if>
		       <if test="saleProcessId != null and saleProcessId != ''">
		       		AND T1.LAST_OPTION_ID = #{saleProcessId,jdbcType=VARCHAR}
		       </if>
		       <if test="resGroupId != null and resGroupId != ''">
		       		AND T1.RES_GROUP_ID = #{resGroupId,jdbcType=VARCHAR} 
		       </if>
		       <if test="startActionDate != null and startActionDate != ''">
		       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test="endActionDate != null and endActionDate != ''">
		       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="startDate != null and startDate != ''">
		       		AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="endDate != null and endDate != ''">
		       		AND T1.SIGN_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
	         	<if test="pstartDate != null and pstartDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="pendDate != null and pendDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test='lDateType != null and lDateType == "6"'>
		       		AND T1.ACTION_DATE IS NULL 
		       </if>
		       <if test='oDateType != null and oDateType == "6"'>
		       		AND T1.NEXTFOLLOW_DATE IS NULL 
		       </if>
		       <if test='noteType == "2"'>
		       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "3"'>
		       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "4"'>
		       		AND T1.ACTION_DATE  >= STR_TO_DATE(CONCAT(DATE_FORMAT(DATE_ADD(CURDATE(),INTERVAL -WEEKDAY(CURDATE())DAY),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test='noteType == "5"'>
		       		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
		       </if>
		       <if test='noteType == "6"'>
		       		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -30 DAY) 
		       </if>
		       <choose>
					<when test="isContact == 1">
						and DATE_FORMAT(T1.OWNER_ACTION_DATE, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')   
					</when>
					<when test="isContact == 0">
						<if test="ids.size() > 0">
							AND T1.RES_CUST_ID NOT IN
							<foreach collection="ids" item="item" open="(" separator="," close=")">
								#{item} 
							</foreach>
						</if>
					</when>
				</choose>
		     <!--   <if test="labels != null and labels.size() > 0">
		       		<foreach collection="labels" item="label" separator=" " >
		       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
		       		</foreach> 
		       </if> -->
	         <if test="queryText != null and queryText != ''">
		       		<choose>
		       			<when test='queryType != null and queryType == "3" and (state == null or state == 0)'>
		       				AND T1.telphone =  #{queryText} 
		       			</when>
		       		</choose>
      		</if>
      		 )TRCI
			   WHERE 
                 TRCI.RES_CUST_ID != #{resCustId}
                 <if test=" orderType != null and orderType != '' ">
					<choose>
		      			<when test="orderType == 1">
		       				order by trci.NEXT_ACTION_DATE asc
		      			</when>
		      			<when test="orderType == 2">
		      				order by trci.NEXT_ACTION_DATE desc
		      			</when>
		      			<when test="orderType == 3">
		      				order by trci.ACTION_DATE asc
		      			</when>
		      			<when test="orderType == 4">
		      				order by trci.ACTION_DATE desc
		      			</when>
		      			<when test="orderType == 5">
		      				order by trci.AMOYTOCUSTOMER_DATE asc
		      			</when>
		      			<when test="orderType == 6">
		      				order by trci.AMOYTOCUSTOMER_DATE desc
		      			</when>
	      			</choose>
			  </if>
                <!-- limit #{startPage},#{endPage}	 -->	 
	</select>
	
	<!-- 我的客户 共有客户 点击 跟进操作 -->
	<select id="findCustFollowRightByMyComListPage" resultMap="RestDtoMap" parameterType="com.qftx.tsm.follow.dto.RestDto">
		SELECT
	  		T1.RES_CUST_ID,
		    T1.NAME,  
			T1.ACTION_DATE,
          	T1.AMOYTOCUSTOMER_DATE,                            
		    T1.NEXTFOLLOW_DATE as NEXT_ACTION_DATE,
		    ifnull(T1.MOBILEPHONE, T1.TELPHONE) TELPHONE
		FROM TSM_RES_CUST_INFO T1
		  	WHERE T1.ORG_ID = #{orgId,jdbcType=VARCHAR} 
			   AND T1.TYPE = 2 
			    AND T1.IS_DEL = 0 
			   AND T1.COMMON_ACC = #{commonAcc} 
			    <!-- 下次联系时间是否为空 -->
		  		<!-- <choose>
		  			<when test="dateIsNull == 0">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NULL
		  					</when>
		  				</choose>
		  			</when>
		  			<when test="dateIsNull == 1">
		  				<choose>
		  					<when test="orderType == 1 or orderType == 2">
				  				AND T1.NEXTFOLLOW_DATE IS NOT NULL
		  					</when>
		  					<when test="orderType == 3">
		  						AND T1.ACTION_DATE IS NOT NULL
		  					</when>
		  				</choose>
		  			</when>
		  		</choose> -->
			   <if test="resIds != null and resIds.size() > 0">
			   		AND T1.RES_CUST_ID IN 
			   			<foreach collection="resIds" item="rid" open="(" separator="," close=")">
			   				#{rid}
			   			</foreach>
			   </if>
			   <if test=" companyTrade != null and companyTrade != '' ">
				    AND T1.company_trade = #{companyTrade,jdbcType=VARCHAR}
				</if>
			   <choose>
			   		<when test='custType == "2"'>
			   			AND T1.STATUS IN (2,3) 
			   		</when>
			   		<when test='custType == "3"'>
			   			AND T1.STATUS = 6  
			   		</when>
			   		<otherwise>
			   			AND T1.STATUS IN (2,3,6) 
			   		</otherwise>
			   </choose>
			   <if test="commonAccs != null and commonAccs.size() > 0">
					AND T1.OWNER_ACC IN 
						<foreach collection="commonAccs" item="ca" open="(" separator="," close=")">
							#{ca} 
						</foreach>
			   </if>
			   <if test="custTypeId != null and custTypeId != ''">
		       		AND T1.LAST_CUST_TYPE_ID = #{custTypeId,jdbcType=VARCHAR} 
		       </if>
		       <if test="saleProcessId != null and saleProcessId != ''">
		       		AND T1.LAST_OPTION_ID = #{saleProcessId,jdbcType=VARCHAR}
		       </if>
		       <if test="resGroupId != null and resGroupId != ''">
		       		AND T1.RES_GROUP_ID = #{resGroupId,jdbcType=VARCHAR} 
		       </if>
		       <if test="startActionDate != null and startActionDate != ''">
		       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(#{startActionDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test="endActionDate != null and endActionDate != ''">
		       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(#{endActionDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="startDate != null and startDate != ''">
		       		AND T1.SIGN_DATE &gt;= STR_TO_DATE(CONCAT(#{startDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="endDate != null and endDate != ''">
		       		AND T1.SIGN_DATE &lt;= STR_TO_DATE(CONCAT(#{endDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
	         	<if test="pstartDate != null and pstartDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(#{pstartDate},' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test="pendDate != null and pendDate != ''">
		       		AND T1.NEXTFOLLOW_DATE &lt;= STR_TO_DATE(CONCAT(#{pendDate},' 23:59:59'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test='lDateType != null and lDateType == "6"'>
		       		AND T1.ACTION_DATE IS NULL 
		       </if>
		       <if test='oDateType != null and oDateType == "6"'>
		       		AND T1.NEXTFOLLOW_DATE IS NULL 
		       </if>
		       <if test='noteType == "2"'>
		       		AND T1.ACTION_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       		AND T1.ACTION_DATE &lt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 23:59:59'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "3"'>
		       		AND T1.NEXTFOLLOW_DATE &gt;= STR_TO_DATE(CONCAT(DATE_FORMAT(now(),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s') 
		       </if>
		       <if test='noteType == "4"'>
		       		AND T1.ACTION_DATE  >= STR_TO_DATE(CONCAT(DATE_FORMAT(DATE_ADD(CURDATE(),INTERVAL -WEEKDAY(CURDATE())DAY),'%Y-%m-%d'),' 00:00:00'),'%Y-%m-%d %H:%i:%s')
		       </if>
		       <if test='noteType == "5"'>
		       		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -7 DAY)
		       </if>
		       <if test='noteType == "6"'>
		       		AND T1.ACTION_DATE &lt;= DATE_ADD(NOW(),INTERVAL -30 DAY) 
		       </if>
		        <choose>
					<when test="isContact == 1">
						and DATE_FORMAT(T1.OWNER_ACTION_DATE, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')   
					</when>
					<when test="isContact == 0">
						<if test="ids.size() > 0">
							AND T1.RES_CUST_ID NOT IN
							<foreach collection="ids" item="item" open="(" separator="," close=")">
								#{item} 
							</foreach>
						</if>
					</when>
				</choose>
		     <!--   <if test="labels != null and labels.size() > 0">
		       		<foreach collection="labels" item="label" separator=" " >
		       			AND T1.LABEL_CODE LIKE CONCAT('%',#{label},'%') 
		       		</foreach> 
		       </if> -->
             AND T1.RES_CUST_ID != #{resCustId}
	        <if test="queryText != null and queryText != ''">
	       		<choose>
	       			<when test='queryType != null and queryType == "1"'>
	       				AND T1.NAME LIKE CONCAT('%',#{queryText},'%') 
	       			</when>
	       			<when test='queryType != null and queryType == "2" and (state == null or state == 0)'>
	       				AND T1.MAIN_LINKMAN LIKE CONCAT('%',#{queryText},'%') 
	       			</when>
	       			<when test='queryType != null and queryType == "4"'>
	       				AND T1.COMPANY LIKE CONCAT('%',#{queryText},'%') 
	       			</when>
	       			<otherwise>
	       				AND T1.${queryType } LIKE CONCAT('%',#{queryText},'%') 
	       			</otherwise>
	       		</choose>
	         </if>
      		 <if test=" orderType != null and orderType != '' ">
					<choose>
		      			<when test="orderType == 1">
		       				order by T1.NEXTFOLLOW_DATE asc
		      			</when>
		      			<when test="orderType == 2">
		      				order by T1.NEXT_ACTION_DATE desc
		      			</when>
		      			<when test="orderType == 3">
		      				order by T1.ACTION_DATE asc
		      			</when>
		      			<when test="orderType == 4">
		      				order by T1.ACTION_DATE desc
		      			</when>
		      			<when test="orderType == 5">
		      				order by T1.AMOYTOCUSTOMER_DATE asc
		      			</when>
		      			<when test="orderType == 6">
		      				order by T1.AMOYTOCUSTOMER_DATE desc
		      			</when>
	      			</choose>
			  </if>
                <!-- limit #{startPage},#{endPage} -->		 
	</select>
	
</mapper>